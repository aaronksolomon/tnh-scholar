
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../docs/planning/maintenance/">
      
      
        <link rel="next" href="../design_guide/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>API Reference - TNH Scholar Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TNH Scholar Documentation" class="md-header__button md-logo" aria-label="TNH Scholar Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TNH Scholar Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aaronksolomon/tnh-scholar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TNH Scholar Documentation" class="md-nav__button md-logo" aria-label="TNH Scholar Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TNH Scholar Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aaronksolomon/tnh-scholar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/installation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/getting-started.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            CLI Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/audio-transcribe.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    audio-transcribe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/tnh-fab.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tnh-fab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/ytt-fetch.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ytt-fetch
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Design
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docs/design/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Planning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docs/planning/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docs/planning/maintenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tnh_scholar" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_scholar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_scholar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.CLI_TOOLS_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      CLI_TOOLS_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.DEFAULT_PATTERN_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PATTERN_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.PROJECT_ROOT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      PROJECT_ROOT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.TNH_ROOT_SRC_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      TNH_ROOT_SRC_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.__version__" class="md-nav__link">
    <span class="md-ellipsis">
      __version__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ai_text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ai_text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ai_text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ai_text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_MIN_SECTION_COUNT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MIN_SECTION_COUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_OPENAI_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OPENAI_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PARAGRAPH_FORMAT_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PARAGRAPH_FORMAT_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_REVIEW_COUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RANGE_VAR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_RANGE_VAR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RESULT_MAX_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_RESULT_MAX_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_TOKEN_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_TOKEN_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TARGET_LANGUAGE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TARGET_LANGUAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_CONTEXT_LINES" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_CONTEXT_LINES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_SEGMENT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_SEGMENT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_TARGET_TOKENS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATION_TARGET_TOKENS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_XML_FORMAT_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_XML_FORMAT_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.FOLLOWING_CONTEXT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      FOLLOWING_CONTEXT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.PRECEDING_CONTEXT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      PRECEDING_CONTEXT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SECTION_SEGMENT_SIZE_WARNING_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      SECTION_SEGMENT_SIZE_WARNING_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TRANSCRIPT_SEGMENT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      TRANSCRIPT_SEGMENT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      GeneralProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeneralProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.source_language" class="md-nav__link">
    <span class="md-ellipsis">
      source_language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      LineTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LineTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.context_lines" class="md-nav__link">
    <span class="md-ellipsis">
      context_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.style" class="md-nav__link">
    <span class="md-ellipsis">
      style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_segment" class="md-nav__link">
    <span class="md-ellipsis">
      translate_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      translate_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager" class="md-nav__link">
    <span class="md-ellipsis">
      LocalPatternManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LocalPatternManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.pattern_manager" class="md-nav__link">
    <span class="md-ellipsis">
      pattern_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.max_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      max_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessedSection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessedSection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.end_line" class="md-nav__link">
    <span class="md-ellipsis">
      end_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.original_text" class="md-nav__link">
    <span class="md-ellipsis">
      original_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.processed_text" class="md-nav__link">
    <span class="md-ellipsis">
      processed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.start_line" class="md-nav__link">
    <span class="md-ellipsis">
      start_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.title" class="md-nav__link">
    <span class="md-ellipsis">
      title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser" class="md-nav__link">
    <span class="md-ellipsis">
      SectionParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SectionParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      section_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_scanner" class="md-nav__link">
    <span class="md-ellipsis">
      section_scanner
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.find_sections" class="md-nav__link">
    <span class="md-ellipsis">
      find_sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      SectionProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SectionProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.template_dict" class="md-nav__link">
    <span class="md-ellipsis">
      template_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.wrap_in_document" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_in_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      process_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_sections" class="md-nav__link">
    <span class="md-ellipsis">
      process_sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      TextProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator" class="md-nav__link">
    <span class="md-ellipsis">
      TextPunctuator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextPunctuator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.source_language" class="md-nav__link">
    <span class="md-ellipsis">
      source_language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.style_convention" class="md-nav__link">
    <span class="md-ellipsis">
      style_convention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_text" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.find_sections" class="md-nav__link">
    <span class="md-ellipsis">
      find_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.get_default_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      get_default_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_by_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_sections" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_by_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.punctuate_text" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.translate_text_by_lines" class="md-nav__link">
    <span class="md-ellipsis">
      translate_text_by_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang" class="md-nav__link">
    <span class="md-ellipsis">
      lang
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lang">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_code" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_from_code" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_from_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_process_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_process_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.TOKEN_BUFFER" class="md-nav__link">
    <span class="md-ellipsis">
      TOKEN_BUFFER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.openai_process_text" class="md-nav__link">
    <span class="md-ellipsis">
      openai_process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns" class="md-nav__link">
    <span class="md-ellipsis">
      patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.MarkdownStr" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownStr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.SYSTEM_UPDATE_MESSAGE" class="md-nav__link">
    <span class="md-ellipsis">
      SYSTEM_UPDATE_MESSAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager" class="md-nav__link">
    <span class="md-ellipsis">
      ConcurrentAccessManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConcurrentAccessManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.lock_dir" class="md-nav__link">
    <span class="md-ellipsis">
      lock_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.file_lock" class="md-nav__link">
    <span class="md-ellipsis">
      file_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.is_locked" class="md-nav__link">
    <span class="md-ellipsis">
      is_locked
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository" class="md-nav__link">
    <span class="md-ellipsis">
      GitBackedRepository
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GitBackedRepository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo" class="md-nav__link">
    <span class="md-ellipsis">
      repo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo_path" class="md-nav__link">
    <span class="md-ellipsis">
      repo_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.display_history" class="md-nav__link">
    <span class="md-ellipsis">
      display_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.update_file" class="md-nav__link">
    <span class="md-ellipsis">
      update_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.default_template_fields" class="md-nav__link">
    <span class="md-ellipsis">
      default_template_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.instructions" class="md-nav__link">
    <span class="md-ellipsis">
      instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.apply_template" class="md-nav__link">
    <span class="md-ellipsis">
      apply_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.content_hash" class="md-nav__link">
    <span class="md-ellipsis">
      content_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.extract_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_frontmatter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.get_content_without_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      get_content_without_frontmatter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.update_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      update_frontmatter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager" class="md-nav__link">
    <span class="md-ellipsis">
      PatternManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PatternManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.access_manager" class="md-nav__link">
    <span class="md-ellipsis">
      access_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.base_path" class="md-nav__link">
    <span class="md-ellipsis">
      base_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.repo" class="md-nav__link">
    <span class="md-ellipsis">
      repo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.get_pattern_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.load_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      load_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.save_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      save_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.show_pattern_history" class="md-nav__link">
    <span class="md-ellipsis">
      show_pattern_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.verify_repository" class="md-nav__link">
    <span class="md-ellipsis">
      verify_repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format" class="md-nav__link">
    <span class="md-ellipsis">
      response_format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="response_format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TEXT_SECTIONS_DESCRIPTION" class="md-nav__link">
    <span class="md-ellipsis">
      TEXT_SECTIONS_DESCRIPTION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection" class="md-nav__link">
    <span class="md-ellipsis">
      LogicalSection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogicalSection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.end_line" class="md-nav__link">
    <span class="md-ellipsis">
      end_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.start_line" class="md-nav__link">
    <span class="md-ellipsis">
      start_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.title" class="md-nav__link">
    <span class="md-ellipsis">
      title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject" class="md-nav__link">
    <span class="md-ellipsis">
      TextObject
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject.language" class="md-nav__link">
    <span class="md-ellipsis">
      language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject.sections" class="md-nav__link">
    <span class="md-ellipsis">
      sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.typing" class="md-nav__link">
    <span class="md-ellipsis">
      typing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="typing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.typing.ResponseFormat" class="md-nav__link">
    <span class="md-ellipsis">
      ResponseFormat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing" class="md-nav__link">
    <span class="md-ellipsis">
      audio_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio" class="md-nav__link">
    <span class="md-ellipsis">
      audio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.EXPECTED_TIME_FACTOR" class="md-nav__link">
    <span class="md-ellipsis">
      EXPECTED_TIME_FACTOR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_DURATION" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_DURATION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_DURATION_MS" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_DURATION_MS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_INT16" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_INT16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_SILENCE_LENGTH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.SEEK_LENGTH" class="md-nav__link">
    <span class="md-ellipsis">
      SEEK_LENGTH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD" class="md-nav__link">
    <span class="md-ellipsis">
      SILENCE_DBFS_THRESHOLD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary" class="md-nav__link">
    <span class="md-ellipsis">
      Boundary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boundary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.text" class="md-nav__link">
    <span class="md-ellipsis">
      text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.audio_to_numpy" class="md-nav__link">
    <span class="md-ellipsis">
      audio_to_numpy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.detect_silence_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      detect_silence_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.detect_whisper_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      detect_whisper_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio" class="md-nav__link">
    <span class="md-ellipsis">
      split_audio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="split_audio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio--split-using-silence-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Split using silence detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio--split-using-whisper-based-sentence-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      Split using whisper-based sentence boundaries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio_at_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      split_audio_at_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      whisper_model_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="whisper_model_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-a-file-path" class="md-nav__link">
    <span class="md-ellipsis">
      Using a file path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-an-audio-array" class="md-nav__link">
    <span class="md-ellipsis">
      Using an audio array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription" class="md-nav__link">
    <span class="md-ellipsis">
      transcription
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transcription">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.custom_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      custom_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.get_text_from_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_transcript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.get_transcription" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.process_audio_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      process_audio_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.process_audio_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_audio_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security" class="md-nav__link">
    <span class="md-ellipsis">
      whisper_security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="whisper_security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.load_whisper_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_whisper_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.safe_torch_load" class="md-nav__link">
    <span class="md-ellipsis">
      safe_torch_load
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools" class="md-nav__link">
    <span class="md-ellipsis">
      cli_tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli_tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe--download-split-and-transcribe-from-a-single-youtube-url" class="md-nav__link">
    <span class="md-ellipsis">
      Download, split, and transcribe from a single YouTube URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_MIN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_MIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_SEC" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_SEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_OUTPUT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OUTPUT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_PROMPT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PROMPT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.REQUIREMENTS_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      REQUIREMENTS_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.RE_DOWNLOAD_CONFIRMATION_STR" class="md-nav__link">
    <span class="md-ellipsis">
      RE_DOWNLOAD_CONFIRMATION_STR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env" class="md-nav__link">
    <span class="md-ellipsis">
      env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.check_env--ensures-env-checks-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Ensures .env, checks requirements.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.check_requirements--prints-warnings-if-imports-fail-otherwise-silent" class="md-nav__link">
    <span class="md-ellipsis">
      Prints warnings if imports fail, otherwise silent.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.ensure_env_file_exists--if-env-doesnt-exist-user-is-prompted-for-key-file-created-with-openai_api_key" class="md-nav__link">
    <span class="md-ellipsis">
      If .env doesn't exist, user is prompted for key, file created with OPENAI_API_KEY.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.validate.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
    <nav class="md-nav" aria-label="version_check">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker" class="md-nav__link">
    <span class="md-ellipsis">
      YTDVersionChecker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.check_ytd_version" class="md-nav__link">
    <span class="md-ellipsis">
      check_ytd_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nfmt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nfmt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_fab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_fab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.DEFAULT_SECTION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.pass_config" class="md-nav__link">
    <span class="md-ellipsis">
      pass_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TNHFabConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.get_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.punctuate" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.read_input" class="md-nav__link">
    <span class="md-ellipsis">
      read_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.section" class="md-nav__link">
    <span class="md-ellipsis">
      section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="token_count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="token_count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count.token_count_cli" class="md-nav__link">
    <span class="md-ellipsis">
      token_count_cli
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ytt_fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ytt_fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing" class="md-nav__link">
    <span class="md-ellipsis">
      journal_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="journal_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process" class="md-nav__link">
    <span class="md-ellipsis">
      journal_process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="journal_process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.BATCH_RETRY_DELAY" class="md-nav__link">
    <span class="md-ellipsis">
      BATCH_RETRY_DELAY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.MAX_BATCH_RETRIES" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_BATCH_RETRIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.MAX_TOKEN_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_TOKEN_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.journal_schema" class="md-nav__link">
    <span class="md-ellipsis">
      journal_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.batch_section" class="md-nav__link">
    <span class="md-ellipsis">
      batch_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.batch_translate" class="md-nav__link">
    <span class="md-ellipsis">
      batch_translate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.deserialize_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.extract_page_groups_from_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      extract_page_groups_from_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_all_batches" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_clean_batch" class="md-nav__link">
    <span class="md-ellipsis">
      generate_clean_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_single_oa_batch_from_pages" class="md-nav__link">
    <span class="md-ellipsis">
      generate_single_oa_batch_from_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_cleaned_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_cleaned_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_sectioning_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_sectioning_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_translation_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_translation_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.send_data_for_tx_batch" class="md-nav__link">
    <span class="md-ellipsis">
      send_data_for_tx_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.setup_logger" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.translate_sections" class="md-nav__link">
    <span class="md-ellipsis">
      translate_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.unwrap_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.unwrap_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.validate_and_clean_data" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_clean_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.validate_and_save_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_save_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.wrap_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.wrap_lines" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config" class="md-nav__link">
    <span class="md-ellipsis">
      logging_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.BASE_LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      BASE_LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.BASE_LOG_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      BASE_LOG_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_CONSOLE_FORMAT_STRING" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CONSOLE_FORMAT_STRING
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_FILE_FORMAT_STRING" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_FILE_FORMAT_STRING
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_LOG_FILEPATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_LOG_FILEPATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.LOG_COLORS" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_COLORS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.MAX_FILE_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_FILE_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.PRIORITY_INFO_LEVEL" class="md-nav__link">
    <span class="md-ellipsis">
      PRIORITY_INFO_LEVEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.OMPFilter" class="md-nav__link">
    <span class="md-ellipsis">
      OMPFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OMPFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.OMPFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.get_child_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_child_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.priority_info" class="md-nav__link">
    <span class="md-ellipsis">
      priority_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_LANGUAGE_HINTS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_METHOD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_OFFSET
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.PDFParseWarning" class="md-nav__link">
    <span class="md-ellipsis">
      PDFParseWarning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PDFParseWarning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.PDFParseWarning.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.annotate_image_with_text" class="md-nav__link">
    <span class="md-ellipsis">
      annotate_image_with_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.build_processed_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      build_processed_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.deserialize_entity_annotations_from_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_entity_annotations_from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.extract_image_from_page" class="md-nav__link">
    <span class="md-ellipsis">
      extract_image_from_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.get_page_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      get_page_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.load_pdf_pages" class="md-nav__link">
    <span class="md-ellipsis">
      load_pdf_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.load_processed_PDF_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_processed_PDF_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.make_image_preprocess_mask" class="md-nav__link">
    <span class="md-ellipsis">
      make_image_preprocess_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.pil_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      pil_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.process_page" class="md-nav__link">
    <span class="md-ellipsis">
      process_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.process_single_image" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.save_processed_pdf_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_processed_pdf_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.serialize_entity_annotations_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_entity_annotations_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.start_image_annotator_client" class="md-nav__link">
    <span class="md-ellipsis">
      start_image_annotator_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_editor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_editor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_image" class="md-nav__link">
    <span class="md-ellipsis">
      current_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_page_index" class="md-nav__link">
    <span class="md-ellipsis">
      current_page_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_text" class="md-nav__link">
    <span class="md-ellipsis">
      current_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.edited_text" class="md-nav__link">
    <span class="md-ellipsis">
      edited_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.image_directory" class="md-nav__link">
    <span class="md-ellipsis">
      image_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.ocr_text_directory" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_text_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.pages" class="md-nav__link">
    <span class="md-ellipsis">
      pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.save_path" class="md-nav__link">
    <span class="md-ellipsis">
      save_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.tree" class="md-nav__link">
    <span class="md-ellipsis">
      tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.uploaded_image_file" class="md-nav__link">
    <span class="md-ellipsis">
      uploaded_image_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.uploaded_text_file" class="md-nav__link">
    <span class="md-ellipsis">
      uploaded_text_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.extract_pages" class="md-nav__link">
    <span class="md-ellipsis">
      extract_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.load_xml" class="md-nav__link">
    <span class="md-ellipsis">
      load_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.save_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_xml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_LANGUAGE_HINTS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_METHOD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_OFFSET
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning" class="md-nav__link">
    <span class="md-ellipsis">
      PDFParseWarning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PDFParseWarning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.annotate_image_with_text" class="md-nav__link">
    <span class="md-ellipsis">
      annotate_image_with_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.build_processed_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      build_processed_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.deserialize_entity_annotations_from_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_entity_annotations_from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.extract_image_from_page" class="md-nav__link">
    <span class="md-ellipsis">
      extract_image_from_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.get_page_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      get_page_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.load_pdf_pages" class="md-nav__link">
    <span class="md-ellipsis">
      load_pdf_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.load_processed_PDF_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_processed_PDF_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.make_image_preprocess_mask" class="md-nav__link">
    <span class="md-ellipsis">
      make_image_preprocess_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.pil_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      pil_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.process_page" class="md-nav__link">
    <span class="md-ellipsis">
      process_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.process_single_image" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.save_processed_pdf_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_processed_pdf_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.serialize_entity_annotations_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_entity_annotations_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.start_image_annotator_client" class="md-nav__link">
    <span class="md-ellipsis">
      start_image_annotator_client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEBUG_DISPLAY_BUFFER" class="md-nav__link">
    <span class="md-ellipsis">
      DEBUG_DISPLAY_BUFFER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEFAULT_MAX_BATCH_RETRY" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MAX_BATCH_RETRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEFAULT_MODEL_SETTINGS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MODEL_SETTINGS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.MAX_BATCH_LIST" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_BATCH_LIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OPEN_AI_DEFAULT_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      OPEN_AI_DEFAULT_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.open_ai_encoding" class="md-nav__link">
    <span class="md-ellipsis">
      open_ai_encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.open_ai_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      open_ai_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.ClientNotInitializedError" class="md-nav__link">
    <span class="md-ellipsis">
      ClientNotInitializedError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.client" class="md-nav__link">
    <span class="md-ellipsis">
      client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.get_instance" class="md-nav__link">
    <span class="md-ellipsis">
      get_instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.create_jsonl_file_for_batch" class="md-nav__link">
    <span class="md-ellipsis">
      create_jsonl_file_for_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.delete_api_files" class="md-nav__link">
    <span class="md-ellipsis">
      delete_api_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.generate_messages" class="md-nav__link">
    <span class="md-ellipsis">
      generate_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_active_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_all_batch_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_batch_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_api_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_api_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_batch_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_batch_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_batch_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_batch_status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completed_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_completed_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completion_content" class="md-nav__link">
    <span class="md-ellipsis">
      get_completion_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completion_object" class="md-nav__link">
    <span class="md-ellipsis">
      get_completion_object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_last_batch_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_last_batch_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.poll_batch_for_response" class="md-nav__link">
    <span class="md-ellipsis">
      poll_batch_for_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_immediate_chat_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_immediate_chat_process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_immediate_completion_simple" class="md-nav__link">
    <span class="md-ellipsis">
      run_immediate_completion_simple
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_single_batch" class="md-nav__link">
    <span class="md-ellipsis">
      run_single_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_transcription_speech" class="md-nav__link">
    <span class="md-ellipsis">
      run_transcription_speech
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.set_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      set_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.start_batch" class="md-nav__link">
    <span class="md-ellipsis">
      start_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.start_batch_with_retries" class="md-nav__link">
    <span class="md-ellipsis">
      start_batch_with_retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.token_count_file" class="md-nav__link">
    <span class="md-ellipsis">
      token_count_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      run_oa_batch_jobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_oa_batch_jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.BATCH_JOB_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      BATCH_JOB_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.CHECK_INTERVAL_SECONDS" class="md-nav__link">
    <span class="md-ellipsis">
      CHECK_INTERVAL_SECONDS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.ENQUEUED_BATCH_TOKEN_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      ENQUEUED_BATCH_TOKEN_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.enqueued_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      enqueued_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.sent_batches" class="md-nav__link">
    <span class="md-ellipsis">
      sent_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.calculate_enqueued_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_enqueued_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.download_batch_result" class="md-nav__link">
    <span class="md-ellipsis">
      download_batch_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.get_active_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.poll_batches" class="md-nav__link">
    <span class="md-ellipsis">
      poll_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.process_batch_files" class="md-nav__link">
    <span class="md-ellipsis">
      process_batch_files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags_by_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags_by_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup" class="md-nav__link">
    <span class="md-ellipsis">
      generate_reduced_text_soup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_reduced_text_soup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_attribute_values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_attribute_values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tag_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_tag_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.lines_from_bracketed_text" class="md-nav__link">
    <span class="md-ellipsis">
      lines_from_bracketed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_newlines" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_newlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_quotes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize_quotes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.number_lines" class="md-nav__link">
    <span class="md-ellipsis">
      number_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_all_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_all_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_empty_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_empty_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tag_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tag_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_descendants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_descendants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_visible_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_visible_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unbracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unbracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_redundant_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unwrap_redundant_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket" class="md-nav__link">
    <span class="md-ellipsis">
      bracket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bracket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.bracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.bracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.lines_from_bracketed_text" class="md-nav__link">
    <span class="md-ellipsis">
      lines_from_bracketed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.number_lines" class="md-nav__link">
    <span class="md-ellipsis">
      number_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.unbracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.unbracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag" class="md-nav__link">
    <span class="md-ellipsis">
      clean_parse_tag
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean_parse_tag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.clean_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags_by_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags_by_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup" class="md-nav__link">
    <span class="md-ellipsis">
      generate_reduced_text_soup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_reduced_text_soup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_attribute_values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_attribute_values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tag_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_tag_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_newlines" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_newlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_quotes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize_quotes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_all_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_all_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_empty_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_empty_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tag_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tag_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_descendants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_descendants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_visible_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_visible_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_redundant_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unwrap_redundant_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      initial_cleaning_scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="initial_cleaning_scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.nlp" class="md-nav__link">
    <span class="md-ellipsis">
      nlp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.clean_and_tag_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_and_tag_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.extract_content" class="md-nav__link">
    <span class="md-ellipsis">
      extract_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.extract_text_and_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      extract_text_and_metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text" class="md-nav__link">
    <span class="md-ellipsis">
      numbered_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="numbered_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat" class="md-nav__link">
    <span class="md-ellipsis">
      NumberedFormat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumberedFormat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.is_numbered" class="md-nav__link">
    <span class="md-ellipsis">
      is_numbered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.separator" class="md-nav__link">
    <span class="md-ellipsis">
      separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.start_num" class="md-nav__link">
    <span class="md-ellipsis">
      start_num
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText" class="md-nav__link">
    <span class="md-ellipsis">
      NumberedText
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumberedText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.content" class="md-nav__link">
    <span class="md-ellipsis">
      content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.lines" class="md-nav__link">
    <span class="md-ellipsis">
      lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.numbered_lines" class="md-nav__link">
    <span class="md-ellipsis">
      numbered_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.separator" class="md-nav__link">
    <span class="md-ellipsis">
      separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.size" class="md-nav__link">
    <span class="md-ellipsis">
      size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment" class="md-nav__link">
    <span class="md-ellipsis">
      LineSegment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentIterator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.append" class="md-nav__link">
    <span class="md-ellipsis">
      append
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.from_file" class="md-nav__link">
    <span class="md-ellipsis">
      from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_line" class="md-nav__link">
    <span class="md-ellipsis">
      get_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_lines" class="md-nav__link">
    <span class="md-ellipsis">
      get_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_line" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_lines" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_segment" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_segment" class="md-nav__link">
    <span class="md-ellipsis">
      get_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.iter_segments" class="md-nav__link">
    <span class="md-ellipsis">
      iter_segments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.get_numbered_format" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      v2_cleaning_scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="v2_cleaning_scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.classifier" class="md-nav__link">
    <span class="md-ellipsis">
      classifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.nlp" class="md-nav__link">
    <span class="md-ellipsis">
      nlp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.classify_heading" class="md-nav__link">
    <span class="md-ellipsis">
      classify_heading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.process_book" class="md-nav__link">
    <span class="md-ellipsis">
      process_book
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils" class="md-nav__link">
    <span class="md-ellipsis">
      file_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="file_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.FileExistsWarning" class="md-nav__link">
    <span class="md-ellipsis">
      FileExistsWarning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.copy_files_with_regex" class="md-nav__link">
    <span class="md-ellipsis">
      copy_files_with_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.ensure_directory_exists" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_directory_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.get_text_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.iterate_subdir" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_subdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.write_text_to_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_text_to_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils" class="md-nav__link">
    <span class="md-ellipsis">
      json_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="json_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.format_json" class="md-nav__link">
    <span class="md-ellipsis">
      format_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.load_json_into_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_json_into_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.load_jsonl_to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      load_jsonl_to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.save_model_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      save_model_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.write_data_to_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_data_to_json_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils" class="md-nav__link">
    <span class="md-ellipsis">
      progress_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="progress_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.BAR_FORMAT" class="md-nav__link">
    <span class="md-ellipsis">
      BAR_FORMAT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM" class="md-nav__link">
    <span class="md-ellipsis">
      ExpectedTimeTQDM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExpectedTimeTQDM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.delay_start" class="md-nav__link">
    <span class="md-ellipsis">
      delay_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.desc" class="md-nav__link">
    <span class="md-ellipsis">
      desc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.display_interval" class="md-nav__link">
    <span class="md-ellipsis">
      display_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.expected_time" class="md-nav__link">
    <span class="md-ellipsis">
      expected_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress" class="md-nav__link">
    <span class="md-ellipsis">
      TimeProgress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeProgress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.desc" class="md-nav__link">
    <span class="md-ellipsis">
      desc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.display_interval" class="md-nav__link">
    <span class="md-ellipsis">
      display_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.expected_time" class="md-nav__link">
    <span class="md-ellipsis">
      expected_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.slugify" class="md-nav__link">
    <span class="md-ellipsis">
      slugify
    </span>
  </a>
  
    <nav class="md-nav" aria-label="slugify">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.slugify.slugify" class="md-nav__link">
    <span class="md-ellipsis">
      slugify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils" class="md-nav__link">
    <span class="md-ellipsis">
      user_io_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_io_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils.get_single_char" class="md-nav__link">
    <span class="md-ellipsis">
      get_single_char
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils.get_user_confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_confirmation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing" class="md-nav__link">
    <span class="md-ellipsis">
      video_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing" class="md-nav__link">
    <span class="md-ellipsis">
      video_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSCRIPT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_OPTIONS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSCRIPT_OPTIONS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack" class="md-nav__link">
    <span class="md-ellipsis">
      SubtitleTrack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SubtitleTrack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.ext" class="md-nav__link">
    <span class="md-ellipsis">
      ext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.url" class="md-nav__link">
    <span class="md-ellipsis">
      url
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError" class="md-nav__link">
    <span class="md-ellipsis">
      TranscriptNotFoundError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TranscriptNotFoundError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.language" class="md-nav__link">
    <span class="md-ellipsis">
      language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.video_url" class="md-nav__link">
    <span class="md-ellipsis">
      video_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo" class="md-nav__link">
    <span class="md-ellipsis">
      VideoInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VideoInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo.automatic_captions" class="md-nav__link">
    <span class="md-ellipsis">
      automatic_captions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo.subtitles" class="md-nav__link">
    <span class="md-ellipsis">
      subtitles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.download_audio_yt" class="md-nav__link">
    <span class="md-ellipsis">
      download_audio_yt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_transcript_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcript_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_video_download_path_yt" class="md-nav__link">
    <span class="md-ellipsis">
      get_video_download_path_yt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_youtube_urls_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      get_youtube_urls_from_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      yt_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yt_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_MS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_MS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_S" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_S
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_OUTPUT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OUTPUT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_PROMPT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PROMPT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.EXPECTED_ENV" class="md-nav__link">
    <span class="md-ellipsis">
      EXPECTED_ENV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.group" class="md-nav__link">
    <span class="md-ellipsis">
      group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.output_directory" class="md-nav__link">
    <span class="md-ellipsis">
      output_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.parser" class="md-nav__link">
    <span class="md-ellipsis">
      parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.url_file" class="md-nav__link">
    <span class="md-ellipsis">
      url_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.video_urls" class="md-nav__link">
    <span class="md-ellipsis">
      video_urls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.check_conda_env" class="md-nav__link">
    <span class="md-ellipsis">
      check_conda_env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.transcribe_youtube_videos" class="md-nav__link">
    <span class="md-ellipsis">
      transcribe_youtube_videos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing" class="md-nav__link">
    <span class="md-ellipsis">
      xml_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xml_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.join_xml_data_to_doc" class="md-nav__link">
    <span class="md-ellipsis">
      join_xml_data_to_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.remove_page_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_page_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.save_pages_to_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_pages_to_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.split_xml_on_pagebreaks" class="md-nav__link">
    <span class="md-ellipsis">
      split_xml_on_pagebreaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags.extract_unique_tags" class="md-nav__link">
    <span class="md-ellipsis">
      extract_unique_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing" class="md-nav__link">
    <span class="md-ellipsis">
      xml_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xml_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.join_xml_data_to_doc" class="md-nav__link">
    <span class="md-ellipsis">
      join_xml_data_to_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.remove_page_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_page_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.save_pages_to_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_pages_to_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.split_xml_on_pagebreaks" class="md-nav__link">
    <span class="md-ellipsis">
      split_xml_on_pagebreaks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../translation_research/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translation Research
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preliminary_feasibility_study/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feasibility Study
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ADRs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            ADRs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    YTT Fetch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            YTT Fetch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ytt-fetch/ADRs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ytt-fetch/ADR%20transcript%20source%20handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transcript Source
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ytt-fetch/ADR%20yt-dlp%20transcripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YT-DLP Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ytt-fetch/yt-dlp%20vs.%20Youtube%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Comparison
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpt_4o_search_query_text_pair_testing/testing_input_output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpt_4o_translations%20experiments/passage_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Design
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            CLI Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tnh-fab/text%20processing%20cli%20design_v1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TNH-FAB v1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tnh-fab/text%20processing%20cli%20design_v2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TNH-FAB v2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tnh_scholar" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_scholar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_scholar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.CLI_TOOLS_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      CLI_TOOLS_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.DEFAULT_PATTERN_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PATTERN_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.PROJECT_ROOT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      PROJECT_ROOT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.TNH_ROOT_SRC_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      TNH_ROOT_SRC_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.__version__" class="md-nav__link">
    <span class="md-ellipsis">
      __version__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ai_text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ai_text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ai_text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ai_text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_MIN_SECTION_COUNT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MIN_SECTION_COUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_OPENAI_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OPENAI_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PARAGRAPH_FORMAT_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PARAGRAPH_FORMAT_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PUNCTUATE_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_REVIEW_COUNT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RANGE_VAR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_RANGE_VAR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RESULT_MAX_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_RESULT_MAX_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_TOKEN_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_TOKEN_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TARGET_LANGUAGE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TARGET_LANGUAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_CONTEXT_LINES" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_CONTEXT_LINES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_SEGMENT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_SEGMENT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATE_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_TARGET_TOKENS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSLATION_TARGET_TOKENS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_XML_FORMAT_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_XML_FORMAT_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.FOLLOWING_CONTEXT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      FOLLOWING_CONTEXT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.PRECEDING_CONTEXT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      PRECEDING_CONTEXT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SECTION_SEGMENT_SIZE_WARNING_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      SECTION_SEGMENT_SIZE_WARNING_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TRANSCRIPT_SEGMENT_MARKER" class="md-nav__link">
    <span class="md-ellipsis">
      TRANSCRIPT_SEGMENT_MARKER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      GeneralProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GeneralProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.source_language" class="md-nav__link">
    <span class="md-ellipsis">
      source_language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      LineTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LineTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.context_lines" class="md-nav__link">
    <span class="md-ellipsis">
      context_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.style" class="md-nav__link">
    <span class="md-ellipsis">
      style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_segment" class="md-nav__link">
    <span class="md-ellipsis">
      translate_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      translate_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager" class="md-nav__link">
    <span class="md-ellipsis">
      LocalPatternManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LocalPatternManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.pattern_manager" class="md-nav__link">
    <span class="md-ellipsis">
      pattern_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.max_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      max_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessedSection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessedSection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.end_line" class="md-nav__link">
    <span class="md-ellipsis">
      end_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.original_text" class="md-nav__link">
    <span class="md-ellipsis">
      original_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.processed_text" class="md-nav__link">
    <span class="md-ellipsis">
      processed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.start_line" class="md-nav__link">
    <span class="md-ellipsis">
      start_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.title" class="md-nav__link">
    <span class="md-ellipsis">
      title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser" class="md-nav__link">
    <span class="md-ellipsis">
      SectionParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SectionParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      section_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_scanner" class="md-nav__link">
    <span class="md-ellipsis">
      section_scanner
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.find_sections" class="md-nav__link">
    <span class="md-ellipsis">
      find_sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      SectionProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SectionProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.pattern" class="md-nav__link">
    <span class="md-ellipsis">
      pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.template_dict" class="md-nav__link">
    <span class="md-ellipsis">
      template_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.wrap_in_document" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_in_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      process_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_sections" class="md-nav__link">
    <span class="md-ellipsis">
      process_sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      TextProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator" class="md-nav__link">
    <span class="md-ellipsis">
      TextPunctuator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextPunctuator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.review_count" class="md-nav__link">
    <span class="md-ellipsis">
      review_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.source_language" class="md-nav__link">
    <span class="md-ellipsis">
      source_language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.style_convention" class="md-nav__link">
    <span class="md-ellipsis">
      style_convention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_text" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.find_sections" class="md-nav__link">
    <span class="md-ellipsis">
      find_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.get_default_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      get_default_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      process_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_paragraphs" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_by_paragraphs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_sections" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_by_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.punctuate_text" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.ai_text_processing.translate_text_by_lines" class="md-nav__link">
    <span class="md-ellipsis">
      translate_text_by_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang" class="md-nav__link">
    <span class="md-ellipsis">
      lang
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lang">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_code" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_from_code" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_from_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.lang.get_language_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_language_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_process_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_process_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.TOKEN_BUFFER" class="md-nav__link">
    <span class="md-ellipsis">
      TOKEN_BUFFER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.openai_process_interface.openai_process_text" class="md-nav__link">
    <span class="md-ellipsis">
      openai_process_text
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns" class="md-nav__link">
    <span class="md-ellipsis">
      patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.MarkdownStr" class="md-nav__link">
    <span class="md-ellipsis">
      MarkdownStr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.SYSTEM_UPDATE_MESSAGE" class="md-nav__link">
    <span class="md-ellipsis">
      SYSTEM_UPDATE_MESSAGE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager" class="md-nav__link">
    <span class="md-ellipsis">
      ConcurrentAccessManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConcurrentAccessManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.lock_dir" class="md-nav__link">
    <span class="md-ellipsis">
      lock_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.file_lock" class="md-nav__link">
    <span class="md-ellipsis">
      file_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.is_locked" class="md-nav__link">
    <span class="md-ellipsis">
      is_locked
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository" class="md-nav__link">
    <span class="md-ellipsis">
      GitBackedRepository
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GitBackedRepository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo" class="md-nav__link">
    <span class="md-ellipsis">
      repo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo_path" class="md-nav__link">
    <span class="md-ellipsis">
      repo_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.display_history" class="md-nav__link">
    <span class="md-ellipsis">
      display_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.GitBackedRepository.update_file" class="md-nav__link">
    <span class="md-ellipsis">
      update_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.default_template_fields" class="md-nav__link">
    <span class="md-ellipsis">
      default_template_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.instructions" class="md-nav__link">
    <span class="md-ellipsis">
      instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.apply_template" class="md-nav__link">
    <span class="md-ellipsis">
      apply_template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.content_hash" class="md-nav__link">
    <span class="md-ellipsis">
      content_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.extract_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_frontmatter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.get_content_without_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      get_content_without_frontmatter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.Pattern.update_frontmatter" class="md-nav__link">
    <span class="md-ellipsis">
      update_frontmatter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager" class="md-nav__link">
    <span class="md-ellipsis">
      PatternManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PatternManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.access_manager" class="md-nav__link">
    <span class="md-ellipsis">
      access_manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.base_path" class="md-nav__link">
    <span class="md-ellipsis">
      base_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.repo" class="md-nav__link">
    <span class="md-ellipsis">
      repo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.get_pattern_path" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.load_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      load_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.save_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      save_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.show_pattern_history" class="md-nav__link">
    <span class="md-ellipsis">
      show_pattern_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.patterns.PatternManager.verify_repository" class="md-nav__link">
    <span class="md-ellipsis">
      verify_repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format" class="md-nav__link">
    <span class="md-ellipsis">
      response_format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="response_format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TEXT_SECTIONS_DESCRIPTION" class="md-nav__link">
    <span class="md-ellipsis">
      TEXT_SECTIONS_DESCRIPTION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection" class="md-nav__link">
    <span class="md-ellipsis">
      LogicalSection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LogicalSection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.end_line" class="md-nav__link">
    <span class="md-ellipsis">
      end_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.start_line" class="md-nav__link">
    <span class="md-ellipsis">
      start_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.LogicalSection.title" class="md-nav__link">
    <span class="md-ellipsis">
      title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject" class="md-nav__link">
    <span class="md-ellipsis">
      TextObject
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject.language" class="md-nav__link">
    <span class="md-ellipsis">
      language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.response_format.TextObject.sections" class="md-nav__link">
    <span class="md-ellipsis">
      sections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.typing" class="md-nav__link">
    <span class="md-ellipsis">
      typing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="typing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ai_text_processing.typing.ResponseFormat" class="md-nav__link">
    <span class="md-ellipsis">
      ResponseFormat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing" class="md-nav__link">
    <span class="md-ellipsis">
      audio_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio" class="md-nav__link">
    <span class="md-ellipsis">
      audio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.EXPECTED_TIME_FACTOR" class="md-nav__link">
    <span class="md-ellipsis">
      EXPECTED_TIME_FACTOR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_DURATION" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_DURATION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_DURATION_MS" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_DURATION_MS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MAX_INT16" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_INT16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH" class="md-nav__link">
    <span class="md-ellipsis">
      MIN_SILENCE_LENGTH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.SEEK_LENGTH" class="md-nav__link">
    <span class="md-ellipsis">
      SEEK_LENGTH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD" class="md-nav__link">
    <span class="md-ellipsis">
      SILENCE_DBFS_THRESHOLD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary" class="md-nav__link">
    <span class="md-ellipsis">
      Boundary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boundary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.text" class="md-nav__link">
    <span class="md-ellipsis">
      text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.Boundary.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.audio_to_numpy" class="md-nav__link">
    <span class="md-ellipsis">
      audio_to_numpy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.detect_silence_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      detect_silence_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.detect_whisper_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      detect_whisper_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio" class="md-nav__link">
    <span class="md-ellipsis">
      split_audio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="split_audio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio--split-using-silence-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Split using silence detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio--split-using-whisper-based-sentence-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      Split using whisper-based sentence boundaries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.split_audio_at_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      split_audio_at_boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      whisper_model_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="whisper_model_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-a-file-path" class="md-nav__link">
    <span class="md-ellipsis">
      Using a file path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-an-audio-array" class="md-nav__link">
    <span class="md-ellipsis">
      Using an audio array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription" class="md-nav__link">
    <span class="md-ellipsis">
      transcription
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transcription">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.custom_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      custom_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.get_text_from_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_transcript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.get_transcription" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.process_audio_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      process_audio_chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.transcription.process_audio_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_audio_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security" class="md-nav__link">
    <span class="md-ellipsis">
      whisper_security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="whisper_security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.load_whisper_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_whisper_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.audio_processing.whisper_security.safe_torch_load" class="md-nav__link">
    <span class="md-ellipsis">
      safe_torch_load
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools" class="md-nav__link">
    <span class="md-ellipsis">
      cli_tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cli_tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="audio_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe--download-split-and-transcribe-from-a-single-youtube-url" class="md-nav__link">
    <span class="md-ellipsis">
      Download, split, and transcribe from a single YouTube URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_MIN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_MIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_SEC" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_SEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_OUTPUT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OUTPUT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_PROMPT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PROMPT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.REQUIREMENTS_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      REQUIREMENTS_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.RE_DOWNLOAD_CONFIRMATION_STR" class="md-nav__link">
    <span class="md-ellipsis">
      RE_DOWNLOAD_CONFIRMATION_STR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.audio_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      audio_transcribe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env" class="md-nav__link">
    <span class="md-ellipsis">
      env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.check_env--ensures-env-checks-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Ensures .env, checks requirements.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.check_requirements--prints-warnings-if-imports-fail-otherwise-silent" class="md-nav__link">
    <span class="md-ellipsis">
      Prints warnings if imports fail, otherwise silent.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.environment.env.ensure_env_file_exists--if-env-doesnt-exist-user-is-prompted-for-key-file-created-with-openai_api_key" class="md-nav__link">
    <span class="md-ellipsis">
      If .env doesn't exist, user is prompted for key, file created with OPENAI_API_KEY.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.validate.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
    <nav class="md-nav" aria-label="version_check">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker" class="md-nav__link">
    <span class="md-ellipsis">
      YTDVersionChecker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.audio_transcribe.version_check.check_ytd_version" class="md-nav__link">
    <span class="md-ellipsis">
      check_ytd_version
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nfmt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nfmt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.nfmt.nfmt.nfmt" class="md-nav__link">
    <span class="md-ellipsis">
      nfmt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_fab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tnh_fab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.DEFAULT_SECTION_PATTERN" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SECTION_PATTERN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.pass_config" class="md-nav__link">
    <span class="md-ellipsis">
      pass_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TNHFabConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.get_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      get_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.punctuate" class="md-nav__link">
    <span class="md-ellipsis">
      punctuate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.read_input" class="md-nav__link">
    <span class="md-ellipsis">
      read_input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.section" class="md-nav__link">
    <span class="md-ellipsis">
      section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.tnh_fab" class="md-nav__link">
    <span class="md-ellipsis">
      tnh_fab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.tnh_fab.tnh_fab.translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="token_count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="token_count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.token_count.token_count.token_count_cli" class="md-nav__link">
    <span class="md-ellipsis">
      token_count_cli
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ytt_fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ytt_fetch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.ytt_fetch" class="md-nav__link">
    <span class="md-ellipsis">
      ytt_fetch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing" class="md-nav__link">
    <span class="md-ellipsis">
      journal_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="journal_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process" class="md-nav__link">
    <span class="md-ellipsis">
      journal_process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="journal_process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.BATCH_RETRY_DELAY" class="md-nav__link">
    <span class="md-ellipsis">
      BATCH_RETRY_DELAY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.MAX_BATCH_RETRIES" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_BATCH_RETRIES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.MAX_TOKEN_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_TOKEN_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.journal_schema" class="md-nav__link">
    <span class="md-ellipsis">
      journal_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.batch_section" class="md-nav__link">
    <span class="md-ellipsis">
      batch_section
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.batch_translate" class="md-nav__link">
    <span class="md-ellipsis">
      batch_translate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.deserialize_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.extract_page_groups_from_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      extract_page_groups_from_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_all_batches" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_clean_batch" class="md-nav__link">
    <span class="md-ellipsis">
      generate_clean_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.generate_single_oa_batch_from_pages" class="md-nav__link">
    <span class="md-ellipsis">
      generate_single_oa_batch_from_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_cleaned_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_cleaned_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_sectioning_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_sectioning_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.save_translation_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_translation_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.send_data_for_tx_batch" class="md-nav__link">
    <span class="md-ellipsis">
      send_data_for_tx_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.setup_logger" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.translate_sections" class="md-nav__link">
    <span class="md-ellipsis">
      translate_sections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.unwrap_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.unwrap_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.validate_and_clean_data" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_clean_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.validate_and_save_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      validate_and_save_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.wrap_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.journal_processing.journal_process.wrap_lines" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config" class="md-nav__link">
    <span class="md-ellipsis">
      logging_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="logging_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.BASE_LOG_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      BASE_LOG_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.BASE_LOG_NAME" class="md-nav__link">
    <span class="md-ellipsis">
      BASE_LOG_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_CONSOLE_FORMAT_STRING" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CONSOLE_FORMAT_STRING
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_FILE_FORMAT_STRING" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_FILE_FORMAT_STRING
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.DEFAULT_LOG_FILEPATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_LOG_FILEPATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.LOG_COLORS" class="md-nav__link">
    <span class="md-ellipsis">
      LOG_COLORS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.MAX_FILE_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_FILE_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.PRIORITY_INFO_LEVEL" class="md-nav__link">
    <span class="md-ellipsis">
      PRIORITY_INFO_LEVEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.OMPFilter" class="md-nav__link">
    <span class="md-ellipsis">
      OMPFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OMPFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.OMPFilter.filter" class="md-nav__link">
    <span class="md-ellipsis">
      filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.get_child_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_child_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.priority_info" class="md-nav__link">
    <span class="md-ellipsis">
      priority_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.logging_config.setup_logging" class="md-nav__link">
    <span class="md-ellipsis">
      setup_logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_LANGUAGE_HINTS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_METHOD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_OFFSET
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.PDFParseWarning" class="md-nav__link">
    <span class="md-ellipsis">
      PDFParseWarning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PDFParseWarning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.PDFParseWarning.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.annotate_image_with_text" class="md-nav__link">
    <span class="md-ellipsis">
      annotate_image_with_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.build_processed_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      build_processed_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.deserialize_entity_annotations_from_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_entity_annotations_from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.extract_image_from_page" class="md-nav__link">
    <span class="md-ellipsis">
      extract_image_from_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.get_page_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      get_page_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.load_pdf_pages" class="md-nav__link">
    <span class="md-ellipsis">
      load_pdf_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.load_processed_PDF_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_processed_PDF_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.make_image_preprocess_mask" class="md-nav__link">
    <span class="md-ellipsis">
      make_image_preprocess_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.pil_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      pil_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.process_page" class="md-nav__link">
    <span class="md-ellipsis">
      process_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.process_single_image" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.save_processed_pdf_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_processed_pdf_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.serialize_entity_annotations_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_entity_annotations_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.start_image_annotator_client" class="md-nav__link">
    <span class="md-ellipsis">
      start_image_annotator_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_editor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_editor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_image" class="md-nav__link">
    <span class="md-ellipsis">
      current_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_page_index" class="md-nav__link">
    <span class="md-ellipsis">
      current_page_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.current_text" class="md-nav__link">
    <span class="md-ellipsis">
      current_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.edited_text" class="md-nav__link">
    <span class="md-ellipsis">
      edited_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.image_directory" class="md-nav__link">
    <span class="md-ellipsis">
      image_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.ocr_text_directory" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_text_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.pages" class="md-nav__link">
    <span class="md-ellipsis">
      pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.save_path" class="md-nav__link">
    <span class="md-ellipsis">
      save_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.tree" class="md-nav__link">
    <span class="md-ellipsis">
      tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.uploaded_image_file" class="md-nav__link">
    <span class="md-ellipsis">
      uploaded_image_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.uploaded_text_file" class="md-nav__link">
    <span class="md-ellipsis">
      uploaded_text_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.extract_pages" class="md-nav__link">
    <span class="md-ellipsis">
      extract_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.load_xml" class="md-nav__link">
    <span class="md-ellipsis">
      load_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_editor.save_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_xml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing" class="md-nav__link">
    <span class="md-ellipsis">
      ocr_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_FONT_SIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_LANGUAGE_HINTS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_METHOD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_ANNOTATION_OFFSET
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning" class="md-nav__link">
    <span class="md-ellipsis">
      PDFParseWarning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PDFParseWarning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning.warn" class="md-nav__link">
    <span class="md-ellipsis">
      warn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.annotate_image_with_text" class="md-nav__link">
    <span class="md-ellipsis">
      annotate_image_with_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.build_processed_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      build_processed_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.deserialize_entity_annotations_from_json" class="md-nav__link">
    <span class="md-ellipsis">
      deserialize_entity_annotations_from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.extract_image_from_page" class="md-nav__link">
    <span class="md-ellipsis">
      extract_image_from_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.get_page_dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      get_page_dimensions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.load_pdf_pages" class="md-nav__link">
    <span class="md-ellipsis">
      load_pdf_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.load_processed_PDF_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_processed_PDF_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.make_image_preprocess_mask" class="md-nav__link">
    <span class="md-ellipsis">
      make_image_preprocess_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.pil_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      pil_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.process_page" class="md-nav__link">
    <span class="md-ellipsis">
      process_page
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.process_single_image" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.save_processed_pdf_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_processed_pdf_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.serialize_entity_annotations_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_entity_annotations_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.ocr_processing.ocr_processing.start_image_annotator_client" class="md-nav__link">
    <span class="md-ellipsis">
      start_image_annotator_client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface" class="md-nav__link">
    <span class="md-ellipsis">
      openai_interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openai_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEBUG_DISPLAY_BUFFER" class="md-nav__link">
    <span class="md-ellipsis">
      DEBUG_DISPLAY_BUFFER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEFAULT_MAX_BATCH_RETRY" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MAX_BATCH_RETRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.DEFAULT_MODEL_SETTINGS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MODEL_SETTINGS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.MAX_BATCH_LIST" class="md-nav__link">
    <span class="md-ellipsis">
      MAX_BATCH_LIST
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OPEN_AI_DEFAULT_MODEL" class="md-nav__link">
    <span class="md-ellipsis">
      OPEN_AI_DEFAULT_MODEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.open_ai_encoding" class="md-nav__link">
    <span class="md-ellipsis">
      open_ai_encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.open_ai_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      open_ai_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.ClientNotInitializedError" class="md-nav__link">
    <span class="md-ellipsis">
      ClientNotInitializedError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.client" class="md-nav__link">
    <span class="md-ellipsis">
      client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.OpenAIClient.get_instance" class="md-nav__link">
    <span class="md-ellipsis">
      get_instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.create_jsonl_file_for_batch" class="md-nav__link">
    <span class="md-ellipsis">
      create_jsonl_file_for_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.delete_api_files" class="md-nav__link">
    <span class="md-ellipsis">
      delete_api_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.generate_messages" class="md-nav__link">
    <span class="md-ellipsis">
      generate_messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_active_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_all_batch_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_batch_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_api_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_api_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_batch_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_batch_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_batch_status" class="md-nav__link">
    <span class="md-ellipsis">
      get_batch_status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completed_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_completed_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completion_content" class="md-nav__link">
    <span class="md-ellipsis">
      get_completion_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_completion_object" class="md-nav__link">
    <span class="md-ellipsis">
      get_completion_object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_last_batch_response" class="md-nav__link">
    <span class="md-ellipsis">
      get_last_batch_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.get_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      get_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.poll_batch_for_response" class="md-nav__link">
    <span class="md-ellipsis">
      poll_batch_for_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_immediate_chat_process" class="md-nav__link">
    <span class="md-ellipsis">
      run_immediate_chat_process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_immediate_completion_simple" class="md-nav__link">
    <span class="md-ellipsis">
      run_immediate_completion_simple
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_single_batch" class="md-nav__link">
    <span class="md-ellipsis">
      run_single_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.run_transcription_speech" class="md-nav__link">
    <span class="md-ellipsis">
      run_transcription_speech
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.set_model_settings" class="md-nav__link">
    <span class="md-ellipsis">
      set_model_settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.start_batch" class="md-nav__link">
    <span class="md-ellipsis">
      start_batch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.start_batch_with_retries" class="md-nav__link">
    <span class="md-ellipsis">
      start_batch_with_retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.token_count" class="md-nav__link">
    <span class="md-ellipsis">
      token_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.openai_interface.token_count_file" class="md-nav__link">
    <span class="md-ellipsis">
      token_count_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      run_oa_batch_jobs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_oa_batch_jobs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.BATCH_JOB_PATH" class="md-nav__link">
    <span class="md-ellipsis">
      BATCH_JOB_PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.CHECK_INTERVAL_SECONDS" class="md-nav__link">
    <span class="md-ellipsis">
      CHECK_INTERVAL_SECONDS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.ENQUEUED_BATCH_TOKEN_LIMIT" class="md-nav__link">
    <span class="md-ellipsis">
      ENQUEUED_BATCH_TOKEN_LIMIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.enqueued_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      enqueued_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.sent_batches" class="md-nav__link">
    <span class="md-ellipsis">
      sent_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.calculate_enqueued_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_enqueued_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.download_batch_result" class="md-nav__link">
    <span class="md-ellipsis">
      download_batch_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.get_active_batches" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.poll_batches" class="md-nav__link">
    <span class="md-ellipsis">
      poll_batches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.openai_interface.run_oa_batch_jobs.process_batch_files" class="md-nav__link">
    <span class="md-ellipsis">
      process_batch_files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing" class="md-nav__link">
    <span class="md-ellipsis">
      text_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="text_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags_by_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags_by_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.extract_tags_by_attributes--example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup" class="md-nav__link">
    <span class="md-ellipsis">
      generate_reduced_text_soup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_reduced_text_soup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.generate_reduced_text_soup--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_attribute_values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_attribute_values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_attribute_values--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tag_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_tag_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.get_all_tag_names--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.lines_from_bracketed_text" class="md-nav__link">
    <span class="md-ellipsis">
      lines_from_bracketed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_newlines" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_newlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_quotes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize_quotes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.normalize_quotes--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.number_lines" class="md-nav__link">
    <span class="md-ellipsis">
      number_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_all_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_all_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_all_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_empty_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_empty_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_empty_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tag_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tag_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.remove_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_descendants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_descendants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_descendants--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_visible_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_visible_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.tag_has_visible_text--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unbracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unbracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_redundant_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unwrap_redundant_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.unwrap_redundant_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket" class="md-nav__link">
    <span class="md-ellipsis">
      bracket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bracket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.bracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.bracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      bracket_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.lines_from_bracketed_text" class="md-nav__link">
    <span class="md-ellipsis">
      lines_from_bracketed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.number_lines" class="md-nav__link">
    <span class="md-ellipsis">
      number_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.unbracket_all_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_all_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.bracket.unbracket_lines" class="md-nav__link">
    <span class="md-ellipsis">
      unbracket_lines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag" class="md-nav__link">
    <span class="md-ellipsis">
      clean_parse_tag
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean_parse_tag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.clean_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags_by_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags_by_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup" class="md-nav__link">
    <span class="md-ellipsis">
      generate_reduced_text_soup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_reduced_text_soup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_attribute_values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_attribute_values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tag_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_all_tag_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_newlines" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_newlines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_quotes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="normalize_quotes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_all_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_all_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_attributes--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_empty_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_empty_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tag_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tag_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      remove_tags_with_attribute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_tags_with_attribute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_descendants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_descendants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text" class="md-nav__link">
    <span class="md-ellipsis">
      tag_has_visible_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tag_has_visible_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags" class="md-nav__link">
    <span class="md-ellipsis">
      unwrap_redundant_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="unwrap_redundant_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      initial_cleaning_scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="initial_cleaning_scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.nlp" class="md-nav__link">
    <span class="md-ellipsis">
      nlp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.clean_and_tag_text" class="md-nav__link">
    <span class="md-ellipsis">
      clean_and_tag_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.extract_content" class="md-nav__link">
    <span class="md-ellipsis">
      extract_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.initial_cleaning_scripts.extract_text_and_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      extract_text_and_metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text" class="md-nav__link">
    <span class="md-ellipsis">
      numbered_text
    </span>
  </a>
  
    <nav class="md-nav" aria-label="numbered_text">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat" class="md-nav__link">
    <span class="md-ellipsis">
      NumberedFormat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumberedFormat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.is_numbered" class="md-nav__link">
    <span class="md-ellipsis">
      is_numbered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.separator" class="md-nav__link">
    <span class="md-ellipsis">
      separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedFormat.start_num" class="md-nav__link">
    <span class="md-ellipsis">
      start_num
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText" class="md-nav__link">
    <span class="md-ellipsis">
      NumberedText
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumberedText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.content" class="md-nav__link">
    <span class="md-ellipsis">
      content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.end" class="md-nav__link">
    <span class="md-ellipsis">
      end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.lines" class="md-nav__link">
    <span class="md-ellipsis">
      lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.numbered_lines" class="md-nav__link">
    <span class="md-ellipsis">
      numbered_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.separator" class="md-nav__link">
    <span class="md-ellipsis">
      separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.size" class="md-nav__link">
    <span class="md-ellipsis">
      size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment" class="md-nav__link">
    <span class="md-ellipsis">
      LineSegment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentIterator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.append" class="md-nav__link">
    <span class="md-ellipsis">
      append
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.from_file" class="md-nav__link">
    <span class="md-ellipsis">
      from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_line" class="md-nav__link">
    <span class="md-ellipsis">
      get_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_lines" class="md-nav__link">
    <span class="md-ellipsis">
      get_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_line" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_lines" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_segment" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.get_segment" class="md-nav__link">
    <span class="md-ellipsis">
      get_segment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.iter_segments" class="md-nav__link">
    <span class="md-ellipsis">
      iter_segments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.NumberedText.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.numbered_text.get_numbered_format" class="md-nav__link">
    <span class="md-ellipsis">
      get_numbered_format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      v2_cleaning_scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="v2_cleaning_scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.classifier" class="md-nav__link">
    <span class="md-ellipsis">
      classifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.nlp" class="md-nav__link">
    <span class="md-ellipsis">
      nlp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.classify_heading" class="md-nav__link">
    <span class="md-ellipsis">
      classify_heading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.text_processing.v2_cleaning_scripts.process_book" class="md-nav__link">
    <span class="md-ellipsis">
      process_book
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils" class="md-nav__link">
    <span class="md-ellipsis">
      file_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="file_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.FileExistsWarning" class="md-nav__link">
    <span class="md-ellipsis">
      FileExistsWarning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.copy_files_with_regex" class="md-nav__link">
    <span class="md-ellipsis">
      copy_files_with_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.ensure_directory_exists" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_directory_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.get_text_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.iterate_subdir" class="md-nav__link">
    <span class="md-ellipsis">
      iterate_subdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.file_utils.write_text_to_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_text_to_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils" class="md-nav__link">
    <span class="md-ellipsis">
      json_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="json_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.format_json" class="md-nav__link">
    <span class="md-ellipsis">
      format_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.load_json_into_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_json_into_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.load_jsonl_to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      load_jsonl_to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.save_model_to_json" class="md-nav__link">
    <span class="md-ellipsis">
      save_model_to_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.json_utils.write_data_to_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_data_to_json_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils" class="md-nav__link">
    <span class="md-ellipsis">
      progress_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="progress_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.BAR_FORMAT" class="md-nav__link">
    <span class="md-ellipsis">
      BAR_FORMAT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM" class="md-nav__link">
    <span class="md-ellipsis">
      ExpectedTimeTQDM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExpectedTimeTQDM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.delay_start" class="md-nav__link">
    <span class="md-ellipsis">
      delay_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.desc" class="md-nav__link">
    <span class="md-ellipsis">
      desc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.display_interval" class="md-nav__link">
    <span class="md-ellipsis">
      display_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.expected_time" class="md-nav__link">
    <span class="md-ellipsis">
      expected_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress" class="md-nav__link">
    <span class="md-ellipsis">
      TimeProgress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeProgress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.desc" class="md-nav__link">
    <span class="md-ellipsis">
      desc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.display_interval" class="md-nav__link">
    <span class="md-ellipsis">
      display_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.expected_time" class="md-nav__link">
    <span class="md-ellipsis">
      expected_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.progress_utils.TimeProgress.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.slugify" class="md-nav__link">
    <span class="md-ellipsis">
      slugify
    </span>
  </a>
  
    <nav class="md-nav" aria-label="slugify">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.slugify.slugify" class="md-nav__link">
    <span class="md-ellipsis">
      slugify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils" class="md-nav__link">
    <span class="md-ellipsis">
      user_io_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_io_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils.get_single_char" class="md-nav__link">
    <span class="md-ellipsis">
      get_single_char
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.utils.user_io_utils.get_user_confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_confirmation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing" class="md-nav__link">
    <span class="md-ellipsis">
      video_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing" class="md-nav__link">
    <span class="md-ellipsis">
      video_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="video_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSCRIPT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_OPTIONS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_TRANSCRIPT_OPTIONS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack" class="md-nav__link">
    <span class="md-ellipsis">
      SubtitleTrack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SubtitleTrack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.ext" class="md-nav__link">
    <span class="md-ellipsis">
      ext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.SubtitleTrack.url" class="md-nav__link">
    <span class="md-ellipsis">
      url
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError" class="md-nav__link">
    <span class="md-ellipsis">
      TranscriptNotFoundError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TranscriptNotFoundError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.language" class="md-nav__link">
    <span class="md-ellipsis">
      language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.video_url" class="md-nav__link">
    <span class="md-ellipsis">
      video_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo" class="md-nav__link">
    <span class="md-ellipsis">
      VideoInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VideoInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo.automatic_captions" class="md-nav__link">
    <span class="md-ellipsis">
      automatic_captions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.VideoInfo.subtitles" class="md-nav__link">
    <span class="md-ellipsis">
      subtitles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.download_audio_yt" class="md-nav__link">
    <span class="md-ellipsis">
      download_audio_yt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_transcript" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_transcript_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_transcript_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_video_download_path_yt" class="md-nav__link">
    <span class="md-ellipsis">
      get_video_download_path_yt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.video_processing.get_youtube_urls_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      get_youtube_urls_from_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe" class="md-nav__link">
    <span class="md-ellipsis">
      yt_transcribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="yt_transcribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_MS" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_MS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_S" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_CHUNK_DURATION_S
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_OUTPUT_DIR" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_OUTPUT_DIR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_PROMPT" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_PROMPT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.EXPECTED_ENV" class="md-nav__link">
    <span class="md-ellipsis">
      EXPECTED_ENV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.group" class="md-nav__link">
    <span class="md-ellipsis">
      group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.logger" class="md-nav__link">
    <span class="md-ellipsis">
      logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.output_directory" class="md-nav__link">
    <span class="md-ellipsis">
      output_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.parser" class="md-nav__link">
    <span class="md-ellipsis">
      parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.url_file" class="md-nav__link">
    <span class="md-ellipsis">
      url_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.video_urls" class="md-nav__link">
    <span class="md-ellipsis">
      video_urls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.check_conda_env" class="md-nav__link">
    <span class="md-ellipsis">
      check_conda_env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.video_processing.yt_transcribe.transcribe_youtube_videos" class="md-nav__link">
    <span class="md-ellipsis">
      transcribe_youtube_videos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing" class="md-nav__link">
    <span class="md-ellipsis">
      xml_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xml_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.join_xml_data_to_doc" class="md-nav__link">
    <span class="md-ellipsis">
      join_xml_data_to_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.remove_page_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_page_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.save_pages_to_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_pages_to_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.split_xml_on_pagebreaks" class="md-nav__link">
    <span class="md-ellipsis">
      split_xml_on_pagebreaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags" class="md-nav__link">
    <span class="md-ellipsis">
      extract_tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract_tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags.extract_unique_tags" class="md-nav__link">
    <span class="md-ellipsis">
      extract_unique_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.extract_tags.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing" class="md-nav__link">
    <span class="md-ellipsis">
      xml_processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xml_processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.FormattingError" class="md-nav__link">
    <span class="md-ellipsis">
      FormattingError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FormattingError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.FormattingError.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.join_xml_data_to_doc" class="md-nav__link">
    <span class="md-ellipsis">
      join_xml_data_to_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.remove_page_tags" class="md-nav__link">
    <span class="md-ellipsis">
      remove_page_tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.save_pages_to_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_pages_to_xml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tnh_scholar.xml_processing.xml_processing.split_xml_on_pagebreaks" class="md-nav__link">
    <span class="md-ellipsis">
      split_xml_on_pagebreaks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="tnh_scholar" class="doc doc-heading">
            <code>tnh_scholar</code>


</h2>

    <div class="doc doc-contents first">

        <p>TNH Scholar: Buddhist Text Processing and Analysis Tools</p>
<p>TNH Scholar is an AI-driven project designed to explore, query, process and translate
the teachings of Thich Nhat Hanh and other Plum Village Dharma Teachers. The project aims 
to create a resource for practitioners and scholars to deeply engage with mindfulness 
and spiritual wisdom through natural language processing and machine learning models.</p>


<details class="core-features" open>
  <summary>Core Features</summary>
  <ul>
<li>Audio transcription and processing</li>
<li>Multi-lingual text processing and translation</li>
<li>Pattern-based text analysis</li>
<li>OCR processing for historical documents</li>
<li>CLI tools for batch processing</li>
</ul>
</details>

<details class="package-structure" open>
  <summary>Package Structure</summary>
  <p>tnh_scholar/
    CLI_tools/          - Command line interface tools
    audio_processing/   - Audio file handling and transcription
    journal_processing/ - Journal and publication processing
    ocr_processing/     - Optical character recognition tools
    openai_interface/   - OpenAI API integration
    text_processing/    - Core text processing utilities
    video_processing/   - Video file handling and transcription
    utils/             - Shared utility functions
    xml_processing/    - XML parsing and generation</p>
</details>

<details class="environment-configuration" open>
  <summary>Environment Configuration</summary>
  <p>The package uses environment variables for configuration, including:
    TNH_FAB_PATTERN_DIR - Directory for text processing patterns
    OPENAI_API_KEY     - OpenAI API authentication
    GOOGLE_VISION_KEY  - Google Cloud Vision API key for OCR</p>
</details>

<details class="cli-tools" open>
  <summary>CLI Tools</summary>
  <p>audio-transcribe  - Audio file transcription utility
tnh-fab          - Text processing and analysis toolkit</p>
</details>        <p>For more information, see:
    Documentation: https://github.com/aaronksolomon/tnh-scholar/wiki
    Source: https://github.com/aaronksolomon/tnh-scholar
    Issues: https://github.com/aaronksolomon/tnh-scholar/issues</p>


<details class="dependencies" open>
  <summary>Dependencies</summary>
  <p>Core: click, pydantic, openai, yt-dlp
Optional: streamlit (GUI), spacy (NLP), google-cloud-vision (OCR)</p>
</details>







  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.CLI_TOOLS_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CLI_TOOLS_DIR</span> <span class="o">=</span> <span class="n">TNH_ROOT_SRC_DIR</span> <span class="o">/</span> <span class="s1">&#39;cli_tools&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.DEFAULT_PATTERN_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PATTERN_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.config&#39;</span> <span class="o">/</span> <span class="s1">&#39;tnh_scholar&#39;</span> <span class="o">/</span> <span class="s1">&#39;patterns&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.LOG_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">LOG_DIR</span> <span class="o">=</span> <span class="n">PROJECT_ROOT_DIR</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.PROJECT_ROOT_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="n">TNH_ROOT_SRC_DIR</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.TNH_ROOT_SRC_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TNH_ROOT_SRC_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="tnh_scholar.__version__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.1.0&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
    </div>

</div>




<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.ai_text_processing" class="doc doc-heading">
            <code>ai_text_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.ai_text_processing" class="doc doc-heading">
            <code>ai_text_processing</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_MIN_SECTION_COUNT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_MIN_SECTION_COUNT</span> <span class="o">=</span> <span class="mi">3</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_OPENAI_MODEL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_OPENAI_MODEL</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PARAGRAPH_FORMAT_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PARAGRAPH_FORMAT_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_xml_paragraph_format&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_MODEL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PUNCTUATE_MODEL</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PUNCTUATE_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_punctuate&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_PUNCTUATE_STYLE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PUNCTUATE_STYLE</span> <span class="o">=</span> <span class="s1">&#39;APA&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_REVIEW_COUNT</span> <span class="o">=</span> <span class="mi">5</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SECTION_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_section&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RANGE_VAR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SECTION_RANGE_VAR</span> <span class="o">=</span> <span class="mi">2</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RESULT_MAX_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SECTION_RESULT_MAX_SIZE</span> <span class="o">=</span> <span class="mi">4000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_TOKEN_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SECTION_TOKEN_SIZE</span> <span class="o">=</span> <span class="mi">650</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TARGET_LANGUAGE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TARGET_LANGUAGE</span> <span class="o">=</span> <span class="s1">&#39;English&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_CONTEXT_LINES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSLATE_CONTEXT_LINES</span> <span class="o">=</span> <span class="mi">3</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_SEGMENT_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSLATE_SEGMENT_SIZE</span> <span class="o">=</span> <span class="mi">20</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_STYLE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSLATE_STYLE</span> <span class="o">=</span> <span class="s2">&quot;&#39;American Dharma Teaching&#39;&quot;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSLATION_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_line_translation&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATION_TARGET_TOKENS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSLATION_TARGET_TOKENS</span> <span class="o">=</span> <span class="mi">650</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_XML_FORMAT_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_XML_FORMAT_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_xml_format&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.FOLLOWING_CONTEXT_MARKER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">FOLLOWING_CONTEXT_MARKER</span> <span class="o">=</span> <span class="s1">&#39;FOLLOWING_CONTEXT&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.PRECEDING_CONTEXT_MARKER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PRECEDING_CONTEXT_MARKER</span> <span class="o">=</span> <span class="s1">&#39;PRECEDING_CONTEXT&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.SECTION_SEGMENT_SIZE_WARNING_LIMIT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SECTION_SEGMENT_SIZE_WARNING_LIMIT</span> <span class="o">=</span> <span class="mi">5</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.TRANSCRIPT_SEGMENT_MARKER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TRANSCRIPT_SEGMENT_MARKER</span> <span class="o">=</span> <span class="s1">&#39;TRANSCRIPT_SEGMENT&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor" class="doc doc-heading">
            <code>GeneralProcessor</code>


</h5>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GeneralProcessor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize punctuation generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_punctuator: Implementation of TextProcessor</span>
<span class="sd">            punctuate_pattern: Pattern object containing punctuation instructions</span>
<span class="sd">            section_count: Target number of sections</span>
<span class="sd">            review_count: Number of review passes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>

    <span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        process a text based on a pattern and source language.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span><span class="p">:</span>
                <span class="n">source_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
            <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
            <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing text...&quot;</span><span class="p">)</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions:</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing completed.&quot;</span><span class="p">)</span>

        <span class="c1"># normalize newline spacing to two newline between lines and return</span>
        <span class="c1"># commented out to allow pattern to dictate newlines:</span>
        <span class="c1"># return normalize_newlines(text)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.review_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.source_language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize punctuation generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_punctuator</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Implementation of TextProcessor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>punctuate_pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing punctuation instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_count</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of sections</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>review_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of review passes</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT">DEFAULT_REVIEW_COUNT</a></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize punctuation generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_punctuator: Implementation of TextProcessor</span>
<span class="sd">        punctuate_pattern: Pattern object containing punctuation instructions</span>
<span class="sd">        section_count: Target number of sections</span>
<span class="sd">        review_count: Number of review passes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.GeneralProcessor.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>process a text based on a pattern and source language.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    process a text based on a pattern and source language.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
        <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
        <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing text...&quot;</span><span class="p">)</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions:</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing completed.&quot;</span><span class="p">)</span>

    <span class="c1"># normalize newline spacing to two newline between lines and return</span>
    <span class="c1"># commented out to allow pattern to dictate newlines:</span>
    <span class="c1"># return normalize_newlines(text)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator" class="doc doc-heading">
            <code>LineTranslator</code>


</h5>


    <div class="doc doc-contents ">


        <p>Translates text line by line while maintaining line numbers and context.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LineTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translates text line by line while maintaining line numbers and context.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
        <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
        <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_TRANSLATE_STYLE</span><span class="p">,</span>
        <span class="n">context_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TRANSLATE_CONTEXT_LINES</span><span class="p">,</span>  <span class="c1"># Number of context lines before/after</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize line translator.</span>

<span class="sd">        Args:</span>
<span class="sd">            processor: Implementation of TextProcessor</span>
<span class="sd">            pattern: Pattern object containing translation instructions</span>
<span class="sd">            review_count: Number of review passes</span>
<span class="sd">            style: Translation style to apply</span>
<span class="sd">            context_lines: Number of context lines to include before/after</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span> <span class="o">=</span> <span class="n">context_lines</span>

    <span class="k">def</span> <span class="nf">translate_segment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_text</span><span class="p">:</span> <span class="n">NumberedText</span><span class="p">,</span>
        <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TARGET_LANGUAGE</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate a segment of text with context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Full text to extract segment from</span>
<span class="sd">            start_line: Starting line number of segment</span>
<span class="sd">            end_line: Ending line number of segment</span>
<span class="sd">            source_language: Source language code</span>
<span class="sd">            target_language: Target language code (default: English)</span>
<span class="sd">            template_dict: Optional additional template values</span>

<span class="sd">        Returns:</span>
<span class="sd">            Translated text segment with line numbers preserved</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Extract main segment and context</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">numbered_lines</span>

        <span class="c1"># Calculate context ranges</span>
        <span class="n">preceding_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_line</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span><span class="p">)</span>  <span class="c1"># lines start on 1.</span>
        <span class="n">following_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_text</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_line</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span><span class="p">)</span>

        <span class="c1"># Extract context and segment</span>
        <span class="n">preceding_context</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">preceding_start</span><span class="p">,</span> <span class="n">start_line</span><span class="p">)</span>
        <span class="n">transcript_segment</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">)</span>
        <span class="n">following_context</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">following_end</span><span class="p">)</span>

        <span class="c1"># build input text</span>
        <span class="n">translation_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_translation_input</span><span class="p">(</span>
            <span class="n">preceding_context</span><span class="p">,</span> <span class="n">transcript_segment</span><span class="p">,</span> <span class="n">following_context</span>
        <span class="p">)</span>

        <span class="c1"># Prepare template values</span>
        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
            <span class="s2">&quot;target_language&quot;</span><span class="p">:</span> <span class="n">target_language</span><span class="p">,</span>
            <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
            <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

        <span class="c1"># Get and apply translation instructions</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translating segment (lines </span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">translate_instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_line</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Translate instructions (first segment):</span><span class="se">\n</span><span class="si">{</span><span class="n">translate_instructions</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translation input:</span><span class="se">\n</span><span class="si">{</span><span class="n">translation_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">translation_input</span><span class="p">,</span> <span class="n">translate_instructions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_translation_input</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">preceding_context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transcript_segment</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">following_context</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build input text in required XML-style format.</span>

<span class="sd">        Args:</span>
<span class="sd">            preceding_context: Context lines before segment</span>
<span class="sd">            transcript_segment: Main segment to translate</span>
<span class="sd">            following_context: Context lines after segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted input text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add preceding context if exists</span>
        <span class="k">if</span> <span class="n">preceding_context</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">PRECEDING_CONTEXT_MARKER</span><span class="p">,</span>
                    <span class="n">preceding_context</span><span class="p">,</span>
                    <span class="n">PRECEDING_CONTEXT_MARKER</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Add main segment (always required)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">TRANSCRIPT_SEGMENT_MARKER</span><span class="p">,</span>
                <span class="n">transcript_segment</span><span class="p">,</span>
                <span class="n">TRANSCRIPT_SEGMENT_MARKER</span><span class="p">,</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Add following context if exists</span>
        <span class="k">if</span> <span class="n">following_context</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">FOLLOWING_CONTEXT_MARKER</span><span class="p">,</span>
                    <span class="n">following_context</span><span class="p">,</span>
                    <span class="n">FOLLOWING_CONTEXT_MARKER</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Number of lines per segment</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate entire text in segments while maintaining line continuity.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to translate</span>
<span class="sd">            segment_size: Number of lines per translation segment</span>
<span class="sd">            source_language: Source language code</span>
<span class="sd">            target_language: Target language code (default: English)</span>
<span class="sd">            template_dict: Optional additional template values</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete translated text with line numbers preserved</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Auto-detect language if not specified</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Convert text to numbered lines</span>
        <span class="n">num_text</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">total_lines</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">segment_size</span><span class="p">:</span>
            <span class="n">segment_size</span> <span class="o">=</span> <span class="n">_calculate_segment_size</span><span class="p">(</span>
                <span class="n">num_text</span><span class="p">,</span> <span class="n">DEFAULT_TRANSLATION_TARGET_TOKENS</span>
            <span class="p">)</span>

        <span class="n">translated_segments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Total lines to translate: </span><span class="si">{</span><span class="n">total_lines</span><span class="si">}</span><span class="s2"> | Translation segment size: </span><span class="si">{</span><span class="n">segment_size</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Process text in segments using segment iteration</span>
        <span class="k">for</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="ow">in</span> <span class="n">num_text</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">(</span>
            <span class="n">segment_size</span><span class="p">,</span> <span class="n">segment_size</span> <span class="o">//</span> <span class="mi">5</span>
        <span class="p">):</span>
            <span class="n">translated_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_segment</span><span class="p">(</span>
                <span class="n">num_text</span><span class="p">,</span>
                <span class="n">start_idx</span><span class="p">,</span>
                <span class="n">end_idx</span><span class="p">,</span>
                <span class="n">source_language</span><span class="p">,</span>
                <span class="n">target_language</span><span class="p">,</span>
                <span class="n">template_dict</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># validate the translated segment</span>
            <span class="n">translated_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_content</span><span class="p">(</span><span class="n">translated_segment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_segment</span><span class="p">(</span><span class="n">translated_content</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>

            <span class="n">translated_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">translated_content</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">translated_segments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># remove any filling whitespace</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">TRANSCRIPT_SEGMENT_MARKER</span><span class="p">)</span> <span class="ow">and</span> <span class="n">segment</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
            <span class="n">TRANSCRIPT_SEGMENT_MARKER</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">segment</span><span class="p">[</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">TRANSCRIPT_SEGMENT_MARKER</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">TRANSCRIPT_SEGMENT_MARKER</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Translated segment missing transcript_segment tags&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segment</span>

    <span class="k">def</span> <span class="nf">_validate_segment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">translated_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate translated segment format, content, and line number sequence.</span>
<span class="sd">        Issues warnings for validation issues rather than raising errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            translated_segment: Translated text to validate</span>
<span class="sd">            start_idx: the staring index of the range (inclusive)</span>
<span class="sd">            end_line: then ending index of the range (exclusive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Content with segment tags removed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate lines</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">translated_content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">line_numbers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start_line</span> <span class="o">=</span> <span class="n">start_index</span>  <span class="c1"># inclusive start</span>
        <span class="n">end_line</span> <span class="o">=</span> <span class="n">end_index</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># exclusive end</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid line format: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span> <span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">line_num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid line number: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">line_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line number parsing failed: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Validate sequence</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line_numbers</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid line numbers found&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">start_line</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;First line number </span><span class="si">{</span><span class="n">line_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t match expected </span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">line_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">end_line</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Last line number </span><span class="si">{</span><span class="n">line_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t match expected </span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">expected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="o">:=</span> <span class="n">expected</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">line_numbers</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing line numbers in sequence: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="si">}</span><span class="s2"> lines from </span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.context_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">context_lines</span> <span class="o">=</span> <span class="n">context_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.review_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.style" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">style</span> <span class="o">=</span> <span class="n">style</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">DEFAULT_TRANSLATE_STYLE</span><span class="p">,</span> <span class="n">context_lines</span><span class="o">=</span><span class="n">DEFAULT_TRANSLATE_CONTEXT_LINES</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize line translator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor">TextProcessor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Implementation of TextProcessor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing translation instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>review_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of review passes</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT">DEFAULT_REVIEW_COUNT</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>style</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Translation style to apply</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_STYLE" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_STYLE">DEFAULT_TRANSLATE_STYLE</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context_lines</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of context lines to include before/after</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_CONTEXT_LINES" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TRANSLATE_CONTEXT_LINES">DEFAULT_TRANSLATE_CONTEXT_LINES</a></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_TRANSLATE_STYLE</span><span class="p">,</span>
    <span class="n">context_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_TRANSLATE_CONTEXT_LINES</span><span class="p">,</span>  <span class="c1"># Number of context lines before/after</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize line translator.</span>

<span class="sd">    Args:</span>
<span class="sd">        processor: Implementation of TextProcessor</span>
<span class="sd">        pattern: Pattern object containing translation instructions</span>
<span class="sd">        review_count: Number of review passes</span>
<span class="sd">        style: Translation style to apply</span>
<span class="sd">        context_lines: Number of context lines to include before/after</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span> <span class="o">=</span> <span class="n">context_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_segment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_segment</span><span class="p">(</span><span class="n">num_text</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_language</span><span class="o">=</span><span class="n">DEFAULT_TARGET_LANGUAGE</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Translate a segment of text with context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full text to extract segment from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_line</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number of segment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_line</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending line number of segment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source language code</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target language code (default: English)</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TARGET_LANGUAGE" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_TARGET_LANGUAGE">DEFAULT_TARGET_LANGUAGE</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional template values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Translated text segment with line numbers preserved</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_segment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_text</span><span class="p">:</span> <span class="n">NumberedText</span><span class="p">,</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TARGET_LANGUAGE</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate a segment of text with context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Full text to extract segment from</span>
<span class="sd">        start_line: Starting line number of segment</span>
<span class="sd">        end_line: Ending line number of segment</span>
<span class="sd">        source_language: Source language code</span>
<span class="sd">        target_language: Target language code (default: English)</span>
<span class="sd">        template_dict: Optional additional template values</span>

<span class="sd">    Returns:</span>
<span class="sd">        Translated text segment with line numbers preserved</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract main segment and context</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">numbered_lines</span>

    <span class="c1"># Calculate context ranges</span>
    <span class="n">preceding_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_line</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span><span class="p">)</span>  <span class="c1"># lines start on 1.</span>
    <span class="n">following_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_text</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_line</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_lines</span><span class="p">)</span>

    <span class="c1"># Extract context and segment</span>
    <span class="n">preceding_context</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">preceding_start</span><span class="p">,</span> <span class="n">start_line</span><span class="p">)</span>
    <span class="n">transcript_segment</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">)</span>
    <span class="n">following_context</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">following_end</span><span class="p">)</span>

    <span class="c1"># build input text</span>
    <span class="n">translation_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_translation_input</span><span class="p">(</span>
        <span class="n">preceding_context</span><span class="p">,</span> <span class="n">transcript_segment</span><span class="p">,</span> <span class="n">following_context</span>
    <span class="p">)</span>

    <span class="c1"># Prepare template values</span>
    <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
        <span class="s2">&quot;target_language&quot;</span><span class="p">:</span> <span class="n">target_language</span><span class="p">,</span>
        <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
        <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

    <span class="c1"># Get and apply translation instructions</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translating segment (lines </span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">translate_instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start_line</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Translate instructions (first segment):</span><span class="se">\n</span><span class="si">{</span><span class="n">translate_instructions</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translation input:</span><span class="se">\n</span><span class="si">{</span><span class="n">translation_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">translation_input</span><span class="p">,</span> <span class="n">translate_instructions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LineTranslator.translate_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">segment_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Translate entire text in segments while maintaining line continuity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to translate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of lines per translation segment</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source language code</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target language code (default: English)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional template values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Complete translated text with line numbers preserved</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Number of lines per segment</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate entire text in segments while maintaining line continuity.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to translate</span>
<span class="sd">        segment_size: Number of lines per translation segment</span>
<span class="sd">        source_language: Source language code</span>
<span class="sd">        target_language: Target language code (default: English)</span>
<span class="sd">        template_dict: Optional additional template values</span>

<span class="sd">    Returns:</span>
<span class="sd">        Complete translated text with line numbers preserved</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Auto-detect language if not specified</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
        <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># Convert text to numbered lines</span>
    <span class="n">num_text</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">total_lines</span> <span class="o">=</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">segment_size</span><span class="p">:</span>
        <span class="n">segment_size</span> <span class="o">=</span> <span class="n">_calculate_segment_size</span><span class="p">(</span>
            <span class="n">num_text</span><span class="p">,</span> <span class="n">DEFAULT_TRANSLATION_TARGET_TOKENS</span>
        <span class="p">)</span>

    <span class="n">translated_segments</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Total lines to translate: </span><span class="si">{</span><span class="n">total_lines</span><span class="si">}</span><span class="s2"> | Translation segment size: </span><span class="si">{</span><span class="n">segment_size</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Process text in segments using segment iteration</span>
    <span class="k">for</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="ow">in</span> <span class="n">num_text</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">(</span>
        <span class="n">segment_size</span><span class="p">,</span> <span class="n">segment_size</span> <span class="o">//</span> <span class="mi">5</span>
    <span class="p">):</span>
        <span class="n">translated_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_segment</span><span class="p">(</span>
            <span class="n">num_text</span><span class="p">,</span>
            <span class="n">start_idx</span><span class="p">,</span>
            <span class="n">end_idx</span><span class="p">,</span>
            <span class="n">source_language</span><span class="p">,</span>
            <span class="n">target_language</span><span class="p">,</span>
            <span class="n">template_dict</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># validate the translated segment</span>
        <span class="n">translated_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_content</span><span class="p">(</span><span class="n">translated_segment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_segment</span><span class="p">(</span><span class="n">translated_content</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>

        <span class="n">translated_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">translated_content</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">translated_segments</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager" class="doc doc-heading">
            <code>LocalPatternManager</code>


</h5>


    <div class="doc doc-contents ">


        <p>A simple singleton implementation of PatternManager that ensures only one instance
is created and reused throughout the application lifecycle.</p>
<p>This class wraps the PatternManager to provide efficient pattern loading by
maintaining a single reusable instance.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager._instance">_instance</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[SingletonPatternManager]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The singleton instance</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager._pattern_manager">_pattern_manager</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.PatternManager" href="#tnh_scholar.ai_text_processing.patterns.PatternManager">PatternManager</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wrapped PatternManager instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LocalPatternManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple singleton implementation of PatternManager that ensures only one instance</span>
<span class="sd">    is created and reused throughout the application lifecycle.</span>

<span class="sd">    This class wraps the PatternManager to provide efficient pattern loading by</span>
<span class="sd">    maintaining a single reusable instance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _instance (Optional[SingletonPatternManager]): The singleton instance</span>
<span class="sd">        _pattern_manager (Optional[PatternManager]): The wrapped PatternManager instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;LocalPatternManager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;LocalPatternManager&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create or return the singleton instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SingletonPatternManager: The singleton instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_pattern_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pattern_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PatternManager&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lazy initialization of the PatternManager instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PatternManager: The wrapped PatternManager instance</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If PATTERN_REPO is not properly configured</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">load_dotenv</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">pattern_path_name</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;TNH_FAB_PATTERN_DIR&quot;</span><span class="p">):</span>
                    <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pattern_path_name</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pattern dir: </span><span class="si">{</span><span class="n">pattern_path_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">DEFAULT_PATTERN_DIR</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_manager</span> <span class="o">=</span> <span class="n">PatternManager</span><span class="p">(</span><span class="n">pattern_dir</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to initialize PatternManager. Ensure pattern_manager &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;module and PATTERN_REPO are properly configured: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_manager</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.pattern_manager" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pattern_manager</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Lazy initialization of the PatternManager instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PatternManager</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.PatternManager" href="#tnh_scholar.ai_text_processing.patterns.PatternManager">PatternManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wrapped PatternManager instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If PATTERN_REPO is not properly configured</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager.__new__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__new__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Create or return the singleton instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SingletonPatternManager</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager" href="#tnh_scholar.ai_text_processing.ai_text_processing.LocalPatternManager">LocalPatternManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The singleton instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;LocalPatternManager&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create or return the singleton instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SingletonPatternManager: The singleton instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_pattern_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor" class="doc doc-heading">
            <code>OpenAIProcessor</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor">TextProcessor</a></code></p>


        <p>OpenAI-based text processor implementation.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OpenAIProcessor</span><span class="p">(</span><span class="n">TextProcessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenAI-based text processor implementation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">DEFAULT_OPENAI_MODEL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_tokens</span>

    <span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ResponseFormat</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process text using OpenAI API with optional structured output.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span>

        <span class="k">return</span> <span class="n">openai_process_text</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">instructions</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
            <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.max_tokens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_tokens</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span> <span class="o">=</span> <span class="n">model</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DEFAULT_OPENAI_MODEL</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.OpenAIProcessor.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Process text using OpenAI API with optional structured output.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">response_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ResponseFormat</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process text using OpenAI API with optional structured output.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span>

    <span class="k">return</span> <span class="n">openai_process_text</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">instructions</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
        <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection" class="doc doc-heading">
            <code>ProcessedSection</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">


        <p>Represents a processed section of text with its metadata.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ProcessedSection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a processed section of text with its metadata.&quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">original_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">processed_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.end_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_line</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.original_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">original_text</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.processed_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">processed_text</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.start_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_line</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">title</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">original_text</span><span class="p">,</span> <span class="n">processed_text</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span></code>

</h6>


    <div class="doc doc-contents ">

    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser" class="doc doc-heading">
            <code>SectionParser</code>


</h5>


    <div class="doc doc-contents ">


        <p>Generates structured section breakdowns of text content.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SectionParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates structured section breakdowns of text content.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">section_scanner</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
        <span class="n">section_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
        <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize section generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            processor: Implementation of TextProcessor</span>
<span class="sd">            pattern: Pattern object containing section generation instructions</span>
<span class="sd">            max_tokens: Maximum tokens for response</span>
<span class="sd">            section_count: Target number of sections</span>
<span class="sd">            review_count: Number of review passes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_scanner</span> <span class="o">=</span> <span class="n">section_scanner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_pattern</span> <span class="o">=</span> <span class="n">section_pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>

    <span class="k">def</span> <span class="nf">find_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">section_count_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">segment_size_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate section breakdown of input text. The text must be split up by newlines.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text to process</span>
<span class="sd">            source_language: ISO 639-1 language code, or None for autodetection</span>
<span class="sd">            section_count_target: the target for the number of sections to find</span>
<span class="sd">            segment_size_target: the target for the number of lines per section</span>
<span class="sd">                (if section_count_target is specified, this value will be set to generate correct segments)</span>
<span class="sd">            template_dict: Optional additional template variables</span>

<span class="sd">        Returns:</span>
<span class="sd">            TextObject containing section breakdown</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If response doesn&#39;t match TextObject schema</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Prepare numbered text, each line is numbered</span>
        <span class="n">num_text</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">SECTION_SEGMENT_SIZE_WARNING_LIMIT</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;find_sections: Text has only </span><span class="si">{</span><span class="n">num_text</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> lines. This may lead to unexpected sectioning results.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get language if not specified</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># determine section count if not specified</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">section_count_target</span><span class="p">:</span>
            <span class="n">segment_size_target</span><span class="p">,</span> <span class="n">section_count_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_count_info</span><span class="p">(</span>
                <span class="n">text</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">segment_size_target</span><span class="p">:</span>
            <span class="n">segment_size_target</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num_text</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">section_count_target</span><span class="p">)</span>

        <span class="n">section_count_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_count_range</span><span class="p">(</span><span class="n">section_count_target</span><span class="p">)</span>

        <span class="c1"># Prepare template variables</span>
        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
            <span class="s2">&quot;section_count&quot;</span><span class="p">:</span> <span class="n">section_count_range</span><span class="p">,</span>
            <span class="s2">&quot;line_count&quot;</span><span class="p">:</span> <span class="n">segment_size_target</span><span class="p">,</span>
            <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
            <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

        <span class="c1"># Get and apply processing instructions</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finding sections with pattern instructions:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Finding sections for </span><span class="si">{</span><span class="n">source_language</span><span class="si">}</span><span class="s2"> text &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(target sections: </span><span class="si">{</span><span class="n">section_count_target</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Process text with structured output</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_scanner</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">num_text</span><span class="p">),</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="n">TextObject</span>
            <span class="p">)</span>

            <span class="c1"># Validate section coverage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_sections</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sections</span><span class="p">,</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Section generation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_get_section_count_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">num_text</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">segment_size</span> <span class="o">=</span> <span class="n">_calculate_segment_size</span><span class="p">(</span><span class="n">num_text</span><span class="p">,</span> <span class="n">DEFAULT_SECTION_TOKEN_SIZE</span><span class="p">)</span>
        <span class="n">section_count_target</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num_text</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">segment_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">segment_size</span><span class="p">,</span> <span class="n">section_count_target</span>

    <span class="k">def</span> <span class="nf">_get_section_count_range</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">section_count_target</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">section_range_var</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_SECTION_RANGE_VAR</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">low</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">section_count_target</span> <span class="o">-</span> <span class="n">section_range_var</span><span class="p">)</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">section_count_target</span> <span class="o">+</span> <span class="n">section_range_var</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">low</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">high</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_validate_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LogicalSection</span><span class="p">],</span> <span class="n">total_lines</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate section line coverage and ordering. Issues warnings for validation problems</span>
<span class="sd">        instead of raising errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            sections: List of generated sections</span>
<span class="sd">            text: Original text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">covered_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">last_end</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="c1"># Check line ordering</span>
            <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">start_line</span> <span class="o">&lt;=</span> <span class="n">last_end</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Section lines should be sequential but found overlap: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;section starting at </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="si">}</span><span class="s2"> begins before or at &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;previous section end </span><span class="si">{</span><span class="n">last_end</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Track line coverage</span>
            <span class="n">section_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span> <span class="n">section</span><span class="o">.</span><span class="n">end_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">section_lines</span> <span class="o">&amp;</span> <span class="n">covered_lines</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found overlapping lines in section &#39;</span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title_en</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Each line should belong to exactly one section.&quot;</span>
                <span class="p">)</span>
            <span class="n">covered_lines</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">section_lines</span><span class="p">)</span>

            <span class="n">last_end</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">end_line</span>

        <span class="c1"># Check complete coverage</span>
        <span class="n">expected_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">covered_lines</span> <span class="o">!=</span> <span class="n">expected_lines</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">expected_lines</span> <span class="o">-</span> <span class="n">covered_lines</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not all lines are covered by sections. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Missing line numbers: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.review_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_pattern</span> <span class="o">=</span> <span class="n">section_pattern</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.section_scanner" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_scanner</span> <span class="o">=</span> <span class="n">section_scanner</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">section_scanner</span><span class="p">,</span> <span class="n">section_pattern</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize section generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processor</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Implementation of TextProcessor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing section generation instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_tokens</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum tokens for response</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_count</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of sections</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>review_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of review passes</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT">DEFAULT_REVIEW_COUNT</a></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">section_scanner</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
    <span class="n">section_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize section generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        processor: Implementation of TextProcessor</span>
<span class="sd">        pattern: Pattern object containing section generation instructions</span>
<span class="sd">        max_tokens: Maximum tokens for response</span>
<span class="sd">        section_count: Target number of sections</span>
<span class="sd">        review_count: Number of review passes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">section_scanner</span> <span class="o">=</span> <span class="n">section_scanner</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">section_pattern</span> <span class="o">=</span> <span class="n">section_pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionParser.find_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_sections</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">section_count_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segment_size_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generate section breakdown of input text. The text must be split up by newlines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ISO 639-1 language code, or None for autodetection</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_count_target</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target for the number of sections to find</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment_size_target</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target for the number of lines per section
(if section_count_target is specified, this value will be set to generate correct segments)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional template variables</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.response_format.TextObject" href="#tnh_scholar.ai_text_processing.response_format.TextObject">TextObject</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TextObject containing section breakdown</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValidationError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If response doesn't match TextObject schema</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_sections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">section_count_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">segment_size_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate section breakdown of input text. The text must be split up by newlines.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Input text to process</span>
<span class="sd">        source_language: ISO 639-1 language code, or None for autodetection</span>
<span class="sd">        section_count_target: the target for the number of sections to find</span>
<span class="sd">        segment_size_target: the target for the number of lines per section</span>
<span class="sd">            (if section_count_target is specified, this value will be set to generate correct segments)</span>
<span class="sd">        template_dict: Optional additional template variables</span>

<span class="sd">    Returns:</span>
<span class="sd">        TextObject containing section breakdown</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If response doesn&#39;t match TextObject schema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Prepare numbered text, each line is numbered</span>
    <span class="n">num_text</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">SECTION_SEGMENT_SIZE_WARNING_LIMIT</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;find_sections: Text has only </span><span class="si">{</span><span class="n">num_text</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> lines. This may lead to unexpected sectioning results.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Get language if not specified</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
        <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># determine section count if not specified</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">section_count_target</span><span class="p">:</span>
        <span class="n">segment_size_target</span><span class="p">,</span> <span class="n">section_count_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_count_info</span><span class="p">(</span>
            <span class="n">text</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">segment_size_target</span><span class="p">:</span>
        <span class="n">segment_size_target</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num_text</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">section_count_target</span><span class="p">)</span>

    <span class="n">section_count_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_count_range</span><span class="p">(</span><span class="n">section_count_target</span><span class="p">)</span>

    <span class="c1"># Prepare template variables</span>
    <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
        <span class="s2">&quot;section_count&quot;</span><span class="p">:</span> <span class="n">section_count_range</span><span class="p">,</span>
        <span class="s2">&quot;line_count&quot;</span><span class="p">:</span> <span class="n">segment_size_target</span><span class="p">,</span>
        <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
        <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

    <span class="c1"># Get and apply processing instructions</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finding sections with pattern instructions:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Finding sections for </span><span class="si">{</span><span class="n">source_language</span><span class="si">}</span><span class="s2"> text &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(target sections: </span><span class="si">{</span><span class="n">section_count_target</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Process text with structured output</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_scanner</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">num_text</span><span class="p">),</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="n">TextObject</span>
        <span class="p">)</span>

        <span class="c1"># Validate section coverage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_sections</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sections</span><span class="p">,</span> <span class="n">num_text</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Section generation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor" class="doc doc-heading">
            <code>SectionProcessor</code>


</h5>


    <div class="doc doc-contents ">


        <p>Handles section-based XML text processing with configurable output handling.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SectionProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles section-based XML text processing with configurable output handling.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">wrap_in_document</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the XML section processor.</span>

<span class="sd">        Args:</span>
<span class="sd">            processor: Implementation of TextProcessor to use</span>
<span class="sd">            pattern: Pattern object containing processing instructions</span>
<span class="sd">            template_dict: Dictionary for template substitution</span>
<span class="sd">            wrap_in_document: Whether to wrap output in &lt;document&gt; tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span> <span class="o">=</span> <span class="n">template_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrap_in_document</span> <span class="o">=</span> <span class="n">wrap_in_document</span>

    <span class="k">def</span> <span class="nf">process_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">text_object</span><span class="p">:</span> <span class="n">TextObject</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">ProcessedSection</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process transcript sections and yield results one section at a time.</span>

<span class="sd">        Args:</span>
<span class="sd">            transcript: Text to process</span>
<span class="sd">            text_object: Object containing section definitions</span>

<span class="sd">        Yields:</span>
<span class="sd">            ProcessedSection: One processed section at a time, containing:</span>
<span class="sd">                - title: Section title (English or original language)</span>
<span class="sd">                - original_text: Raw text segment</span>
<span class="sd">                - processed_text: Processed text content</span>
<span class="sd">                - start_line: Starting line number</span>
<span class="sd">                - end_line: Ending line number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numbered_transcript</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="n">text_object</span><span class="o">.</span><span class="n">sections</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> sections with pattern: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing section </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>

            <span class="c1"># Get text segment for section</span>
            <span class="n">text_segment</span> <span class="o">=</span> <span class="n">numbered_transcript</span><span class="o">.</span><span class="n">get_segment</span><span class="p">(</span>
                <span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">end_line</span>
            <span class="p">)</span>

            <span class="c1"># Prepare template variables</span>
            <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;section_title&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">text_object</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span><span class="p">:</span>
                <span class="n">template_values</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span>

            <span class="c1"># Get and apply processing instructions</span>
            <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions (first section):</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">processed_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text_segment</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">ProcessedSection</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="n">original_text</span><span class="o">=</span><span class="n">text_segment</span><span class="p">,</span>
                <span class="n">processed_text</span><span class="o">=</span><span class="n">processed_text</span><span class="p">,</span>
                <span class="n">start_line</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
                <span class="n">end_line</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_paragraphs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process transcript by paragraphs (as sections) where paragraphs are assumed to be given as newline separated.</span>

<span class="sd">        Args:</span>
<span class="sd">            transcript: Text to process</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator of lines</span>

<span class="sd">        Yields:</span>
<span class="sd">            Processed lines as strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numbered_transcript</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing lines as paragraphs with pattern: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">numbered_transcript</span><span class="p">:</span>

            <span class="c1"># If line is empty or whitespace, continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">continue</span>

            <span class="c1"># Otherwise get and apply processing instructions</span>
            <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions (first paragraph):</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.template_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">template_dict</span> <span class="o">=</span> <span class="n">template_dict</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.wrap_in_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_in_document</span> <span class="o">=</span> <span class="n">wrap_in_document</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">,</span> <span class="n">wrap_in_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize the XML section processor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" href="#tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor">TextProcessor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Implementation of TextProcessor to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing processing instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary for template substitution</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wrap_in_document</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to wrap output in <document> tags</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">wrap_in_document</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the XML section processor.</span>

<span class="sd">    Args:</span>
<span class="sd">        processor: Implementation of TextProcessor to use</span>
<span class="sd">        pattern: Pattern object containing processing instructions</span>
<span class="sd">        template_dict: Dictionary for template substitution</span>
<span class="sd">        wrap_in_document: Whether to wrap output in &lt;document&gt; tags</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span> <span class="o">=</span> <span class="n">template_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wrap_in_document</span> <span class="o">=</span> <span class="n">wrap_in_document</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_paragraphs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_paragraphs</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Process transcript by paragraphs (as sections) where paragraphs are assumed to be given as newline separated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transcript</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator of lines</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processed lines as strings</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_paragraphs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process transcript by paragraphs (as sections) where paragraphs are assumed to be given as newline separated.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript: Text to process</span>

<span class="sd">    Returns:</span>
<span class="sd">        Generator of lines</span>

<span class="sd">    Yields:</span>
<span class="sd">        Processed lines as strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numbered_transcript</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing lines as paragraphs with pattern: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">numbered_transcript</span><span class="p">:</span>

        <span class="c1"># If line is empty or whitespace, continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># Otherwise get and apply processing instructions</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions (first paragraph):</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.SectionProcessor.process_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_sections</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">text_object</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Process transcript sections and yield results one section at a time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transcript</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_object</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.response_format.TextObject" href="#tnh_scholar.ai_text_processing.response_format.TextObject">TextObject</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object containing section definitions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ProcessedSection</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection" href="#tnh_scholar.ai_text_processing.ai_text_processing.ProcessedSection">ProcessedSection</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One processed section at a time, containing:
- title: Section title (English or original language)
- original_text: Raw text segment
- processed_text: Processed text content
- start_line: Starting line number
- end_line: Ending line number</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_sections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">text_object</span><span class="p">:</span> <span class="n">TextObject</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">ProcessedSection</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process transcript sections and yield results one section at a time.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript: Text to process</span>
<span class="sd">        text_object: Object containing section definitions</span>

<span class="sd">    Yields:</span>
<span class="sd">        ProcessedSection: One processed section at a time, containing:</span>
<span class="sd">            - title: Section title (English or original language)</span>
<span class="sd">            - original_text: Raw text segment</span>
<span class="sd">            - processed_text: Processed text content</span>
<span class="sd">            - start_line: Starting line number</span>
<span class="sd">            - end_line: Ending line number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numbered_transcript</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">text_object</span><span class="o">.</span><span class="n">sections</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> sections with pattern: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing section </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>

        <span class="c1"># Get text segment for section</span>
        <span class="n">text_segment</span> <span class="o">=</span> <span class="n">numbered_transcript</span><span class="o">.</span><span class="n">get_segment</span><span class="p">(</span>
            <span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">end_line</span>
        <span class="p">)</span>

        <span class="c1"># Prepare template variables</span>
        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;section_title&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">text_object</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
            <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span><span class="p">:</span>
            <span class="n">template_values</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_dict</span>

        <span class="c1"># Get and apply processing instructions</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Process instructions (first section):</span><span class="se">\n</span><span class="si">{</span><span class="n">instructions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">processed_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text_segment</span><span class="p">,</span> <span class="n">instructions</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">ProcessedSection</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="n">original_text</span><span class="o">=</span><span class="n">text_segment</span><span class="p">,</span>
            <span class="n">processed_text</span><span class="o">=</span><span class="n">processed_text</span><span class="p">,</span>
            <span class="n">start_line</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">start_line</span><span class="p">,</span>
            <span class="n">end_line</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor" class="doc doc-heading">
            <code>TextProcessor</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for text processors that can return Pydantic objects.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TextProcessor</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for text processors that can return Pydantic objects.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ResponseFormat</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process text according to instructions.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text to process</span>
<span class="sd">            instructions: Processing instructions</span>
<span class="sd">            response_object: Optional Pydantic class for structured output</span>
<span class="sd">            **kwargs: Additional processing parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            Either string or Pydantic model instance based on response_model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextProcessor.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Process text according to instructions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>instructions</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>response_object</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Pydantic class for structured output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional processing parameters</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[str, <a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.typing.ResponseFormat" href="#tnh_scholar.ai_text_processing.typing.ResponseFormat">ResponseFormat</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either string or Pydantic model instance based on response_model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">response_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ResponseFormat</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process text according to instructions.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Input text to process</span>
<span class="sd">        instructions: Processing instructions</span>
<span class="sd">        response_object: Optional Pydantic class for structured output</span>
<span class="sd">        **kwargs: Additional processing parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Either string or Pydantic model instance based on response_model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator" class="doc doc-heading">
            <code>TextPunctuator</code>


</h5>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TextPunctuator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
        <span class="n">punctuate_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
        <span class="n">style_convention</span><span class="o">=</span><span class="n">DEFAULT_PUNCTUATE_STYLE</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize punctuation generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_punctuator: Implementation of TextProcessor</span>
<span class="sd">            punctuate_pattern: Pattern object containing punctuation instructions</span>
<span class="sd">            section_count: Target number of sections</span>
<span class="sd">            review_count: Number of review passes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">punctuate_pattern</span> <span class="o">=</span> <span class="n">punctuate_pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_convention</span> <span class="o">=</span> <span class="n">style_convention</span>

    <span class="k">def</span> <span class="nf">punctuate_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        punctuate a text based on a pattern and source language.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span><span class="p">:</span>
                <span class="n">source_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
            <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
            <span class="s2">&quot;style_convention&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_convention</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
            <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Punctuating text...&quot;</span><span class="p">)</span>
        <span class="n">punctuate_instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">punctuate_pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">punctuate_instructions</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Punctuation completed.&quot;</span><span class="p">)</span>

        <span class="c1"># normalize newline spacing to two newline (default) between lines and return</span>
        <span class="c1"># commented out to allow pattern to dictate newlines.</span>
        <span class="c1"># return normalize_newlines(text)</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">punctuate_pattern</span> <span class="o">=</span> <span class="n">punctuate_pattern</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.review_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.source_language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.style_convention" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">style_convention</span> <span class="o">=</span> <span class="n">style_convention</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">punctuate_pattern</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span> <span class="n">style_convention</span><span class="o">=</span><span class="n">DEFAULT_PUNCTUATE_STYLE</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize punctuation generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_punctuator</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Implementation of TextProcessor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>punctuate_pattern</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing punctuation instructions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_count</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of sections</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>review_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of review passes</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT">DEFAULT_REVIEW_COUNT</a></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">TextProcessor</span><span class="p">,</span>
    <span class="n">punctuate_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="n">style_convention</span><span class="o">=</span><span class="n">DEFAULT_PUNCTUATE_STYLE</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize punctuation generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_punctuator: Implementation of TextProcessor</span>
<span class="sd">        punctuate_pattern: Pattern object containing punctuation instructions</span>
<span class="sd">        section_count: Target number of sections</span>
<span class="sd">        review_count: Number of review passes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span> <span class="o">=</span> <span class="n">source_language</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">punctuate_pattern</span> <span class="o">=</span> <span class="n">punctuate_pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span> <span class="o">=</span> <span class="n">review_count</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">style_convention</span> <span class="o">=</span> <span class="n">style_convention</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.ai_text_processing.TextPunctuator.punctuate_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">punctuate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>punctuate a text based on a pattern and source language.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">punctuate_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    punctuate a text based on a pattern and source language.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_language</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_language</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_language&quot;</span><span class="p">:</span> <span class="n">source_language</span><span class="p">,</span>
        <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_count</span><span class="p">,</span>
        <span class="s2">&quot;style_convention&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_convention</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">template_dict</span><span class="p">:</span>
        <span class="n">template_values</span> <span class="o">|=</span> <span class="n">template_dict</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Punctuating text...&quot;</span><span class="p">)</span>
    <span class="n">punctuate_instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">punctuate_pattern</span><span class="o">.</span><span class="n">apply_template</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">punctuate_instructions</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Punctuation completed.&quot;</span><span class="p">)</span>

    <span class="c1"># normalize newline spacing to two newline (default) between lines and return</span>
    <span class="c1"># commented out to allow pattern to dictate newlines.</span>
    <span class="c1"># return normalize_newlines(text)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.find_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_sections</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">section_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">section_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="n">DEFAULT_SECTION_RESULT_MAX_SIZE</span><span class="p">,</span> <span class="n">section_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>High-level function for generating text sections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_language</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ISO 639-1 language code</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom pattern (uses default if None)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional model identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_tokens</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum tokens for response</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RESULT_MAX_SIZE" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_SECTION_RESULT_MAX_SIZE">DEFAULT_SECTION_RESULT_MAX_SIZE</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_count</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of sections</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>review_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of review passes</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT" href="#tnh_scholar.ai_text_processing.ai_text_processing.DEFAULT_REVIEW_COUNT">DEFAULT_REVIEW_COUNT</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional template variables</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.response_format.TextObject" href="#tnh_scholar.ai_text_processing.response_format.TextObject">TextObject</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TextObject containing section breakdown</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_sections</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">section_pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">section_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_SECTION_RESULT_MAX_SIZE</span><span class="p">,</span>
    <span class="n">section_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TextObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level function for generating text sections.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Input text</span>
<span class="sd">        source_language: ISO 639-1 language code</span>
<span class="sd">        pattern: Optional custom pattern (uses default if None)</span>
<span class="sd">        model: Optional model identifier</span>
<span class="sd">        max_tokens: Maximum tokens for response</span>
<span class="sd">        section_count: Target number of sections</span>
<span class="sd">        review_count: Number of review passes</span>
<span class="sd">        template_dict: Optional additional template variables</span>

<span class="sd">    Returns:</span>
<span class="sd">        TextObject containing section breakdown</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">section_pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">section_pattern</span> <span class="o">=</span> <span class="n">get_default_pattern</span><span class="p">(</span><span class="n">DEFAULT_SECTION_PATTERN</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default section pattern: </span><span class="si">{</span><span class="n">DEFAULT_SECTION_PATTERN</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source_language</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_language</span> <span class="o">=</span> <span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">section_scanner</span> <span class="o">=</span> <span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">section_model</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">SectionParser</span><span class="p">(</span>
        <span class="n">section_scanner</span><span class="o">=</span><span class="n">section_scanner</span><span class="p">,</span>
        <span class="n">section_pattern</span><span class="o">=</span><span class="n">section_pattern</span><span class="p">,</span>
        <span class="n">review_count</span><span class="o">=</span><span class="n">review_count</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">find_sections</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span>
        <span class="n">section_count_target</span><span class="o">=</span><span class="n">section_count</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="o">=</span><span class="n">template_dict</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.get_default_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_default_pattern</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get a pattern by name using the singleton PatternManager.</p>
<p>This is a more efficient version that reuses a single PatternManager instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pattern to load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded pattern</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If pattern name is invalid</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If pattern file doesn't exist</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_default_pattern</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a pattern by name using the singleton PatternManager.</span>

<span class="sd">    This is a more efficient version that reuses a single PatternManager instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Name of the pattern to load</span>

<span class="sd">    Returns:</span>
<span class="sd">        The loaded pattern</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If pattern name is invalid</span>
<span class="sd">        FileNotFoundError: If pattern file doesn&#39;t exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">LocalPatternManager</span><span class="p">()</span><span class="o">.</span><span class="n">pattern_manager</span><span class="o">.</span><span class="n">load_pattern</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DEFAULT_OPENAI_MODEL</span>

    <span class="n">processor</span> <span class="o">=</span> <span class="n">GeneralProcessor</span><span class="p">(</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">model</span><span class="p">),</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="n">template_dict</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_paragraphs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text_by_paragraphs</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>High-level function for processing text paragraphs. Assumes paragraphs are separated by newlines.
Uses DEFAULT_XML_FORMAT_PATTERN as default pattern for text processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transcript</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing processing instructions</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary for template substitution</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional model identifier for processor</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator for ProcessedSections</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_text_by_paragraphs</span><span class="p">(</span>
    <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level function for processing text paragraphs. Assumes paragraphs are separated by newlines.</span>
<span class="sd">    Uses DEFAULT_XML_FORMAT_PATTERN as default pattern for text processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript: Text to process</span>
<span class="sd">        pattern: Pattern object containing processing instructions</span>
<span class="sd">        template_dict: Dictionary for template substitution</span>
<span class="sd">        model: Optional model identifier for processor</span>


<span class="sd">    Returns:</span>
<span class="sd">        Generator for ProcessedSections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">get_default_pattern</span><span class="p">(</span><span class="n">DEFAULT_PARAGRAPH_FORMAT_PATTERN</span><span class="p">)</span>

    <span class="n">section_processor</span> <span class="o">=</span> <span class="n">SectionProcessor</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">section_processor</span><span class="o">.</span><span class="n">process_paragraphs</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.process_text_by_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text_by_sections</span><span class="p">(</span><span class="n">transcript</span><span class="p">,</span> <span class="n">text_object</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>High-level function for processing text sections with configurable output handling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transcript</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to process</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_object</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.response_format.TextObject" href="#tnh_scholar.ai_text_processing.response_format.TextObject">TextObject</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object containing section definitions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pattern object containing processing instructions</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary for template substitution</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional model identifier for processor</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generator for ProcessedSections</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_text_by_sections</span><span class="p">(</span>
    <span class="n">transcript</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">text_object</span><span class="p">:</span> <span class="n">TextObject</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">ProcessedSection</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level function for processing text sections with configurable output handling.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript: Text to process</span>
<span class="sd">        text_object: Object containing section definitions</span>
<span class="sd">        pattern: Pattern object containing processing instructions</span>
<span class="sd">        template_dict: Dictionary for template substitution</span>
<span class="sd">        model: Optional model identifier for processor</span>

<span class="sd">    Returns:</span>
<span class="sd">        Generator for ProcessedSections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">get_default_pattern</span><span class="p">(</span><span class="n">DEFAULT_XML_FORMAT_PATTERN</span><span class="p">)</span>

    <span class="n">section_processor</span> <span class="o">=</span> <span class="n">SectionProcessor</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">section_processor</span><span class="o">.</span><span class="n">process_sections</span><span class="p">(</span>
        <span class="n">transcript</span><span class="p">,</span>
        <span class="n">text_object</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.punctuate_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">punctuate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">punctuate_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">punctuate_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">punctuate_text</span><span class="p">(</span>
    <span class="n">text</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">punctuate_pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">punctuate_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">punctuate_model</span><span class="p">:</span>
        <span class="n">punctuate_model</span> <span class="o">=</span> <span class="n">DEFAULT_PUNCTUATE_MODEL</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">punctuate_pattern</span><span class="p">:</span>
        <span class="n">punctuate_pattern</span> <span class="o">=</span> <span class="n">get_default_pattern</span><span class="p">(</span><span class="n">DEFAULT_PUNCTUATE_PATTERN</span><span class="p">)</span>

    <span class="n">punctuator</span> <span class="o">=</span> <span class="n">TextPunctuator</span><span class="p">(</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">punctuate_model</span><span class="p">),</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span>
        <span class="n">punctuate_pattern</span><span class="o">=</span><span class="n">punctuate_pattern</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">punctuator</span><span class="o">.</span><span class="n">punctuate_text</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="n">template_dict</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.ai_text_processing.translate_text_by_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_text_by_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">source_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segment_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">review_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/ai_text_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_text_by_lines</span><span class="p">(</span>
    <span class="n">text</span><span class="p">,</span>
    <span class="n">source_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">context_lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">get_default_pattern</span><span class="p">(</span><span class="n">DEFAULT_TRANSLATION_PATTERN</span><span class="p">)</span>

    <span class="n">translator</span> <span class="o">=</span> <span class="n">LineTranslator</span><span class="p">(</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">OpenAIProcessor</span><span class="p">(</span><span class="n">model</span><span class="p">),</span>
        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span> <span class="ow">or</span> <span class="n">DEFAULT_TRANSLATE_STYLE</span><span class="p">,</span>
        <span class="n">context_lines</span><span class="o">=</span><span class="n">context_lines</span> <span class="ow">or</span> <span class="n">DEFAULT_TRANSLATE_CONTEXT_LINES</span><span class="p">,</span>
        <span class="n">review_count</span><span class="o">=</span><span class="n">review_count</span> <span class="ow">or</span> <span class="n">DEFAULT_REVIEW_COUNT</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">translator</span><span class="o">.</span><span class="n">translate_text</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">source_language</span><span class="p">,</span>
        <span class="n">target_language</span><span class="o">=</span><span class="n">target_language</span><span class="p">,</span>
        <span class="n">segment_size</span><span class="o">=</span><span class="n">segment_size</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="o">=</span><span class="n">template_dict</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.lang" class="doc doc-heading">
            <code>lang</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.lang.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.lang.get_language_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_language_code</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Detect the language of the provided text using langdetect.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to analyze</p>
<pre><code>      code or 'name' for full English language name
</code></pre>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>return result 'code' ISO 639-1 for detected language.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If text is empty or invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/lang.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_language_code</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect the language of the provided text using langdetect.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to analyze</span>

<span class="sd">                      code or &#39;name&#39; for full English language name</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: return result &#39;code&#39; ISO 639-1 for detected language.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If text is empty or invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input text cannot be empty&quot;</span><span class="p">)</span>

    <span class="n">sample</span> <span class="o">=</span> <span class="n">_get_sample_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">detect</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">LangDetectException</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Language could not be detected in get_language().&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;un&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.lang.get_language_from_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_language_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/lang.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_language_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">language</span> <span class="o">:=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">languages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_2</span><span class="o">=</span><span class="n">code</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">language</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No language name found for code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.lang.get_language_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/lang.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_language_name</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">get_language_from_code</span><span class="p">(</span><span class="n">get_language_code</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.openai_process_interface" class="doc doc-heading">
            <code>openai_process_interface</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.openai_process_interface.TOKEN_BUFFER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TOKEN_BUFFER</span> <span class="o">=</span> <span class="mi">500</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.openai_process_interface.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ai_text_processing.openai_process_interface.openai_process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">openai_process_text</span><span class="p">(</span><span class="n">text_input</span><span class="p">,</span> <span class="n">process_instructions</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>postprocessing a transcription.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/openai_process_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">openai_process_text</span><span class="p">(</span>
    <span class="n">text_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">process_instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">response_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ResponseFormat</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;postprocessing a transcription.&quot;&quot;&quot;</span>

    <span class="n">user_prompts</span> <span class="o">=</span> <span class="p">[</span><span class="n">text_input</span><span class="p">]</span>
    <span class="n">system_message</span> <span class="o">=</span> <span class="n">process_instructions</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OpenAI Process Text with process instructions:</span><span class="se">\n</span><span class="si">{</span><span class="n">system_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">token_count</span><span class="p">(</span><span class="n">text_input</span><span class="p">)</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">tokens</span> <span class="o">+</span> <span class="n">TOKEN_BUFFER</span>

    <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="s2">&quot;default&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Open AI Text Processing</span><span class="si">{</span><span class="s1">&#39; as batch process&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> with model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; initiated. Requesting a maximum of </span><span class="si">{</span><span class="n">max_tokens</span><span class="si">}</span><span class="s2"> tokens.&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_run_batch_process_text</span><span class="p">(</span>
            <span class="n">response_format</span><span class="p">,</span> <span class="n">user_prompts</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">max_tokens</span>
        <span class="p">)</span>
    <span class="n">completion</span> <span class="o">=</span> <span class="n">run_immediate_completion_simple</span><span class="p">(</span>
        <span class="n">system_message</span><span class="p">,</span>
        <span class="n">text_input</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
        <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Full completion:</span><span class="se">\n</span><span class="si">{</span><span class="n">completion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response_format</span><span class="p">:</span>
        <span class="n">process_object</span> <span class="o">=</span> <span class="n">get_completion_object</span><span class="p">(</span><span class="n">completion</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing completed.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">process_object</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">process_text</span> <span class="o">=</span> <span class="n">get_completion_content</span><span class="p">(</span><span class="n">completion</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing completed.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">process_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.patterns" class="doc doc-heading">
            <code>patterns</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.patterns.MarkdownStr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MarkdownStr</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;MarkdownStr&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.patterns.SYSTEM_UPDATE_MESSAGE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SYSTEM_UPDATE_MESSAGE</span> <span class="o">=</span> <span class="s1">&#39;PatternManager System Update:&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.patterns.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager" class="doc doc-heading">
            <code>ConcurrentAccessManager</code>


</h5>


    <div class="doc doc-contents ">


        <p>Manages concurrent access to pattern files.</p>
<p>Provides:
- File-level locking
- Safe concurrent access patterns
- Lock cleanup</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ConcurrentAccessManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages concurrent access to pattern files.</span>

<span class="sd">    Provides:</span>
<span class="sd">    - File-level locking</span>
<span class="sd">    - Safe concurrent access patterns</span>
<span class="sd">    - Lock cleanup</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize access manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            lock_dir: Directory for lock files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lock_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_lock_dir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_stale_locks</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ensure_lock_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create lock directory if it doesn&#39;t exist.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cleanup_stale_locks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_age</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove stale lock files.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_age: Maximum age for lock files before considered stale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lock_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.lock&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">lock_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">mtime</span> <span class="o">&gt;</span> <span class="n">max_age</span><span class="p">:</span>
                    <span class="n">lock_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed stale lock file: </span><span class="si">{</span><span class="n">lock_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="c1"># Lock was removed by another process</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning up lock file </span><span class="si">{</span><span class="n">lock_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">file_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager for safely accessing files.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file to lock</span>

<span class="sd">        Yields:</span>
<span class="sd">            None when lock is acquired</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If file is already locked</span>
<span class="sd">            OSError: If lock file operations fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">lock_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.lock&quot;</span>
        <span class="n">lock_fd</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Open or create lock file</span>
            <span class="n">lock_fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Attempt to acquire lock</span>
                <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>

                <span class="c1"># Write process info to lock file</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquired lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">yield</span>

            <span class="k">except</span> <span class="ne">BlockingIOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is locked by another process&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lock operation failed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lock_fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Release lock and close file descriptor</span>
                    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">)</span>

                    <span class="c1"># Remove lock file</span>
                    <span class="n">lock_file_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Released lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning up lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a file is currently locked.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if file is locked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lock_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.lock&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lock_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># Try to acquire and immediately release lock</span>
                <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
                <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">BlockingIOError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.lock_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lock_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lock_dir</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lock_dir</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize access manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lock_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory for lock files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize access manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        lock_dir: Directory for lock files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lock_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_lock_dir</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_stale_locks</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.file_lock" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_lock</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Context manager for safely accessing files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to file to lock</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None when lock is acquired</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If file is already locked</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>OSError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If lock file operations fail</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">file_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager for safely accessing files.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to file to lock</span>

<span class="sd">    Yields:</span>
<span class="sd">        None when lock is acquired</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If file is already locked</span>
<span class="sd">        OSError: If lock file operations fail</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">lock_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.lock&quot;</span>
    <span class="n">lock_fd</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Open or create lock file</span>
        <span class="n">lock_fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Attempt to acquire lock</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>

            <span class="c1"># Write process info to lock file</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquired lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">yield</span>

        <span class="k">except</span> <span class="ne">BlockingIOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is locked by another process&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lock operation failed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lock_fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Release lock and close file descriptor</span>
                <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">lock_fd</span><span class="p">)</span>

                <span class="c1"># Remove lock file</span>
                <span class="n">lock_file_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Released lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning up lock for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.ConcurrentAccessManager.is_locked" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_locked</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if a file is currently locked.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to file to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if file is locked</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a file is currently locked.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to file to check</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if file is locked</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lock_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.lock&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lock_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lock_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Try to acquire and immediately release lock</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">BlockingIOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository" class="doc doc-heading">
            <code>GitBackedRepository</code>


</h5>


    <div class="doc doc-contents ">


        <p>Manages versioned storage of patterns using Git.</p>
<p>Provides basic Git operations while hiding complexity:
- Automatic versioning of changes
- Basic conflict resolution
- History tracking</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GitBackedRepository</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages versioned storage of patterns using Git.</span>

<span class="sd">    Provides basic Git operations while hiding complexity:</span>
<span class="sd">    - Automatic versioning of changes</span>
<span class="sd">    - Basic conflict resolution</span>
<span class="sd">    - History tracking</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize or connect to Git repository.</span>

<span class="sd">        Args:</span>
<span class="sd">            repo_path: Path to repository directory</span>

<span class="sd">        Raises:</span>
<span class="sd">            GitCommandError: If Git operations fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span> <span class="o">=</span> <span class="n">repo_path</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to connect to existing repository</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to existing Git repository at </span><span class="si">{</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">InvalidGitRepositoryError</span><span class="p">:</span>
            <span class="c1"># Initialize new repository if none exists</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing new Git repository at </span><span class="si">{</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>

            <span class="c1"># Create initial commit if repo is empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="c1"># Create and commit .gitignore</span>
                <span class="n">gitignore</span> <span class="o">=</span> <span class="n">repo_path</span> <span class="o">/</span> <span class="s2">&quot;.gitignore&quot;</span>
                <span class="n">gitignore</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;*.lock</span><span class="se">\n</span><span class="s2">.DS_Store</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;.gitignore&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="s2">&quot;Initial repository setup&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stage and commit changes to a file in the Git repository.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Absolute or relative path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Commit hash if changes were made.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the file does not exist.</span>
<span class="sd">            ValueError: If the file is outside the repository.</span>
<span class="sd">            GitCommandError: If Git operations fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="c1"># Ensure the file is within the repository</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not under the repository root </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File does not exist: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commit_file_update</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GitCommandError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Git operation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_commit_file_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_file_clean</span><span class="p">(</span><span class="n">rel_path</span><span class="p">):</span>
            <span class="c1"># Return the current commit hash if no changes</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected changes in </span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="s2">, updating version control.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)])</span>
        <span class="n">commit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">SYSTEM_UPDATE_MESSAGE</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rel_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="n">Actor</span><span class="p">(</span><span class="s2">&quot;PatternManager&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Committed changes to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span>

    <span class="k">def</span> <span class="nf">_get_file_revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Commit</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ordered list of commits that modified a file, most recent first.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file relative to repository root</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Commit objects affecting this file</span>

<span class="sd">        Raises:</span>
<span class="sd">            GitCommandError: If Git operations fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">iter_commits</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">GitCommandError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get commits for </span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_get_commit_diff</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="p">:</span> <span class="n">Commit</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">prev_commit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Commit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get both stat and detailed diff for a commit.</span>

<span class="sd">        Args:</span>
<span class="sd">            commit: Commit to diff</span>
<span class="sd">            file_path: Path relative to repository root</span>
<span class="sd">            prev_commit: Previous commit for diff, defaults to commit&#39;s parent</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (stat_diff, detailed_diff) where:</span>
<span class="sd">                stat_diff: Summary of changes (files changed, insertions/deletions)</span>
<span class="sd">                detailed_diff: Colored word-level diff with context</span>

<span class="sd">        Raises:</span>
<span class="sd">            GitCommandError: If Git operations fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">prev_commit</span><span class="o">.</span><span class="n">hexsha</span> <span class="k">if</span> <span class="n">prev_commit</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="si">}</span><span class="s2">^&quot;</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get stats diff</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">git</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">prev_hash</span><span class="p">,</span> <span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Get detailed diff</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">git</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
                <span class="n">prev_hash</span><span class="p">,</span>
                <span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="p">,</span>
                <span class="n">rel_path</span><span class="p">,</span>
                <span class="n">unified</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">word_diff</span><span class="o">=</span><span class="s2">&quot;plain&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;always&quot;</span><span class="p">,</span>
                <span class="n">ignore_space_change</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">stat</span><span class="p">,</span> <span class="n">diff</span>
        <span class="k">except</span> <span class="n">GitCommandError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get diff for </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">display_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">max_versions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display history of changes for a file with diffs between versions.</span>

<span class="sd">        Shows most recent changes first, limited to max_versions entries.</span>
<span class="sd">        For each change shows:</span>
<span class="sd">        - Commit info and date</span>
<span class="sd">        - Stats summary of changes</span>
<span class="sd">        - Detailed color diff with 2 lines of context</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file in repository</span>
<span class="sd">            max_versions: Maximum number of versions to show, if zero, shows all revisions.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; repo.display_history(Path(&quot;patterns/format_dharma_talk.yaml&quot;))</span>
<span class="sd">            Commit abc123def (2024-12-28 14:30:22):</span>
<span class="sd">            1 file changed, 5 insertions(+), 2 deletions(-)</span>

<span class="sd">            diff --git a/patterns/format_dharma_talk.yaml ...</span>
<span class="sd">            ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get commit history</span>
            <span class="n">commits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_revisions</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">commits</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No history found for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">max_versions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_versions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span>  <span class="c1"># look at all commits.</span>

            <span class="c1"># Display limited history with diffs</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">commit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">commits</span><span class="p">[:</span><span class="n">max_versions</span><span class="p">]):</span>
                <span class="c1"># Print commit header</span>
                <span class="n">date_str</span> <span class="o">=</span> <span class="n">commit</span><span class="o">.</span><span class="n">committed_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Commit </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message: </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Get and display diffs</span>
                <span class="n">prev_commit</span> <span class="o">=</span> <span class="n">commits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">stat_diff</span><span class="p">,</span> <span class="n">detailed_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_commit_diff</span><span class="p">(</span>
                    <span class="n">commit</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">prev_commit</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">stat_diff</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Changes:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">stat_diff</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">detailed_diff</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Detailed diff:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">detailed_diff</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>  <span class="c1"># Visual separator between commits</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to display history for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error displaying history: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_is_file_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if file has uncommitted changes.</span>

<span class="sd">        Args:</span>
<span class="sd">            rel_path: Path relative to repository root</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if file has no changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">a_path</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">untracked_files</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository.repo_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">repo_path</span> <span class="o">=</span> <span class="n">repo_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize or connect to Git repository.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>repo_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to repository directory</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="git.exc.GitCommandError">GitCommandError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If Git operations fail</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize or connect to Git repository.</span>

<span class="sd">    Args:</span>
<span class="sd">        repo_path: Path to repository directory</span>

<span class="sd">    Raises:</span>
<span class="sd">        GitCommandError: If Git operations fail</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span> <span class="o">=</span> <span class="n">repo_path</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try to connect to existing repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to existing Git repository at </span><span class="si">{</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">InvalidGitRepositoryError</span><span class="p">:</span>
        <span class="c1"># Initialize new repository if none exists</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing new Git repository at </span><span class="si">{</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>

        <span class="c1"># Create initial commit if repo is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># Create and commit .gitignore</span>
            <span class="n">gitignore</span> <span class="o">=</span> <span class="n">repo_path</span> <span class="o">/</span> <span class="s2">&quot;.gitignore&quot;</span>
            <span class="n">gitignore</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;*.lock</span><span class="se">\n</span><span class="s2">.DS_Store</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;.gitignore&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="s2">&quot;Initial repository setup&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository.display_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_history</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">max_versions</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Display history of changes for a file with diffs between versions.</p>
<p>Shows most recent changes first, limited to max_versions entries.
For each change shows:
- Commit info and date
- Stats summary of changes
- Detailed color diff with 2 lines of context</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to file in repository</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_versions</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of versions to show, if zero, shows all revisions.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>repo.display_history(Path("patterns/format_dharma_talk.yaml"))
Commit abc123def (2024-12-28 14:30:22):
1 file changed, 5 insertions(+), 2 deletions(-)</p>
</blockquote>
</blockquote>
</blockquote>
<p>diff --git a/patterns/format_dharma_talk.yaml ...
...</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">display_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">max_versions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display history of changes for a file with diffs between versions.</span>

<span class="sd">    Shows most recent changes first, limited to max_versions entries.</span>
<span class="sd">    For each change shows:</span>
<span class="sd">    - Commit info and date</span>
<span class="sd">    - Stats summary of changes</span>
<span class="sd">    - Detailed color diff with 2 lines of context</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path to file in repository</span>
<span class="sd">        max_versions: Maximum number of versions to show, if zero, shows all revisions.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; repo.display_history(Path(&quot;patterns/format_dharma_talk.yaml&quot;))</span>
<span class="sd">        Commit abc123def (2024-12-28 14:30:22):</span>
<span class="sd">        1 file changed, 5 insertions(+), 2 deletions(-)</span>

<span class="sd">        diff --git a/patterns/format_dharma_talk.yaml ...</span>
<span class="sd">        ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get commit history</span>
        <span class="n">commits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_revisions</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">commits</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No history found for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">max_versions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_versions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span>  <span class="c1"># look at all commits.</span>

        <span class="c1"># Display limited history with diffs</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">commit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">commits</span><span class="p">[:</span><span class="n">max_versions</span><span class="p">]):</span>
            <span class="c1"># Print commit header</span>
            <span class="n">date_str</span> <span class="o">=</span> <span class="n">commit</span><span class="o">.</span><span class="n">committed_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Commit </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message: </span><span class="si">{</span><span class="n">commit</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Get and display diffs</span>
            <span class="n">prev_commit</span> <span class="o">=</span> <span class="n">commits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commits</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">stat_diff</span><span class="p">,</span> <span class="n">detailed_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_commit_diff</span><span class="p">(</span>
                <span class="n">commit</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">prev_commit</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">stat_diff</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Changes:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">stat_diff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">detailed_diff</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Detailed diff:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">detailed_diff</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>  <span class="c1"># Visual separator between commits</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to display history for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error displaying history: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.GitBackedRepository.update_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Stage and commit changes to a file in the Git repository.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute or relative path to the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Commit hash if changes were made.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file is outside the repository.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="git.exc.GitCommandError">GitCommandError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If Git operations fail.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stage and commit changes to a file in the Git repository.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Absolute or relative path to the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Commit hash if changes were made.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>
<span class="sd">        ValueError: If the file is outside the repository.</span>
<span class="sd">        GitCommandError: If Git operations fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="c1"># Ensure the file is within the repository</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not under the repository root </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File does not exist: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_commit_file_update</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GitCommandError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Git operation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.patterns.Pattern" class="doc doc-heading">
            <code>Pattern</code>


</h5>


    <div class="doc doc-contents ">


        <p>Base Pattern class for version-controlled template patterns.</p>
<p>Patterns contain:
- Instructions: The main pattern instructions as a Jinja2 template.
   Note: Instructions are intended to be saved in markdown format in a .md file.
- Template fields: Default values for template variables
- Metadata: Name and identifier information</p>
<p>Version control is handled externally through Git, not in the pattern itself.
Pattern identity is determined by the combination of identifiers.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern.name" href="#tnh_scholar.ai_text_processing.patterns.Pattern.name">name</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the pattern</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern.instructions" href="#tnh_scholar.ai_text_processing.patterns.Pattern.instructions">instructions</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Jinja2 template string for this pattern</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern.default_template_fields" href="#tnh_scholar.ai_text_processing.patterns.Pattern.default_template_fields">default_template_fields</a></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default values for template variables</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tnh_scholar.ai_text_processing.patterns.Pattern._allow_empty_vars">_allow_empty_vars</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow undefined template variables</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tnh_scholar.ai_text_processing.patterns.Pattern._env">_env</span></code></td>
            <td>
                  <code><span title="jinja2.Environment">Environment</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured Jinja2 environment instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Pattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base Pattern class for version-controlled template patterns.</span>

<span class="sd">    Patterns contain:</span>
<span class="sd">    - Instructions: The main pattern instructions as a Jinja2 template.</span>
<span class="sd">       Note: Instructions are intended to be saved in markdown format in a .md file.</span>
<span class="sd">    - Template fields: Default values for template variables</span>
<span class="sd">    - Metadata: Name and identifier information</span>

<span class="sd">    Version control is handled externally through Git, not in the pattern itself.</span>
<span class="sd">    Pattern identity is determined by the combination of identifiers.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The name of the pattern</span>
<span class="sd">        instructions (str): The Jinja2 template string for this pattern</span>
<span class="sd">        default_template_fields (Dict[str, str]): Default values for template variables</span>
<span class="sd">        _allow_empty_vars (bool): Whether to allow undefined template variables</span>
<span class="sd">        _env (Environment): Configured Jinja2 environment instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">instructions</span><span class="p">:</span> <span class="n">MarkdownStr</span><span class="p">,</span>
        <span class="n">default_template_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allow_empty_vars</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new Pattern instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Unique name identifying the pattern</span>
<span class="sd">            instructions: Jinja2 template string containing the pattern</span>
<span class="sd">            default_template_fields: Optional default values for template variables</span>
<span class="sd">            allow_empty_vars: Whether to allow undefined template variables</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If name or instructions are empty</span>
<span class="sd">            TemplateError: If template syntax is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">instructions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name and instructions must not be empty&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="n">instructions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span> <span class="o">=</span> <span class="n">default_template_fields</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_empty_vars</span> <span class="o">=</span> <span class="n">allow_empty_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_environment</span><span class="p">()</span>

        <span class="c1"># Validate template syntax on initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_template</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_environment</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Environment</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and configure a Jinja2 environment with optimal settings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Environment: Configured Jinja2 environment with security and formatting options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Environment</span><span class="p">(</span>
            <span class="n">undefined</span><span class="o">=</span><span class="n">StrictUndefined</span><span class="p">,</span>  <span class="c1"># Raise errors for undefined variables</span>
            <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Remove first newline after a block</span>
            <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Strip tabs and spaces from the start of lines</span>
            <span class="n">autoescape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable autoescaping for security</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the template syntax without rendering.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TemplateError: If template syntax is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TemplateError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid template syntax in pattern &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Template</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or create a cached template instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Template: Compiled Jinja2 template</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply template values to pattern instructions using Jinja2.</span>

<span class="sd">        Args:</span>
<span class="sd">            field_values: Values to substitute into the template.</span>
<span class="sd">                        If None, default_template_fields are used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Rendered instructions with template values applied.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TemplateError: If template rendering fails</span>
<span class="sd">            ValueError: If required template variables are missing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Combine default fields with provided fields, with provided taking precedence</span>
        <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">field_values</span> <span class="ow">or</span> <span class="p">{})}</span>

        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_without_frontmatter</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_template_with_values</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">template_values</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TemplateError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Template rendering failed for pattern &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">_render_template_with_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">template_values</span><span class="p">):</span>
        <span class="c1"># Parse template to find required variables</span>

        <span class="n">parsed_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
        <span class="n">required_vars</span> <span class="o">=</span> <span class="n">find_undeclared_variables</span><span class="p">(</span><span class="n">parsed_content</span><span class="p">)</span>

        <span class="c1"># Validate all required variables are provided</span>
        <span class="n">missing_vars</span> <span class="o">=</span> <span class="n">required_vars</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">template_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">missing_vars</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_empty_vars</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required template variables in pattern &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">missing_vars</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_template</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">template_values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract and validate YAML frontmatter from markdown instructions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict]: Frontmatter data if found and valid, None otherwise</span>

<span class="sd">        Note:</span>
<span class="sd">            Frontmatter must be at the very start of the file and properly formatted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># More precise pattern matching</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\A---\s*\n(.*?)\n---\s*\n&quot;</span>
        <span class="k">if</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">frontmatter</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontmatter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Frontmatter must be a YAML dictionary&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">frontmatter</span>
            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid YAML in frontmatter: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_content_without_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get markdown content with frontmatter removed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Markdown content without frontmatter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\A---\s*\n.*?\n---\s*\n&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update or add frontmatter to the markdown content.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_data: Dictionary of frontmatter fields to update</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_frontmatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_frontmatter</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">updated_frontmatter</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">current_frontmatter</span><span class="p">,</span> <span class="o">**</span><span class="n">new_data</span><span class="p">}</span>

        <span class="c1"># Create YAML string</span>
        <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="n">updated_frontmatter</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Remove existing frontmatter if present</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_without_frontmatter</span><span class="p">()</span>

        <span class="c1"># Combine new frontmatter with content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="si">{</span><span class="n">yaml_str</span><span class="si">}</span><span class="s2">---</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">content_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a SHA-256 hash of the pattern content.</span>

<span class="sd">        Useful for quick content comparison and change detection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Hexadecimal string of the SHA-256 hash</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="si">}{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert pattern to dictionary for serialization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict containing all pattern data in serializable format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;instructions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span>
            <span class="s2">&quot;default_template_fields&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pattern&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create pattern instance from dictionary data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Dictionary containing pattern data</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pattern: New pattern instance</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If required fields are missing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">missing_fields</span> <span class="o">:=</span> <span class="n">required_fields</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;instructions&quot;</span><span class="p">],</span>
            <span class="n">default_template_fields</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_template_fields&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare patterns based on their content.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_hash</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">content_hash</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hash based on content hash for container operations.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_hash</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.default_template_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default_template_fields</span> <span class="o">=</span> <span class="n">default_template_fields</span> <span class="ow">or</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.instructions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instructions</span> <span class="o">=</span> <span class="n">instructions</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.__eq__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Compare patterns based on their content.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare patterns based on their content.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_hash</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">content_hash</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.__hash__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__hash__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Hash based on content hash for container operations.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hash based on content hash for container operations.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_hash</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">default_template_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_empty_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize a new Pattern instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique name identifying the pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>instructions</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.MarkdownStr" href="#tnh_scholar.ai_text_processing.patterns.MarkdownStr">MarkdownStr</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jinja2 template string containing the pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_template_fields</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional default values for template variables</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_empty_vars</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow undefined template variables</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If name or instructions are empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jinja2.TemplateError">TemplateError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If template syntax is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="n">MarkdownStr</span><span class="p">,</span>
    <span class="n">default_template_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allow_empty_vars</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a new Pattern instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Unique name identifying the pattern</span>
<span class="sd">        instructions: Jinja2 template string containing the pattern</span>
<span class="sd">        default_template_fields: Optional default values for template variables</span>
<span class="sd">        allow_empty_vars: Whether to allow undefined template variables</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If name or instructions are empty</span>
<span class="sd">        TemplateError: If template syntax is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name and instructions must not be empty&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="n">instructions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span> <span class="o">=</span> <span class="n">default_template_fields</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_allow_empty_vars</span> <span class="o">=</span> <span class="n">allow_empty_vars</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_environment</span><span class="p">()</span>

    <span class="c1"># Validate template syntax on initialization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_template</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.apply_template" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_template</span><span class="p">(</span><span class="n">field_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Apply template values to pattern instructions using Jinja2.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field_values</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values to substitute into the template.
        If None, default_template_fields are used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rendered instructions with template values applied.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jinja2.TemplateError">TemplateError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If template rendering fails</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required template variables are missing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply template values to pattern instructions using Jinja2.</span>

<span class="sd">    Args:</span>
<span class="sd">        field_values: Values to substitute into the template.</span>
<span class="sd">                    If None, default_template_fields are used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Rendered instructions with template values applied.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TemplateError: If template rendering fails</span>
<span class="sd">        ValueError: If required template variables are missing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Combine default fields with provided fields, with provided taking precedence</span>
    <span class="n">template_values</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">field_values</span> <span class="ow">or</span> <span class="p">{})}</span>

    <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_without_frontmatter</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_template_with_values</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">template_values</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TemplateError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Template rendering failed for pattern &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.content_hash" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">content_hash</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generate a SHA-256 hash of the pattern content.</p>
<p>Useful for quick content comparison and change detection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hexadecimal string of the SHA-256 hash</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">content_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a SHA-256 hash of the pattern content.</span>

<span class="sd">    Useful for quick content comparison and change detection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Hexadecimal string of the SHA-256 hash</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="si">}{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.extract_frontmatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_frontmatter</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Extract and validate YAML frontmatter from markdown instructions.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[Dict]: Frontmatter data if found and valid, None otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Frontmatter must be at the very start of the file and properly formatted.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract and validate YAML frontmatter from markdown instructions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Dict]: Frontmatter data if found and valid, None otherwise</span>

<span class="sd">    Note:</span>
<span class="sd">        Frontmatter must be at the very start of the file and properly formatted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># More precise pattern matching</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\A---\s*\n(.*?)\n---\s*\n&quot;</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">frontmatter</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frontmatter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Frontmatter must be a YAML dictionary&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">frontmatter</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid YAML in frontmatter: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Create pattern instance from dictionary data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing pattern data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Pattern</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New pattern instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required fields are missing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pattern&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create pattern instance from dictionary data.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Dictionary containing pattern data</span>

<span class="sd">    Returns:</span>
<span class="sd">        Pattern: New pattern instance</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If required fields are missing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">missing_fields</span> <span class="o">:=</span> <span class="n">required_fields</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="n">instructions</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;instructions&quot;</span><span class="p">],</span>
        <span class="n">default_template_fields</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_template_fields&quot;</span><span class="p">,</span> <span class="p">{}),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.get_content_without_frontmatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_content_without_frontmatter</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get markdown content with frontmatter removed.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Markdown content without frontmatter</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_content_without_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get markdown content with frontmatter removed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Markdown content without frontmatter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\A---\s*\n.*?\n---\s*\n&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Convert pattern to dictionary for serialization.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing all pattern data in serializable format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert pattern to dictionary for serialization.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict containing all pattern data in serializable format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;instructions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span>
        <span class="s2">&quot;default_template_fields&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_template_fields</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.Pattern.update_frontmatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_frontmatter</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Update or add frontmatter to the markdown content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>new_data</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of frontmatter fields to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_frontmatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update or add frontmatter to the markdown content.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_data: Dictionary of frontmatter fields to update</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current_frontmatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_frontmatter</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">updated_frontmatter</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">current_frontmatter</span><span class="p">,</span> <span class="o">**</span><span class="n">new_data</span><span class="p">}</span>

    <span class="c1"># Create YAML string</span>
    <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
        <span class="n">updated_frontmatter</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Remove existing frontmatter if present</span>
    <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_without_frontmatter</span><span class="p">()</span>

    <span class="c1"># Combine new frontmatter with content</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="si">{</span><span class="n">yaml_str</span><span class="si">}</span><span class="s2">---</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.patterns.PatternManager" class="doc doc-heading">
            <code>PatternManager</code>


</h5>


    <div class="doc doc-contents ">


        <p>Main interface for pattern management system.</p>
<p>Provides high-level operations:
- Pattern creation and loading
- Automatic versioning
- Safe concurrent access
- Basic history tracking</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PatternManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main interface for pattern management system.</span>

<span class="sd">    Provides high-level operations:</span>
<span class="sd">    - Pattern creation and loading</span>
<span class="sd">    - Automatic versioning</span>
<span class="sd">    - Safe concurrent access</span>
<span class="sd">    - Basic history tracking</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize pattern management system.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_path: Base directory for pattern storage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Initialize subsystems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">GitBackedRepository</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span> <span class="o">=</span> <span class="n">ConcurrentAccessManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.locks&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initialized pattern management system at </span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_normalize_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize a path to be absolute under the repository base path.</span>

<span class="sd">        Handles these cases to same result:</span>
<span class="sd">        - &quot;my_file&quot; -&gt; &lt;base_path&gt;/my_file</span>
<span class="sd">        - &quot;&lt;base_path&gt;/my_file&quot; -&gt; &lt;base_path&gt;/my_file</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Input path as string or Path</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path: Absolute path under base_path</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If path would resolve outside repository</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># ensure we have a path</span>

        <span class="c1"># Join with base_path as needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="n">path</span>

        <span class="c1"># Safety check after resolution</span>
        <span class="n">resolved</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resolved</span><span class="o">.</span><span class="n">is_relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> resolves outside repository: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">resolved</span>

    <span class="k">def</span> <span class="nf">get_pattern_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively search for a pattern file with the given name in base_path and all subdirectories.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern_id: pattern identifier to search for</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Path]: Full path to the found pattern file, or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pattern_path</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found pattern file for ID </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> at: </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_path</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pattern file found with ID: </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">save_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">subdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>

        <span class="n">pattern_name</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">name</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">instructions</span>

        <span class="k">if</span> <span class="n">subdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="n">subdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Check for existing pattern with same ID</span>
        <span class="n">existing_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">existing_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">!=</span> <span class="n">existing_path</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Existing pattern - </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> already exists at &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Attempted to access at location: </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span><span class="o">.</span><span class="n">file_lock</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">write_text_to_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">update_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern saved at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save pattern </span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">load_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the .md pattern file by name, extract placeholders, and</span>
<span class="sd">        return a fully constructed Pattern object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern_name: Name of the pattern (without .md extension).</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new Pattern object whose &#39;instructions&#39; is the file&#39;s text</span>
<span class="sd">            and whose &#39;template_fields&#39; are inferred from placeholders in</span>
<span class="sd">            those instructions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Locate the .md file; raise if missing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pattern file named </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md found.&quot;</span><span class="p">)</span>

        <span class="c1"># Acquire lock before reading</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span><span class="o">.</span><span class="n">file_lock</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">instructions</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">instructions</span> <span class="o">=</span> <span class="n">MarkdownStr</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

        <span class="c1"># Create the pattern from the raw .md text</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pattern_name</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">)</span>

        <span class="c1"># Check for local uncommitted changes, updating file:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">update_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pattern</span>

    <span class="k">def</span> <span class="nf">show_pattern_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">display_history</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path to </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="c1"># def get_pattern_history_from_path(self, path: Path) -&gt; List[Dict[str, Any]]:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Get version history for a pattern.</span>

    <span class="c1">#     Args:</span>
    <span class="c1">#         path: Path to pattern file</span>

    <span class="c1">#     Returns:</span>
    <span class="c1">#         List of version information</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     path = self._normalize_path(path)</span>

    <span class="c1">#     return self.repo.get_history(path)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">verify_repository</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify repository integrity and uniqueness of pattern names.</span>

<span class="sd">        Performs the following checks:</span>
<span class="sd">        1. Validates Git repository structure.</span>
<span class="sd">        2. Ensures no duplicate pattern names exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_path: Repository path to verify.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the repository is valid and contains no duplicate pattern files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if it&#39;s a valid Git repository</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>

            <span class="c1"># Verify basic repository structure</span>
            <span class="n">basic_valid</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">repo</span><span class="o">.</span><span class="n">bare</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.git&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.locks&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">basic_valid</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Check for duplicate pattern names</span>
            <span class="n">pattern_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">base_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.md&quot;</span><span class="p">))</span>
            <span class="n">seen_names</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">pattern_file</span> <span class="ow">in</span> <span class="n">pattern_files</span><span class="p">:</span>
                <span class="c1"># Skip files in .git directory</span>
                <span class="k">if</span> <span class="s2">&quot;.git&quot;</span> <span class="ow">in</span> <span class="n">pattern_file</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Get pattern name from the filename (without extension)</span>
                <span class="n">pattern_name</span> <span class="o">=</span> <span class="n">pattern_file</span><span class="o">.</span><span class="n">stem</span>

                <span class="k">if</span> <span class="n">pattern_name</span> <span class="ow">in</span> <span class="n">seen_names</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Duplicate pattern file detected:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;  First occurrence: </span><span class="si">{</span><span class="n">seen_names</span><span class="p">[</span><span class="n">pattern_name</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;  Second occurrence: </span><span class="si">{</span><span class="n">pattern_file</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="n">seen_names</span><span class="p">[</span><span class="n">pattern_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern_file</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">InvalidGitRepositoryError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repository verification failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.access_manager" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">access_manager</span> <span class="o">=</span> <span class="n">ConcurrentAccessManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="s1">&#39;.locks&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.base_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.repo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">repo</span> <span class="o">=</span> <span class="n">GitBackedRepository</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize pattern management system.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for pattern storage</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize pattern management system.</span>

<span class="sd">    Args:</span>
<span class="sd">        base_path: Base directory for pattern storage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Initialize subsystems</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">GitBackedRepository</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span> <span class="o">=</span> <span class="n">ConcurrentAccessManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.locks&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initialized pattern management system at </span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.get_pattern_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Recursively search for a pattern file with the given name in base_path and all subdirectories.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern_id</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern identifier to search for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[Path]: Full path to the found pattern file, or None if not found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pattern_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively search for a pattern file with the given name in base_path and all subdirectories.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern_id: pattern identifier to search for</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Path]: Full path to the found pattern file, or None if not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pattern_path</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found pattern file for ID </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> at: </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_path</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pattern file found with ID: </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.load_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_pattern</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Load the .md pattern file by name, extract placeholders, and
return a fully constructed Pattern object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pattern (without .md extension).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Pattern object whose 'instructions' is the file's text</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and whose 'template_fields' are inferred from placeholders in</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.patterns.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>those instructions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the .md pattern file by name, extract placeholders, and</span>
<span class="sd">    return a fully constructed Pattern object.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern_name: Name of the pattern (without .md extension).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new Pattern object whose &#39;instructions&#39; is the file&#39;s text</span>
<span class="sd">        and whose &#39;template_fields&#39; are inferred from placeholders in</span>
<span class="sd">        those instructions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Locate the .md file; raise if missing</span>
    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pattern file named </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md found.&quot;</span><span class="p">)</span>

    <span class="c1"># Acquire lock before reading</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span><span class="o">.</span><span class="n">file_lock</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">instructions</span> <span class="o">=</span> <span class="n">MarkdownStr</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

    <span class="c1"># Create the pattern from the raw .md text</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pattern_name</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">)</span>

    <span class="c1"># Check for local uncommitted changes, updating file:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">update_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pattern</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.save_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">subdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>

    <span class="n">pattern_name</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">name</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">instructions</span>

    <span class="k">if</span> <span class="n">subdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">/</span> <span class="n">subdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">.md&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Check for existing pattern with same ID</span>
    <span class="n">existing_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">existing_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">!=</span> <span class="n">existing_path</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Existing pattern - </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> already exists at &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Attempted to access at location: </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_manager</span><span class="o">.</span><span class="n">file_lock</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">write_text_to_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">update_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern saved at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save pattern </span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.show_pattern_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_pattern_history</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_pattern_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pattern_path</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">display_history</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path to </span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ai_text_processing.patterns.PatternManager.verify_repository" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verify_repository</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Verify repository integrity and uniqueness of pattern names.</p>
<p>Performs the following checks:
1. Validates Git repository structure.
2. Ensures no duplicate pattern names exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repository path to verify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the repository is valid and contains no duplicate pattern files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ai_text_processing/patterns.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">verify_repository</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify repository integrity and uniqueness of pattern names.</span>

<span class="sd">    Performs the following checks:</span>
<span class="sd">    1. Validates Git repository structure.</span>
<span class="sd">    2. Ensures no duplicate pattern names exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        base_path: Repository path to verify.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the repository is valid and contains no duplicate pattern files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if it&#39;s a valid Git repository</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">Repo</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>

        <span class="c1"># Verify basic repository structure</span>
        <span class="n">basic_valid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">repo</span><span class="o">.</span><span class="n">bare</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.git&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;.locks&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">basic_valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check for duplicate pattern names</span>
        <span class="n">pattern_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">base_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.md&quot;</span><span class="p">))</span>
        <span class="n">seen_names</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">pattern_file</span> <span class="ow">in</span> <span class="n">pattern_files</span><span class="p">:</span>
            <span class="c1"># Skip files in .git directory</span>
            <span class="k">if</span> <span class="s2">&quot;.git&quot;</span> <span class="ow">in</span> <span class="n">pattern_file</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Get pattern name from the filename (without extension)</span>
            <span class="n">pattern_name</span> <span class="o">=</span> <span class="n">pattern_file</span><span class="o">.</span><span class="n">stem</span>

            <span class="k">if</span> <span class="n">pattern_name</span> <span class="ow">in</span> <span class="n">seen_names</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Duplicate pattern file detected:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;  First occurrence: </span><span class="si">{</span><span class="n">seen_names</span><span class="p">[</span><span class="n">pattern_name</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;  Second occurrence: </span><span class="si">{</span><span class="n">pattern_file</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">seen_names</span><span class="p">[</span><span class="n">pattern_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern_file</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">InvalidGitRepositoryError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repository verification failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.response_format" class="doc doc-heading">
            <code>response_format</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.response_format.TEXT_SECTIONS_DESCRIPTION" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">TEXT_SECTIONS_DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;Ordered list of logical sections for the text. The sequence of line ranges for the sections must cover every line from start to finish without any overlaps or gaps.&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.response_format.LogicalSection" class="doc doc-heading">
            <code>LogicalSection</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>A logically coherent section of text.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/response_format.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogicalSection</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A logically coherent section of text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Meaningful title for the section in the original language of the section.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Starting line number of the section (inclusive).&quot;</span>
    <span class="p">)</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ending line number of the section (inclusive).&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.response_format.LogicalSection.end_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_line</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Ending line number of the section (inclusive).&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.response_format.LogicalSection.start_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_line</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Starting line number of the section (inclusive).&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.response_format.LogicalSection.title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Meaningful title for the section in the original language of the section.&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ai_text_processing.response_format.TextObject" class="doc doc-heading">
            <code>TextObject</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Represents a text in any language broken into coherent logical sections.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ai_text_processing/response_format.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TextObject</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a text in any language broken into coherent logical sections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ISO 639-1 language code of the text.&quot;</span><span class="p">)</span>
    <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LogicalSection</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">TEXT_SECTIONS_DESCRIPTION</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.response_format.TextObject.language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">language</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ISO 639-1 language code of the text.&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.ai_text_processing.response_format.TextObject.sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sections</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">TEXT_SECTIONS_DESCRIPTION</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ai_text_processing.typing" class="doc doc-heading">
            <code>typing</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ai_text_processing.typing.ResponseFormat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ResponseFormat</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;ResponseFormat&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">BaseModel</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.audio_processing" class="doc doc-heading">
            <code>audio_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.audio_processing.audio" class="doc doc-heading">
            <code>audio</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.EXPECTED_TIME_FACTOR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">EXPECTED_TIME_FACTOR</span> <span class="o">=</span> <span class="mf">0.45</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.MAX_DURATION" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_DURATION</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.MAX_DURATION_MS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_DURATION_MS</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.MAX_INT16" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_INT16</span> <span class="o">=</span> <span class="mf">32768.0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MIN_SILENCE_LENGTH</span> <span class="o">=</span> <span class="mi">1000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.SEEK_LENGTH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SEEK_LENGTH</span> <span class="o">=</span> <span class="mi">50</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">SILENCE_DBFS_THRESHOLD</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.audio.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="s1">&#39;audio_processing&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.audio_processing.audio.Boundary" class="doc doc-heading">
            <code>Boundary</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">


        <p>A data structure representing a detected audio boundary.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary.start" href="#tnh_scholar.audio_processing.audio.Boundary.start">start</a></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time of the segment in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary.end" href="#tnh_scholar.audio_processing.audio.Boundary.end">end</a></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time of the segment in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary.text" href="#tnh_scholar.audio_processing.audio.Boundary.text">text</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated text (empty if silence-based).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>b = Boundary(start=0.0, end=30.0, text="Hello world")
b.start, b.end, b.text
(0.0, 30.0, 'Hello world')</p>
</blockquote>
</blockquote>
</blockquote>
</details>





              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Boundary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A data structure representing a detected audio boundary.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        start (float): Start time of the segment in seconds.</span>
<span class="sd">        end (float): End time of the segment in seconds.</span>
<span class="sd">        text (str): Associated text (empty if silence-based).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; b = Boundary(start=0.0, end=30.0, text=&quot;Hello world&quot;)</span>
<span class="sd">        &gt;&gt;&gt; b.start, b.end, b.text</span>
<span class="sd">        (0.0, 30.0, &#39;Hello world&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.audio_processing.audio.Boundary.end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.audio_processing.audio.Boundary.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.audio_processing.audio.Boundary.text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.audio_processing.audio.Boundary.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.audio_to_numpy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">audio_to_numpy</span><span class="p">(</span><span class="n">audio_segment</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Convert an AudioSegment object to a NumPy array suitable for Whisper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_segment</code>
            </td>
            <td>
                  <code><span title="pydub.AudioSegment">AudioSegment</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input audio segment to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: A mono-channel NumPy array normalized to the range [-1, 1].</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>audio = AudioSegment.from_file("example.mp3")
audio_numpy = audio_to_numpy(audio)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">audio_to_numpy</span><span class="p">(</span><span class="n">audio_segment</span><span class="p">:</span> <span class="n">AudioSegment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an AudioSegment object to a NumPy array suitable for Whisper.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_segment (AudioSegment): The input audio segment to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: A mono-channel NumPy array normalized to the range [-1, 1].</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; audio = AudioSegment.from_file(&quot;example.mp3&quot;)</span>
<span class="sd">        &gt;&gt;&gt; audio_numpy = audio_to_numpy(audio)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert the audio segment to raw sample data</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">audio_segment</span><span class="o">.</span><span class="n">get_array_of_samples</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Normalize data to the range [-1, 1]</span>
    <span class="n">raw_data</span> <span class="o">/=</span> <span class="n">MAX_INT16</span>

    <span class="c1"># Ensure mono-channel (use first channel if stereo)</span>
    <span class="k">if</span> <span class="n">audio_segment</span><span class="o">.</span><span class="n">channels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">audio_segment</span><span class="o">.</span><span class="n">channels</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">raw_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.detect_silence_boundaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_silence_boundaries</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">min_silence_len</span><span class="o">=</span><span class="n">MIN_SILENCE_LENGTH</span><span class="p">,</span> <span class="n">silence_thresh</span><span class="o">=</span><span class="n">SILENCE_DBFS_THRESHOLD</span><span class="p">,</span> <span class="n">max_duration</span><span class="o">=</span><span class="n">MAX_DURATION_MS</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Detect boundaries (start/end times) based on silence detection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the audio file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_silence_len</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum silence length to consider for splitting (ms).</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH" href="#tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH">MIN_SILENCE_LENGTH</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>silence_thresh</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Silence threshold in dBFS.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD" href="#tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD">SILENCE_DBFS_THRESHOLD</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_duration</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum duration of any segment (ms).</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.MAX_DURATION_MS" href="#tnh_scholar.audio_processing.audio.MAX_DURATION_MS">MAX_DURATION_MS</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary" href="#tnh_scholar.audio_processing.audio.Boundary">Boundary</a>], <span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Boundary]: A list of boundaries with empty text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>boundaries = detect_silence_boundaries(Path("my_audio.mp3"))
for b in boundaries:
...     print(b.start, b.end)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_silence_boundaries</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">min_silence_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MIN_SILENCE_LENGTH</span><span class="p">,</span>
    <span class="n">silence_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SILENCE_DBFS_THRESHOLD</span><span class="p">,</span>
    <span class="n">max_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MAX_DURATION_MS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Boundary</span><span class="p">],</span> <span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect boundaries (start/end times) based on silence detection.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_file (Path): Path to the audio file.</span>
<span class="sd">        min_silence_len (int): Minimum silence length to consider for splitting (ms).</span>
<span class="sd">        silence_thresh (int): Silence threshold in dBFS.</span>
<span class="sd">        max_duration (int): Maximum duration of any segment (ms).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Boundary]: A list of boundaries with empty text.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; boundaries = detect_silence_boundaries(Path(&quot;my_audio.mp3&quot;))</span>
<span class="sd">        &gt;&gt;&gt; for b in boundaries:</span>
<span class="sd">        ...     print(b.start, b.end)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Detecting silence boundaries with min_silence=</span><span class="si">{</span><span class="n">min_silence_len</span><span class="si">}</span><span class="s2">, silence_thresh=</span><span class="si">{</span><span class="n">silence_thresh</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">audio_file</span><span class="p">)</span>
    <span class="n">nonsilent_ranges</span> <span class="o">=</span> <span class="n">detect_nonsilent</span><span class="p">(</span>
        <span class="n">audio</span><span class="p">,</span>
        <span class="n">min_silence_len</span><span class="o">=</span><span class="n">min_silence_len</span><span class="p">,</span>
        <span class="n">silence_thresh</span><span class="o">=</span><span class="n">silence_thresh</span><span class="p">,</span>
        <span class="n">seek_step</span><span class="o">=</span><span class="n">SEEK_LENGTH</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Combine ranges to enforce max_duration</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nonsilent_ranges</span><span class="p">:</span>
        <span class="c1"># If no nonsilent segments found, return entire file as one boundary</span>
        <span class="n">duration_s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Boundary</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">duration_s</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)]</span>

    <span class="n">combined_ranges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_start</span><span class="p">,</span> <span class="n">current_end</span> <span class="o">=</span> <span class="n">nonsilent_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">nonsilent_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current_end</span> <span class="o">-</span> <span class="n">current_start</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_duration</span><span class="p">:</span>
            <span class="c1"># Extend the current segment</span>
            <span class="n">current_end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">combined_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_start</span><span class="p">,</span> <span class="n">current_end</span><span class="p">))</span>
            <span class="n">current_start</span><span class="p">,</span> <span class="n">current_end</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
    <span class="n">combined_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_start</span><span class="p">,</span> <span class="n">current_end</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="n">Boundary</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">start_ms</span><span class="p">,</span> <span class="n">end_ms</span> <span class="ow">in</span> <span class="n">combined_ranges</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.detect_whisper_boundaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_whisper_boundaries</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">model_size</span><span class="o">=</span><span class="s1">&#39;tiny&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Detect sentence boundaries using a Whisper model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the audio file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_size</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whisper model size.</p>
              </div>
            </td>
            <td>
                  <code>&#39;tiny&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language to force for transcription (e.g. 'en', 'vi'), or None for auto.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary" href="#tnh_scholar.audio_processing.audio.Boundary">Boundary</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Boundary]: A list of sentence boundaries with text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>boundaries = detect_whisper_boundaries(Path("my_audio.mp3"), model_size="tiny")
for b in boundaries:
...     print(b.start, b.end, b.text)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_whisper_boundaries</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">model_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiny&quot;</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Boundary</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect sentence boundaries using a Whisper model.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_file (Path): Path to the audio file.</span>
<span class="sd">        model_size (str): Whisper model size.</span>
<span class="sd">        language (str): Language to force for transcription (e.g. &#39;en&#39;, &#39;vi&#39;), or None for auto.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Boundary]: A list of sentence boundaries with text.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; boundaries = detect_whisper_boundaries(Path(&quot;my_audio.mp3&quot;), model_size=&quot;tiny&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for b in boundaries:</span>
<span class="sd">        ...     print(b.start, b.end, b.text)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;KMP_WARNINGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>  <span class="c1"># Turn of OMP warning message</span>

    <span class="c1"># Load model</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading Whisper model...&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">load_whisper_model</span><span class="p">(</span><span class="n">model_size</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model &#39;</span><span class="si">{</span><span class="n">model_size</span><span class="si">}</span><span class="s2">&#39; loaded.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Language for boundaries set to &#39;</span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Language not set. Autodetect will be used in Whisper model.&quot;</span><span class="p">)</span>

    <span class="c1"># with TimeProgress(expected_time=expected_time, desc=&quot;Generating transcription boundaries&quot;):</span>
    <span class="n">boundary_transcription</span> <span class="o">=</span> <span class="n">whisper_model_transcribe</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">audio_file</span><span class="p">),</span>
        <span class="n">task</span><span class="o">=</span><span class="s2">&quot;transcribe&quot;</span><span class="p">,</span>
        <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">sentence_boundaries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Boundary</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">boundary_transcription</span><span class="p">[</span><span class="s2">&quot;segments&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">sentence_boundaries</span><span class="p">,</span> <span class="n">boundary_transcription</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.split_audio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_audio</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;whisper&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_size</span><span class="o">=</span><span class="s1">&#39;tiny&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_silence_len</span><span class="o">=</span><span class="n">MIN_SILENCE_LENGTH</span><span class="p">,</span> <span class="n">silence_thresh</span><span class="o">=</span><span class="n">SILENCE_DBFS_THRESHOLD</span><span class="p">,</span> <span class="n">max_duration</span><span class="o">=</span><span class="n">MAX_DURATION</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>High-level function to split an audio file into chunks based on a chosen method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input audio file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Splitting method, "silence" or "whisper".</p>
              </div>
            </td>
            <td>
                  <code>&#39;whisper&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to store output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_size</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whisper model size if method='whisper'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;tiny&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language for whisper transcription if method='whisper'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_silence_len</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For silence-based detection, min silence length in ms.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH" href="#tnh_scholar.audio_processing.audio.MIN_SILENCE_LENGTH">MIN_SILENCE_LENGTH</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>silence_thresh</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Silence threshold in dBFS.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD" href="#tnh_scholar.audio_processing.audio.SILENCE_DBFS_THRESHOLD">SILENCE_DBFS_THRESHOLD</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_duration_s</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Max chunk length in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_duration_ms</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Max chunk length in ms (for silence detection combination).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Path</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing the resulting chunks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h6 id="tnh_scholar.audio_processing.audio.split_audio--split-using-silence-detection">Split using silence detection</h6>
<p>split_audio(Path("my_audio.mp3"), method="silence")</p>
<h6 id="tnh_scholar.audio_processing.audio.split_audio--split-using-whisper-based-sentence-boundaries">Split using whisper-based sentence boundaries</h6>
<p>split_audio(Path("my_audio.mp3"), method="whisper", model_size="base", language="en")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_audio</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whisper&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiny&quot;</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_silence_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MIN_SILENCE_LENGTH</span><span class="p">,</span>
    <span class="n">silence_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SILENCE_DBFS_THRESHOLD</span><span class="p">,</span>
    <span class="n">max_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MAX_DURATION</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-level function to split an audio file into chunks based on a chosen method.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_file (Path): The input audio file.</span>
<span class="sd">        method (str): Splitting method, &quot;silence&quot; or &quot;whisper&quot;.</span>
<span class="sd">        output_dir (Path): Directory to store output.</span>
<span class="sd">        model_size (str): Whisper model size if method=&#39;whisper&#39;.</span>
<span class="sd">        language (str): Language for whisper transcription if method=&#39;whisper&#39;.</span>
<span class="sd">        min_silence_len (int): For silence-based detection, min silence length in ms.</span>
<span class="sd">        silence_thresh (int): Silence threshold in dBFS.</span>
<span class="sd">        max_duration_s (int): Max chunk length in seconds.</span>
<span class="sd">        max_duration_ms (int): Max chunk length in ms (for silence detection combination).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path: Directory containing the resulting chunks.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Split using silence detection</span>
<span class="sd">        &gt;&gt;&gt; split_audio(Path(&quot;my_audio.mp3&quot;), method=&quot;silence&quot;)</span>

<span class="sd">        &gt;&gt;&gt; # Split using whisper-based sentence boundaries</span>
<span class="sd">        &gt;&gt;&gt; split_audio(Path(&quot;my_audio.mp3&quot;), method=&quot;whisper&quot;, model_size=&quot;base&quot;, language=&quot;en&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Splitting audio with max_duration=</span><span class="si">{</span><span class="n">max_duration</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;whisper&quot;</span><span class="p">:</span>
        <span class="n">boundaries</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">detect_whisper_boundaries</span><span class="p">(</span>
            <span class="n">audio_file</span><span class="p">,</span> <span class="n">model_size</span><span class="o">=</span><span class="n">model_size</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">language</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;silence&quot;</span><span class="p">:</span>
        <span class="n">max_duration_ms</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">max_duration</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="p">)</span>  <span class="c1"># convert duration in seconds to milliseconds</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">detect_silence_boundaries</span><span class="p">(</span>
            <span class="n">audio_file</span><span class="p">,</span>
            <span class="n">min_silence_len</span><span class="o">=</span><span class="n">min_silence_len</span><span class="p">,</span>
            <span class="n">silence_thresh</span><span class="o">=</span><span class="n">silence_thresh</span><span class="p">,</span>
            <span class="n">max_duration</span><span class="o">=</span><span class="n">max_duration_ms</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">. Must be &#39;silence&#39; or &#39;whisper&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># delete all files in the output_dir (this is useful for reprocessing)</span>

    <span class="k">return</span> <span class="n">split_audio_at_boundaries</span><span class="p">(</span>
        <span class="n">audio_file</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">max_duration</span><span class="o">=</span><span class="n">max_duration</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.split_audio_at_boundaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_audio_at_boundaries</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_duration</span><span class="o">=</span><span class="n">MAX_DURATION</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Split the audio file into chunks based on provided boundaries, ensuring all audio is included
and boundaries align with the start of Whisper segments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input audio file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boundaries</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.Boundary" href="#tnh_scholar.audio_processing.audio.Boundary">Boundary</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detected boundaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to store the resulting chunks.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_duration</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum chunk length in seconds.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.audio_processing.audio.MAX_DURATION" href="#tnh_scholar.audio_processing.audio.MAX_DURATION">MAX_DURATION</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Path</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing the chunked audio files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>boundaries = [Boundary(34.02, 37.26, "..."), Boundary(38.0, 41.18, "...")]
out_dir = split_audio_at_boundaries(Path("my_audio.mp3"), boundaries)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_audio_at_boundaries</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">boundaries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Boundary</span><span class="p">],</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MAX_DURATION</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split the audio file into chunks based on provided boundaries, ensuring all audio is included</span>
<span class="sd">    and boundaries align with the start of Whisper segments.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_file (Path): The input audio file.</span>
<span class="sd">        boundaries (List[Boundary]): Detected boundaries.</span>
<span class="sd">        output_dir (Path): Directory to store the resulting chunks.</span>
<span class="sd">        max_duration (int): Maximum chunk length in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path: Directory containing the chunked audio files.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; boundaries = [Boundary(34.02, 37.26, &quot;...&quot;), Boundary(38.0, 41.18, &quot;...&quot;)]</span>
<span class="sd">        &gt;&gt;&gt; out_dir = split_audio_at_boundaries(Path(&quot;my_audio.mp3&quot;), boundaries)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Splitting audio with max_duration=</span><span class="si">{</span><span class="n">max_duration</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="c1"># Load the audio file</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">audio_file</span><span class="p">)</span>

    <span class="c1"># Create output directory based on filename</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">audio_file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_chunks&quot;</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Clean up the output directory</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting existing file: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="n">chunk_start</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Start time for the first chunk in ms</span>
    <span class="n">chunk_count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">current_chunk</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">boundaries</span><span class="p">):</span>
        <span class="n">segment_start_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">boundary</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">):</span>
            <span class="n">segment_end_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">boundaries</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="p">)</span>  <span class="c1"># Next boundary&#39;s start</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segment_end_ms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>  <span class="c1"># End of the audio for the last boundary</span>

        <span class="c1"># Adjust for the first segment starting at 0</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">segment_start_ms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">segment_start_ms</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Ensure we include the very beginning of the audio</span>

        <span class="n">segment</span> <span class="o">=</span> <span class="n">audio</span><span class="p">[</span><span class="n">segment_start_ms</span><span class="p">:</span><span class="n">segment_end_ms</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Boundary index: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">, segment_start: </span><span class="si">{</span><span class="n">segment_start_ms</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">, segment_end: </span><span class="si">{</span><span class="n">segment_end_ms</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">, duration: </span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">duration_seconds</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current chunk Duration (s): </span><span class="si">{</span><span class="n">current_chunk</span><span class="o">.</span><span class="n">duration_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_duration</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="c1"># Add segment to the current chunk</span>
            <span class="n">current_chunk</span> <span class="o">+=</span> <span class="n">segment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Export current chunk</span>
            <span class="n">chunk_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;chunk_</span><span class="si">{</span><span class="n">chunk_count</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
            <span class="n">current_chunk</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">chunk_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported: </span><span class="si">{</span><span class="n">chunk_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">chunk_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Start a new chunk with the current segment</span>
            <span class="n">current_chunk</span> <span class="o">=</span> <span class="n">segment</span>

    <span class="c1"># Export the final chunk if any audio remains</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">chunk_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;chunk_</span><span class="si">{</span><span class="n">chunk_count</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
        <span class="n">current_chunk</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">chunk_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported: </span><span class="si">{</span><span class="n">chunk_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.audio.whisper_model_transcribe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">whisper_model_transcribe</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wrapper around model.transcribe that suppresses the known
'FP16 is not supported on CPU; using FP32 instead' UserWarning
and redirects unwanted 'OMP' messages to prevent interference.</p>
<p>This function accepts all args and kwargs that model.transcribe normally does,
and supports input sources as file paths (str or Path) or in-memory audio arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Whisper model instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_source</code>
            </td>
            <td>
                  <code>Union[str, <span title="pathlib.Path">Path</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input audio file path, URL, or in-memory audio array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional positional arguments for model.transcribe.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for model.transcribe.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]: Transcription result from model.transcribe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h6 id="tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-a-file-path">Using a file path</h6>
<p>result = whisper_model_transcribe(my_model, "sample_audio.mp3", verbose=True)</p>
<h6 id="tnh_scholar.audio_processing.audio.whisper_model_transcribe--using-an-audio-array">Using an audio array</h6>
<p>result = whisper_model_transcribe(my_model, audio_array, language="en")</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">whisper_model_transcribe</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">input_source</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around model.transcribe that suppresses the known</span>
<span class="sd">    &#39;FP16 is not supported on CPU; using FP32 instead&#39; UserWarning</span>
<span class="sd">    and redirects unwanted &#39;OMP&#39; messages to prevent interference.</span>

<span class="sd">    This function accepts all args and kwargs that model.transcribe normally does,</span>
<span class="sd">    and supports input sources as file paths (str or Path) or in-memory audio arrays.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (Any): The Whisper model instance.</span>
<span class="sd">        input_source (Union[str, Path, np.ndarray]): Input audio file path, URL, or in-memory audio array.</span>
<span class="sd">        *args: Additional positional arguments for model.transcribe.</span>
<span class="sd">        **kwargs: Additional keyword arguments for model.transcribe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, Any]: Transcription result from model.transcribe.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Using a file path</span>
<span class="sd">        result = whisper_model_transcribe(my_model, &quot;sample_audio.mp3&quot;, verbose=True)</span>

<span class="sd">        # Using an audio array</span>
<span class="sd">        result = whisper_model_transcribe(my_model, audio_array, language=&quot;en&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># class StdoutFilter(io.StringIO):</span>
    <span class="c1">#     def __init__(self, original_stdout):</span>
    <span class="c1">#         super().__init__()</span>
    <span class="c1">#         self.original_stdout = original_stdout</span>

    <span class="c1">#     def write(self, message):</span>
    <span class="c1">#         # Suppress specific messages like &#39;OMP:&#39; while allowing others</span>
    <span class="c1">#         if &quot;OMP:&quot; not in message:</span>
    <span class="c1">#             self.original_stdout.write(message)</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;FP16 is not supported on CPU; using FP32 instead&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Redirect stdout to suppress OMP messages</span>
        <span class="c1"># original_stdout = sys.stdout</span>
        <span class="c1"># sys.stdout = filtered_stdout</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Convert Path to str if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_source</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
                <span class="n">input_source</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_source</span><span class="p">)</span>

            <span class="c1"># Call the original transcribe function</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">input_source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original stdout</span>
            <span class="c1"># sys.stdout = original_stdout</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.audio_processing.transcription" class="doc doc-heading">
            <code>transcription</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.transcription.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.transcription.custom_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">custom_to_json</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Custom JSON conversion function to handle problematic float values from Open AI API interface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transcript</code>
            </td>
            <td>
                  <code>Any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object from OpenAI API's transcription.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON string with problematic values fixed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/transcription.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">custom_to_json</span><span class="p">(</span><span class="n">transcript</span><span class="p">:</span> <span class="n">TranscriptionVerbose</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom JSON conversion function to handle problematic float values from Open AI API interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript (Any): Object from OpenAI API&#39;s transcription.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: JSON string with problematic values fixed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Entered custom_to_json function.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use warnings.catch_warnings to catch specific warnings</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">caught_warnings</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>  <span class="c1"># Catch all UserWarnings</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">transcript</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Check if any warnings were caught</span>
            <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">caught_warnings</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">):</span>
                    <span class="n">warning_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;Expected `str` but got `float`&quot;</span> <span class="ow">in</span> <span class="n">warning_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Known UserWarning in OPENAI .to_dict() float serialization caught and ignored.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Unexpected warning during to_dict(): </span><span class="si">{</span><span class="n">warning_msg</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during to_dict(): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({})</span>  <span class="c1"># Return an empty JSON as a fallback</span>

    <span class="c1"># Traverse the dictionary to convert problematic floats to strings</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>  <span class="c1"># Handle floats</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.18f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Serialize the cleaned dictionary back to JSON</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dumping json in custom_to_json...&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.transcription.get_text_from_transcript" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_from_transcript</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Extracts and combines text from all segments of a transcription.

Args:
    transcript (TranscriptionVerbose): A transcription object containing segments of text.

Returns:
    str: A single string with all segment texts concatenated, separated by newlines.

Raises:
    ValueError: If the transcript object is invalid or missing required attributes.

Example:
    &gt;&gt;&gt; from openai.types.audio.transcription_verbose import TranscriptionVerbose
    &gt;&gt;&gt; transcript = TranscriptionVerbose(segments=[{"text": "Hello"}, {"text": "world"}])
    &gt;&gt;&gt; get_text_from_transcript(transcript)
    'Hello
</code></pre>
<p>world'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/transcription.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_text_from_transcript</span><span class="p">(</span><span class="n">transcript</span><span class="p">:</span> <span class="n">TranscriptionVerbose</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts and combines text from all segments of a transcription.</span>

<span class="sd">    Args:</span>
<span class="sd">        transcript (TranscriptionVerbose): A transcription object containing segments of text.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A single string with all segment texts concatenated, separated by newlines.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the transcript object is invalid or missing required attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from openai.types.audio.transcription_verbose import TranscriptionVerbose</span>
<span class="sd">        &gt;&gt;&gt; transcript = TranscriptionVerbose(segments=[{&quot;text&quot;: &quot;Hello&quot;}, {&quot;text&quot;: &quot;world&quot;}])</span>
<span class="sd">        &gt;&gt;&gt; get_text_from_transcript(transcript)</span>
<span class="sd">        &#39;Hello\nworld&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;transcript is type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">transcript</span><span class="o">.</span><span class="n">segments</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.transcription.get_transcription" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transcription</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;transcribe&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/transcription.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_transcription</span><span class="p">(</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;transcribe&quot;</span>
<span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Speech transcript parameters: file=</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">, model=</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">, response_format=verbose_json, mode=</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">prompt=&#39;</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">transcript</span> <span class="o">=</span> <span class="n">run_transcription_speech</span><span class="p">(</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="s2">&quot;verbose_json&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
    <span class="p">)</span>

    <span class="c1"># Use the custom_to_json function</span>
    <span class="n">json_output</span> <span class="o">=</span> <span class="n">custom_to_json</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Serialized JSON output excerpt: </span><span class="si">{</span><span class="n">json_output</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Write the serialized JSON to the JSONL file</span>
    <span class="n">jsonl_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_output</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">get_text_from_transcript</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.transcription.process_audio_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_audio_chunks</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">jsonl_file</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;whisper-1&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Processes all audio chunks in the specified directory using OpenAI's transcription API,
saves the transcription objects into a JSONL file, and stitches the transcriptions
into a single text file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing audio chunks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the output file to save the stitched transcription.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jsonl_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the transcription objects as a JSONL file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transcription model to use (default is "whisper-1").</p>
              </div>
            </td>
            <td>
                  <code>&#39;whisper-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional prompt to provide context for better transcription.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>translate</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional flag to translate speech to English (useful if the audio input is not English)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Raises:
    FileNotFoundError: If no audio chunks are found in the directory.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/transcription.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_audio_chunks</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">jsonl_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whisper-1&quot;</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes all audio chunks in the specified directory using OpenAI&#39;s transcription API,</span>
<span class="sd">    saves the transcription objects into a JSONL file, and stitches the transcriptions</span>
<span class="sd">    into a single text file.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (Path): Path to the directory containing audio chunks.</span>
<span class="sd">        output_file (Path): Path to the output file to save the stitched transcription.</span>
<span class="sd">        jsonl_file (Path): Path to save the transcription objects as a JSONL file.</span>
<span class="sd">        model (str): The transcription model to use (default is &quot;whisper-1&quot;).</span>
<span class="sd">        prompt (str): Optional prompt to provide context for better transcription.</span>
<span class="sd">        translate (bool): Optional flag to translate speech to English (useful if the audio input is not English)</span>
<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If no audio chunks are found in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure the output directory exists</span>
    <span class="n">output_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">jsonl_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Collect all audio chunks in the directory, sorting numerically by chunk number</span>
    <span class="n">audio_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.mp3&quot;</span><span class="p">),</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># Extract the number from &#39;chunk_X&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">audio_files</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No audio files found in the directory: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># log files to process:</span>
    <span class="n">audio_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">audio_files</span><span class="p">]</span>  <span class="c1"># get strings for logging</span>
    <span class="n">audio_file_name_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">audio_file_names</span><span class="p">)</span>
    <span class="n">audio_file_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_file_names</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">audio_file_count</span><span class="si">}</span><span class="s2"> audio files found in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">audio_file_name_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Initialize the output content</span>
    <span class="n">stitched_transcription</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Open the JSONL file for writing</span>
    <span class="k">with</span> <span class="n">jsonl_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonl_out</span><span class="p">:</span>
        <span class="c1"># Process each audio chunk</span>
        <span class="k">for</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="n">audio_files</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">audio_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">translate</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">get_transcription</span><span class="p">(</span>
                        <span class="n">audio_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;translate&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">get_transcription</span><span class="p">(</span>
                        <span class="n">audio_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;transcribe&quot;</span>
                    <span class="p">)</span>

                <span class="n">stitched_transcription</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">audio_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>

    <span class="c1"># Write the stitched transcription to the output file</span>
    <span class="k">with</span> <span class="n">output_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stitched_transcription</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stitched transcription saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Full transcript objects saved to </span><span class="si">{</span><span class="n">jsonl_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.transcription.process_audio_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_audio_file</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">jsonl_file</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;whisper-1&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Processes a single audio file using OpenAI's transcription API,
saves the transcription objects into a JSONL file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>audio_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the the audio file for processing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the output file to save the stitched transcription.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jsonl_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the transcription objects as a JSONL file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transcription model to use (default is "whisper-1").</p>
              </div>
            </td>
            <td>
                  <code>&#39;whisper-1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional prompt to provide context for better transcription.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>translate</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional flag to translate speech to English (useful if the audio input is not English)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Raises:
    FileNotFoundError: If no audio chunks are found in the directory.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/transcription.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_audio_file</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">jsonl_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whisper-1&quot;</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a single audio file using OpenAI&#39;s transcription API,</span>
<span class="sd">    saves the transcription objects into a JSONL file.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio_file (Path): Path to the the audio file for processing</span>
<span class="sd">        output_file (Path): Path to the output file to save the stitched transcription.</span>
<span class="sd">        jsonl_file (Path): Path to save the transcription objects as a JSONL file.</span>
<span class="sd">        model (str): The transcription model to use (default is &quot;whisper-1&quot;).</span>
<span class="sd">        prompt (str): Optional prompt to provide context for better transcription.</span>
<span class="sd">        translate (bool): Optional flag to translate speech to English (useful if the audio input is not English)</span>
<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If no audio chunks are found in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure the output directory exists</span>
    <span class="n">output_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">jsonl_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio file </span><span class="si">{</span><span class="n">audio_file</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio file found: </span><span class="si">{</span><span class="n">audio_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Open the JSONL file for writing</span>
    <span class="k">with</span> <span class="n">jsonl_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonl_out</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">audio_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">translate</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">get_transcription</span><span class="p">(</span>
                    <span class="n">audio_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;translate&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">get_transcription</span><span class="p">(</span>
                    <span class="n">audio_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">jsonl_out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;transcribe&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">audio_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="c1"># Write the stitched transcription to the output file</span>
    <span class="k">with</span> <span class="n">output_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcription saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Full transcript objects saved to </span><span class="si">{</span><span class="n">jsonl_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.audio_processing.whisper_security" class="doc doc-heading">
            <code>whisper_security</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.audio_processing.whisper_security.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.whisper_security.load_whisper_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_whisper_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Safely load a Whisper model with security best practices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Whisper model to load (e.g., "tiny", "base", "small")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded Whisper model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If model loading fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/whisper_security.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_whisper_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Safely load a Whisper model with security best practices.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name: Name of the Whisper model to load (e.g., &quot;tiny&quot;, &quot;base&quot;, &quot;small&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Loaded Whisper model</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If model loading fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">whisper</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">safe_torch_load</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load Whisper model </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load Whisper model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.audio_processing.whisper_security.safe_torch_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_torch_load</span><span class="p">(</span><span class="n">weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Context manager that temporarily modifies torch.load to use weights_only=True by default.</p>
<p>This addresses the FutureWarning in PyTorch regarding pickle security:
https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>weights_only</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, limits unpickling to tensor data only.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with safe_torch_load():
...     model = whisper.load_model("tiny")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/audio_processing/whisper_security.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">safe_torch_load</span><span class="p">(</span><span class="n">weights_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager that temporarily modifies torch.load to use weights_only=True by default.</span>

<span class="sd">    This addresses the FutureWarning in PyTorch regarding pickle security:</span>
<span class="sd">    https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models</span>

<span class="sd">    Args:</span>
<span class="sd">        weights_only: If True, limits unpickling to tensor data only.</span>

<span class="sd">    Yields:</span>
<span class="sd">        None</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; with safe_torch_load():</span>
<span class="sd">        ...     model = whisper.load_model(&quot;tiny&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">original_torch_load</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">original_torch_load</span><span class="p">,</span> <span class="n">weights_only</span><span class="o">=</span><span class="n">weights_only</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Modified torch.load to use weights_only=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">weights_only</span><span class="p">)</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">original_torch_load</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Restored original torch.load&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.cli_tools" class="doc doc-heading">
            <code>cli_tools</code>


</h3>

    <div class="doc doc-contents ">

        <p>TNH Scholar CLI Tools</p>
<p>Command-line interface tools for the TNH Scholar project:</p>
<pre><code>audio-transcribe:
    Audio processing pipeline that handles downloading, segmentation,
    and transcription of Buddhist teachings.

tnh-fab:
    Text processing tool for texts, providing functionality for
    punctuation, sectioning, translation, and pattern-based processing.
</code></pre>
<p>See individual tool documentation for usage details and examples.</p>








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.cli_tools.audio_transcribe" class="doc doc-heading">
            <code>audio_transcribe</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe" class="doc doc-heading">
            <code>audio_transcribe</code>


</h5>

    <div class="doc doc-contents ">

        <p>This module provides a command line interface for handling audio transcription tasks.
It can optionally:
 - Download audio from a YouTube URL.
 - Split existing audio into chunks.
 - Transcribe audio chunks to text.</p>


<details class="usage-example" open>
  <summary>Usage Example</summary>
  <h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe--download-split-and-transcribe-from-a-single-youtube-url">Download, split, and transcribe from a single YouTube URL</h6>
<p>audio-transcribe         --yt_download         --yt_process_url "https://www.youtube.com/watch?v=EXAMPLE"         --split         --transcribe         --output_dir ./processed         --prompt "Dharma, Deer Park..."</p>
</details>        <p>In a production environment, this CLI tool would be installed as part of the <code>tnh-scholar</code> package.</p>








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_MIN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_CHUNK_DURATION_MIN</span> <span class="o">=</span> <span class="mi">7</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_CHUNK_DURATION_SEC" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_CHUNK_DURATION_SEC</span> <span class="o">=</span> <span class="n">DEFAULT_CHUNK_DURATION_MIN</span> <span class="o">*</span> <span class="mi">60</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_OUTPUT_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_OUTPUT_DIR</span> <span class="o">=</span> <span class="s1">&#39;./audio_transcriptions&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.DEFAULT_PROMPT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PROMPT</span> <span class="o">=</span> <span class="s1">&#39;Dharma, Deer Park, Thay, Thich Nhat Hanh, Bodhicitta, Bodhisattva, Mahayana&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.LOG_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">LOG_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.REQUIREMENTS_PATH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">REQUIREMENTS_PATH</span> <span class="o">=</span> <span class="n">CLI_TOOLS_DIR</span> <span class="o">/</span> <span class="s1">&#39;audio_transcribe&#39;</span> <span class="o">/</span> <span class="s1">&#39;environment&#39;</span> <span class="o">/</span> <span class="s1">&#39;requirements.txt&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.RE_DOWNLOAD_CONFIRMATION_STR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">RE_DOWNLOAD_CONFIRMATION_STR</span> <span class="o">=</span> <span class="s1">&#39;An mp3 file corresponding to </span><span class="si">{url}</span><span class="s1"> already exists in the output path:</span><span class="se">\n\t</span><span class="si">{output_dir}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">SKIP download ([Y]/n)?&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="s1">&#39;audio_transcribe&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.audio_transcribe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">audio_transcribe</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">transcribe</span><span class="p">,</span> <span class="n">yt_url</span><span class="p">,</span> <span class="n">yt_url_csv</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">chunk_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">chunk_duration</span><span class="p">,</span> <span class="n">no_chunks</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">translate</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">silence_boundaries</span><span class="p">,</span> <span class="n">whisper_boundaries</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Entry point for the audio transcription pipeline.
Depending on the provided flags and arguments, it can download audio from YouTube,
split the audio into chunks, and/or transcribe the chunks.</p>
<p>Steps are:</p>
<ol>
<li>
<p>Download (if requested)</p>
</li>
<li>
<p>Split (if requested)</p>
</li>
<li>
<p>Transcribe (if requested)</p>
</li>
</ol>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/audio_transcribe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--split&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Split downloaded/local audio into chunks.&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--transcribe&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Transcribe the audio chunks.&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;--yt_url&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Single YouTube URL to process.&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--yt_url_csv&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A CSV File containing multiple YouTube URLs. The first column of the file must be the URL and Second column a start time (if specified).&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to a local audio file.&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--chunk_dir&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for pre-existing chunks or where to store new chunks.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--output_dir&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(),</span>
    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Base output directory. DEFAULT: &#39;</span><span class="si">{</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--chunk_duration&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_CHUNK_DURATION_SEC</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Max chunk duration in seconds (default: </span><span class="si">{</span><span class="n">DEFAULT_CHUNK_DURATION_MIN</span><span class="si">}</span><span class="s2"> minutes).&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--no_chunks&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run transcription directly on the audio files source(s). WARNING: for files &gt; 10 minutes in Length, the Open AI transcription API may fail.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--start&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start_time&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start time (beginning) offset for the input media (HH:MM:SS).&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--translate&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Include translation in the transcription if set.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--prompt&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_PROMPT</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Prompt or keywords to guide the transcription.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--silence_boundaries&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use silence detection to split audio file(s)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--whisper_boundaries&quot;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(DEFAULT) Use a whisper based model to audio at sentence boundaries.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--language&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The two letter language code. e.g. &#39;vi&#39; for Vietnamese. Used for splitting only. DEFAULT: English (&#39;en&#39;).&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">audio_transcribe</span><span class="p">(</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">transcribe</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">yt_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">yt_url_csv</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunk_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">chunk_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">no_chunks</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">silence_boundaries</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">whisper_boundaries</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entry point for the audio transcription pipeline.</span>
<span class="sd">    Depending on the provided flags and arguments, it can download audio from YouTube,</span>
<span class="sd">    split the audio into chunks, and/or transcribe the chunks.</span>

<span class="sd">    Steps are:</span>

<span class="sd">    1. Download (if requested)</span>

<span class="sd">    2. Split (if requested)</span>

<span class="sd">    3. Transcribe (if requested)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_ytd_version</span><span class="p">()</span>  <span class="c1"># Do a version check on startup. Version issues can cause yt-dlp to fail.</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting audio transcription pipeline...&quot;</span><span class="p">)</span>

    <span class="c1"># initial parameter processing</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">split</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">transcribe</span><span class="p">:</span>  <span class="c1"># if neither set, we assume both.</span>
        <span class="n">split</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">transcribe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">is_download</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">yt_url</span> <span class="ow">or</span> <span class="n">yt_url_csv</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">language</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>

    <span class="c1"># default logic for splitting boundaries</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">whisper_boundaries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">silence_boundaries</span><span class="p">:</span>
        <span class="n">whisper_boundaries</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate input arguments</span>
        <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">chunk_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">chunk_dir</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

        <span class="n">validate_inputs</span><span class="p">(</span>
            <span class="n">is_download</span><span class="o">=</span><span class="n">is_download</span><span class="p">,</span>
            <span class="n">yt_url</span><span class="o">=</span><span class="n">yt_url</span><span class="p">,</span>
            <span class="n">yt_url_list</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">yt_url_csv</span><span class="p">)</span> <span class="k">if</span> <span class="n">yt_url_csv</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">audio_file</span><span class="o">=</span><span class="n">audio_file</span><span class="p">,</span>
            <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">transcribe</span><span class="o">=</span><span class="n">transcribe</span><span class="p">,</span>
            <span class="n">chunk_dir</span><span class="o">=</span><span class="n">chunk_directory</span><span class="p">,</span>
            <span class="n">no_chunks</span><span class="o">=</span><span class="n">no_chunks</span><span class="p">,</span>
            <span class="n">silence_boundaries</span><span class="o">=</span><span class="n">silence_boundaries</span><span class="p">,</span>
            <span class="n">whisper_boundaries</span><span class="o">=</span><span class="n">whisper_boundaries</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Determine the list of URLs if we are downloading from YouTube</span>
        <span class="n">urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">yt_url_csv</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_download</span><span class="p">:</span>
                <span class="n">urls</span> <span class="o">=</span> <span class="n">get_youtube_urls_from_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">yt_url_csv</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">yt_url</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_download</span><span class="p">:</span>
                <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">yt_url</span><span class="p">]</span>

        <span class="c1"># If we are downloading from YouTube, handle that</span>
        <span class="n">downloaded_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">is_download</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
                <span class="n">download_path</span> <span class="o">=</span> <span class="n">get_video_download_path_yt</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">download_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">get_user_confirmation</span><span class="p">(</span>
                        <span class="n">RE_DOWNLOAD_CONFIRMATION_STR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping download for </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Re-downloading </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                        <span class="n">download_path</span> <span class="o">=</span> <span class="n">download_audio_yt</span><span class="p">(</span>
                            <span class="n">url</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span>
                        <span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully downloaded </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">download_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading from YouTube: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">ensure_directory_exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
                    <span class="n">download_path</span> <span class="o">=</span> <span class="n">download_audio_yt</span><span class="p">(</span>
                        <span class="n">url</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully downloaded </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">download_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">downloaded_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>

        <span class="c1"># If we have a local audio file specified (no yt_download), treat that as our input</span>
        <span class="k">if</span> <span class="n">audio_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_download</span><span class="p">:</span>
            <span class="n">downloaded_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">audio_file</span><span class="p">]</span>

        <span class="c1"># If splitting is requested, split either the downloaded files or the provided audio</span>
        <span class="k">if</span> <span class="n">split</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="n">downloaded_files</span><span class="p">:</span>
                <span class="n">audio_name</span> <span class="o">=</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">audio_output_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="n">audio_name</span>
                <span class="n">ensure_directory_exists</span><span class="p">(</span><span class="n">audio_output_dir</span><span class="p">)</span>
                <span class="n">chunk_output_dir</span> <span class="o">=</span> <span class="n">chunk_directory</span> <span class="ow">or</span> <span class="n">audio_output_dir</span> <span class="o">/</span> <span class="s2">&quot;chunks&quot;</span>
                <span class="n">ensure_directory_exists</span><span class="p">(</span><span class="n">chunk_output_dir</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Splitting audio into chunks for </span><span class="si">{</span><span class="n">audio_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">whisper_boundaries</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">silence_boundaries</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="n">silence_boundaries</span>
                <span class="p">):</span>
                    <span class="n">detection_method</span> <span class="o">=</span> <span class="s2">&quot;whisper&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">detection_method</span> <span class="o">=</span> <span class="s2">&quot;silence&quot;</span>
                <span class="n">split_audio</span><span class="p">(</span>
                    <span class="n">audio_file</span><span class="o">=</span><span class="n">audio_file</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">detection_method</span><span class="p">,</span>
                    <span class="n">output_dir</span><span class="o">=</span><span class="n">chunk_output_dir</span><span class="p">,</span>
                    <span class="n">max_duration</span><span class="o">=</span><span class="n">chunk_duration</span><span class="p">,</span>
                    <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># If transcribe is requested, we must have a chunk directory to transcribe from</span>
        <span class="k">if</span> <span class="n">transcribe</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="n">downloaded_files</span><span class="p">:</span>
                <span class="n">audio_name</span> <span class="o">=</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">audio_output_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="n">audio_name</span>
                <span class="n">transcript_file</span> <span class="o">=</span> <span class="n">audio_output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">audio_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
                <span class="k">if</span> <span class="n">no_chunks</span><span class="p">:</span>
                    <span class="n">jsonl_file</span> <span class="o">=</span> <span class="n">audio_output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">audio_name</span><span class="si">}</span><span class="s2">.jsonl&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Transcribing </span><span class="si">{</span><span class="n">audio_name</span><span class="si">}</span><span class="s2"> directly without chunking...&quot;</span>
                    <span class="p">)</span>
                    <span class="n">process_audio_file</span><span class="p">(</span>
                        <span class="n">audio_file</span><span class="o">=</span><span class="n">audio_file</span><span class="p">,</span>
                        <span class="n">output_file</span><span class="o">=</span><span class="n">transcript_file</span><span class="p">,</span>
                        <span class="n">jsonl_file</span><span class="o">=</span><span class="n">jsonl_file</span><span class="p">,</span>
                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
                        <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chunk_output_dir</span> <span class="o">=</span> <span class="n">chunk_directory</span> <span class="ow">or</span> <span class="n">audio_output_dir</span> <span class="o">/</span> <span class="s2">&quot;chunks&quot;</span>
                    <span class="n">jsonl_file</span> <span class="o">=</span> <span class="n">audio_output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">audio_name</span><span class="si">}</span><span class="s2">.jsonl&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcribing chunks from </span><span class="si">{</span><span class="n">chunk_output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">process_audio_chunks</span><span class="p">(</span>
                        <span class="n">directory</span><span class="o">=</span><span class="n">chunk_output_dir</span><span class="p">,</span>
                        <span class="n">output_file</span><span class="o">=</span><span class="n">transcript_file</span><span class="p">,</span>
                        <span class="n">jsonl_file</span><span class="o">=</span><span class="n">jsonl_file</span><span class="p">,</span>
                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
                        <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio transcription pipeline completed successfully.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;traceback info&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.audio_transcribe.audio_transcribe.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Entry point for AUDIO-TRANSCRIBE CLI tool.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/audio_transcribe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry point for AUDIO-TRANSCRIBE CLI tool.&quot;&quot;&quot;</span>
    <span class="n">audio_transcribe</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.audio_transcribe.environment" class="doc doc-heading">
            <code>environment</code>


</h5>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.environment.env" class="doc doc-heading">
            <code>env</code>


</h6>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="s1">&#39;environement_checking&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.check_env" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_env</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">requirements_file</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Check the environment for necessary conditions:
1. Verify that .env file exists or create it if not found.
2. Check that all requirements from requirements.txt are importable.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>check_env(Path("/path/to/tnh-scholar"), Path("/path/to/tnh-scholar/requirements.txt"))</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.check_env--ensures-env-checks-requirements">Ensures .env, checks requirements.</h6>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/environment/env.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_env</span><span class="p">(</span><span class="n">root_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">requirements_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the environment for necessary conditions:</span>
<span class="sd">    1. Verify that .env file exists or create it if not found.</span>
<span class="sd">    2. Check that all requirements from requirements.txt are importable.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; check_env(Path(&quot;/path/to/tnh-scholar&quot;), Path(&quot;/path/to/tnh-scholar/requirements.txt&quot;))</span>
<span class="sd">        # Ensures .env, checks requirements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;root_dir: </span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">, requirements_file: </span><span class="si">{</span><span class="n">requirements_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ensure_env_file_exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;ffmpeg&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: ffmpeg not found in PATH. Please install ffmpeg.&quot;</span><span class="p">)</span>
    <span class="n">check_requirements</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.check_requirements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_requirements</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Check that all requirements listed in requirements.txt can be imported.
If any cannot be imported, print a warning.</p>
<p>This is a heuristic check. Some packages may not share the same name as their importable module.
Adjust the name mappings below as needed.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>check_requirements(Path("./requirements.txt"))</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.check_requirements--prints-warnings-if-imports-fail-otherwise-silent">Prints warnings if imports fail, otherwise silent.</h6>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/environment/env.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_requirements</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that all requirements listed in requirements.txt can be imported.</span>
<span class="sd">    If any cannot be imported, print a warning.</span>

<span class="sd">    This is a heuristic check. Some packages may not share the same name as their importable module.</span>
<span class="sd">    Adjust the name mappings below as needed.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; check_requirements(Path(&quot;./requirements.txt&quot;))</span>
<span class="sd">        # Prints warnings if imports fail, otherwise silent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Map requirement names to their importable module names if they differ</span>
    <span class="n">name_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;python-dotenv&quot;</span><span class="p">:</span> <span class="s2">&quot;dotenv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;openai_whisper&quot;</span><span class="p">:</span> <span class="s2">&quot;whisper&quot;</span><span class="p">,</span>
        <span class="s2">&quot;protobuf&quot;</span><span class="p">:</span> <span class="s2">&quot;google.protobuf&quot;</span><span class="p">,</span>
        <span class="c1"># Add other mappings if needed</span>
    <span class="p">}</span>

    <span class="c1"># Parse requirements.txt to get a list of package names</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">requirements_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">req_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">req_file</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Each line generally looks like &#39;package==version&#39;</span>
            <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">)</span>

    <span class="c1"># Try importing each package</span>
    <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
        <span class="n">mod_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">pkg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">mod_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: Could not import &#39;</span><span class="si">{</span><span class="n">mod_name</span><span class="si">}</span><span class="s2">&#39; from &#39;</span><span class="si">{</span><span class="n">pkg</span><span class="si">}</span><span class="s2">&#39;. Check that it is correctly installed.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.ensure_env_file_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_env_file_exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Ensure that a .env file exists at the root of the project.
If it does not, prompt the user for an OPENAI_API_KEY and create the file.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ensure_env_file_exists(Path("/path/to/tnh-scholar"))</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.cli_tools.audio_transcribe.environment.env.ensure_env_file_exists--if-env-doesnt-exist-user-is-prompted-for-key-file-created-with-openai_api_key">If .env doesn't exist, user is prompted for key, file created with OPENAI_API_KEY.</h6>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/environment/env.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_env_file_exists</span><span class="p">(</span><span class="n">root_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that a .env file exists at the root of the project.</span>
<span class="sd">    If it does not, prompt the user for an OPENAI_API_KEY and create the file.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; ensure_env_file_exists(Path(&quot;/path/to/tnh-scholar&quot;))</span>
<span class="sd">        # If .env doesn&#39;t exist, user is prompted for key, file created with OPENAI_API_KEY.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_path</span> <span class="o">=</span> <span class="n">root_dir</span> <span class="o">/</span> <span class="s2">&quot;.env&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No .env file found at project root. Creating one:&quot;</span><span class="p">)</span>
        <span class="n">openai_key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please enter your OPENAI_API_KEY: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">openai_key</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No key entered. Exiting without creating .env file.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">env_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">env_file</span><span class="p">:</span>
            <span class="n">env_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OPENAI_API_KEY=</span><span class="si">{</span><span class="n">openai_key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.env file created with your OPENAI_API_KEY.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.audio_transcribe.validate" class="doc doc-heading">
            <code>validate</code>


</h5>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.audio_transcribe.validate.validate_inputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_inputs</span><span class="p">(</span><span class="n">is_download</span><span class="p">,</span> <span class="n">yt_url</span><span class="p">,</span> <span class="n">yt_url_list</span><span class="p">,</span> <span class="n">audio_file</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">transcribe</span><span class="p">,</span> <span class="n">chunk_dir</span><span class="p">,</span> <span class="n">no_chunks</span><span class="p">,</span> <span class="n">silence_boundaries</span><span class="p">,</span> <span class="n">whisper_boundaries</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Validate the CLI inputs to ensure logical consistency given all the flags.</p>
<p>Conditions &amp; Requirements:
1. At least one action (yt_download, split, transcribe) should be requested.
   Otherwise, nothing is done, so raise an error.</p>
<ol>
<li>If yt_download is True:</li>
<li>
<p>Must specify either yt_process_url OR yt_process_url_list (not both, not none).</p>
</li>
<li>
<p>If yt_download is False:</p>
</li>
<li>If split is requested, we need a local audio file (since no download will occur).</li>
<li>
<p>If transcribe is requested without split and without yt_download:</p>
<ul>
<li>If no_chunks = False, we must have chunk_dir to read existing chunks.</li>
<li>If no_chunks = True, we must have a local audio file (direct transcription) or previously downloaded file
   (but since yt_download=False, previously downloaded file scenario doesn't apply here,
   so effectively we need local audio in that scenario).</li>
</ul>
</li>
<li>
<p>no_chunks flag:</p>
</li>
<li>
<p>If no_chunks = True, we are doing direct transcription on entire audio without chunking.</p>
<ul>
<li>Cannot use split if no_chunks = True. (Mutually exclusive)</li>
<li>chunk_dir is irrelevant if no_chunks = True; since we don't split into chunks,
   requiring a chunk_dir doesn't make sense. If provided, it's not useful, but let's allow it silently
   or raise an error for clarity. It's safer to raise an error to prevent user confusion.</li>
</ul>
</li>
<li>
<p>Boundaries flags (silence_boundaries, whisper_boundaries):</p>
</li>
<li>These flags control how splitting is done.</li>
<li>If split = False, these are irrelevant. Not necessarily an error, but could be a no-op.
     For robustness, raise an error if user specifies these without split, to avoid confusion.</li>
<li>If split = True and no_chunks = True, that’s contradictory already, so no need for boundary logic there.</li>
<li>If split = True, exactly one method should be chosen:
     If both silence_boundaries and whisper_boundaries are True simultaneously or both are False simultaneously,
     we need a clear default or raise an error. By the code snippet logic, whisper_boundaries is default True
     if not stated otherwise. To keep it robust:<ul>
<li>If both are True, raise error.</li>
<li>If both are False, that means user explicitly turned them off or never turned on whisper.
     The code snippet sets whisper_boundaries True by default. If user sets it False somehow,
     we can then default to silence. Just ensure at run-time we have a deterministic method:
     If both are False, we can default to whisper or silence. Let's default to whisper if no flags given.
     However, given the code snippet, whisper_boundaries has a default of True.
     If the user sets whisper_boundaries to False and also does not set silence_boundaries,
     then no method is chosen. Let's then raise an error if both ended up False to avoid ambiguity.</li>
</ul>
</li>
</ol>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input arguments are not logically consistent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/validate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span>
    <span class="n">is_download</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">yt_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">yt_url_list</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">transcribe</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">chunk_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">no_chunks</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">silence_boundaries</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">whisper_boundaries</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the CLI inputs to ensure logical consistency given all the flags.</span>

<span class="sd">    Conditions &amp; Requirements:</span>
<span class="sd">    1. At least one action (yt_download, split, transcribe) should be requested.</span>
<span class="sd">       Otherwise, nothing is done, so raise an error.</span>

<span class="sd">    2. If yt_download is True:</span>
<span class="sd">       - Must specify either yt_process_url OR yt_process_url_list (not both, not none).</span>

<span class="sd">    3. If yt_download is False:</span>
<span class="sd">       - If split is requested, we need a local audio file (since no download will occur).</span>
<span class="sd">       - If transcribe is requested without split and without yt_download:</span>
<span class="sd">         - If no_chunks = False, we must have chunk_dir to read existing chunks.</span>
<span class="sd">         - If no_chunks = True, we must have a local audio file (direct transcription) or previously downloaded file</span>
<span class="sd">           (but since yt_download=False, previously downloaded file scenario doesn&#39;t apply here,</span>
<span class="sd">           so effectively we need local audio in that scenario).</span>

<span class="sd">    4. no_chunks flag:</span>
<span class="sd">       - If no_chunks = True, we are doing direct transcription on entire audio without chunking.</span>
<span class="sd">         - Cannot use split if no_chunks = True. (Mutually exclusive)</span>
<span class="sd">         - chunk_dir is irrelevant if no_chunks = True; since we don&#39;t split into chunks,</span>
<span class="sd">           requiring a chunk_dir doesn&#39;t make sense. If provided, it&#39;s not useful, but let&#39;s allow it silently</span>
<span class="sd">           or raise an error for clarity. It&#39;s safer to raise an error to prevent user confusion.</span>

<span class="sd">    5. Boundaries flags (silence_boundaries, whisper_boundaries):</span>
<span class="sd">       - These flags control how splitting is done.</span>
<span class="sd">       - If split = False, these are irrelevant. Not necessarily an error, but could be a no-op.</span>
<span class="sd">         For robustness, raise an error if user specifies these without split, to avoid confusion.</span>
<span class="sd">       - If split = True and no_chunks = True, that’s contradictory already, so no need for boundary logic there.</span>
<span class="sd">       - If split = True, exactly one method should be chosen:</span>
<span class="sd">         If both silence_boundaries and whisper_boundaries are True simultaneously or both are False simultaneously,</span>
<span class="sd">         we need a clear default or raise an error. By the code snippet logic, whisper_boundaries is default True</span>
<span class="sd">         if not stated otherwise. To keep it robust:</span>
<span class="sd">           - If both are True, raise error.</span>
<span class="sd">           - If both are False, that means user explicitly turned them off or never turned on whisper.</span>
<span class="sd">             The code snippet sets whisper_boundaries True by default. If user sets it False somehow,</span>
<span class="sd">             we can then default to silence. Just ensure at run-time we have a deterministic method:</span>
<span class="sd">             If both are False, we can default to whisper or silence. Let&#39;s default to whisper if no flags given.</span>
<span class="sd">             However, given the code snippet, whisper_boundaries has a default of True.</span>
<span class="sd">             If the user sets whisper_boundaries to False and also does not set silence_boundaries,</span>
<span class="sd">             then no method is chosen. Let&#39;s then raise an error if both ended up False to avoid ambiguity.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input arguments are not logically consistent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. Check that we have at least one action</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_download</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">split</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">transcribe</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;No actions requested. At least one of --yt_download, --split, --transcribe, or --full must be set.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># 2. Validate YouTube download logic</span>
    <span class="k">if</span> <span class="n">is_download</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">yt_url</span> <span class="ow">and</span> <span class="n">yt_url_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Both --yt_process_url and --yt_process_url_list provided. Only one allowed.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yt_url</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">yt_url_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;When --yt_download is specified, you must provide --yt_process_url or --yt_process_url_list.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># 3. Logic when no YouTube download:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_download</span><span class="p">:</span>
        <span class="c1"># If splitting but no download, need an audio file</span>
        <span class="k">if</span> <span class="n">split</span> <span class="ow">and</span> <span class="n">audio_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Splitting requested but no audio file provided and no YouTube download source available.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">transcribe</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">split</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">no_chunks</span><span class="p">:</span>
                <span class="c1"># Direct transcription, need an audio file</span>
                <span class="k">if</span> <span class="n">audio_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Transcription requested with no_chunks=True but no audio file provided.&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">chunk_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Transcription requested without splitting or downloading and no_chunks=False. Must provide --chunk_dir with pre-split chunks.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Check no_chunks scenario:</span>
    <span class="c1"># no_chunks and split are mutually exclusive</span>
    <span class="c1"># If transcribing but not splitting or downloading:</span>
    <span class="c1"># If no_chunks and chunk_dir provided, it doesn&#39;t make sense since we won&#39;t use chunks at all.</span>
    <span class="c1"># 4. no_chunks flag validation:</span>
    <span class="c1"># no_chunks=False, we need chunks from chunk_dir</span>
    <span class="k">if</span> <span class="n">no_chunks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">split</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot use --no_chunks and --split together. Choose one option.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">chunk_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify --chunk_dir when --no_chunks is set.&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Boundaries flags:</span>
    <span class="c1"># If splitting is not requested but boundaries flags are set, it&#39;s meaningless.</span>
    <span class="c1"># The code snippet defaults whisper_boundaries to True, so if user tries to turn it off and sets silence?</span>
    <span class="c1"># We&#39;ll require that boundaries only matter if split is True.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">split</span> <span class="ow">and</span> <span class="p">(</span><span class="n">silence_boundaries</span> <span class="ow">or</span> <span class="n">whisper_boundaries</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Boundary detection flags given but splitting is not requested. Remove these flags or enable --split.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># If split is True, we must have a consistent boundary method:</span>
    <span class="k">if</span> <span class="n">split</span><span class="p">:</span>
        <span class="c1"># If both whisper and silence are somehow True:</span>
        <span class="k">if</span> <span class="n">silence_boundaries</span> <span class="ow">and</span> <span class="n">whisper_boundaries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot use both --silence_boundaries and --whisper_boundaries simultaneously.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If both are False:</span>
        <span class="c1"># Given the original snippet, whisper_boundaries is True by default.</span>
        <span class="c1"># For the sake of robustness, let&#39;s say if user sets both off, we can&#39;t proceed:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silence_boundaries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">whisper_boundaries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No boundary method selected for splitting. Enable either whisper or silence boundaries.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.audio_transcribe.version_check" class="doc doc-heading">
            <code>version_check</code>


</h5>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.version_check.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h6 id="tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker" class="doc doc-heading">
            <code>YTDVersionChecker</code>


</h6>


    <div class="doc doc-contents ">


        <p>Simple version checker for yt-dlp with robust version comparison.</p>
<p>This is a prototype implementation may need expansion in these areas:
- Caching to prevent frequent PyPI calls
- More comprehensive error handling for:
    - Missing/uninstalled packages
    - Network timeouts
    - JSON parsing errors
    - Invalid version strings
- Environment detection (virtualenv, conda, system Python)
- Configuration options for version pinning
- Proxy support for network requests</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/version_check.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">YTDVersionChecker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple version checker for yt-dlp with robust version comparison.</span>

<span class="sd">    This is a prototype implementation may need expansion in these areas:</span>
<span class="sd">    - Caching to prevent frequent PyPI calls</span>
<span class="sd">    - More comprehensive error handling for:</span>
<span class="sd">        - Missing/uninstalled packages</span>
<span class="sd">        - Network timeouts</span>
<span class="sd">        - JSON parsing errors</span>
<span class="sd">        - Invalid version strings</span>
<span class="sd">    - Environment detection (virtualenv, conda, system Python)</span>
<span class="sd">    - Configuration options for version pinning</span>
<span class="sd">    - Proxy support for network requests</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PYPI_URL</span> <span class="o">=</span> <span class="s2">&quot;https://pypi.org/pypi/yt-dlp/json&quot;</span>
    <span class="n">NETWORK_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># seconds</span>

    <span class="k">def</span> <span class="nf">_get_installed_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get installed yt-dlp version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version object representing installed version</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If yt-dlp is not installed</span>
<span class="sd">            InvalidVersion: If installed version string is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version_str</span> <span class="o">:=</span> <span class="nb">str</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;yt-dlp&quot;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidVersion</span><span class="p">(</span><span class="s2">&quot;yt-dlp version string is empty&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">PackageNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;yt-dlp is not installed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">except</span> <span class="n">InvalidVersion</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_get_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get latest version from PyPI.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Version object representing latest available version</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.RequestException: For any network-related errors</span>
<span class="sd">            InvalidVersion: If PyPI version string is invalid</span>
<span class="sd">            KeyError: If PyPI response JSON is malformed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYPI_URL</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NETWORK_TIMEOUT</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">version_str</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;info&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span><span class="p">(</span>
                <span class="s2">&quot;Failed to fetch version from PyPI. Check network connection.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">check_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Version</span><span class="p">,</span> <span class="n">Version</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if yt-dlp needs updating.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (needs_update, installed_version, latest_version)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If yt-dlp is not installed</span>
<span class="sd">            requests.RequestException: For network-related errors</span>
<span class="sd">            InvalidVersion: If version strings are invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">installed_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_installed_version</span><span class="p">()</span>
        <span class="n">latest_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_version</span><span class="p">()</span>

        <span class="n">needs_update</span> <span class="o">=</span> <span class="n">installed_version</span> <span class="o">&lt;</span> <span class="n">latest_version</span>
        <span class="k">return</span> <span class="n">needs_update</span><span class="p">,</span> <span class="n">installed_version</span><span class="p">,</span> <span class="n">latest_version</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker.NETWORK_TIMEOUT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">NETWORK_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker.PYPI_URL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PYPI_URL</span> <span class="o">=</span> <span class="s1">&#39;https://pypi.org/pypi/yt-dlp/json&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.cli_tools.audio_transcribe.version_check.YTDVersionChecker.check_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_version</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Check if yt-dlp needs updating.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[bool, <span title="packaging.version.Version">Version</span>, <span title="packaging.version.Version">Version</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (needs_update, installed_version, latest_version)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ImportError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If yt-dlp is not installed</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="requests.RequestException">RequestException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For network-related errors</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="packaging.version.InvalidVersion">InvalidVersion</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If version strings are invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/version_check.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Version</span><span class="p">,</span> <span class="n">Version</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if yt-dlp needs updating.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (needs_update, installed_version, latest_version)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If yt-dlp is not installed</span>
<span class="sd">        requests.RequestException: For network-related errors</span>
<span class="sd">        InvalidVersion: If version strings are invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">installed_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_installed_version</span><span class="p">()</span>
    <span class="n">latest_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_latest_version</span><span class="p">()</span>

    <span class="n">needs_update</span> <span class="o">=</span> <span class="n">installed_version</span> <span class="o">&lt;</span> <span class="n">latest_version</span>
    <span class="k">return</span> <span class="n">needs_update</span><span class="p">,</span> <span class="n">installed_version</span><span class="p">,</span> <span class="n">latest_version</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.audio_transcribe.version_check.check_ytd_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_ytd_version</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Check if yt-dlp needs updating and log appropriate messages.</p>
<p>This function checks the installed version of yt-dlp against the latest version
on PyPI and logs informational or error messages as appropriate. It handles
network errors, missing packages, and version parsing issues gracefully.</p>
<p>The function does not raise exceptions but logs them using the application's
logging system.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/audio_transcribe/version_check.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_ytd_version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if yt-dlp needs updating and log appropriate messages.</span>

<span class="sd">    This function checks the installed version of yt-dlp against the latest version</span>
<span class="sd">    on PyPI and logs informational or error messages as appropriate. It handles</span>
<span class="sd">    network errors, missing packages, and version parsing issues gracefully.</span>

<span class="sd">    The function does not raise exceptions but logs them using the application&#39;s</span>
<span class="sd">    logging system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checker</span> <span class="o">=</span> <span class="n">YTDVersionChecker</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">needs_update</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">latest</span> <span class="o">=</span> <span class="n">checker</span><span class="o">.</span><span class="n">check_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">needs_update</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update available: </span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">latest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Please run the appropriate upgrade in your environment.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   For example: pip install --upgrade yt-dlp &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yt-dlp is up to date (version </span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In yt-dlp version check: Package error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In yt-dlp version check: Network error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">InvalidVersion</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In yt-dlp version check: Version parsing error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In yt-dlp version check: Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.cli_tools.nfmt" class="doc doc-heading">
            <code>nfmt</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.nfmt.nfmt" class="doc doc-heading">
            <code>nfmt</code>


</h5>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.nfmt.nfmt.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Entry point for the nfmt CLI tool.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/nfmt/nfmt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry point for the nfmt CLI tool.&quot;&quot;&quot;</span>
    <span class="n">nfmt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.nfmt.nfmt.nfmt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nfmt</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Normalize the number of newlines in a text file.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/nfmt/nfmt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output file (default: stdout)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--spacing&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of newlines between blocks (default: 2)&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">nfmt</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize the number of newlines in a text file.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.cli_tools.tnh_fab" class="doc doc-heading">
            <code>tnh_fab</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab" class="doc doc-heading">
            <code>tnh_fab</code>


</h5>

    <div class="doc doc-contents ">

        <p>TNH-FAB Command Line Interface</p>
<p>Part of the THICH NHAT HANH SCHOLAR (TNH_SCHOLAR) project.
A rapid prototype implementation of the TNH-FAB command-line tool for Open AI based text processing.
Provides core functionality for text punctuation, sectioning, translation, and processing.</p>








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.DEFAULT_SECTION_PATTERN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SECTION_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;default_section&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.pass_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pass_config</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">make_pass_decorator</span><span class="p">(</span><span class="n">TNHFabConfig</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig" class="doc doc-heading">
            <code>TNHFabConfig</code>


</h6>


    <div class="doc doc-contents ">


        <p>Holds configuration for the TNH-FAB CLI tool.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TNHFabConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds configuration for the TNH-FAB CLI tool.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Initialize pattern manager with directory set in .env file or default.</span>

        <span class="n">load_dotenv</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pattern_path_name</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;TNH_FAB_PATTERN_DIR&quot;</span><span class="p">):</span>
            <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pattern_path_name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pattern dir: </span><span class="si">{</span><span class="n">pattern_path_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">DEFAULT_PATTERN_DIR</span>

        <span class="n">pattern_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern_manager</span> <span class="o">=</span> <span class="n">PatternManager</span><span class="p">(</span><span class="n">pattern_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig.debug" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig.pattern_manager" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pattern_manager</span> <span class="o">=</span> <span class="n">PatternManager</span><span class="p">(</span><span class="n">pattern_dir</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig.quiet" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">quiet</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig.verbose" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.TNHFabConfig.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Initialize pattern manager with directory set in .env file or default.</span>

    <span class="n">load_dotenv</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pattern_path_name</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;TNH_FAB_PATTERN_DIR&quot;</span><span class="p">):</span>
        <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pattern_path_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pattern dir: </span><span class="si">{</span><span class="n">pattern_path_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pattern_dir</span> <span class="o">=</span> <span class="n">DEFAULT_PATTERN_DIR</span>

    <span class="n">pattern_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern_manager</span> <span class="o">=</span> <span class="n">PatternManager</span><span class="p">(</span><span class="n">pattern_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.get_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pattern</span><span class="p">(</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get pattern from the pattern manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern_manager</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.PatternManager" href="#tnh_scholar.ai_text_processing.patterns.PatternManager">PatternManager</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initialized PatternManager instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pattern to load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Pattern</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ai_text_processing.Pattern" href="#tnh_scholar.ai_text_processing.patterns.Pattern">Pattern</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded pattern object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="click.ClickException">ClickException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If pattern cannot be loaded</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pattern</span><span class="p">(</span><span class="n">pattern_manager</span><span class="p">:</span> <span class="n">PatternManager</span><span class="p">,</span> <span class="n">pattern_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get pattern from the pattern manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern_manager: Initialized PatternManager instance</span>
<span class="sd">        pattern_name: Name of the pattern to load</span>

<span class="sd">    Returns:</span>
<span class="sd">        Pattern: Loaded pattern object</span>

<span class="sd">    Raises:</span>
<span class="sd">        click.ClickException: If pattern cannot be loaded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pattern_manager</span><span class="o">.</span><span class="n">load_pattern</span><span class="p">(</span><span class="n">pattern_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">ClickException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">pattern_name</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">pattern_manager</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">ClickException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading pattern: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Entry point for TNH-FAB CLI tool.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry point for TNH-FAB CLI tool.&quot;&quot;&quot;</span>
    <span class="n">tnh_fab</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">paragraph</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Apply custom pattern-based processing to text with flexible structuring options.</p>
<p>This command provides flexible text processing using customizable patterns. It can
process text either by sections (defined in a JSON file or auto-detected), by
paragraphs, or can be used to process a text as a whole (this is the default).
This is particularly useful for formatting, restructuring, or applying
consistent transformations to text.</p>
<p>Examples:</p>
<pre><code>
# Process using a specific pattern
$ tnh-fab process -p format_xml input.txt


# Process using paragraph mode
$ tnh-fab process -p format_xml -g input.txt


# Process with custom sections
$ tnh-fab process -p format_xml -s sections.json input.txt


# Process with template values
$ tnh-fab process -p format_xml -t template.yaml input.txt
</code></pre>
<p>Processing Modes:</p>
<pre><code>
1. Single Input Mode (default)
    - Processes entire input.


2. Section Mode (-s):
    - Uses sections from JSON file if provided (-s)
    - If no section file is provided, sections are auto-generated.
    - Processes each section according to pattern


3. Paragraph Mode (-g):
    - Treats each line/paragraph as a separate unit
    - Useful for simpler processing tasks
    - More memory efficient for large files
</code></pre>
<p>
Notes:
    - Required pattern must exist in pattern directory
    - Template values can customize pattern behavior</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tnh_fab</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--pattern&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pattern name for processing&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--section&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Process using sections from JSON file, or auto-generate if no file provided&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--paragraph&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Process text by paragraphs&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--template&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YAML file containing template values&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@pass_config</span>
<span class="k">def</span> <span class="nf">process</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TNHFabConfig</span><span class="p">,</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">section</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">paragraph</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply custom pattern-based processing to text with flexible structuring options.</span>

<span class="sd">    This command provides flexible text processing using customizable patterns. It can</span>
<span class="sd">    process text either by sections (defined in a JSON file or auto-detected), by</span>
<span class="sd">    paragraphs, or can be used to process a text as a whole (this is the default).</span>
<span class="sd">    This is particularly useful for formatting, restructuring, or applying</span>
<span class="sd">    consistent transformations to text.</span>

<span class="sd">    Examples:</span>

<span class="sd">        \b</span>
<span class="sd">        # Process using a specific pattern</span>
<span class="sd">        $ tnh-fab process -p format_xml input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process using paragraph mode</span>
<span class="sd">        $ tnh-fab process -p format_xml -g input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process with custom sections</span>
<span class="sd">        $ tnh-fab process -p format_xml -s sections.json input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process with template values</span>
<span class="sd">        $ tnh-fab process -p format_xml -t template.yaml input.txt</span>


<span class="sd">    Processing Modes:</span>

<span class="sd">        \b</span>
<span class="sd">        1. Single Input Mode (default)</span>
<span class="sd">            - Processes entire input.</span>

<span class="sd">        \b</span>
<span class="sd">        2. Section Mode (-s):</span>
<span class="sd">            - Uses sections from JSON file if provided (-s)</span>
<span class="sd">            - If no section file is provided, sections are auto-generated.</span>
<span class="sd">            - Processes each section according to pattern</span>

<span class="sd">        \b</span>
<span class="sd">        3. Paragraph Mode (-g):</span>
<span class="sd">            - Treats each line/paragraph as a separate unit</span>
<span class="sd">            - Useful for simpler processing tasks</span>
<span class="sd">            - More memory efficient for large files</span>

<span class="sd">    \b</span>
<span class="sd">    Notes:</span>
<span class="sd">        - Required pattern must exist in pattern directory</span>
<span class="sd">        - Template values can customize pattern behavior</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">click</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">process_pattern</span> <span class="o">=</span> <span class="n">get_pattern</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>

    <span class="n">template_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">paragraph</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">process_text_by_paragraphs</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">process_pattern</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">processed</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Section mode (either file or auto-generate)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>  <span class="c1"># Section file provided</span>
            <span class="n">sections_json</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">section</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
            <span class="n">text_obj</span> <span class="o">=</span> <span class="n">TextObject</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="n">sections_json</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Auto-generate sections</span>
            <span class="n">default_section_pattern</span> <span class="o">=</span> <span class="n">get_pattern</span><span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">DEFAULT_SECTION_PATTERN</span>
            <span class="p">)</span>
            <span class="n">text_obj</span> <span class="o">=</span> <span class="n">find_sections</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">section_pattern</span><span class="o">=</span><span class="n">default_section_pattern</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">process_text_by_sections</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">text_obj</span><span class="p">,</span> <span class="n">template_dict</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">process_pattern</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">processed_section</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">processed_section</span><span class="o">.</span><span class="n">processed_text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">process_text</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">process_pattern</span><span class="p">,</span> <span class="n">template_dict</span><span class="o">=</span><span class="n">template_dict</span>
        <span class="p">)</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.punctuate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">punctuate</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">review_count</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Add punctuation and structure to text based on language-specific rules.</p>
<p>This command processes input text to add or correct punctuation, spacing, and basic
structural elements. It is particularly useful for texts that lack proper punctuation
or need standardization.</p>
<p>Examples:</p>
<pre><code>
# Process a file using default settings
$ tnh-fab punctuate input.txt


# Process Vietnamese text with custom style
$ tnh-fab punctuate -l vi -y "Modern" input.txt


# Process from stdin with increased review passes
$ cat input.txt | tnh-fab punctuate -c 5
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tnh_fab</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--language&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Source language code (e.g., &#39;en&#39;, &#39;vi&#39;). Auto-detected if not specified.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;--style&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;APA&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Punctuation style to apply (default: &#39;APA&#39;)&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--review-count&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of review passes (default: 3)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--pattern&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_punctuate&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pattern name for punctuation rules (default: &#39;default_punctuate&#39;)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@pass_config</span>
<span class="k">def</span> <span class="nf">punctuate</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TNHFabConfig</span><span class="p">,</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add punctuation and structure to text based on language-specific rules.</span>

<span class="sd">    This command processes input text to add or correct punctuation, spacing, and basic</span>
<span class="sd">    structural elements. It is particularly useful for texts that lack proper punctuation</span>
<span class="sd">    or need standardization.</span>


<span class="sd">    Examples:</span>

<span class="sd">        \b</span>
<span class="sd">        # Process a file using default settings</span>
<span class="sd">        $ tnh-fab punctuate input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process Vietnamese text with custom style</span>
<span class="sd">        $ tnh-fab punctuate -l vi -y &quot;Modern&quot; input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process from stdin with increased review passes</span>
<span class="sd">        $ cat input.txt | tnh-fab punctuate -c 5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">click</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">punctuate_pattern</span> <span class="o">=</span> <span class="n">get_pattern</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">punctuate_text</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">punctuate_pattern</span><span class="o">=</span><span class="n">punctuate_pattern</span><span class="p">,</span>
        <span class="n">template_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;style_convention&quot;</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span> <span class="s2">&quot;review_count&quot;</span><span class="p">:</span> <span class="n">review_count</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.read_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_input</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Read input from file or stdin.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_input</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">input_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read input from file or stdin.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;No input provided&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">,</span> <span class="n">review_count</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Analyze and divide text into logical sections based on content.</p>
<p>This command processes the input text to identify coherent sections based on content
analysis. It generates a structured representation of the text with sections that
maintain logical continuity. Each section includes metadata such as title and line
range.</p>
<p>Examples:</p>
<pre><code>
# Auto-detect sections in a file
$ tnh-fab section input.txt


# Specify desired number of sections
$ tnh-fab section -n 5 input.txt


# Process Vietnamese text with custom pattern
$ tnh-fab section -l vi -p custom_section_pattern input.txt


# Section text from stdin with increased review
$ cat input.txt | tnh-fab section -c 5
</code></pre>
<p>
Output Format:
    JSON object containing:
    - language: Detected or specified language code
    - sections: Array of section objects, each with:
        - title: Section title in original language
        - start_line: Starting line number (inclusive)
        - end_line: Ending line number (inclusive)</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tnh_fab</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--language&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Source language code (e.g., &#39;en&#39;, &#39;vi&#39;). Auto-detected if not specified.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--num-sections&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Target number of sections (auto-calculated if not specified)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--review-count&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of review passes (default: 3)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--pattern&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_section&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pattern name for section analysis (default: &#39;default_section&#39;)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@pass_config</span>
<span class="k">def</span> <span class="nf">section</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TNHFabConfig</span><span class="p">,</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">num_sections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">review_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze and divide text into logical sections based on content.</span>

<span class="sd">    This command processes the input text to identify coherent sections based on content</span>
<span class="sd">    analysis. It generates a structured representation of the text with sections that</span>
<span class="sd">    maintain logical continuity. Each section includes metadata such as title and line</span>
<span class="sd">    range.</span>

<span class="sd">    Examples:</span>

<span class="sd">        \b</span>
<span class="sd">        # Auto-detect sections in a file</span>
<span class="sd">        $ tnh-fab section input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Specify desired number of sections</span>
<span class="sd">        $ tnh-fab section -n 5 input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Process Vietnamese text with custom pattern</span>
<span class="sd">        $ tnh-fab section -l vi -p custom_section_pattern input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Section text from stdin with increased review</span>
<span class="sd">        $ cat input.txt | tnh-fab section -c 5</span>

<span class="sd">    \b</span>
<span class="sd">    Output Format:</span>
<span class="sd">        JSON object containing:</span>
<span class="sd">        - language: Detected or specified language code</span>
<span class="sd">        - sections: Array of section objects, each with:</span>
<span class="sd">            - title: Section title in original language</span>
<span class="sd">            - start_line: Starting line number (inclusive)</span>
<span class="sd">            - end_line: Ending line number (inclusive)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">click</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">section_pattern</span> <span class="o">=</span> <span class="n">get_pattern</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">find_sections</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">section_pattern</span><span class="o">=</span><span class="n">section_pattern</span><span class="p">,</span>
        <span class="n">section_count</span><span class="o">=</span><span class="n">num_sections</span><span class="p">,</span>
        <span class="n">review_count</span><span class="o">=</span><span class="n">review_count</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># For prototype, just output the JSON representation</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.tnh_fab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tnh_fab</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">quiet</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>TNH-FAB: Thich Nhat Hanh Scholar Text processing command-line tool.</p>
<p>CORE COMMANDS: punctuate, section, translate, process</p>
<p>To Get help on any command and see its options:</p>
<p>tnh-fab [COMMAND] --help</p>
<p>Provides specialized processing for multi-lingual Dharma content.</p>
<p>Offers functionalities for punctuation, sectioning, line-based translation,
and general text processing based on predefined patterns.
Input text can be provided either via a file or standard input.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable detailed logging&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable debug output&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Suppress all non-error output&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">tnh_fab</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TNH-FAB: Thich Nhat Hanh Scholar Text processing command-line tool.</span>

<span class="sd">    CORE COMMANDS: punctuate, section, translate, process</span>

<span class="sd">    To Get help on any command and see its options:</span>

<span class="sd">    tnh-fab [COMMAND] --help</span>

<span class="sd">    Provides specialized processing for multi-lingual Dharma content.</span>

<span class="sd">    Offers functionalities for punctuation, sectioning, line-based translation,</span>
<span class="sd">    and general text processing based on predefined patterns.</span>
<span class="sd">    Input text can be provided either via a file or standard input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">ensure_object</span><span class="p">(</span><span class="n">TNHFabConfig</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="n">config</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
    <span class="n">config</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="n">quiet</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.tnh_fab.tnh_fab.translate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">context_lines</span><span class="p">,</span> <span class="n">segment_size</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Translate text while preserving line numbers and contextual understanding.</p>
<p>This command performs intelligent translation that maintains line number correspondence
between source and translated text. It uses surrounding context to improve translation
accuracy and consistency, particularly important for Buddhist texts where terminology
and context are crucial.</p>
<p>Examples:</p>
<pre><code>
# Translate Vietnamese text to English
$ tnh-fab translate -l vi input.txt


# Translate to French with specific style
$ tnh-fab translate -l vi -r fr -y "Formal" input.txt


# Translate with increased context
$ tnh-fab translate --context-lines 5 input.txt


# Translate using custom segment size
$ tnh-fab translate --segment-size 10 input.txt
</code></pre>
<p>
Notes:
    - Line numbers are preserved in the output
    - Context lines are used to improve translation accuracy
    - Segment size affects processing speed and memory usage</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/tnh_fab/tnh_fab.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tnh_fab</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;--language&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Source language code. Auto-detected if not specified.&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Target language code (default: &#39;en&#39;)&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;--style&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Translation style (e.g., &#39;American Dharma Teaching&#39;)&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--context-lines&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of context lines to consider (default: 3)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--segment-size&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Lines per translation segment (auto-calculated if not specified)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--pattern&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_line_translation&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pattern name for translation (default: &#39;default_line_translation&#39;)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@pass_config</span>
<span class="k">def</span> <span class="nf">translate</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TNHFabConfig</span><span class="p">,</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">style</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">context_lines</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translate text while preserving line numbers and contextual understanding.</span>

<span class="sd">    This command performs intelligent translation that maintains line number correspondence</span>
<span class="sd">    between source and translated text. It uses surrounding context to improve translation</span>
<span class="sd">    accuracy and consistency, particularly important for Buddhist texts where terminology</span>
<span class="sd">    and context are crucial.</span>

<span class="sd">    Examples:</span>

<span class="sd">        \b</span>
<span class="sd">        # Translate Vietnamese text to English</span>
<span class="sd">        $ tnh-fab translate -l vi input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Translate to French with specific style</span>
<span class="sd">        $ tnh-fab translate -l vi -r fr -y &quot;Formal&quot; input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Translate with increased context</span>
<span class="sd">        $ tnh-fab translate --context-lines 5 input.txt</span>

<span class="sd">        \b</span>
<span class="sd">        # Translate using custom segment size</span>
<span class="sd">        $ tnh-fab translate --segment-size 10 input.txt</span>

<span class="sd">    \b</span>
<span class="sd">    Notes:</span>
<span class="sd">        - Line numbers are preserved in the output</span>
<span class="sd">        - Context lines are used to improve translation accuracy</span>
<span class="sd">        - Segment size affects processing speed and memory usage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">click</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">translation_pattern</span> <span class="o">=</span> <span class="n">get_pattern</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">pattern_manager</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">translate_text_by_lines</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">source_language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">target_language</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="n">translation_pattern</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">context_lines</span><span class="o">=</span><span class="n">context_lines</span><span class="p">,</span>
        <span class="n">segment_size</span><span class="o">=</span><span class="n">segment_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.cli_tools.token_count" class="doc doc-heading">
            <code>token_count</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.token_count.token_count" class="doc doc-heading">
            <code>token_count</code>


</h5>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.token_count.token_count.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Entry point for the token-count CLI tool.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/token_count/token_count.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry point for the token-count CLI tool.&quot;&quot;&quot;</span>
    <span class="n">token_count_cli</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.token_count.token_count.token_count_cli" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_count_cli</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Return the Open AI API token count of a text file. Based on gpt-4o.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/token_count/token_count.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">token_count_cli</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the Open AI API token count of a text file. Based on gpt-4o.&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">token_count</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.cli_tools.ytt_fetch" class="doc doc-heading">
            <code>ytt_fetch</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="tnh_scholar.cli_tools.ytt_fetch.ytt_fetch" class="doc doc-heading">
            <code>ytt_fetch</code>


</h5>

    <div class="doc doc-contents ">

        <p>Simple CLI tool for retrieving video transcripts.</p>
<p>This module provides a command line interface for downloading video transcripts
in specified languages. It uses yt-dlp for video info extraction.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/ytt_fetch/ytt_fetch.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">ytt_fetch</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.cli_tools.ytt_fetch.ytt_fetch.ytt_fetch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ytt_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Youtube Transcript Fetch: Retrieve and save transcript for a Youtube video using yt-dlp.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/cli_tools/ytt_fetch/ytt_fetch.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;--lang&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Language code for transcript (default: en)&quot;</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Save transcript text to file instead of printing&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">ytt_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Youtube Transcript Fetch: Retrieve and save transcript for a Youtube video using yt-dlp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">transcript_text</span> <span class="o">=</span> <span class="n">get_transcript</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">TranscriptNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yt_dlp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">DownloadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract video transcript: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">write_text_to_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">transcript_text</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcript written to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">transcript_text</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing transcript to file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected type error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.journal_processing" class="doc doc-heading">
            <code>journal_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.journal_processing.journal_process" class="doc doc-heading">
            <code>journal_process</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.journal_processing.journal_process.BATCH_RETRY_DELAY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BATCH_RETRY_DELAY</span> <span class="o">=</span> <span class="mi">5</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.journal_processing.journal_process.MAX_BATCH_RETRIES" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_BATCH_RETRIES</span> <span class="o">=</span> <span class="mi">40</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.journal_processing.journal_process.MAX_TOKEN_LIMIT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_TOKEN_LIMIT</span> <span class="o">=</span> <span class="mi">60000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.journal_processing.journal_process.journal_schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">journal_schema</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;journal_summary&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="s1">&#39;sections&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title_vi&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="s1">&#39;title_en&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span><span class="p">]},</span> <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">}},</span> <span class="s1">&#39;start_page&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s1">&#39;end_page&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;title_vi&#39;</span><span class="p">,</span> <span class="s1">&#39;title_en&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;start_page&#39;</span><span class="p">,</span> <span class="s1">&#39;end_page&#39;</span><span class="p">]}}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;journal_summary&#39;</span><span class="p">,</span> <span class="s1">&#39;sections&#39;</span><span class="p">]}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.journal_processing.journal_process.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;journal_process&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.batch_section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">batch_section</span><span class="p">(</span><span class="n">input_xml_path</span><span class="p">,</span> <span class="n">batch_jsonl</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Splits the journal content into sections using GPT, with retries for both starting and completing the batch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_xml_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the input XML file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_json_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save validated metadata JSON.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_output_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the raw batch results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>journal_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the journal being processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of retries for batch processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retry_delay</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Delay in seconds between retries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the result of the batch sectioning process as a serialized json object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">batch_section</span><span class="p">(</span>
    <span class="n">input_xml_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">batch_jsonl</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">journal_name</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits the journal content into sections using GPT, with retries for both starting and completing the batch.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_xml_path (str): Path to the input XML file.</span>
<span class="sd">        output_json_path (str): Path to save validated metadata JSON.</span>
<span class="sd">        raw_output_path (str): Path to save the raw batch results.</span>
<span class="sd">        journal_name (str): Name of the journal being processed.</span>
<span class="sd">        max_retries (int): Maximum number of retries for batch processing.</span>
<span class="sd">        retry_delay (int): Delay in seconds between retries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: the result of the batch sectioning process as a serialized json object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Starting sectioning batch for </span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2"> with file:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">input_xml_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Load journal content</span>
        <span class="n">journal_pages</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">input_xml_path</span><span class="p">)</span>

        <span class="c1"># Create GPT messages for sectioning</span>
        <span class="n">user_message_wrapper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">generate_messages</span><span class="p">(</span>
            <span class="n">system_message</span><span class="p">,</span> <span class="n">user_message_wrapper</span><span class="p">,</span> <span class="p">[</span><span class="n">journal_pages</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Create JSONL file for batch processing</span>
        <span class="n">jsonl_file</span> <span class="o">=</span> <span class="n">create_jsonl_file_for_batch</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">batch_jsonl</span><span class="p">,</span> <span class="n">json_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to initialize batch sectioning data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input_xml_path&quot;</span><span class="p">:</span> <span class="n">input_xml_path</span><span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error initializing batch sectioning data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">start_batch_with_retries</span><span class="p">(</span>
        <span class="n">jsonl_file</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Batch for sectioning journal: </span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2"> | input file: </span><span class="si">{</span><span class="n">input_xml_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">json_result</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span>
            <span class="mi">0</span>
        <span class="p">]</span>  <span class="c1"># should return json, just one batch so first response</span>
        <span class="c1"># Log success and return output json</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Successfully batch sectioned journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39; with input file: </span><span class="si">{</span><span class="n">input_xml_path</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">json_result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Section batch failed to get response.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.batch_translate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">batch_translate</span><span class="p">(</span><span class="n">input_xml_path</span><span class="p">,</span> <span class="n">batch_json_path</span><span class="p">,</span> <span class="n">metadata_path</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Translates the journal sections using the GPT model.
Saves the translated content back to XML.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_xml_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the input XML file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the metadata JSON file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>journal_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the journal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xml_output_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the translated XML.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of retries for batch operations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retry_delay</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Delay in seconds between retries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the process succeeds, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">batch_translate</span><span class="p">(</span>
    <span class="n">input_xml_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">batch_json_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">metadata_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">,</span>
    <span class="n">journal_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the journal sections using the GPT model.</span>
<span class="sd">    Saves the translated content back to XML.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_xml_path (str): Path to the input XML file.</span>
<span class="sd">        metadata_path (str): Path to the metadata JSON file.</span>
<span class="sd">        journal_name (str): Name of the journal.</span>
<span class="sd">        xml_output_path (str): Path to save the translated XML.</span>
<span class="sd">        max_retries (int): Maximum number of retries for batch operations.</span>
<span class="sd">        retry_delay (int): Delay in seconds between retries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the process succeeds, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting translation batch for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n\t</span><span class="s2">with file: </span><span class="si">{</span><span class="n">input_xml_path</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">metadata: </span><span class="si">{</span><span class="n">metadata_path</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Data initialization:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># load metadata</span>
        <span class="n">serial_json</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">)</span>

        <span class="n">section_metadata</span> <span class="o">=</span> <span class="n">deserialize_json</span><span class="p">(</span><span class="n">serial_json</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">section_metadata</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata could not be loaded from </span><span class="si">{</span><span class="n">metadata_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract page groups and split XML content</span>
        <span class="n">page_groups</span> <span class="o">=</span> <span class="n">extract_page_groups_from_metadata</span><span class="p">(</span><span class="n">section_metadata</span><span class="p">)</span>
        <span class="n">xml_content</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">input_xml_path</span><span class="p">)</span>
        <span class="n">section_contents</span> <span class="o">=</span> <span class="n">split_xml_on_pagebreaks</span><span class="p">(</span><span class="n">xml_content</span><span class="p">,</span> <span class="n">page_groups</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">section_contents</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;section_contents[0]:</span><span class="se">\n</span><span class="si">{</span><span class="n">section_contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No sectin contents.&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to initialize data for translation batching for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error during data initialization for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">translation_data</span> <span class="o">=</span> <span class="n">translate_sections</span><span class="p">(</span>
        <span class="n">batch_json_path</span><span class="p">,</span>
        <span class="n">system_message</span><span class="p">,</span>
        <span class="n">section_contents</span><span class="p">,</span>
        <span class="n">section_metadata</span><span class="p">,</span>
        <span class="n">journal_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">translation_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.deserialize_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deserialize_json</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Converts a serialized JSON string into a Python dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>serialized_data</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JSON string to deserialize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The deserialized Python dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deserialize_json</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a serialized JSON string into a Python dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        serialized_data (str): The JSON string to deserialize.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The deserialized Python dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;String input required for deserialize_json. Received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;String input required.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert the JSON string into a dictionary</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to deserialize JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.extract_page_groups_from_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_page_groups_from_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts page groups from the section metadata for use with <code>split_xml_pages</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The section metadata containing sections with start and end pages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[int, int]]: A list of tuples, each representing a page range (start_page, end_page).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_page_groups_from_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts page groups from the section metadata for use with `split_xml_pages`.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        metadata (dict): The section metadata containing sections with start and end pages.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[int, int]]: A list of tuples, each representing a page range (start_page, end_page).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">page_groups</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Ensure metadata contains sections</span>
    <span class="k">if</span> <span class="s2">&quot;sections&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sections&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Metadata does not contain a valid &#39;sections&#39; key with a list of sections.&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sections&quot;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Extract start and end pages</span>
            <span class="n">start_page</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_page&quot;</span><span class="p">)</span>
            <span class="n">end_page</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_page&quot;</span><span class="p">)</span>

            <span class="c1"># Ensure both start_page and end_page are integers</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_page</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid page range in section: </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Add the tuple to the page groups list</span>
            <span class="n">page_groups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing key in section metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing section metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;page groups found: </span><span class="si">{</span><span class="n">page_groups</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">page_groups</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.generate_all_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_all_batches</span><span class="p">(</span><span class="n">processed_document_dir</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">,</span> <span class="n">file_regex</span><span class="o">=</span><span class="s1">&#39;.*</span><span class="se">\\</span><span class="s1">.xml&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generate cleaning batches for all journals in the specified directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>processed_journals_dir</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing processed journal data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System message template for batch processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_wrap_function</code>
            </td>
            <td>
                  <code>callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to wrap user input for processing pages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_regex</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regex pattern to identify target files (default: ".*.xml").</p>
              </div>
            </td>
            <td>
                  <code>&#39;.*\\.xml&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_all_batches</span><span class="p">(</span>
    <span class="n">processed_document_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_wrap_function</span><span class="p">,</span>
    <span class="n">file_regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.*\.xml&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate cleaning batches for all journals in the specified directory.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        processed_journals_dir (str): Path to the directory containing processed journal data.</span>
<span class="sd">        system_message (str): System message template for batch processing.</span>
<span class="sd">        user_wrap_function (callable): Function to wrap user input for processing pages.</span>
<span class="sd">        file_regex (str): Regex pattern to identify target files (default: &quot;.*\\.xml&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">document_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">processed_document_dir</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">file_regex</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">journal_file</span> <span class="ow">in</span> <span class="n">document_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">journal_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">journal_file</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Derive output file path</span>
                <span class="n">output_file</span> <span class="o">=</span> <span class="n">journal_file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.jsonl&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating batch for </span><span class="si">{</span><span class="n">journal_file</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                <span class="c1"># Call single batch function</span>
                <span class="n">generate_single_oa_batch_from_pages</span><span class="p">(</span>
                    <span class="n">input_xml_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">journal_file</span><span class="p">),</span>
                    <span class="n">output_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">output_file</span><span class="p">),</span>
                    <span class="n">system_message</span><span class="o">=</span><span class="n">system_message</span><span class="p">,</span>
                    <span class="n">user_wrap_function</span><span class="o">=</span><span class="n">user_wrap_function</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process </span><span class="si">{</span><span class="n">journal_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Batch generation completed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.generate_clean_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_clean_batch</span><span class="p">(</span><span class="n">input_xml_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generate a batch file for the OpenAI (OA) API using a single input XML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full path to the input XML file to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full path to the output batch JSONL file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System message template for batch processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_wrap_function</code>
            </td>
            <td>
                  <code>callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to wrap user input for processing pages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created batch file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an error occurs during file processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_clean_batch</span><span class="p">(</span>
    <span class="n">input_xml_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_wrap_function</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a batch file for the OpenAI (OA) API using a single input XML file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        batch_file (str): Full path to the input XML file to process.</span>
<span class="sd">        output_file (str): Full path to the output batch JSONL file.</span>
<span class="sd">        system_message (str): System message template for batch processing.</span>
<span class="sd">        user_wrap_function (callable): Function to wrap user input for processing pages.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created batch file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs during file processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read the OCR text from the batch file</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">input_xml_file</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Split the text into pages for processing</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">split_xml_on_pagebreaks</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">wrap_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>  <span class="c1"># wrap lines with brackets.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pages</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pages found in XML file: </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span><span class="si">}</span><span class="s2"> pages in </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">max_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_max_tokens_for_clean</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">]</span>

        <span class="c1"># Generate messages for the pages</span>
        <span class="n">batch_message_seq</span> <span class="o">=</span> <span class="n">generate_messages</span><span class="p">(</span><span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">,</span> <span class="n">pages</span><span class="p">)</span>

        <span class="c1"># Save the batch file</span>
        <span class="n">create_jsonl_file_for_batch</span><span class="p">(</span>
            <span class="n">batch_message_seq</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">max_token_list</span><span class="o">=</span><span class="n">max_tokens</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch file created successfully: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_file</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;File not found.&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error while processing </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.generate_single_oa_batch_from_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_single_oa_batch_from_pages</span><span class="p">(</span><span class="n">input_xml_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>*** Depricated ***
Generate a batch file for the OpenAI (OA) API using a single input XML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full path to the input XML file to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full path to the output batch JSONL file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System message template for batch processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_wrap_function</code>
            </td>
            <td>
                  <code>callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to wrap user input for processing pages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created batch file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an error occurs during file processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_single_oa_batch_from_pages</span><span class="p">(</span>
    <span class="n">input_xml_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_wrap_function</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *** Depricated ***</span>
<span class="sd">    Generate a batch file for the OpenAI (OA) API using a single input XML file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        batch_file (str): Full path to the input XML file to process.</span>
<span class="sd">        output_file (str): Full path to the output batch JSONL file.</span>
<span class="sd">        system_message (str): System message template for batch processing.</span>
<span class="sd">        user_wrap_function (callable): Function to wrap user input for processing pages.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created batch file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs during file processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read the OCR text from the batch file</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">input_xml_file</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Split the text into pages for processing</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">split_xml_pages</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pages</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pages found in XML file: </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span><span class="si">}</span><span class="s2"> pages in </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># Generate messages for the pages</span>
        <span class="n">batch_message_seq</span> <span class="o">=</span> <span class="n">generate_messages</span><span class="p">(</span><span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">,</span> <span class="n">pages</span><span class="p">)</span>

        <span class="c1"># Save the batch file</span>
        <span class="n">create_jsonl_file_for_batch</span><span class="p">(</span><span class="n">batch_message_seq</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch file created successfully: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_file</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error while processing </span><span class="si">{</span><span class="n">input_xml_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.save_cleaned_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_cleaned_data</span><span class="p">(</span><span class="n">cleaned_xml_path</span><span class="p">,</span> <span class="n">cleaned_wrapped_pages</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_cleaned_data</span><span class="p">(</span>
    <span class="n">cleaned_xml_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">cleaned_wrapped_pages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">journal_name</span>
<span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving cleaned content to XML for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="n">cleaned_wrapped_pages</span> <span class="o">=</span> <span class="n">unwrap_all_lines</span><span class="p">(</span><span class="n">cleaned_wrapped_pages</span><span class="p">)</span>
        <span class="n">save_pages_to_xml</span><span class="p">(</span><span class="n">cleaned_xml_path</span><span class="p">,</span> <span class="n">cleaned_wrapped_pages</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned journal saved successfully to:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">cleaned_xml_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to save cleaned data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cleaned_xml_path&quot;</span><span class="p">:</span> <span class="n">cleaned_xml_path</span><span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to save cleaned data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.save_sectioning_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_sectioning_data</span><span class="p">(</span><span class="n">output_json_path</span><span class="p">,</span> <span class="n">raw_output_path</span><span class="p">,</span> <span class="n">serial_json</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_sectioning_data</span><span class="p">(</span>
    <span class="n">output_json_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">raw_output_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">serial_json</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">journal_name</span>
<span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">raw_output_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">serial_json</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to write raw response file for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raw_output_path&quot;</span><span class="p">:</span> <span class="n">raw_output_path</span><span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to write raw response file for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># Validate and save metadata</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">validate_and_save_metadata</span><span class="p">(</span>
            <span class="n">output_json_path</span><span class="p">,</span> <span class="n">serial_json</span><span class="p">,</span> <span class="n">journal_schema</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Validation failed for metadata of journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error occurred while validating and saving metadata for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;output_json_path&quot;</span><span class="p">:</span> <span class="n">output_json_path</span><span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">return</span> <span class="n">output_json_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.save_translation_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_translation_data</span><span class="p">(</span><span class="n">xml_output_path</span><span class="p">,</span> <span class="n">translation_data</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_translation_data</span><span class="p">(</span><span class="n">xml_output_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">translation_data</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">):</span>
    <span class="c1"># Save translated content back to XML</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving translated content to XML for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="n">join_xml_data_to_doc</span><span class="p">(</span><span class="n">xml_output_path</span><span class="p">,</span> <span class="n">translation_data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translated journal saved successfully to:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">xml_output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to save translation data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xml_output_path&quot;</span><span class="p">:</span> <span class="n">xml_output_path</span><span class="p">},</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to save translation data for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.send_data_for_tx_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_data_for_tx_batch</span><span class="p">(</span><span class="n">batch_jsonl_path</span><span class="p">,</span> <span class="n">section_data_to_send</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">max_token_list</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Sends data for translation batch or immediate processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch_jsonl_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the JSONL file to save batch data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>section_data_to_send</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of section data to translate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System message for the translation process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_token_list</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of max tokens for each section.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>journal_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the journal being processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>immediate</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, run immediate chat processing instead of batch.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>List</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Translated data from the batch or immediate process.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">send_data_for_tx_batch</span><span class="p">(</span>
    <span class="n">batch_jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">section_data_to_send</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">,</span>
    <span class="n">max_token_list</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">journal_name</span><span class="p">,</span>
    <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sends data for translation batch or immediate processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_jsonl_path (Path): Path for the JSONL file to save batch data.</span>
<span class="sd">        section_data_to_send (List): List of section data to translate.</span>
<span class="sd">        system_message (str): System message for the translation process.</span>
<span class="sd">        max_token_list (List): List of max tokens for each section.</span>
<span class="sd">        journal_name (str): Name of the journal being processed.</span>
<span class="sd">        immediate (bool): If True, run immediate chat processing instead of batch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List: Translated data from the batch or immediate process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Generate all messages using the generate_messages function</span>
        <span class="n">user_message_wrapper</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">section_info</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Translate this section with title &#39;</span><span class="si">{</span><span class="n">section_info</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="si">{</span><span class="n">section_info</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">generate_messages</span><span class="p">(</span>
            <span class="n">system_message</span><span class="p">,</span> <span class="n">user_message_wrapper</span><span class="p">,</span> <span class="n">section_data_to_send</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">immediate</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running immediate chat process for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="n">translated_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
                <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_token_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">run_immediate_chat_process</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">)</span>
                <span class="n">translated_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Immediate translation completed for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">translated_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running batch processing for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="c1"># Create batch file for batch processing</span>
            <span class="n">jsonl_file</span> <span class="o">=</span> <span class="n">create_jsonl_file_for_batch</span><span class="p">(</span>
                <span class="n">messages</span><span class="p">,</span> <span class="n">batch_jsonl_path</span><span class="p">,</span> <span class="n">max_token_list</span><span class="o">=</span><span class="n">max_token_list</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_file</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to create JSONL file for translation batch.&quot;</span><span class="p">)</span>

            <span class="c1"># Process batch and return the result</span>
            <span class="n">translation_data</span> <span class="o">=</span> <span class="n">start_batch_with_retries</span><span class="p">(</span>
                <span class="n">jsonl_file</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Batch for translating journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch translation completed for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">translation_data</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error during translation processing for journal &#39;</span><span class="si">{</span><span class="n">journal_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error in translation process.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.setup_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_logger</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Configures the logger to write to a log file and the console.
Adds a custom "PRIORITY_INFO" logging level for important messages.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logger</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configures the logger to write to a log file and the console.</span>
<span class="sd">    Adds a custom &quot;PRIORITY_INFO&quot; logging level for important messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove existing handlers</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Include logger name</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(),</span>  <span class="c1"># Optional: to log to the console as well</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Suppress DEBUG/INFO logs for specific noisy modules</span>
    <span class="n">modules_to_suppress</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;httpx&quot;</span><span class="p">,</span> <span class="s2">&quot;httpcore&quot;</span><span class="p">,</span> <span class="s2">&quot;urllib3&quot;</span><span class="p">,</span> <span class="s2">&quot;openai&quot;</span><span class="p">,</span> <span class="s2">&quot;google&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules_to_suppress</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>  <span class="c1"># Suppress DEBUG and INFO logs</span>

    <span class="c1"># Add a custom &quot;PRIORITY_INFO&quot; level</span>
    <span class="n">PRIORITY_INFO_LEVEL</span> <span class="o">=</span> <span class="mi">25</span>  <span class="c1"># Between INFO (20) and WARNING (30)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">addLevelName</span><span class="p">(</span><span class="n">PRIORITY_INFO_LEVEL</span><span class="p">,</span> <span class="s2">&quot;PRIORITY_INFO&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">priority_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">PRIORITY_INFO_LEVEL</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">PRIORITY_INFO_LEVEL</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93m</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">priority_info</span> <span class="o">=</span> <span class="n">priority_info</span>

    <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.translate_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_sections</span><span class="p">(</span><span class="n">batch_jsonl_path</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">section_contents</span><span class="p">,</span> <span class="n">section_metadata</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>build up sections in batches to translate</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_sections</span><span class="p">(</span>
    <span class="n">batch_jsonl_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">,</span>
    <span class="n">section_contents</span><span class="p">,</span>
    <span class="n">section_metadata</span><span class="p">,</span>
    <span class="n">journal_name</span><span class="p">,</span>
    <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;build up sections in batches to translate&quot;&quot;&quot;</span>

    <span class="n">section_mdata</span> <span class="o">=</span> <span class="n">section_metadata</span><span class="p">[</span><span class="s2">&quot;sections&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_contents</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_mdata</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Section length mismatch.&quot;</span><span class="p">)</span>

    <span class="c1"># collate metadata and section content, calculate max_tokens per section:</span>
    <span class="n">section_data_to_send</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_token_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_token_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">collected_translations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">section_last_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_mdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">section_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">section_mdata</span><span class="p">):</span>
        <span class="n">section_content</span> <span class="o">=</span> <span class="n">section_contents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">token_count</span><span class="p">(</span><span class="n">section_content</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1000</span>
        <span class="n">max_token_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_tokens</span><span class="p">)</span>
        <span class="n">current_token_count</span> <span class="o">+=</span> <span class="n">max_tokens</span>
        <span class="n">section_data</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">section_info</span><span class="p">[</span><span class="s2">&quot;title_en&quot;</span><span class="p">],</span> <span class="n">content</span><span class="o">=</span><span class="n">section_content</span>
        <span class="p">)</span>
        <span class="n">section_data_to_send</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_data</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;section </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">section_data</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> added for batch processing.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_token_count</span> <span class="o">&gt;=</span> <span class="n">MAX_TOKEN_LIMIT</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="n">section_last_index</span><span class="p">:</span>
            <span class="c1"># send sections for batch processing since token limit reached.</span>
            <span class="n">batch_result</span> <span class="o">=</span> <span class="n">send_data_for_tx_batch</span><span class="p">(</span>
                <span class="n">batch_jsonl_path</span><span class="p">,</span>
                <span class="n">section_data_to_send</span><span class="p">,</span>
                <span class="n">system_message</span><span class="p">,</span>
                <span class="n">max_token_list</span><span class="p">,</span>
                <span class="n">journal_name</span><span class="p">,</span>
                <span class="n">immediate</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">collected_translations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_result</span><span class="p">)</span>

            <span class="c1"># reset containers to start building up next batch.</span>
            <span class="n">section_data_to_send</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">max_token_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_token_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">collected_translations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.unwrap_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwrap_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unwrap_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;blank page&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unwrap_lines</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.unwrap_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwrap_lines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Removes angle brackets (&lt; &gt;) from encapsulated lines and merges them into
a newline-separated string.

Parameters:
    text (str): The input string with encapsulated lines.

Returns:
    str: A newline-separated string with the encapsulation removed.

Example:
    &gt;&gt;&gt; merge_encapsulated_lines("&lt;Line 1&gt; &lt;Line 2&gt; &lt;Line 3&gt;")
    'Line 1
</code></pre>
<p>Line 2
Line 3'
        &gt;&gt;&gt; merge_encapsulated_lines("<Line 1>
<Line 2>
<Line 3>")
        'Line 1
Line 2
Line 3'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unwrap_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes angle brackets (&lt; &gt;) from encapsulated lines and merges them into</span>
<span class="sd">    a newline-separated string.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        text (str): The input string with encapsulated lines.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A newline-separated string with the encapsulation removed.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; merge_encapsulated_lines(&quot;&lt;Line 1&gt; &lt;Line 2&gt; &lt;Line 3&gt;&quot;)</span>
<span class="sd">        &#39;Line 1\nLine 2\nLine 3&#39;</span>
<span class="sd">        &gt;&gt;&gt; merge_encapsulated_lines(&quot;&lt;Line 1&gt;\n&lt;Line 2&gt;\n&lt;Line 3&gt;&quot;)</span>
<span class="sd">        &#39;Line 1\nLine 2\nLine 3&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find all content between &lt; and &gt; using regex</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Join the extracted content with newlines</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.validate_and_clean_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_and_clean_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Recursively validate and clean AI-generated data to fit the given schema.
Any missing fields are filled with defaults, and extra fields are ignored.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The AI-generated data to validate and clean.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema defining the required structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned data adhering to the schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_and_clean_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively validate and clean AI-generated data to fit the given schema.</span>
<span class="sd">    Any missing fields are filled with defaults, and extra fields are ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): The AI-generated data to validate and clean.</span>
<span class="sd">        schema (dict): The schema defining the required structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The cleaned data adhering to the schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_schema</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean a single value based on its schema, attempting type conversions where necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">field_type</span> <span class="o">=</span> <span class="n">field_schema</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="c1"># Handle type: string</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;unset&quot;</span>

        <span class="c1"># Handle type: integer</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>  <span class="c1"># Handle cases like &quot;2.0&quot;</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Handle type: array</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">item_schema</span> <span class="o">=</span> <span class="n">field_schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">clean_value</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">item_schema</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Try splitting comma-separated strings into a list</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Handle type: object</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">validate_and_clean_data</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Handle nullable strings</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Default case for unknown or unsupported types</span>
        <span class="k">return</span> <span class="s2">&quot;unset&quot;</span>

    <span class="k">def</span> <span class="nf">clean_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj_schema</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean a dictionary object based on its schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected dict but got: </span><span class="se">\n</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="se">\n</span><span class="s2">Resetting to empty dict.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">obj_schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">field_schema</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Set default value for missing fields</span>
            <span class="n">cleaned</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">field_schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleaned</span>

    <span class="c1"># Handle the top-level object</span>
    <span class="k">if</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="n">clean_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleaned_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Top-level schema must be of type &#39;object&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.validate_and_save_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_and_save_metadata</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">json_metadata_serial</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Validates and cleans journal data against the schema, then writes it to a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The journal data as a serialized JSON string to validate and clean.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema defining the required structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the output JSON file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if successfully written to the file, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_and_save_metadata</span><span class="p">(</span>
    <span class="n">output_file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">json_metadata_serial</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates and cleans journal data against the schema, then writes it to a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (str): The journal data as a serialized JSON string to validate and clean.</span>
<span class="sd">        schema (dict): The schema defining the required structure.</span>
<span class="sd">        output_file_path (str): Path to the output JSON file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if successfully written to the file, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Clean the data to fit the schema</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">deserialize_json</span><span class="p">(</span><span class="n">json_metadata_serial</span><span class="p">)</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="n">validate_and_clean_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

        <span class="c1"># Write the parsed data to the specified JSON file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Parsed and validated metadata successfully written to </span><span class="si">{</span><span class="n">output_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred during validation or writing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.wrap_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wrap_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">wrap_lines</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.journal_processing.journal_process.wrap_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_lines</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Encloses each line of the input text with angle brackets.

Args:
    text (str): The input string containing lines separated by '
</code></pre>
<p>'.</p>
<pre><code>Returns:
    str: A string where each line is enclosed in angle brackets.

Example:
    &gt;&gt;&gt; enclose_lines("This is a string with
</code></pre>
<p>two lines.")
        '<This is a string with  >
&lt;    two lines.&gt;'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/journal_processing/journal_process.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wrap_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encloses each line of the input text with angle brackets.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input string containing lines separated by &#39;\n&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string where each line is enclosed in angle brackets.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; enclose_lines(&quot;This is a string with   \n   two lines.&quot;)</span>
<span class="sd">        &#39;&lt;This is a string with  &gt;\n&lt;    two lines.&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&gt;&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.logging_config" class="doc doc-heading">
            <code>logging_config</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.BASE_LOG_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BASE_LOG_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./logs&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.BASE_LOG_NAME" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BASE_LOG_NAME</span> <span class="o">=</span> <span class="s1">&#39;tnh&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.DEFAULT_CONSOLE_FORMAT_STRING" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_CONSOLE_FORMAT_STRING</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(log_color)s%(levelname)s%(reset)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.DEFAULT_FILE_FORMAT_STRING" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_FILE_FORMAT_STRING</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.DEFAULT_LOG_FILEPATH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_LOG_FILEPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;main.log&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.LOG_COLORS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">LOG_COLORS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="s1">&#39;bold_green&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;PRIORITY_INFO&#39;</span><span class="p">:</span> <span class="s1">&#39;bold_cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">:</span> <span class="s1">&#39;bold_yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="s1">&#39;bold_red&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">:</span> <span class="s1">&#39;bold_red&#39;</span><span class="p">}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.MAX_FILE_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_FILE_SIZE</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.logging_config.PRIORITY_INFO_LEVEL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PRIORITY_INFO_LEVEL</span> <span class="o">=</span> <span class="mi">25</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h4 id="tnh_scholar.logging_config.OMPFilter" class="doc doc-heading">
            <code>OMPFilter</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>







              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/logging_config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OMPFilter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="c1"># Suppress messages containing &quot;OMP:&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;OMP:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.logging_config.OMPFilter.filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">filter</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/logging_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
    <span class="c1"># Suppress messages containing &quot;OMP:&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;OMP:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.logging_config.get_child_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_child_logger</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separate_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get a child logger that writes logs to a console or a specified file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the child logger (e.g., module name).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>console</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, log to the console. If False, do not log to the console.
                      If None, inherit console behavior from the parent logger.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string specifying a logfile to log to. will be placed under existing root logs directory. If provided,
                   a rotating file handler will be added.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logging.Logger: Configured child logger.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/logging_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_child_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">separate_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a child logger that writes logs to a console or a specified file.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the child logger (e.g., module name).</span>
<span class="sd">        console (bool, optional): If True, log to the console. If False, do not log to the console.</span>
<span class="sd">                                  If None, inherit console behavior from the parent logger.</span>
<span class="sd">        file (Path, optional): A string specifying a logfile to log to. will be placed under existing root logs directory. If provided,</span>
<span class="sd">                               a rotating file handler will be added.</span>

<span class="sd">    Returns:</span>
<span class="sd">        logging.Logger: Configured child logger.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the fully qualified child logger name</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_LOG_NAME</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created logger with name: </span><span class="si">{</span><span class="n">logger</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the logger already has handlers to avoid duplication</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
        <span class="c1"># Add console handler if specified</span>
        <span class="k">if</span> <span class="n">console</span><span class="p">:</span>
            <span class="n">console_handler</span> <span class="o">=</span> <span class="n">colorlog</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
            <span class="n">console_formatter</span> <span class="o">=</span> <span class="n">colorlog</span><span class="o">.</span><span class="n">ColoredFormatter</span><span class="p">(</span>
                <span class="n">DEFAULT_CONSOLE_FORMAT_STRING</span><span class="p">,</span>
                <span class="n">log_colors</span><span class="o">=</span><span class="n">LOG_COLORS</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">console_formatter</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

        <span class="c1"># Add file handler if a file path is provided</span>
        <span class="k">if</span> <span class="n">separate_file</span><span class="p">:</span>
            <span class="n">logfile</span> <span class="o">=</span> <span class="n">BASE_LOG_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.log&quot;</span>
            <span class="n">logfile</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Ensure directory exists</span>
            <span class="n">file_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span>
                <span class="n">maxBytes</span><span class="o">=</span><span class="n">MAX_FILE_SIZE</span><span class="p">,</span>  <span class="c1"># Use the global MAX_FILE_SIZE</span>
                <span class="n">backupCount</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">file_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">DEFAULT_FILE_FORMAT_STRING</span><span class="p">)</span>
            <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">file_formatter</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

        <span class="c1"># Ensure the logger inherits handlers and settings from the base logger</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.logging_config.priority_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">priority_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/logging_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">priority_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">PRIORITY_INFO_LEVEL</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">PRIORITY_INFO_LEVEL</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.logging_config.setup_logging" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">log_filepath</span><span class="o">=</span><span class="n">DEFAULT_LOG_FILEPATH</span><span class="p">,</span> <span class="n">max_log_file_size</span><span class="o">=</span><span class="n">MAX_FILE_SIZE</span><span class="p">,</span> <span class="n">backup_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">console_format</span><span class="o">=</span><span class="n">DEFAULT_CONSOLE_FORMAT_STRING</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">DEFAULT_FILE_FORMAT_STRING</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppressed_modules</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Configure the base logger with handlers, including the custom PRIORITY_INFO level.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>log_level</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logging level for the base logger.</p>
              </div>
            </td>
            <td>
                  <code><span title="logging.INFO">INFO</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_log_file_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum log file size in bytes.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.logging_config.MAX_FILE_SIZE" href="#tnh_scholar.logging_config.MAX_FILE_SIZE">MAX_FILE_SIZE</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backup_count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of backup log files to keep.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>console_format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Format string for console logs.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.logging_config.DEFAULT_CONSOLE_FORMAT_STRING" href="#tnh_scholar.logging_config.DEFAULT_CONSOLE_FORMAT_STRING">DEFAULT_CONSOLE_FORMAT_STRING</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Format string for file logs.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.logging_config.DEFAULT_FILE_FORMAT_STRING" href="#tnh_scholar.logging_config.DEFAULT_FILE_FORMAT_STRING">DEFAULT_FILE_FORMAT_STRING</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppressed_modules</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of third-party modules to suppress logs for.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/logging_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="n">log_filepath</span><span class="o">=</span><span class="n">DEFAULT_LOG_FILEPATH</span><span class="p">,</span>
    <span class="n">max_log_file_size</span><span class="o">=</span><span class="n">MAX_FILE_SIZE</span><span class="p">,</span>  <span class="c1"># 10MB</span>
    <span class="n">backup_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">console_format</span><span class="o">=</span><span class="n">DEFAULT_CONSOLE_FORMAT_STRING</span><span class="p">,</span>
    <span class="n">file_format</span><span class="o">=</span><span class="n">DEFAULT_FILE_FORMAT_STRING</span><span class="p">,</span>
    <span class="n">console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">suppressed_modules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure the base logger with handlers, including the custom PRIORITY_INFO level.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_level (int): Logging level for the base logger.</span>
<span class="sd">        log_file_path (Path): Path to the log file.</span>
<span class="sd">        max_log_file_size (int): Maximum log file size in bytes.</span>
<span class="sd">        backup_count (int): Number of backup log files to keep.</span>
<span class="sd">        console_format (str): Format string for console logs.</span>
<span class="sd">        file_format (str): Format string for file logs.</span>
<span class="sd">        suppressed_modules (list): List of third-party modules to suppress logs for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the base logger</span>
    <span class="n">log_file_path</span> <span class="o">=</span> <span class="n">BASE_LOG_DIR</span> <span class="o">/</span> <span class="n">log_filepath</span>
    <span class="n">base_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">BASE_LOG_NAME</span><span class="p">)</span>
    <span class="n">base_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Clear existing handlers to avoid duplication</span>
    <span class="n">base_logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Colorized console handler</span>
    <span class="k">if</span> <span class="n">console</span><span class="p">:</span>
        <span class="n">console_handler</span> <span class="o">=</span> <span class="n">colorlog</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">console_formatter</span> <span class="o">=</span> <span class="n">colorlog</span><span class="o">.</span><span class="n">ColoredFormatter</span><span class="p">(</span>
            <span class="n">console_format</span><span class="p">,</span>
            <span class="n">log_colors</span><span class="o">=</span><span class="n">LOG_COLORS</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">console_formatter</span><span class="p">)</span>
        <span class="c1"># Add the OMP filter to the console handler</span>
        <span class="n">console_handler</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="n">OMPFilter</span><span class="p">())</span>
        <span class="n">base_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="c1"># Plain file handler</span>
    <span class="n">log_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">log_file_path</span><span class="p">,</span>
        <span class="n">maxBytes</span><span class="o">=</span><span class="n">max_log_file_size</span><span class="p">,</span>
        <span class="n">backupCount</span><span class="o">=</span><span class="n">backup_count</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">file_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">file_format</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">file_formatter</span><span class="p">)</span>
    <span class="n">base_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="c1"># Suppress noisy third-party logs</span>
    <span class="k">if</span> <span class="n">suppressed_modules</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">suppressed_modules</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

    <span class="c1"># Prevent propagation to the root logger</span>
    <span class="n">base_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">base_logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.ocr_processing" class="doc doc-heading">
            <code>ocr_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_FONT_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/System/Library/Fonts/Supplemental/Arial.ttf&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_FONT_SIZE</span> <span class="o">=</span> <span class="mi">12</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vi&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_METHOD</span> <span class="o">=</span> <span class="s1">&#39;DOCUMENT_TEXT_DETECTION&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_OFFSET</span> <span class="o">=</span> <span class="mi">2</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="tnh_scholar.ocr_processing.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ocr_processing&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h4 id="tnh_scholar.ocr_processing.PDFParseWarning" class="doc doc-heading">
            <code>PDFParseWarning</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Warning</code></p>


        <p>Custom warning class for PDF parsing issues.
Encapsulates minimal logic for displaying warnings with a custom format.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PDFParseWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom warning class for PDF parsing issues.</span>
<span class="sd">    Encapsulates minimal logic for displaying warnings with a custom format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a warning message with custom formatting.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            message (str): The warning message to display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93mPDFParseWarning: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">formatted_message</span><span class="p">)</span>  <span class="c1"># Simply prints the warning</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.PDFParseWarning.warn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Display a warning message with custom formatting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The warning message to display.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a warning message with custom formatting.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        message (str): The warning message to display.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formatted_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93mPDFParseWarning: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">formatted_message</span><span class="p">)</span>  <span class="c1"># Simply prints the warning</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.annotate_image_with_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">annotate_image_with_text</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">text_annotations</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Annotates a PIL image with bounding boxes and text descriptions from OCR results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pil_image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input PIL image to annotate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_annotations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OCR results containing bounding boxes and text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for text annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>font_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for text annotations.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image.Image: The annotated PIL image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input image is None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>IOError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the font file cannot be loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any other unexpected errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_image_with_text</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
    <span class="n">text_annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">],</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annotates a PIL image with bounding boxes and text descriptions from OCR results.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pil_image (Image.Image): The input PIL image to annotate.</span>
<span class="sd">        text_annotations (List[EntityAnnotation]): OCR results containing bounding boxes and text.</span>
<span class="sd">        annotation_font_path (str): Path to the font file for text annotations.</span>
<span class="sd">        font_size (int): Font size for text annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image.Image: The annotated PIL image.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input image is None.</span>
<span class="sd">        IOError: If the font file cannot be loaded.</span>
<span class="sd">        Exception: For any other unexpected errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input image is None.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load the font from &#39;</span><span class="si">{</span><span class="n">annotation_font_path</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_annotations</span><span class="p">):</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">text_obj</span><span class="o">.</span><span class="n">bounding_poly</span><span class="o">.</span><span class="n">vertices</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
            <span class="p">):</span>  <span class="c1"># Ensure there are exactly 4 vertices for a rectangle</span>
                <span class="c1"># Draw the bounding box</span>
                <span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Skip the first bounding box (whole text region)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Offset the text position slightly for clarity</span>
                    <span class="n">text_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">text_position</span><span class="p">,</span> <span class="n">text_obj</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span>
                    <span class="p">)</span>

    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid text annotation structure: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred during image annotation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.build_processed_pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_processed_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_FONT_PATH</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Processes a PDF document, extracting text, word locations, annotated images, and unannotated images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for annotations.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH">DEFAULT_ANNOTATION_FONT_PATH</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[str], <span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>]], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[str], List[List[vision.EntityAnnotation]], List[Image.Image], List[Image.Image]]:
- List of extracted full-page texts (one entry per page).
- List of word locations (list of <code>vision.EntityAnnotation</code> objects for each page).
- List of annotated images (with bounding boxes and text annotations).
- List of unannotated images (raw page images).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified PDF file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the PDF file is invalid or contains no pages.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any unexpected errors during processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
from google.cloud import vision
pdf_path = Path("/path/to/example.pdf")
font_path = Path("/path/to/fonts/Arial.ttf")
client = vision.ImageAnnotatorClient()
try:
    text_pages, word_locations_list, annotated_images, unannotated_images = build_processed_pdf(
        pdf_path, client, font_path
    )
    print(f"Processed {len(text_pages)} pages successfully!")
except Exception as e:
    print(f"Error processing PDF: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_processed_pdf</span><span class="p">(</span>
    <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_FONT_PATH</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a PDF document, extracting text, word locations, annotated images, and unannotated images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pdf_path (Path): Path to the PDF file.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        annotation_font_path (Path): Path to the font file for annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[str], List[List[vision.EntityAnnotation]], List[Image.Image], List[Image.Image]]:</span>
<span class="sd">            - List of extracted full-page texts (one entry per page).</span>
<span class="sd">            - List of word locations (list of `vision.EntityAnnotation` objects for each page).</span>
<span class="sd">            - List of annotated images (with bounding boxes and text annotations).</span>
<span class="sd">            - List of unannotated images (raw page images).</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified PDF file does not exist.</span>
<span class="sd">        ValueError: If the PDF file is invalid or contains no pages.</span>
<span class="sd">        Exception: For any unexpected errors during processing.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; from google.cloud import vision</span>
<span class="sd">        &gt;&gt;&gt; pdf_path = Path(&quot;/path/to/example.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; font_path = Path(&quot;/path/to/fonts/Arial.ttf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; client = vision.ImageAnnotatorClient()</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     text_pages, word_locations_list, annotated_images, unannotated_images = build_processed_pdf(</span>
<span class="sd">        &gt;&gt;&gt;         pdf_path, client, font_path</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Processed {len(text_pages)} pages successfully!&quot;)</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error processing PDF: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">fnf_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading PDF: </span><span class="si">{</span><span class="n">fnf_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid PDF file: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred while loading the PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The PDF file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; contains no pages.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file with </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="si">}</span><span class="s2"> pages:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">text_pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">word_locations_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">annotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unannotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">first_page_dimensions</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">full_page_text</span><span class="p">,</span>
                <span class="n">word_locations</span><span class="p">,</span>
                <span class="n">annotated_image</span><span class="p">,</span>
                <span class="n">unannotated_image</span><span class="p">,</span>
                <span class="n">page_dimensions</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">process_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">full_page_text</span><span class="p">:</span>  <span class="c1"># this is not an empty page</span>

                <span class="k">if</span> <span class="n">page_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># save first page info</span>
                    <span class="n">first_page_dimensions</span> <span class="o">=</span> <span class="n">page_dimensions</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">page_dimensions</span> <span class="o">!=</span> <span class="n">first_page_dimensions</span>
                <span class="p">):</span>  <span class="c1"># verify page dimensions are consistent</span>
                    <span class="n">PDFParseWarning</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> has different dimensions than page 1.&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">page_dimensions</span><span class="si">}</span><span class="s2">) compared to the first page: (</span><span class="si">{</span><span class="n">first_page_dimensions</span><span class="si">}</span><span class="s2">).&quot;</span>
                    <span class="p">)</span>

                <span class="n">text_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_page_text</span><span class="p">)</span>
                <span class="n">word_locations_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_locations</span><span class="p">)</span>
                <span class="n">annotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotated_image</span><span class="p">)</span>
                <span class="n">unannotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unannotated_image</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PDFParseWarning</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> empty, added empty datastructures...</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="c1"># f&quot;  (Note that total document length will be reduced.)&quot;</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ValueError on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">oe</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OSError on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">oe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;page dimensions: </span><span class="si">{</span><span class="n">page_dimensions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations_list</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.deserialize_entity_annotations_from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deserialize_entity_annotations_from_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Deserializes JSON data into a nested list of EntityAnnotation objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JSON string containing serialized annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[List[EntityAnnotation]]: The reconstructed nested list of EntityAnnotation objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deserialize_entity_annotations_from_json</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserializes JSON data into a nested list of EntityAnnotation objects.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (str): The JSON string containing serialized annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[List[EntityAnnotation]]: The reconstructed nested list of EntityAnnotation objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">serialized_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">deserialized_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">serialized_page</span> <span class="ow">in</span> <span class="n">serialized_data</span><span class="p">:</span>
        <span class="n">page_annotations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EntityAnnotation</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">serialized_annotation</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">serialized_annotation</span> <span class="ow">in</span> <span class="n">serialized_page</span>
        <span class="p">]</span>
        <span class="n">deserialized_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_annotations</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">deserialized_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.extract_image_from_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extracts the first image from the given PDF page and returns it as a PIL Image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PDF page object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image.Image: The first image on the page as a Pillow Image object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no images are found on the page or the image data is incomplete.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For unexpected errors during image extraction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fitz
from PIL import Image
doc = fitz.open("/path/to/document.pdf")
page = doc.load_page(0)  # Load the first page
try:
    image = extract_image_from_page(page)
    image.show()  # Display the image
except Exception as e:
    print(f"Error extracting image: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the first image from the given PDF page and returns it as a PIL Image.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        page (fitz.Page): The PDF page object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image.Image: The first image on the page as a Pillow Image object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no images are found on the page or the image data is incomplete.</span>
<span class="sd">        Exception: For unexpected errors during image extraction.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fitz</span>
<span class="sd">        &gt;&gt;&gt; from PIL import Image</span>
<span class="sd">        &gt;&gt;&gt; doc = fitz.open(&quot;/path/to/document.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; page = doc.load_page(0)  # Load the first page</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     image = extract_image_from_page(page)</span>
<span class="sd">        &gt;&gt;&gt;     image.show()  # Display the image</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error extracting image: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get images from the page</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">images</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No images found on the page.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the first image reference</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the first image&#39;s xref</span>
        <span class="n">base_image</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span>

        <span class="c1"># Validate the extracted image data</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;image&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
            <span class="ow">or</span> <span class="s2">&quot;width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
            <span class="ow">or</span> <span class="s2">&quot;height&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The extracted image data is incomplete.&quot;</span><span class="p">)</span>

        <span class="c1"># Convert the raw image bytes into a Pillow image</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
        <span class="n">pil_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pil_image</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ve</span>  <span class="c1"># Re-raise for calling functions to handle</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during image extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.get_page_dimensions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extracts the width and height of a single PDF page in both inches and pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PDF page object from PyMuPDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the width and height of the page in inches and pixels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the width and height of a single PDF page in both inches and pixels.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (fitz.Page): A single PDF page object from PyMuPDF.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the width and height of the page in inches and pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get page dimensions in points and convert to inches</span>
    <span class="n">page_width_pts</span><span class="p">,</span> <span class="n">page_height_pts</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
    <span class="n">page_width_in</span> <span class="o">=</span> <span class="n">page_width_pts</span> <span class="o">/</span> <span class="mi">72</span>  <span class="c1"># Convert points to inches</span>
    <span class="n">page_height_in</span> <span class="o">=</span> <span class="n">page_height_pts</span> <span class="o">/</span> <span class="mi">72</span>

    <span class="c1"># Extract the first image on the page (if any) to get pixel dimensions</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">images</span><span class="p">:</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">base_image</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span>
        <span class="n">width_px</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">height_px</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_px</span><span class="p">,</span> <span class="n">height_px</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># No image found on the page</span>

    <span class="c1"># Return dimensions</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;width_in&quot;</span><span class="p">:</span> <span class="n">page_width_in</span><span class="p">,</span>
        <span class="s2">&quot;height_in&quot;</span><span class="p">:</span> <span class="n">page_height_in</span><span class="p">,</span>
        <span class="s2">&quot;width_px&quot;</span><span class="p">:</span> <span class="n">width_px</span><span class="p">,</span>
        <span class="s2">&quot;height_px&quot;</span><span class="p">:</span> <span class="n">height_px</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.load_pdf_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Opens the PDF document and returns the fitz Document object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="fitz.Document">Document</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fitz.Document: The loaded PDF document.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file is not a valid PDF document.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any unexpected error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
pdf_path = Path("/path/to/example.pdf")
try:
    pdf_doc = load_pdf_pages(pdf_path)
    print(f"PDF contains {pdf_doc.page_count} pages.")
except Exception as e:
    print(f"Error loading PDF: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Document</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens the PDF document and returns the fitz Document object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pdf_path (Path): The path to the PDF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fitz.Document: The loaded PDF document.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified file does not exist.</span>
<span class="sd">        ValueError: If the file is not a valid PDF document.</span>
<span class="sd">        Exception: For any unexpected error.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; pdf_path = Path(&quot;/path/to/example.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     pdf_doc = load_pdf_pages(pdf_path)</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;PDF contains {pdf_doc.page_count} pages.&quot;)</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error loading PDF: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; is not a valid PDF document (expected &#39;.pdf&#39;).&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">))</span>  <span class="c1"># PyMuPDF expects a string path</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred while opening the PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.load_processed_PDF_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_processed_PDF_data</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Loads processed PDF data from files using metadata for file references.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory where the data is stored (as a Path object).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name of the processed directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[str], <span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[str], List[List[EntityAnnotation]], List[Image.Image], List[Image.Image]]:
- Loaded text pages.
- Word locations (list of <code>EntityAnnotation</code> objects for each page).
- Annotated images.
- Unannotated images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any required files are missing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the metadata file is incomplete or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_processed_PDF_data</span><span class="p">(</span>
    <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads processed PDF data from files using metadata for file references.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir (Path): Directory where the data is stored (as a Path object).</span>
<span class="sd">        base_name (str): Base name of the processed directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[str], List[List[EntityAnnotation]], List[Image.Image], List[Image.Image]]:</span>
<span class="sd">            - Loaded text pages.</span>
<span class="sd">            - Word locations (list of `EntityAnnotation` objects for each page).</span>
<span class="sd">            - Annotated images.</span>
<span class="sd">            - Unannotated images.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If any required files are missing.</span>
<span class="sd">        ValueError: If the metadata file is incomplete or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span>

    <span class="c1"># Load metadata</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">metadata_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata file &#39;</span><span class="si">{</span><span class="n">metadata_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid metadata file format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract file paths from metadata</span>
    <span class="n">text_pages_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;text_pages&quot;</span><span class="p">,</span> <span class="s2">&quot;text_pages.json&quot;</span>
    <span class="p">)</span>
    <span class="n">word_locations_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;word_locations&quot;</span><span class="p">,</span> <span class="s2">&quot;word_locations.json&quot;</span>
    <span class="p">)</span>
    <span class="n">images_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;images_directory&quot;</span><span class="p">,</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span><span class="p">))</span>

    <span class="c1"># Validate file paths</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text pages file &#39;</span><span class="si">{</span><span class="n">text_pages_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Word locations file &#39;</span><span class="si">{</span><span class="n">word_locations_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">images_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">images_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Images directory &#39;</span><span class="si">{</span><span class="n">images_dir</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

    <span class="c1"># Load text pages</span>
    <span class="k">with</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">text_pages</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Load word locations</span>
    <span class="k">with</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">serialized_word_locations</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="n">deserialize_entity_annotations_from_json</span><span class="p">(</span>
            <span class="n">serialized_word_locations</span>
        <span class="p">)</span>

    <span class="c1"># Load images</span>
    <span class="n">annotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unannotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">images_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
    <span class="p">):</span>  <span class="c1"># Iterate over files in the images directory</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;annotated_page_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="n">annotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unannotated_page_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="n">unannotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="c1"># Ensure images were loaded correctly</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">annotated_images</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">unannotated_images</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No images found in the directory &#39;</span><span class="si">{</span><span class="n">images_dir</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.make_image_preprocess_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_image_preprocess_mask</span><span class="p">(</span><span class="n">mask_height</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a preprocessing function that masks a specified height at the bottom of the image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mask_height</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The proportion of the image height to mask at the bottom (0.0 to 1.0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[[Image.Image, int], Image.Image]: A preprocessing function that takes an image</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and page number as input and returns the processed image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_image_preprocess_mask</span><span class="p">(</span>
    <span class="n">mask_height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a preprocessing function that masks a specified height at the bottom of the image.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mask_height (float): The proportion of the image height to mask at the bottom (0.0 to 1.0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[[Image.Image, int], Image.Image]: A preprocessing function that takes an image</span>
<span class="sd">        and page number as input and returns the processed image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">pre_process_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">page_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocesses the image by masking the bottom region or performing other preprocessing steps.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            image (Image.Image): The input image as a Pillow object.</span>
<span class="sd">            page_number (int): The page number of the image (useful for conditional preprocessing).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Image.Image: The preprocessed image.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">page_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># don&#39;t apply mask to cover page.</span>
            <span class="c1"># Make a copy of the image to avoid modifying the original</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

            <span class="c1"># Get image dimensions</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

            <span class="c1"># Mask the bottom region based on the specified height proportion</span>
            <span class="n">mask_pixels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">mask_height</span><span class="p">)</span>
            <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">mask_pixels</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>

    <span class="k">return</span> <span class="n">pre_process_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.pil_to_bytes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;PNG&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts a Pillow image to raw bytes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Pillow image object to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to save the image as (e.g., "PNG", "JPEG"). Default is "PNG".</p>
              </div>
            </td>
            <td>
                  <code>&#39;PNG&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bytes</code></td>            <td>
                  <code>bytes</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw bytes of the image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Pillow image to raw bytes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        image (Image.Image): The Pillow image object to convert.</span>
<span class="sd">        format (str): The format to save the image as (e.g., &quot;PNG&quot;, &quot;JPEG&quot;). Default is &quot;PNG&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: The raw bytes of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.process_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Processes a single PDF page, extracting text, word locations, and annotated images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PDF page object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pre_processor</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessing function for the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str, <span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>], <span title="PIL.Image.Image">Image</span>, <span title="PIL.Image.Image">Image</span>, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[str, List[vision.EntityAnnotation], Image.Image, Image.Image, dict]:
- Full page text (str)
- Word locations (List of vision.EntityAnnotation)
- Annotated image (Pillow Image object)
- Original unprocessed image (Pillow Image object)
- Page dimensions (dict)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_page</span><span class="p">(</span>
    <span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a single PDF page, extracting text, word locations, and annotated images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        page (fitz.Page): The PDF page object.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        pre_processor (Callable[[Image.Image, int], Image.Image]): Preprocessing function for the image.</span>
<span class="sd">        annotation_font_path (str): Path to the font file for annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[str, List[vision.EntityAnnotation], Image.Image, Image.Image, dict]:</span>
<span class="sd">            - Full page text (str)</span>
<span class="sd">            - Word locations (List of vision.EntityAnnotation)</span>
<span class="sd">            - Annotated image (Pillow Image object)</span>
<span class="sd">            - Original unprocessed image (Pillow Image object)</span>
<span class="sd">            - Page dimensions (dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract the original image from the PDF page</span>
    <span class="n">original_image</span> <span class="o">=</span> <span class="n">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="c1"># Make a copy of the original image for processing</span>
    <span class="n">processed_image</span> <span class="o">=</span> <span class="n">original_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Apply the preprocessing function (if provided)</span>
    <span class="k">if</span> <span class="n">preprocessor</span><span class="p">:</span>
        <span class="c1"># print(&quot;preprocessing...&quot;) # debug</span>
        <span class="n">processed_image</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="p">(</span><span class="n">processed_image</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="c1"># processed_image.show() # debug</span>

    <span class="c1"># Annotate the processed image using the Vision API</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">process_single_image</span><span class="p">(</span><span class="n">processed_image</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">text_annotations</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text_annotations</span>
        <span class="c1"># Extract full text and word locations</span>
        <span class="n">full_page_text</span> <span class="o">=</span> <span class="n">text_annotations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="k">if</span> <span class="n">text_annotations</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="n">text_annotations</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_annotations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># return empty data</span>
        <span class="n">full_page_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">()]</span>
        <span class="n">text_annotations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EntityAnnotation</span><span class="p">()</span>
        <span class="p">]</span>  <span class="c1"># create empty data structures to allow storing to proceed.</span>

    <span class="c1"># Create an annotated image with bounding boxes and labels</span>
    <span class="n">annotated_image</span> <span class="o">=</span> <span class="n">annotate_image_with_text</span><span class="p">(</span>
        <span class="n">processed_image</span><span class="p">,</span> <span class="n">text_annotations</span><span class="p">,</span> <span class="n">annotation_font_path</span>
    <span class="p">)</span>

    <span class="c1"># Get page dimensions (from the original PDF page, not the image)</span>
    <span class="n">page_dimensions</span> <span class="o">=</span> <span class="n">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">full_page_text</span><span class="p">,</span>
        <span class="n">word_locations</span><span class="p">,</span>
        <span class="n">annotated_image</span><span class="p">,</span>
        <span class="n">original_image</span><span class="p">,</span>
        <span class="n">page_dimensions</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.process_single_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_single_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_METHOD</span><span class="p">,</span> <span class="n">language_hints</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Processes a single image with the Google Vision API and returns text annotations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The preprocessed Pillow image object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of text detection to use ('TEXT_DETECTION' or 'DOCUMENT_TEXT_DETECTION').</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD">DEFAULT_ANNOTATION_METHOD</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language_hints</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language hints for OCR.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS">DEFAULT_ANNOTATION_LANGUAGE_HINTS</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[vision.EntityAnnotation]: Text annotations from the Vision API response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no text is detected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_single_image</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_METHOD</span><span class="p">,</span>
    <span class="n">language_hints</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a single image with the Google Vision API and returns text annotations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        image (Image.Image): The preprocessed Pillow image object.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        feature_type (str): Type of text detection to use (&#39;TEXT_DETECTION&#39; or &#39;DOCUMENT_TEXT_DETECTION&#39;).</span>
<span class="sd">        language_hints (List): Language hints for OCR.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[vision.EntityAnnotation]: Text annotations from the Vision API response.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no text is detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert the Pillow image to bytes</span>
    <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>

    <span class="c1"># Map feature type</span>
    <span class="n">feature_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;TEXT_DETECTION&quot;</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">TEXT_DETECTION</span><span class="p">,</span>
        <span class="s2">&quot;DOCUMENT_TEXT_DETECTION&quot;</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">DOCUMENT_TEXT_DETECTION</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">feature_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_map</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid feature type &#39;</span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2">&#39;. Use &#39;TEXT_DETECTION&#39; or &#39;DOCUMENT_TEXT_DETECTION&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Prepare Vision API request</span>
    <span class="n">vision_image</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">image_bytes</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">feature_map</span><span class="p">[</span><span class="n">feature_type</span><span class="p">])]</span>
    <span class="n">image_context</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageContext</span><span class="p">(</span><span class="n">language_hints</span><span class="o">=</span><span class="n">language_hints</span><span class="p">)</span>

    <span class="c1"># Make the API call</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">annotate_image</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">vision_image</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;image_context&quot;</span><span class="p">:</span> <span class="n">image_context</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.save_processed_pdf_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_processed_pdf_data</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">,</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Saves processed PDF data to files for later reloading.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the data (as a Path object).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name for the output directory (usually the PDF name without extension).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_pages</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extracted full-page text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>word_locations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word locations and annotations from Vision API.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotated_images</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annotated images with bounding boxes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unannotated_images</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw unannotated images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_processed_pdf_data</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">journal_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">text_pages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">word_locations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span>
    <span class="n">annotated_images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span>
    <span class="n">unannotated_images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves processed PDF data to files for later reloading.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir (Path): Directory to save the data (as a Path object).</span>
<span class="sd">        base_name (str): Base name for the output directory (usually the PDF name without extension).</span>
<span class="sd">        text_pages (List[str]): Extracted full-page text.</span>
<span class="sd">        word_locations (List[List[EntityAnnotation]]): Word locations and annotations from Vision API.</span>
<span class="sd">        annotated_images (List[PIL.Image.Image]): Annotated images with bounding boxes.</span>
<span class="sd">        unannotated_images (List[PIL.Image.Image]): Raw unannotated images.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create output directories</span>
    <span class="n">base_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">journal_name</span> <span class="o">/</span> <span class="s2">&quot;ocr_data&quot;</span>
    <span class="n">images_dir</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span>

    <span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">images_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Save text data</span>
    <span class="n">text_pages_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;text_pages.json&quot;</span>
    <span class="k">with</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">text_pages</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Save word locations as JSON</span>
    <span class="n">word_locations_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;word_locations.json&quot;</span>
    <span class="n">serialized_word_locations</span> <span class="o">=</span> <span class="n">serialize_entity_annotations_to_json</span><span class="p">(</span><span class="n">word_locations</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serialized_word_locations</span><span class="p">)</span>

    <span class="c1"># Save images</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">annotated_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annotated_images</span><span class="p">):</span>
        <span class="n">annotated_file</span> <span class="o">=</span> <span class="n">images_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;annotated_page_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">annotated_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">annotated_file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">unannotated_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unannotated_images</span><span class="p">):</span>
        <span class="n">unannotated_file</span> <span class="o">=</span> <span class="n">images_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;unannotated_page_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">unannotated_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">unannotated_file</span><span class="p">)</span>

    <span class="c1"># Save metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_pdf&quot;</span><span class="p">:</span> <span class="n">journal_name</span><span class="p">,</span>
        <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_pages</span><span class="p">),</span>
        <span class="s2">&quot;images_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">images_dir</span>
        <span class="p">),</span>  <span class="c1"># Convert Path to string for JSON serialization</span>
        <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;text_pages&quot;</span><span class="p">:</span> <span class="s2">&quot;text_pages.json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;word_locations&quot;</span><span class="p">:</span> <span class="s2">&quot;word_locations.json&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">metadata_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span>
    <span class="k">with</span> <span class="n">metadata_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed data saved in: </span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.serialize_entity_annotations_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize_entity_annotations_to_json</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Serializes a nested list of EntityAnnotation objects into a JSON-compatible format using Base64 encoding.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>annotations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The nested list of EntityAnnotation objects.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The serialized data in JSON format as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">serialize_entity_annotations_to_json</span><span class="p">(</span>
    <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serializes a nested list of EntityAnnotation objects into a JSON-compatible format using Base64 encoding.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        annotations (List[List[EntityAnnotation]]): The nested list of EntityAnnotation objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The serialized data in JSON format as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">serialized_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page_annotations</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="n">serialized_page</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">page_annotations</span>
        <span class="p">]</span>
        <span class="n">serialized_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">serialized_page</span><span class="p">)</span>

    <span class="c1"># Convert to a JSON string</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.ocr_processing.start_image_annotator_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_image_annotator_client</span><span class="p">(</span><span class="n">credentials_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_endpoint</span><span class="o">=</span><span class="s1">&#39;vision.googleapis.com&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">enable_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Starts and returns a Google Vision API ImageAnnotatorClient with optional configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the credentials JSON file. If None, uses the default environment variable.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_endpoint</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom API endpoint for the Vision API. Default is the global endpoint.</p>
              </div>
            </td>
            <td>
                  <code>&#39;vision.googleapis.com&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Connection and read timeouts in seconds. Default is (10, 30).</p>
              </div>
            </td>
            <td>
                  <code>(10, 30)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_logging</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable detailed logging for debugging. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vision.ImageAnnotatorClient: Configured Vision API client.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified credentials file is not found.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For unexpected errors during client setup.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>client = start_image_annotator_client(
    credentials_file="/path/to/credentials.json",
    api_endpoint="vision.googleapis.com",
    timeout=(10, 30),
    enable_logging=True
)
print("Google Vision API client initialized.")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_image_annotator_client</span><span class="p">(</span>
    <span class="n">credentials_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">api_endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vision.googleapis.com&quot;</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">enable_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts and returns a Google Vision API ImageAnnotatorClient with optional configuration.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        credentials_file (str): Path to the credentials JSON file. If None, uses the default environment variable.</span>
<span class="sd">        api_endpoint (str): Custom API endpoint for the Vision API. Default is the global endpoint.</span>
<span class="sd">        timeout (Tuple[int, int]): Connection and read timeouts in seconds. Default is (10, 30).</span>
<span class="sd">        enable_logging (bool): Enable detailed logging for debugging. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        vision.ImageAnnotatorClient: Configured Vision API client.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified credentials file is not found.</span>
<span class="sd">        Exception: For unexpected errors during client setup.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; client = start_image_annotator_client(</span>
<span class="sd">        &gt;&gt;&gt;     credentials_file=&quot;/path/to/credentials.json&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     api_endpoint=&quot;vision.googleapis.com&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     timeout=(10, 30),</span>
<span class="sd">        &gt;&gt;&gt;     enable_logging=True</span>
<span class="sd">        &gt;&gt;&gt; )</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Google Vision API client initialized.&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Set up credentials</span>
        <span class="k">if</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">credentials_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Credentials file &#39;</span><span class="si">{</span><span class="n">credentials_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
                <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">credentials_file</span>

        <span class="c1"># Configure client options</span>
        <span class="n">client_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;api_endpoint&quot;</span><span class="p">:</span> <span class="n">api_endpoint</span><span class="p">}</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">(</span><span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span><span class="p">)</span>

        <span class="c1"># Optionally enable logging</span>
        <span class="k">if</span> <span class="n">enable_logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vision API Client started with endpoint: </span><span class="si">{</span><span class="n">api_endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout settings: Connect=</span><span class="si">{</span><span class="n">timeout</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">s, Read=</span><span class="si">{</span><span class="n">timeout</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">client</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize ImageAnnotatorClient: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ocr_processing.ocr_editor" class="doc doc-heading">
            <code>ocr_editor</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.current_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">current_image</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_image</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.current_page_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">current_page_index</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_page_index</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.current_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">current_text</span> <span class="o">=</span> <span class="n">pages</span><span class="p">[</span><span class="n">current_page_index</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.edited_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">edited_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s1">&#39;Edit OCR Text&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_text</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;text_area_</span><span class="si">{</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_page_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.image_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">image_directory</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s1">&#39;Image Directory&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;./images&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.ocr_text_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ocr_text_directory</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s1">&#39;OCR Text Directory&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;./ocr_text&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pages</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">pages</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.save_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_text_directory</span><span class="p">,</span> <span class="s1">&#39;updated_ocr.xml&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tree</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tree</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.uploaded_image_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">uploaded_image_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span><span class="s1">&#39;Upload an Image&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_editor.uploaded_text_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">uploaded_text_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span><span class="s1">&#39;Upload OCR Text File&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;xml&#39;</span><span class="p">])</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_editor.extract_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_pages</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract page data from the XML tree.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tree</code>
            </td>
            <td>
                  <code><span title="lxml.etree.ElementTree">ElementTree</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed XML tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries containing 'number' and 'text' for each page.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_editor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_pages</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract page data from the XML tree.</span>

<span class="sd">    Args:</span>
<span class="sd">        tree (etree.ElementTree): Parsed XML tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of dictionaries containing &#39;number&#39; and &#39;text&#39; for each page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//page&quot;</span><span class="p">):</span>
        <span class="n">page_number</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page&quot;</span><span class="p">)</span>
        <span class="n">ocr_text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">page_number</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">ocr_text</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">pages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_editor.load_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_xml</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Load an XML file from a file-like object.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_editor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_xml</span><span class="p">(</span><span class="n">file_obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load an XML file from a file-like object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>  <span class="c1"># Directly parse the file-like object</span>
        <span class="k">return</span> <span class="n">tree</span>
    <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLSyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing XML file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_editor.save_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_xml</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Save the modified XML tree to a file.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_editor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_xml</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the modified XML tree to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.ocr_processing.ocr_processing" class="doc doc-heading">
            <code>ocr_processing</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_FONT_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/System/Library/Fonts/Supplemental/Arial.ttf&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_SIZE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_FONT_SIZE</span> <span class="o">=</span> <span class="mi">12</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vi&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_METHOD</span> <span class="o">=</span> <span class="s1">&#39;DOCUMENT_TEXT_DETECTION&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_OFFSET" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_ANNOTATION_OFFSET</span> <span class="o">=</span> <span class="mi">2</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ocr_processing&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning" class="doc doc-heading">
            <code>PDFParseWarning</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Warning</code></p>


        <p>Custom warning class for PDF parsing issues.
Encapsulates minimal logic for displaying warnings with a custom format.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PDFParseWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom warning class for PDF parsing issues.</span>
<span class="sd">    Encapsulates minimal logic for displaying warnings with a custom format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a warning message with custom formatting.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            message (str): The warning message to display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93mPDFParseWarning: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">formatted_message</span><span class="p">)</span>  <span class="c1"># Simply prints the warning</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.ocr_processing.ocr_processing.PDFParseWarning.warn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Display a warning message with custom formatting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The warning message to display.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a warning message with custom formatting.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        message (str): The warning message to display.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formatted_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93mPDFParseWarning: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">formatted_message</span><span class="p">)</span>  <span class="c1"># Simply prints the warning</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.annotate_image_with_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">annotate_image_with_text</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">text_annotations</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Annotates a PIL image with bounding boxes and text descriptions from OCR results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pil_image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input PIL image to annotate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_annotations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OCR results containing bounding boxes and text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for text annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>font_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size for text annotations.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image.Image: The annotated PIL image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input image is None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>IOError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the font file cannot be loaded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any other unexpected errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_image_with_text</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
    <span class="n">text_annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">],</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annotates a PIL image with bounding boxes and text descriptions from OCR results.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pil_image (Image.Image): The input PIL image to annotate.</span>
<span class="sd">        text_annotations (List[EntityAnnotation]): OCR results containing bounding boxes and text.</span>
<span class="sd">        annotation_font_path (str): Path to the font file for text annotations.</span>
<span class="sd">        font_size (int): Font size for text annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image.Image: The annotated PIL image.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input image is None.</span>
<span class="sd">        IOError: If the font file cannot be loaded.</span>
<span class="sd">        Exception: For any other unexpected errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input image is None.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load the font from &#39;</span><span class="si">{</span><span class="n">annotation_font_path</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_annotations</span><span class="p">):</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">text_obj</span><span class="o">.</span><span class="n">bounding_poly</span><span class="o">.</span><span class="n">vertices</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
            <span class="p">):</span>  <span class="c1"># Ensure there are exactly 4 vertices for a rectangle</span>
                <span class="c1"># Draw the bounding box</span>
                <span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Skip the first bounding box (whole text region)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Offset the text position slightly for clarity</span>
                    <span class="n">text_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">text_position</span><span class="p">,</span> <span class="n">text_obj</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span>
                    <span class="p">)</span>

    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid text annotation structure: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred during image annotation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.build_processed_pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_processed_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_FONT_PATH</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Processes a PDF document, extracting text, word locations, annotated images, and unannotated images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for annotations.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_FONT_PATH">DEFAULT_ANNOTATION_FONT_PATH</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[str], <span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>]], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[str], List[List[vision.EntityAnnotation]], List[Image.Image], List[Image.Image]]:
- List of extracted full-page texts (one entry per page).
- List of word locations (list of <code>vision.EntityAnnotation</code> objects for each page).
- List of annotated images (with bounding boxes and text annotations).
- List of unannotated images (raw page images).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified PDF file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the PDF file is invalid or contains no pages.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any unexpected errors during processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
from google.cloud import vision
pdf_path = Path("/path/to/example.pdf")
font_path = Path("/path/to/fonts/Arial.ttf")
client = vision.ImageAnnotatorClient()
try:
    text_pages, word_locations_list, annotated_images, unannotated_images = build_processed_pdf(
        pdf_path, client, font_path
    )
    print(f"Processed {len(text_pages)} pages successfully!")
except Exception as e:
    print(f"Error processing PDF: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_processed_pdf</span><span class="p">(</span>
    <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_FONT_PATH</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a PDF document, extracting text, word locations, annotated images, and unannotated images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pdf_path (Path): Path to the PDF file.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        annotation_font_path (Path): Path to the font file for annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[str], List[List[vision.EntityAnnotation]], List[Image.Image], List[Image.Image]]:</span>
<span class="sd">            - List of extracted full-page texts (one entry per page).</span>
<span class="sd">            - List of word locations (list of `vision.EntityAnnotation` objects for each page).</span>
<span class="sd">            - List of annotated images (with bounding boxes and text annotations).</span>
<span class="sd">            - List of unannotated images (raw page images).</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified PDF file does not exist.</span>
<span class="sd">        ValueError: If the PDF file is invalid or contains no pages.</span>
<span class="sd">        Exception: For any unexpected errors during processing.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; from google.cloud import vision</span>
<span class="sd">        &gt;&gt;&gt; pdf_path = Path(&quot;/path/to/example.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; font_path = Path(&quot;/path/to/fonts/Arial.ttf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; client = vision.ImageAnnotatorClient()</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     text_pages, word_locations_list, annotated_images, unannotated_images = build_processed_pdf(</span>
<span class="sd">        &gt;&gt;&gt;         pdf_path, client, font_path</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Processed {len(text_pages)} pages successfully!&quot;)</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error processing PDF: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">fnf_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading PDF: </span><span class="si">{</span><span class="n">fnf_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid PDF file: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred while loading the PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The PDF file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; contains no pages.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file with </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="si">}</span><span class="s2"> pages:</span><span class="se">\n\t</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">text_pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">word_locations_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">annotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unannotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">first_page_dimensions</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">full_page_text</span><span class="p">,</span>
                <span class="n">word_locations</span><span class="p">,</span>
                <span class="n">annotated_image</span><span class="p">,</span>
                <span class="n">unannotated_image</span><span class="p">,</span>
                <span class="n">page_dimensions</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">process_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">full_page_text</span><span class="p">:</span>  <span class="c1"># this is not an empty page</span>

                <span class="k">if</span> <span class="n">page_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># save first page info</span>
                    <span class="n">first_page_dimensions</span> <span class="o">=</span> <span class="n">page_dimensions</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">page_dimensions</span> <span class="o">!=</span> <span class="n">first_page_dimensions</span>
                <span class="p">):</span>  <span class="c1"># verify page dimensions are consistent</span>
                    <span class="n">PDFParseWarning</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> has different dimensions than page 1.&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">page_dimensions</span><span class="si">}</span><span class="s2">) compared to the first page: (</span><span class="si">{</span><span class="n">first_page_dimensions</span><span class="si">}</span><span class="s2">).&quot;</span>
                    <span class="p">)</span>

                <span class="n">text_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_page_text</span><span class="p">)</span>
                <span class="n">word_locations_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_locations</span><span class="p">)</span>
                <span class="n">annotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotated_image</span><span class="p">)</span>
                <span class="n">unannotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unannotated_image</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PDFParseWarning</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> empty, added empty datastructures...</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="c1"># f&quot;  (Note that total document length will be reduced.)&quot;</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ValueError on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">oe</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OSError on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">oe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error on page </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;page dimensions: </span><span class="si">{</span><span class="n">page_dimensions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations_list</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.deserialize_entity_annotations_from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deserialize_entity_annotations_from_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Deserializes JSON data into a nested list of EntityAnnotation objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JSON string containing serialized annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[List[EntityAnnotation]]: The reconstructed nested list of EntityAnnotation objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deserialize_entity_annotations_from_json</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserializes JSON data into a nested list of EntityAnnotation objects.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (str): The JSON string containing serialized annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[List[EntityAnnotation]]: The reconstructed nested list of EntityAnnotation objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">serialized_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">deserialized_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">serialized_page</span> <span class="ow">in</span> <span class="n">serialized_data</span><span class="p">:</span>
        <span class="n">page_annotations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EntityAnnotation</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">serialized_annotation</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">serialized_annotation</span> <span class="ow">in</span> <span class="n">serialized_page</span>
        <span class="p">]</span>
        <span class="n">deserialized_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_annotations</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">deserialized_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.extract_image_from_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts the first image from the given PDF page and returns it as a PIL Image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PDF page object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Image.Image: The first image on the page as a Pillow Image object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no images are found on the page or the image data is incomplete.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For unexpected errors during image extraction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fitz
from PIL import Image
doc = fitz.open("/path/to/document.pdf")
page = doc.load_page(0)  # Load the first page
try:
    image = extract_image_from_page(page)
    image.show()  # Display the image
except Exception as e:
    print(f"Error extracting image: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the first image from the given PDF page and returns it as a PIL Image.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        page (fitz.Page): The PDF page object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Image.Image: The first image on the page as a Pillow Image object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no images are found on the page or the image data is incomplete.</span>
<span class="sd">        Exception: For unexpected errors during image extraction.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fitz</span>
<span class="sd">        &gt;&gt;&gt; from PIL import Image</span>
<span class="sd">        &gt;&gt;&gt; doc = fitz.open(&quot;/path/to/document.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; page = doc.load_page(0)  # Load the first page</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     image = extract_image_from_page(page)</span>
<span class="sd">        &gt;&gt;&gt;     image.show()  # Display the image</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error extracting image: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get images from the page</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">images</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No images found on the page.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the first image reference</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the first image&#39;s xref</span>
        <span class="n">base_image</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span>

        <span class="c1"># Validate the extracted image data</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;image&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
            <span class="ow">or</span> <span class="s2">&quot;width&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
            <span class="ow">or</span> <span class="s2">&quot;height&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_image</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The extracted image data is incomplete.&quot;</span><span class="p">)</span>

        <span class="c1"># Convert the raw image bytes into a Pillow image</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
        <span class="n">pil_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pil_image</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ve</span>  <span class="c1"># Re-raise for calling functions to handle</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during image extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.get_page_dimensions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts the width and height of a single PDF page in both inches and pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PDF page object from PyMuPDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the width and height of the page in inches and pixels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the width and height of a single PDF page in both inches and pixels.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (fitz.Page): A single PDF page object from PyMuPDF.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the width and height of the page in inches and pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get page dimensions in points and convert to inches</span>
    <span class="n">page_width_pts</span><span class="p">,</span> <span class="n">page_height_pts</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
    <span class="n">page_width_in</span> <span class="o">=</span> <span class="n">page_width_pts</span> <span class="o">/</span> <span class="mi">72</span>  <span class="c1"># Convert points to inches</span>
    <span class="n">page_height_in</span> <span class="o">=</span> <span class="n">page_height_pts</span> <span class="o">/</span> <span class="mi">72</span>

    <span class="c1"># Extract the first image on the page (if any) to get pixel dimensions</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">images</span><span class="p">:</span>
        <span class="n">xref</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">base_image</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">extract_image</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span>
        <span class="n">width_px</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">height_px</span> <span class="o">=</span> <span class="n">base_image</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_px</span><span class="p">,</span> <span class="n">height_px</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># No image found on the page</span>

    <span class="c1"># Return dimensions</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;width_in&quot;</span><span class="p">:</span> <span class="n">page_width_in</span><span class="p">,</span>
        <span class="s2">&quot;height_in&quot;</span><span class="p">:</span> <span class="n">page_height_in</span><span class="p">,</span>
        <span class="s2">&quot;width_px&quot;</span><span class="p">:</span> <span class="n">width_px</span><span class="p">,</span>
        <span class="s2">&quot;height_px&quot;</span><span class="p">:</span> <span class="n">height_px</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.load_pdf_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Opens the PDF document and returns the fitz Document object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="fitz.Document">Document</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fitz.Document: The loaded PDF document.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file is not a valid PDF document.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For any unexpected error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
pdf_path = Path("/path/to/example.pdf")
try:
    pdf_doc = load_pdf_pages(pdf_path)
    print(f"PDF contains {pdf_doc.page_count} pages.")
except Exception as e:
    print(f"Error loading PDF: {e}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_pdf_pages</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Document</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens the PDF document and returns the fitz Document object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pdf_path (Path): The path to the PDF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fitz.Document: The loaded PDF document.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified file does not exist.</span>
<span class="sd">        ValueError: If the file is not a valid PDF document.</span>
<span class="sd">        Exception: For any unexpected error.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; pdf_path = Path(&quot;/path/to/example.pdf&quot;)</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        &gt;&gt;&gt;     pdf_doc = load_pdf_pages(pdf_path)</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;PDF contains {pdf_doc.page_count} pages.&quot;)</span>
<span class="sd">        &gt;&gt;&gt; except Exception as e:</span>
<span class="sd">        &gt;&gt;&gt;     print(f&quot;Error loading PDF: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&#39; is not a valid PDF document (expected &#39;.pdf&#39;).&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">))</span>  <span class="c1"># PyMuPDF expects a string path</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred while opening the PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.load_processed_PDF_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_processed_PDF_data</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Loads processed PDF data from files using metadata for file references.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory where the data is stored (as a Path object).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name of the processed directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[str], <span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>], <span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[str], List[List[EntityAnnotation]], List[Image.Image], List[Image.Image]]:
- Loaded text pages.
- Word locations (list of <code>EntityAnnotation</code> objects for each page).
- Annotated images.
- Unannotated images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any required files are missing.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the metadata file is incomplete or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_processed_PDF_data</span><span class="p">(</span>
    <span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span>
<span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads processed PDF data from files using metadata for file references.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir (Path): Directory where the data is stored (as a Path object).</span>
<span class="sd">        base_name (str): Base name of the processed directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[str], List[List[EntityAnnotation]], List[Image.Image], List[Image.Image]]:</span>
<span class="sd">            - Loaded text pages.</span>
<span class="sd">            - Word locations (list of `EntityAnnotation` objects for each page).</span>
<span class="sd">            - Annotated images.</span>
<span class="sd">            - Unannotated images.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If any required files are missing.</span>
<span class="sd">        ValueError: If the metadata file is incomplete or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span>

    <span class="c1"># Load metadata</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">metadata_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata file &#39;</span><span class="si">{</span><span class="n">metadata_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid metadata file format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract file paths from metadata</span>
    <span class="n">text_pages_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;text_pages&quot;</span><span class="p">,</span> <span class="s2">&quot;text_pages.json&quot;</span>
    <span class="p">)</span>
    <span class="n">word_locations_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;word_locations&quot;</span><span class="p">,</span> <span class="s2">&quot;word_locations.json&quot;</span>
    <span class="p">)</span>
    <span class="n">images_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;images_directory&quot;</span><span class="p">,</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span><span class="p">))</span>

    <span class="c1"># Validate file paths</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text pages file &#39;</span><span class="si">{</span><span class="n">text_pages_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Word locations file &#39;</span><span class="si">{</span><span class="n">word_locations_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">images_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">images_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Images directory &#39;</span><span class="si">{</span><span class="n">images_dir</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>

    <span class="c1"># Load text pages</span>
    <span class="k">with</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">text_pages</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Load word locations</span>
    <span class="k">with</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">serialized_word_locations</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="n">deserialize_entity_annotations_from_json</span><span class="p">(</span>
            <span class="n">serialized_word_locations</span>
        <span class="p">)</span>

    <span class="c1"># Load images</span>
    <span class="n">annotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unannotated_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">images_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
    <span class="p">):</span>  <span class="c1"># Iterate over files in the images directory</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;annotated_page_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="n">annotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unannotated_page_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="n">unannotated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

    <span class="c1"># Ensure images were loaded correctly</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">annotated_images</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">unannotated_images</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No images found in the directory &#39;</span><span class="si">{</span><span class="n">images_dir</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.make_image_preprocess_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_image_preprocess_mask</span><span class="p">(</span><span class="n">mask_height</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a preprocessing function that masks a specified height at the bottom of the image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mask_height</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The proportion of the image height to mask at the bottom (0.0 to 1.0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[[Image.Image, int], Image.Image]: A preprocessing function that takes an image</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and page number as input and returns the processed image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_image_preprocess_mask</span><span class="p">(</span>
    <span class="n">mask_height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a preprocessing function that masks a specified height at the bottom of the image.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mask_height (float): The proportion of the image height to mask at the bottom (0.0 to 1.0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[[Image.Image, int], Image.Image]: A preprocessing function that takes an image</span>
<span class="sd">        and page number as input and returns the processed image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">pre_process_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">page_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocesses the image by masking the bottom region or performing other preprocessing steps.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            image (Image.Image): The input image as a Pillow object.</span>
<span class="sd">            page_number (int): The page number of the image (useful for conditional preprocessing).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Image.Image: The preprocessed image.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">page_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># don&#39;t apply mask to cover page.</span>
            <span class="c1"># Make a copy of the image to avoid modifying the original</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

            <span class="c1"># Get image dimensions</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

            <span class="c1"># Mask the bottom region based on the specified height proportion</span>
            <span class="n">mask_pixels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">mask_height</span><span class="p">)</span>
            <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">mask_pixels</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>

    <span class="k">return</span> <span class="n">pre_process_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.pil_to_bytes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;PNG&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Converts a Pillow image to raw bytes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Pillow image object to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to save the image as (e.g., "PNG", "JPEG"). Default is "PNG".</p>
              </div>
            </td>
            <td>
                  <code>&#39;PNG&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bytes</code></td>            <td>
                  <code>bytes</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw bytes of the image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Pillow image to raw bytes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        image (Image.Image): The Pillow image object to convert.</span>
<span class="sd">        format (str): The format to save the image as (e.g., &quot;PNG&quot;, &quot;JPEG&quot;). Default is &quot;PNG&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: The raw bytes of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.process_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">annotation_font_path</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Processes a single PDF page, extracting text, word locations, and annotated images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PDF page object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pre_processor</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="PIL.Image.Image">Image</span>, int], <span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessing function for the image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotation_font_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the font file for annotations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[str, <span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>], <span title="PIL.Image.Image">Image</span>, <span title="PIL.Image.Image">Image</span>, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[str, List[vision.EntityAnnotation], Image.Image, Image.Image, dict]:
- Full page text (str)
- Word locations (List of vision.EntityAnnotation)
- Annotated image (Pillow Image object)
- Original unprocessed image (Pillow Image object)
- Page dimensions (dict)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_page</span><span class="p">(</span>
    <span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">annotation_font_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">],</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a single PDF page, extracting text, word locations, and annotated images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        page (fitz.Page): The PDF page object.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        pre_processor (Callable[[Image.Image, int], Image.Image]): Preprocessing function for the image.</span>
<span class="sd">        annotation_font_path (str): Path to the font file for annotations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[str, List[vision.EntityAnnotation], Image.Image, Image.Image, dict]:</span>
<span class="sd">            - Full page text (str)</span>
<span class="sd">            - Word locations (List of vision.EntityAnnotation)</span>
<span class="sd">            - Annotated image (Pillow Image object)</span>
<span class="sd">            - Original unprocessed image (Pillow Image object)</span>
<span class="sd">            - Page dimensions (dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract the original image from the PDF page</span>
    <span class="n">original_image</span> <span class="o">=</span> <span class="n">extract_image_from_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="c1"># Make a copy of the original image for processing</span>
    <span class="n">processed_image</span> <span class="o">=</span> <span class="n">original_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Apply the preprocessing function (if provided)</span>
    <span class="k">if</span> <span class="n">preprocessor</span><span class="p">:</span>
        <span class="c1"># print(&quot;preprocessing...&quot;) # debug</span>
        <span class="n">processed_image</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="p">(</span><span class="n">processed_image</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="c1"># processed_image.show() # debug</span>

    <span class="c1"># Annotate the processed image using the Vision API</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">process_single_image</span><span class="p">(</span><span class="n">processed_image</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">text_annotations</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text_annotations</span>
        <span class="c1"># Extract full text and word locations</span>
        <span class="n">full_page_text</span> <span class="o">=</span> <span class="n">text_annotations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="k">if</span> <span class="n">text_annotations</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="n">text_annotations</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_annotations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># return empty data</span>
        <span class="n">full_page_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">word_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">()]</span>
        <span class="n">text_annotations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EntityAnnotation</span><span class="p">()</span>
        <span class="p">]</span>  <span class="c1"># create empty data structures to allow storing to proceed.</span>

    <span class="c1"># Create an annotated image with bounding boxes and labels</span>
    <span class="n">annotated_image</span> <span class="o">=</span> <span class="n">annotate_image_with_text</span><span class="p">(</span>
        <span class="n">processed_image</span><span class="p">,</span> <span class="n">text_annotations</span><span class="p">,</span> <span class="n">annotation_font_path</span>
    <span class="p">)</span>

    <span class="c1"># Get page dimensions (from the original PDF page, not the image)</span>
    <span class="n">page_dimensions</span> <span class="o">=</span> <span class="n">get_page_dimensions</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">full_page_text</span><span class="p">,</span>
        <span class="n">word_locations</span><span class="p">,</span>
        <span class="n">annotated_image</span><span class="p">,</span>
        <span class="n">original_image</span><span class="p">,</span>
        <span class="n">page_dimensions</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.process_single_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_single_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">feature_type</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_METHOD</span><span class="p">,</span> <span class="n">language_hints</span><span class="o">=</span><span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Processes a single image with the Google Vision API and returns text annotations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The preprocessed Pillow image object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Vision API client for text detection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of text detection to use ('TEXT_DETECTION' or 'DOCUMENT_TEXT_DETECTION').</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_METHOD">DEFAULT_ANNOTATION_METHOD</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language_hints</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language hints for OCR.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS" href="#tnh_scholar.ocr_processing.ocr_processing.DEFAULT_ANNOTATION_LANGUAGE_HINTS">DEFAULT_ANNOTATION_LANGUAGE_HINTS</a></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="google.cloud.vision.EntityAnnotation">EntityAnnotation</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[vision.EntityAnnotation]: Text annotations from the Vision API response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no text is detected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_single_image</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">,</span>
    <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_METHOD</span><span class="p">,</span>
    <span class="n">language_hints</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="n">DEFAULT_ANNOTATION_LANGUAGE_HINTS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">EntityAnnotation</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a single image with the Google Vision API and returns text annotations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        image (Image.Image): The preprocessed Pillow image object.</span>
<span class="sd">        client (vision.ImageAnnotatorClient): Google Vision API client for text detection.</span>
<span class="sd">        feature_type (str): Type of text detection to use (&#39;TEXT_DETECTION&#39; or &#39;DOCUMENT_TEXT_DETECTION&#39;).</span>
<span class="sd">        language_hints (List): Language hints for OCR.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[vision.EntityAnnotation]: Text annotations from the Vision API response.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no text is detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert the Pillow image to bytes</span>
    <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">pil_to_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>

    <span class="c1"># Map feature type</span>
    <span class="n">feature_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;TEXT_DETECTION&quot;</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">TEXT_DETECTION</span><span class="p">,</span>
        <span class="s2">&quot;DOCUMENT_TEXT_DETECTION&quot;</span><span class="p">:</span> <span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">DOCUMENT_TEXT_DETECTION</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">feature_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_map</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid feature type &#39;</span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2">&#39;. Use &#39;TEXT_DETECTION&#39; or &#39;DOCUMENT_TEXT_DETECTION&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Prepare Vision API request</span>
    <span class="n">vision_image</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">image_bytes</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">vision</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">feature_map</span><span class="p">[</span><span class="n">feature_type</span><span class="p">])]</span>
    <span class="n">image_context</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageContext</span><span class="p">(</span><span class="n">language_hints</span><span class="o">=</span><span class="n">language_hints</span><span class="p">)</span>

    <span class="c1"># Make the API call</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">annotate_image</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">vision_image</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;image_context&quot;</span><span class="p">:</span> <span class="n">image_context</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.save_processed_pdf_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_processed_pdf_data</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">journal_name</span><span class="p">,</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">word_locations</span><span class="p">,</span> <span class="n">annotated_images</span><span class="p">,</span> <span class="n">unannotated_images</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Saves processed PDF data to files for later reloading.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the data (as a Path object).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base name for the output directory (usually the PDF name without extension).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_pages</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extracted full-page text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>word_locations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Word locations and annotations from Vision API.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>annotated_images</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annotated images with bounding boxes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unannotated_images</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="PIL.Image.Image">Image</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw unannotated images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_processed_pdf_data</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">journal_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">text_pages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">word_locations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span>
    <span class="n">annotated_images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span>
    <span class="n">unannotated_images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves processed PDF data to files for later reloading.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir (Path): Directory to save the data (as a Path object).</span>
<span class="sd">        base_name (str): Base name for the output directory (usually the PDF name without extension).</span>
<span class="sd">        text_pages (List[str]): Extracted full-page text.</span>
<span class="sd">        word_locations (List[List[EntityAnnotation]]): Word locations and annotations from Vision API.</span>
<span class="sd">        annotated_images (List[PIL.Image.Image]): Annotated images with bounding boxes.</span>
<span class="sd">        unannotated_images (List[PIL.Image.Image]): Raw unannotated images.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create output directories</span>
    <span class="n">base_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">journal_name</span> <span class="o">/</span> <span class="s2">&quot;ocr_data&quot;</span>
    <span class="n">images_dir</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span>

    <span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">images_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Save text data</span>
    <span class="n">text_pages_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;text_pages.json&quot;</span>
    <span class="k">with</span> <span class="n">text_pages_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">text_pages</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Save word locations as JSON</span>
    <span class="n">word_locations_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;word_locations.json&quot;</span>
    <span class="n">serialized_word_locations</span> <span class="o">=</span> <span class="n">serialize_entity_annotations_to_json</span><span class="p">(</span><span class="n">word_locations</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">word_locations_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serialized_word_locations</span><span class="p">)</span>

    <span class="c1"># Save images</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">annotated_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annotated_images</span><span class="p">):</span>
        <span class="n">annotated_file</span> <span class="o">=</span> <span class="n">images_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;annotated_page_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">annotated_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">annotated_file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">unannotated_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unannotated_images</span><span class="p">):</span>
        <span class="n">unannotated_file</span> <span class="o">=</span> <span class="n">images_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;unannotated_page_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">unannotated_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">unannotated_file</span><span class="p">)</span>

    <span class="c1"># Save metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;source_pdf&quot;</span><span class="p">:</span> <span class="n">journal_name</span><span class="p">,</span>
        <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_pages</span><span class="p">),</span>
        <span class="s2">&quot;images_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">images_dir</span>
        <span class="p">),</span>  <span class="c1"># Convert Path to string for JSON serialization</span>
        <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;text_pages&quot;</span><span class="p">:</span> <span class="s2">&quot;text_pages.json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;word_locations&quot;</span><span class="p">:</span> <span class="s2">&quot;word_locations.json&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">metadata_file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span>
    <span class="k">with</span> <span class="n">metadata_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed data saved in: </span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.serialize_entity_annotations_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize_entity_annotations_to_json</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Serializes a nested list of EntityAnnotation objects into a JSON-compatible format using Base64 encoding.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>annotations</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="google.cloud.vision_v1.types.EntityAnnotation">EntityAnnotation</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The nested list of EntityAnnotation objects.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The serialized data in JSON format as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">serialize_entity_annotations_to_json</span><span class="p">(</span>
    <span class="n">annotations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">EntityAnnotation</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serializes a nested list of EntityAnnotation objects into a JSON-compatible format using Base64 encoding.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        annotations (List[List[EntityAnnotation]]): The nested list of EntityAnnotation objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The serialized data in JSON format as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">serialized_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page_annotations</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="n">serialized_page</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">page_annotations</span>
        <span class="p">]</span>
        <span class="n">serialized_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">serialized_page</span><span class="p">)</span>

    <span class="c1"># Convert to a JSON string</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.ocr_processing.ocr_processing.start_image_annotator_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_image_annotator_client</span><span class="p">(</span><span class="n">credentials_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_endpoint</span><span class="o">=</span><span class="s1">&#39;vision.googleapis.com&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">enable_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Starts and returns a Google Vision API ImageAnnotatorClient with optional configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the credentials JSON file. If None, uses the default environment variable.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_endpoint</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom API endpoint for the Vision API. Default is the global endpoint.</p>
              </div>
            </td>
            <td>
                  <code>&#39;vision.googleapis.com&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Connection and read timeouts in seconds. Default is (10, 30).</p>
              </div>
            </td>
            <td>
                  <code>(10, 30)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_logging</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable detailed logging for debugging. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="google.cloud.vision.ImageAnnotatorClient">ImageAnnotatorClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>vision.ImageAnnotatorClient: Configured Vision API client.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified credentials file is not found.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For unexpected errors during client setup.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>client = start_image_annotator_client(
    credentials_file="/path/to/credentials.json",
    api_endpoint="vision.googleapis.com",
    timeout=(10, 30),
    enable_logging=True
)
print("Google Vision API client initialized.")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/ocr_processing/ocr_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_image_annotator_client</span><span class="p">(</span>
    <span class="n">credentials_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">api_endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vision.googleapis.com&quot;</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">enable_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts and returns a Google Vision API ImageAnnotatorClient with optional configuration.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        credentials_file (str): Path to the credentials JSON file. If None, uses the default environment variable.</span>
<span class="sd">        api_endpoint (str): Custom API endpoint for the Vision API. Default is the global endpoint.</span>
<span class="sd">        timeout (Tuple[int, int]): Connection and read timeouts in seconds. Default is (10, 30).</span>
<span class="sd">        enable_logging (bool): Enable detailed logging for debugging. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        vision.ImageAnnotatorClient: Configured Vision API client.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified credentials file is not found.</span>
<span class="sd">        Exception: For unexpected errors during client setup.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; client = start_image_annotator_client(</span>
<span class="sd">        &gt;&gt;&gt;     credentials_file=&quot;/path/to/credentials.json&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     api_endpoint=&quot;vision.googleapis.com&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     timeout=(10, 30),</span>
<span class="sd">        &gt;&gt;&gt;     enable_logging=True</span>
<span class="sd">        &gt;&gt;&gt; )</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Google Vision API client initialized.&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Set up credentials</span>
        <span class="k">if</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">credentials_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Credentials file &#39;</span><span class="si">{</span><span class="n">credentials_file</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span>
                <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">credentials_file</span>

        <span class="c1"># Configure client options</span>
        <span class="n">client_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;api_endpoint&quot;</span><span class="p">:</span> <span class="n">api_endpoint</span><span class="p">}</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">vision</span><span class="o">.</span><span class="n">ImageAnnotatorClient</span><span class="p">(</span><span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span><span class="p">)</span>

        <span class="c1"># Optionally enable logging</span>
        <span class="k">if</span> <span class="n">enable_logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vision API Client started with endpoint: </span><span class="si">{</span><span class="n">api_endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout settings: Connect=</span><span class="si">{</span><span class="n">timeout</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">s, Read=</span><span class="si">{</span><span class="n">timeout</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">client</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize ImageAnnotatorClient: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.openai_interface" class="doc doc-heading">
            <code>openai_interface</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.openai_interface.openai_interface" class="doc doc-heading">
            <code>openai_interface</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.DEBUG_DISPLAY_BUFFER" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEBUG_DISPLAY_BUFFER</span> <span class="o">=</span> <span class="mi">1000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.DEFAULT_MAX_BATCH_RETRY" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_MAX_BATCH_RETRY</span> <span class="o">=</span> <span class="mi">60</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.DEFAULT_MODEL_SETTINGS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_MODEL_SETTINGS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gpt-4o&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_tokens&#39;</span><span class="p">:</span> <span class="mi">16000</span><span class="p">,</span> <span class="s1">&#39;context_limit&#39;</span><span class="p">:</span> <span class="mi">128000</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span> <span class="s1">&#39;gpt-3.5-turbo&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_tokens&#39;</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span> <span class="s1">&#39;context_limit&#39;</span><span class="p">:</span> <span class="mi">16384</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span> <span class="s1">&#39;gpt-4o-mini&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_tokens&#39;</span><span class="p">:</span> <span class="mi">16000</span><span class="p">,</span> <span class="s1">&#39;context_limit&#39;</span><span class="p">:</span> <span class="mi">128000</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.MAX_BATCH_LIST" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">MAX_BATCH_LIST</span> <span class="o">=</span> <span class="mi">30</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.OPEN_AI_DEFAULT_MODEL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">OPEN_AI_DEFAULT_MODEL</span> <span class="o">=</span> <span class="s1">&#39;gpt-4o&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.open_ai_encoding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_ai_encoding</span> <span class="o">=</span> <span class="n">tiktoken</span><span class="o">.</span><span class="n">encoding_for_model</span><span class="p">(</span><span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.openai_interface.open_ai_model_settings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_ai_model_settings</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL_SETTINGS</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.openai_interface.openai_interface.ClientNotInitializedError" class="doc doc-heading">
            <code>ClientNotInitializedError</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Exception raised when the OpenAI client is not initialized.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ClientNotInitializedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception raised when the OpenAI client is not initialized.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.openai_interface.openai_interface.OpenAIClient" class="doc doc-heading">
            <code>OpenAIClient</code>


</h5>


    <div class="doc doc-contents ">


        <p>Singleton class for managing the OpenAI client.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OpenAIClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Singleton class for managing the OpenAI client.&quot;&quot;&quot;</span>

    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the OpenAI client.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or initialize the OpenAI client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            OpenAI: The singleton OpenAI client instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Load the .env file</span>
            <span class="n">load_dotenv</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">api_key</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">):</span>
                <span class="c1"># Initialize the singleton instance</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;API key not found. Set it in the .env file with the key &#39;OPENAI_API_KEY&#39;.&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">client</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.openai_interface.openai_interface.OpenAIClient.client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.openai_interface.openai_interface.OpenAIClient.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize the OpenAI client.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the OpenAI client.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.openai_interface.openai_interface.OpenAIClient.get_instance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_instance</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Get or initialize the OpenAI client.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>OpenAI</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The singleton OpenAI client instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get or initialize the OpenAI client.</span>

<span class="sd">    Returns:</span>
<span class="sd">        OpenAI: The singleton OpenAI client instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Load the .env file</span>
        <span class="n">load_dotenv</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">api_key</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">):</span>
            <span class="c1"># Initialize the singleton instance</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;API key not found. Set it in the .env file with the key &#39;OPENAI_API_KEY&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.create_jsonl_file_for_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_jsonl_file_for_batch</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">output_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_token_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a JSONL file for batch processing, with each request using the same system message, user messages,
and optional function schema for function calling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of message objects to be sent for completion.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path where the .jsonl file will be saved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to use (default is set globally).</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.openai_interface.openai_interface.OPEN_AI_DEFAULT_MODEL" href="#tnh_scholar.openai_interface.openai_interface.OPEN_AI_DEFAULT_MODEL">OPEN_AI_DEFAULT_MODEL</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>functions</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of function schemas to enable function calling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the generated .jsonl file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_jsonl_file_for_batch</span><span class="p">(</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">output_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_token_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">json_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a JSONL file for batch processing, with each request using the same system message, user messages,</span>
<span class="sd">    and optional function schema for function calling.</span>

<span class="sd">    Args:</span>
<span class="sd">        messages: List of message objects to be sent for completion.</span>
<span class="sd">        output_file_path (str): The path where the .jsonl file will be saved.</span>
<span class="sd">        model (str): The model to use (default is set globally).</span>
<span class="sd">        functions (list, optional): List of function schemas to enable function calling.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The path to the generated .jsonl file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">open_ai_model_settings</span>

    <span class="n">total_tokens</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">max_token_list</span><span class="p">:</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">open_ai_model_settings</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">]</span>
        <span class="n">message_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">max_token_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_tokens</span><span class="p">]</span> <span class="o">*</span> <span class="n">message_count</span>

    <span class="n">temperature</span> <span class="o">=</span> <span class="n">open_ai_model_settings</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
    <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">max_token_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">date_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m</span><span class="si">%d</span><span class="s2">%Y&quot;</span><span class="p">)</span>
        <span class="n">output_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;batch_requests_</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">.jsonl&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure the directory for the output file exists</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>

        <span class="c1"># get max_tokens</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_token_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">request_obj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;request-</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                <span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="n">max_tokens</span><span class="p">,</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">json_mode</span><span class="p">:</span>
            <span class="n">request_obj</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][</span><span class="s2">&quot;response_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json_object&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">tools</span><span class="p">:</span>
            <span class="n">request_obj</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">][</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># log first iteration only.</span>
            <span class="n">_log_batch_creation_info</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">request_obj</span><span class="p">,</span> <span class="n">total_tokens</span><span class="p">)</span>

        <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_obj</span><span class="p">)</span>

    <span class="c1"># Write requests to JSONL file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSONL file created at: </span><span class="si">{</span><span class="n">output_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_file_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.delete_api_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_api_files</span><span class="p">(</span><span class="n">cutoff_date</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Delete all files on OpenAI's storage older than a given date at midnight.</p>
<p>Parameters:
- cutoff_date (datetime): The cutoff date. Files older than this date will be deleted.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_api_files</span><span class="p">(</span><span class="n">cutoff_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete all files on OpenAI&#39;s storage older than a given date at midnight.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - cutoff_date (datetime): The cutoff date. Files older than this date will be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set the OpenAI API key</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="c1"># Get a list of all files</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="c1"># Parse the file creation timestamp</span>
        <span class="n">file_created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
        <span class="c1"># Check if the file is older than the cutoff date</span>
        <span class="k">if</span> <span class="n">file_created_at</span> <span class="o">&lt;</span> <span class="n">cutoff_date</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Delete the file</span>
                <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted file: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> (created on </span><span class="si">{</span><span class="n">file_created_at</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete file </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.generate_messages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_messages</span><span class="p">(</span><span class="n">system_message</span><span class="p">,</span> <span class="n">user_message_wrapper</span><span class="p">,</span> <span class="n">data_list_to_process</span><span class="p">,</span> <span class="n">log_system_message</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_messages</span><span class="p">(</span>
    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_message_wrapper</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
    <span class="n">data_list_to_process</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">log_system_message</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data_element</span> <span class="ow">in</span> <span class="n">data_list_to_process</span><span class="p">:</span>
        <span class="n">message_block</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_message</span><span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">user_message_wrapper</span><span class="p">(</span><span class="n">data_element</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">]</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message_block</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">messages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_active_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_active_batches</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieve the list of active batches using the OpenAI API.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_active_batches</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the list of active batches using the OpenAI API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">MAX_BATCH_LIST</span><span class="p">)</span>
        <span class="n">batch_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;in_progress&quot;</span><span class="p">:</span>
                <span class="n">batch_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                    <span class="c1"># Add other relevant attributes as needed</span>
                <span class="p">}</span>
                <span class="n">batch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">batch_list</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching active batches: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_all_batch_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_batch_info</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieve the list of batches up to MAX_BATCH_LIST using the OpenAI API.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_batch_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the list of batches up to MAX_BATCH_LIST using the OpenAI API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">MAX_BATCH_LIST</span><span class="p">)</span>
        <span class="n">batch_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="n">batch_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                <span class="s2">&quot;output_file_id&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">output_file_id</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                <span class="c1"># Add other relevant attributes as needed</span>
            <span class="p">}</span>
            <span class="n">batch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">batch_list</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching active batches: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_api_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_api_client</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_api_client</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">OpenAIClient</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_batch_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_batch_response</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieves the status of a batch job and returns the result if completed.
Parses the JSON result file, collects the output messages,
and returns them as a Python list.</p>
<p>Args:
- batch_id : The batch_id string to retrieve status and results for.</p>
<p>Returns:
- If completed: A list containing the message content for each response of the batch process.
- If not completed: A string with the batch status.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_batch_response</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the status of a batch job and returns the result if completed.</span>
<span class="sd">    Parses the JSON result file, collects the output messages,</span>
<span class="sd">    and returns them as a Python list.</span>

<span class="sd">    Args:</span>
<span class="sd">    - batch_id : The batch_id string to retrieve status and results for.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - If completed: A list containing the message content for each response of the batch process.</span>
<span class="sd">    - If not completed: A string with the batch status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="c1"># Check the batch status</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch status for </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span>

    <span class="c1"># Retrieve the output file contents</span>
    <span class="n">file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">file_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span>

    <span class="c1"># Parse the JSON lines in the output file</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>  <span class="c1"># Parse each line as JSON</span>
        <span class="k">if</span> <span class="n">response_body</span> <span class="o">:=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">response_body</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_batch_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="n">batch</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_completed_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_completed_batches</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieve the list of active batches using the OpenAI API.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_completed_batches</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the list of active batches using the OpenAI API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">MAX_BATCH_LIST</span><span class="p">)</span>
        <span class="n">batch_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                <span class="n">batch_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                    <span class="s2">&quot;output_file_id&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">output_file_id</span><span class="p">,</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                    <span class="c1"># Add other relevant attributes as needed</span>
                <span class="p">}</span>
                <span class="n">batch_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">batch_list</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching active batches: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_completion_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_completion_content</span><span class="p">(</span><span class="n">chat_completion</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_completion_content</span><span class="p">(</span><span class="n">chat_completion</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chat_completion</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_completion_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_completion_object</span><span class="p">(</span><span class="n">chat_completion</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_completion_object</span><span class="p">(</span><span class="n">chat_completion</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chat_completion</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">parsed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_last_batch_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_last_batch_response</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_last_batch_response</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">MAX_BATCH_LIST</span>
    <span class="n">completed</span> <span class="o">=</span> <span class="n">get_completed_batches</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">get_batch_response</span><span class="p">(</span><span class="n">completed</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.get_model_settings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_model_settings</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_model_settings</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">open_ai_model_settings</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.poll_batch_for_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">poll_batch_for_response</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">max_interval</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Poll the batch status until it completes, fails, or expires.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the batch to poll.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial time (in seconds) to wait between polls. Default is 10 seconds.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum duration (in seconds) to poll before timing out. Use 1 hour as default.</p>
              </div>
            </td>
            <td>
                  <code>3600</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backoff_factor</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Factor by which the interval increases after each poll.</p>
              </div>
            </td>
            <td>
                  <code>1.3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_interval</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum polling interval in seconds.</p>
              </div>
            </td>
            <td>
                  <code>600</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>bool | list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The batch response if successful.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool | list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns False if the batch fails, times out, or expires.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the batch ID is not found or if an unexpected error occurs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">poll_batch_for_response</span><span class="p">(</span>
    <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="n">backoff_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span>
    <span class="n">max_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Poll the batch status until it completes, fails, or expires.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch_id (str): The ID of the batch to poll.</span>
<span class="sd">        interval (int): Initial time (in seconds) to wait between polls. Default is 10 seconds.</span>
<span class="sd">        timeout (int): Maximum duration (in seconds) to poll before timing out. Use 1 hour as default.</span>
<span class="sd">        backoff_factor (int): Factor by which the interval increases after each poll.</span>
<span class="sd">        max_interval (int): Maximum polling interval in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The batch response if successful.</span>
<span class="sd">        bool: Returns False if the batch fails, times out, or expires.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the batch ID is not found or if an unexpected error occurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polling batch status for batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>

    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="c1"># Check for timeout</span>
            <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Polling timed out after </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds for batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Get batch status</span>
            <span class="n">batch_status</span> <span class="o">=</span> <span class="n">get_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> status: </span><span class="si">{</span><span class="n">batch_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_status</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> not found or invalid response from `get_batch_status`.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Handle completed batch</span>
            <span class="k">if</span> <span class="n">batch_status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Batch processing for ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> completed successfully.&quot;</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">get_batch_response</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error retrieving response for batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to retrieve response for batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="c1"># Handle failed batch</span>
            <span class="k">elif</span> <span class="n">batch_status</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch processing for ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> failed.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Log ongoing status and adjust interval</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Batch status: </span><span class="si">{</span><span class="n">batch_status</span><span class="si">}</span><span class="s2">. Retrying in </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> seconds...&quot;</span>
            <span class="p">)</span>
            <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">interval</span> <span class="o">*</span> <span class="n">backoff_factor</span><span class="p">),</span> <span class="n">max_interval</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected error while polling batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during polling for batch ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.run_immediate_chat_process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_immediate_chat_process</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_immediate_chat_process</span><span class="p">(</span>
    <span class="n">messages</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">OPEN_AI_DEFAULT_MODEL</span>
<span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="n">max_model_tokens</span> <span class="o">=</span> <span class="n">open_ai_model_settings</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_model_tokens</span>

    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">&gt;</span> <span class="n">max_model_tokens</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Maximum token request exceeded: </span><span class="si">{max_tokens}</span><span class="s2"> for model: </span><span class="si">{model}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting max_tokens to model maximum: </span><span class="si">{</span><span class="n">max_model_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_model_tokens</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">client</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
                <span class="n">max_completion_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response_format</span>
            <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">max_completion_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running immediate chat: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.run_immediate_completion_simple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_immediate_completion_simple</span><span class="p">(</span><span class="n">system_message</span><span class="p">,</span> <span class="n">user_message</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Runs a single chat completion with a system message and user message.</p>
<p>This function simplifies the process of running a single chat completion with the OpenAI API by handling
model selection, token limits, and logging. It allows for specifying a response format and handles potential
<code>ValueError</code> exceptions during the API call.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The system message to guide the conversation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's message as input for the chat completion.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenAI model to use. Defaults to None, which uses the default model.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_tokens</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of tokens for the completion. Defaults to 0, which uses the model's maximum.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>response_format</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired response format. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpenAIObject | None: The chat completion response if successful, or None if a <code>ValueError</code> occurs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if max_tokens exceeds the model's maximum token limit.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_immediate_completion_simple</span><span class="p">(</span>
    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">response_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs a single chat completion with a system message and user message.</span>

<span class="sd">    This function simplifies the process of running a single chat completion with the OpenAI API by handling</span>
<span class="sd">    model selection, token limits, and logging. It allows for specifying a response format and handles potential</span>
<span class="sd">    `ValueError` exceptions during the API call.</span>

<span class="sd">    Args:</span>
<span class="sd">        system_message (str): The system message to guide the conversation.</span>
<span class="sd">        user_message (str): The user&#39;s message as input for the chat completion.</span>
<span class="sd">        model (str, optional): The OpenAI model to use. Defaults to None, which uses the default model.</span>
<span class="sd">        max_tokens (int, optional): The maximum number of tokens for the completion. Defaults to 0, which uses the model&#39;s maximum.</span>
<span class="sd">        response_format (dict, optional): The desired response format. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        OpenAIObject | None: The chat completion response if successful, or None if a `ValueError` occurs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if max_tokens exceeds the model&#39;s maximum token limit.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">OPEN_AI_DEFAULT_MODEL</span>

    <span class="n">max_model_tokens</span> <span class="o">=</span> <span class="n">open_ai_model_settings</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_model_tokens</span>

    <span class="k">if</span> <span class="n">max_tokens</span> <span class="o">&gt;</span> <span class="n">max_model_tokens</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Maximum token request exceeded: </span><span class="si">{max_tokens}</span><span class="s2"> for model: </span><span class="si">{model}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting max_tokens to model maximum: </span><span class="si">{</span><span class="n">max_model_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">max_model_tokens</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User message content:</span><span class="se">\n</span><span class="si">{</span><span class="n">user_message</span><span class="p">[:</span><span class="n">DEBUG_DISPLAY_BUFFER</span><span class="p">]</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
    <span class="n">message_block</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_message</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">user_message</span><span class="p">},</span>
    <span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Starting chat completion with response_format=</span><span class="si">{</span><span class="n">response_format</span><span class="si">}</span><span class="s2"> and max_tokens=</span><span class="si">{</span><span class="n">max_tokens</span><span class="si">}</span><span class="s2">...&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">client</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">message_block</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
                <span class="n">max_completion_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response_format</span>
            <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">message_block</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">max_completion_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value Error running immediate chat: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.run_single_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_single_batch</span><span class="p">(</span><span class="n">user_prompts</span><span class="p">,</span> <span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_token_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generate a batch file for the OpenAI (OA) API and send it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>system_message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System message template for batch processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_wrap_function</code>
            </td>
            <td>
                  <code>callable</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to wrap user input for processing pages.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created batch file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an error occurs during file processing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_single_batch</span><span class="p">(</span>
    <span class="n">user_prompts</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_wrap_function</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_token_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a batch file for the OpenAI (OA) API and send it.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        system_message (str): System message template for batch processing.</span>
<span class="sd">        user_wrap_function (callable): Function to wrap user input for processing pages.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created batch file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If an error occurs during file processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">max_token_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_token_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_wrap_function</span><span class="p">:</span>
            <span class="n">user_wrap_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

        <span class="c1"># Generate messages for the pages</span>
        <span class="n">batch_message_seq</span> <span class="o">=</span> <span class="n">generate_messages</span><span class="p">(</span>
            <span class="n">system_message</span><span class="p">,</span> <span class="n">user_wrap_function</span><span class="p">,</span> <span class="n">user_prompts</span>
        <span class="p">)</span>

        <span class="n">batch_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./temp_batch_run.jsonl&quot;</span><span class="p">)</span>

        <span class="c1"># Save the batch file</span>
        <span class="n">create_jsonl_file_for_batch</span><span class="p">(</span>
            <span class="n">batch_message_seq</span><span class="p">,</span> <span class="n">batch_file</span><span class="p">,</span> <span class="n">max_token_list</span><span class="o">=</span><span class="n">max_token_list</span>
        <span class="p">)</span>
        <span class="c1"># logger.info(f&quot;Batch file created successfully: {output_file}&quot;)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while creating immediate batch file </span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">description</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Single batch process: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">response_list</span> <span class="o">=</span> <span class="n">start_batch_with_retries</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to complete batch process: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">return</span> <span class="n">response_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.run_transcription_speech" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_transcription_speech</span><span class="p">(</span><span class="n">audio_file</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="s1">&#39;verbose_json&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;transcribe&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_transcription_speech</span><span class="p">(</span>
    <span class="n">audio_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OPEN_AI_DEFAULT_MODEL</span><span class="p">,</span>
    <span class="n">response_format</span><span class="o">=</span><span class="s2">&quot;verbose_json&quot;</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;transcribe&quot;</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># mode can be &quot;transcribe&quot; or &quot;translate&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;transcribe&quot;</span><span class="p">:</span>
            <span class="n">transcript</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">transcriptions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;translate&quot;</span><span class="p">:</span>
            <span class="n">transcript</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">translations</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">, in speech transcription generation.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;translate&#39; or &#39;transcribe&#39; expected, not </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transcript</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.set_model_settings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_model_settings</span><span class="p">(</span><span class="n">model_settings_dict</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_model_settings</span><span class="p">(</span><span class="n">model_settings_dict</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">open_ai_model_settings</span>
    <span class="n">open_ai_model_settings</span> <span class="o">=</span> <span class="n">model_settings_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.start_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_batch</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Starts a batch process using OpenAI's client with an optional description and JSONL batch file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>jsonl_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the .jsonl batch file to be used as input. Must be a pathlib.Path object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A description for metadata to label the batch job.
                         If None, a default description is generated with the
                         current date-time and file name.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the batch object if successful, or an error message if failed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>jsonl_file = Path("batch_requests.jsonl")
start_batch(jsonl_file)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_batch</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts a batch process using OpenAI&#39;s client with an optional description and JSONL batch file.</span>

<span class="sd">    Args:</span>
<span class="sd">        jsonl_file (Path): Path to the .jsonl batch file to be used as input. Must be a pathlib.Path object.</span>
<span class="sd">        description (str, optional): A description for metadata to label the batch job.</span>
<span class="sd">                                     If None, a default description is generated with the</span>
<span class="sd">                                     current date-time and file name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the batch object if successful, or an error message if failed.</span>

<span class="sd">    Example:</span>
<span class="sd">        jsonl_file = Path(&quot;batch_requests.jsonl&quot;)</span>
<span class="sd">        start_batch(jsonl_file)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The &#39;jsonl_file&#39; argument must be a pathlib.Path object.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">jsonl_file</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

    <span class="n">basename</span> <span class="o">=</span> <span class="n">jsonl_file</span><span class="o">.</span><span class="n">stem</span>

    <span class="c1"># Generate description:</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S %Z&quot;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">jsonl_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Attempt to create the input file for the batch process</span>
        <span class="k">with</span> <span class="n">jsonl_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>
        <span class="n">batch_input_file_id</span> <span class="o">=</span> <span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;File upload failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Attempt to create the batch with specified input file and metadata description</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file_id</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
            <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span> <span class="s2">&quot;basename&quot;</span><span class="p">:</span> <span class="n">basename</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># log the batch</span>
        <span class="n">_log_batch_start_info</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">batch</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch creation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.start_batch_with_retries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_batch_with_retries</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="n">DEFAULT_MAX_BATCH_RETRY</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Starts a batch with retries and polls for its completion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>jsonl_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSONL file for batch input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A description for the batch job (optional).</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of retries to start and complete the batch (default: 3).</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.openai_interface.openai_interface.DEFAULT_MAX_BATCH_RETRY" href="#tnh_scholar.openai_interface.openai_interface.DEFAULT_MAX_BATCH_RETRY">DEFAULT_MAX_BATCH_RETRY</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retry_delay</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Delay in seconds between retries (default: 60).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>poll_interval</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval in seconds for polling batch status (default: 10).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeout in seconds for polling (default: 23 hours).</p>
              </div>
            </td>
            <td>
                  <code>3600</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The batch response if completed successfully.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the batch fails after all retries or encounters an error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_batch_with_retries</span><span class="p">(</span>
    <span class="n">jsonl_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_BATCH_RETRY</span><span class="p">,</span>
    <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts a batch with retries and polls for its completion.</span>

<span class="sd">    Args:</span>
<span class="sd">        jsonl_file (Path): Path to the JSONL file for batch input.</span>
<span class="sd">        description (str): A description for the batch job (optional).</span>
<span class="sd">        max_retries (int): Maximum number of retries to start and complete the batch (default: 3).</span>
<span class="sd">        retry_delay (int): Delay in seconds between retries (default: 60).</span>
<span class="sd">        poll_interval (int): Interval in seconds for polling batch status (default: 10).</span>
<span class="sd">        timeout (int): Timeout in seconds for polling (default: 23 hours).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The batch response if completed successfully.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the batch fails after all retries or encounters an error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Start the batch</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">start_batch</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span> <span class="ow">or</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to start batch: </span><span class="si">{</span><span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">batch_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">id</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Batch started but no ID was returned.&quot;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Batch started: attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;batch_id&quot;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># Poll for batch completion</span>
            <span class="n">response_list</span> <span class="o">=</span> <span class="n">poll_batch_for_response</span><span class="p">(</span>
                <span class="n">batch_id</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">poll_interval</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
            <span class="p">)</span>

            <span class="c1"># Check for a response</span>
            <span class="k">if</span> <span class="n">response_list</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Batch completed successfully after </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> attempts.&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;batch_id&quot;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">},</span>
                <span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># exit for loop</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># No response means batch failed. Retry.</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed. Retrying batch process in </span><span class="si">{</span><span class="n">retry_delay</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;attempt&quot;</span><span class="p">:</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="n">max_retries</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Batch start and polling failed on attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;attempt&quot;</span><span class="p">:</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># else the loop completed before succesful result</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to complete batch after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> retries.&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error: Failed to complete batch after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> retries.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">response_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.token_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_count</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_count</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">open_ai_encoding</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.openai_interface.token_count_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_count_file</span><span class="p">(</span><span class="n">text_file</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/openai_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_count_file</span><span class="p">(</span><span class="n">text_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">text_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">token_count</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.openai_interface.run_oa_batch_jobs" class="doc doc-heading">
            <code>run_oa_batch_jobs</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.BATCH_JOB_PATH" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BATCH_JOB_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;UNSET&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.CHECK_INTERVAL_SECONDS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">CHECK_INTERVAL_SECONDS</span> <span class="o">=</span> <span class="mi">60</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.ENQUEUED_BATCH_TOKEN_LIMIT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ENQUEUED_BATCH_TOKEN_LIMIT</span> <span class="o">=</span> <span class="mi">90000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.enqueued_tokens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enqueued_tokens</span> <span class="o">=</span> <span class="mi">0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.sent_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sent_batches</span> <span class="o">=</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.calculate_enqueued_tokens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_enqueued_tokens</span><span class="p">(</span><span class="n">active_batches</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Calculate the total number of enqueued tokens from active batches.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_enqueued_tokens</span><span class="p">(</span><span class="n">active_batches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the total number of enqueued tokens from active batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_tokens</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">active_batches</span><span class="p">:</span>
        <span class="n">total_tokens</span> <span class="o">+=</span> <span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input_tokens&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.download_batch_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_batch_result</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Download the result of a completed batch.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_batch_result</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download the result of a completed batch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/v1/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;batch_results_</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> completed. Result saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error downloading result for batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.get_active_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_active_batches</span><span class="p">(</span><span class="n">client</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieve the list of active batches using the OpenAI API.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_active_batches</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the list of active batches using the OpenAI API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/v1/batches&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching active batches: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Main function to manage and monitor batch jobs.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to manage and monitor batch jobs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">enqueued_tokens</span><span class="p">,</span> <span class="n">sent_batches</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">set_api_client</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to initialize API client. Exiting.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">batch_file_directory</span> <span class="o">=</span> <span class="s2">&quot;./journal_cleaning_batches&quot;</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Poll for completed batches</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Polling for completed batches...&quot;</span><span class="p">)</span>
        <span class="n">poll_batches</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="c1"># Calculate remaining tokens</span>
        <span class="n">remaining_tokens</span> <span class="o">=</span> <span class="n">ENQUEUED_BATCH_TOKEN_LIMIT</span> <span class="o">-</span> <span class="n">enqueued_tokens</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remaining tokens: </span><span class="si">{</span><span class="n">remaining_tokens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Enqueue new batches if there&#39;s space</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing batch files...&quot;</span><span class="p">)</span>
        <span class="n">process_batch_files</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_file_directory</span><span class="p">,</span> <span class="n">remaining_tokens</span><span class="p">)</span>

        <span class="c1"># Wait for the next polling cycle</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="n">CHECK_INTERVAL_SECONDS</span><span class="si">}</span><span class="s2"> seconds before next check...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CHECK_INTERVAL_SECONDS</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.poll_batches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">poll_batches</span><span class="p">(</span><span class="n">client</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Poll for completed batches and update global enqueued_tokens.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">poll_batches</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Poll for completed batches and update global enqueued_tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">enqueued_tokens</span><span class="p">,</span> <span class="n">sent_batches</span>
    <span class="n">completed_batches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">batch_id</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">sent_batches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/v1/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                <span class="n">download_batch_result</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">)</span>
                <span class="n">enqueued_tokens</span> <span class="o">-=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;token_size&quot;</span><span class="p">]</span>
                <span class="n">completed_batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> failed. Removing from tracking.&quot;</span><span class="p">)</span>
                <span class="n">enqueued_tokens</span> <span class="o">-=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;token_size&quot;</span><span class="p">]</span>
                <span class="n">completed_batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking status for batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Remove completed batches from sent_batches</span>
    <span class="k">for</span> <span class="n">batch_id</span> <span class="ow">in</span> <span class="n">completed_batches</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">sent_batches</span><span class="p">[</span><span class="n">batch_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.openai_interface.run_oa_batch_jobs.process_batch_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_batch_files</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_file_directory</span><span class="p">,</span> <span class="n">remaining_tokens</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Process batch files in the batch job directory, enqueue new batches if space permits.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/openai_interface/run_oa_batch_jobs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_batch_files</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_file_directory</span><span class="p">,</span> <span class="n">remaining_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process batch files in the batch job directory, enqueue new batches if space permits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">enqueued_tokens</span><span class="p">,</span> <span class="n">sent_batches</span>
    <span class="n">batch_info</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">path_obj</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">batch_file_directory</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^.*\.jsonl$&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_obj</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">path_obj</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">batch_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">batch_file_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">path_obj</span><span class="o">.</span><span class="n">name</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found batch file: </span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Calculate the token count for this batch</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">batch_tokens</span> <span class="o">=</span> <span class="n">token_count</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to calculate token count for </span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Enqueue batch if there&#39;s space</span>
            <span class="k">if</span> <span class="n">batch_tokens</span> <span class="o">&lt;=</span> <span class="n">remaining_tokens</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">batch</span> <span class="o">=</span> <span class="n">start_batch</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">batch_file</span><span class="p">)</span>
                    <span class="n">sent_batches</span><span class="p">[</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;batch&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="p">,</span>
                        <span class="s2">&quot;token_size&quot;</span><span class="p">:</span> <span class="n">batch_tokens</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">enqueued_tokens</span> <span class="o">+=</span> <span class="n">batch_tokens</span>
                    <span class="n">remaining_tokens</span> <span class="o">-=</span> <span class="n">batch_tokens</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch enqueued: </span><span class="si">{</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to enqueue batch </span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient token space for </span><span class="si">{</span><span class="n">batch_file</span><span class="si">}</span><span class="s2">. Skipping.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.text_processing" class="doc doc-heading">
            <code>text_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tnh_scholar.text_processing.FormattingError" class="doc doc-heading">
            <code>FormattingError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Custom exception raised for formatting-related errors.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FormattingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom exception raised for formatting-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.FormattingError.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;An error occurred due to invalid formatting.&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.bracket_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">bracket_lines</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.bracket_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <pre><code>Encloses each line of the input text with angle brackets.
If number is True, adds a line number followed by a colon `:` and then the line.

Args:
    text (str): The input string containing lines separated by '
</code></pre>
<p>'.
        number (bool): Whether to prepend line numbers to each line.</p>
<pre><code>Returns:
    str: A string where each line is enclosed in angle brackets.

Examples:
    &gt;&gt;&gt; bracket_lines("This is a string with
</code></pre>
<p>two lines.")
        '<This is a string with>
&lt;   two lines.&gt;'</p>
<pre><code>    &gt;&gt;&gt; bracket_lines("This is a string with
</code></pre>
<p>two lines.", number=True)
        '&lt;1:This is a string with&gt;
&lt;2:   two lines.&gt;'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encloses each line of the input text with angle brackets.</span>
<span class="sd">    If number is True, adds a line number followed by a colon `:` and then the line.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input string containing lines separated by &#39;\n&#39;.</span>
<span class="sd">        number (bool): Whether to prepend line numbers to each line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string where each line is enclosed in angle brackets.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; bracket_lines(&quot;This is a string with\n   two lines.&quot;)</span>
<span class="sd">        &#39;&lt;This is a string with&gt;\n&lt;   two lines.&gt;&#39;</span>

<span class="sd">        &gt;&gt;&gt; bracket_lines(&quot;This is a string with\n   two lines.&quot;, number=True)</span>
<span class="sd">        &#39;&lt;1:This is a string with&gt;\n&lt;2:   two lines.&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">line</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.clean_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Cleans a given text by replacing specific unwanted characters such as
tab, and non-breaking spaces with regular spaces.</p>
<p>This function takes a string as input and applies replacements
based on a predefined mapping of characters to replace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to be cleaned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned text with unwanted characters replaced by spaces.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>text = "This is\n an example\ttext with\xa0extra spaces."
clean_text(text)
'This is an example text with extra spaces.'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans a given text by replacing specific unwanted characters such as</span>
<span class="sd">    tab, and non-breaking spaces with regular spaces.</span>

<span class="sd">    This function takes a string as input and applies replacements</span>
<span class="sd">    based on a predefined mapping of characters to replace.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The text to be cleaned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The cleaned text with unwanted characters replaced by spaces.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;This is\\n an example\\ttext with\\xa0extra spaces.&quot;</span>
<span class="sd">        &gt;&gt;&gt; clean_text(text)</span>
<span class="sd">        &#39;This is an example text with extra spaces.&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define a mapping of characters to replace</span>
    <span class="n">replace_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>  <span class="c1"># Replace tabs with space</span>
        <span class="s2">&quot;</span><span class="se">\xa0</span><span class="s2">&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>  <span class="c1"># Replace non-breaking space with regular space</span>
        <span class="c1"># Add more replacements as needed</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">newline</span><span class="p">:</span>
        <span class="n">replace_map</span><span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># remove newlines</span>

    <span class="c1"># Loop through the replace map and replace each character</span>
    <span class="k">for</span> <span class="n">old_char</span><span class="p">,</span> <span class="n">new_char</span> <span class="ow">in</span> <span class="n">replace_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_char</span><span class="p">,</span> <span class="n">new_char</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Ensure any leading/trailing spaces are removed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.extract_tags_by_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_tags_by_attributes</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tags_with_attributes</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extract specified tags and their attributes from a BeautifulSoup object.</p>
<p>This function allows you to search for multiple tags and their respective attributes
within an HTML document parsed by BeautifulSoup. The result is a dictionary where
each key is a tuple <code>(tag, attribute_values)</code> representing the tag name and the
attributes used to search for that tag. The corresponding value is a list of the
matching tags found in the soup object.</p>
<h6 id="tnh_scholar.text_processing.extract_tags_by_attributes--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content from which tags will be extracted.</p>


<details class="tags_with_attributes-" open>
  <summary>dict</summary>
  <p>A dictionary where keys are the tag names (e.g., 'p', 'span') and values are
attribute dictionaries that filter the tags. For example, {'p': {}, 'span': {'class': 'italic'}}.
- To search for a tag without any attribute filters, provide an empty dictionary <code>{}</code>.</p>
</details>        <h6 id="tnh_scholar.text_processing.extract_tags_by_attributes--returns">Returns:</h6>
<p>dict
    A dictionary where each key is a tuple <code>(tag, attribute_values)</code>:
        - <code>tag</code>: The HTML tag name (e.g., 'p', 'span').
        - <code>attribute_values</code>: A tuple of key-value pairs representing the tag's attributes (e.g., <code>(('class', 'italic'),)</code>).
          If no attributes were specified, the tuple will be empty <code>()</code>.
    The corresponding value is a list of BeautifulSoup tag elements that matched the search criteria.</p>
<h6 id="tnh_scholar.text_processing.extract_tags_by_attributes--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<p>This is a paragraph.</p><span class="italic">Italic text</span>', 'html.parser')
tags_to_find = {'p': {}, 'span': {'class': 'italic'}}
extracted = extract_tags_by_attributes(soup, tags_to_find)
for (tag, attributes), matches in extracted.items():
    print(f"Found {len(matches)} {tag} tags with attributes {attributes}.")</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.extract_tags_by_attributes--example-output">Example Output:</h6>
<p>Found 1 p tags with attributes ().
Found 1 span tags with attributes (('class', 'italic'),).</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_tags_by_attributes</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tags_with_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">BeautifulSoup</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract specified tags and their attributes from a BeautifulSoup object.</span>

<span class="sd">    This function allows you to search for multiple tags and their respective attributes</span>
<span class="sd">    within an HTML document parsed by BeautifulSoup. The result is a dictionary where</span>
<span class="sd">    each key is a tuple `(tag, attribute_values)` representing the tag name and the</span>
<span class="sd">    attributes used to search for that tag. The corresponding value is a list of the</span>
<span class="sd">    matching tags found in the soup object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content from which tags will be extracted.</span>

<span class="sd">    tags_with_attributes : dict</span>
<span class="sd">        A dictionary where keys are the tag names (e.g., &#39;p&#39;, &#39;span&#39;) and values are</span>
<span class="sd">        attribute dictionaries that filter the tags. For example, {&#39;p&#39;: {}, &#39;span&#39;: {&#39;class&#39;: &#39;italic&#39;}}.</span>
<span class="sd">        - To search for a tag without any attribute filters, provide an empty dictionary `{}`.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where each key is a tuple `(tag, attribute_values)`:</span>
<span class="sd">            - `tag`: The HTML tag name (e.g., &#39;p&#39;, &#39;span&#39;).</span>
<span class="sd">            - `attribute_values`: A tuple of key-value pairs representing the tag&#39;s attributes (e.g., `((&#39;class&#39;, &#39;italic&#39;),)`).</span>
<span class="sd">              If no attributes were specified, the tuple will be empty `()`.</span>
<span class="sd">        The corresponding value is a list of BeautifulSoup tag elements that matched the search criteria.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;p&gt;This is a paragraph.&lt;/p&gt;&lt;span class=&quot;italic&quot;&gt;Italic text&lt;/span&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tags_to_find = {&#39;p&#39;: {}, &#39;span&#39;: {&#39;class&#39;: &#39;italic&#39;}}</span>
<span class="sd">    &gt;&gt;&gt; extracted = extract_tags_by_attributes(soup, tags_to_find)</span>
<span class="sd">    &gt;&gt;&gt; for (tag, attributes), matches in extracted.items():</span>
<span class="sd">    &gt;&gt;&gt;     print(f&quot;Found {len(matches)} {tag} tags with attributes {attributes}.&quot;)</span>

<span class="sd">    Example Output:</span>
<span class="sd">    ---------------</span>
<span class="sd">    Found 1 p tags with attributes ().</span>
<span class="sd">    Found 1 span tags with attributes ((&#39;class&#39;, &#39;italic&#39;),).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">extracted_tags</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Loop over each tag and attribute specification</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">in</span> <span class="n">tags_with_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Use find_all to search for tags with the specified attributes</span>
        <span class="n">matching_tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Store results using (tag, attribute_values) as key</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">extracted_tags</span><span class="p">[(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="n">matching_tags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No attributes; use an empty tuple for the key</span>
            <span class="n">extracted_tags</span><span class="p">[(</span><span class="n">tag</span><span class="p">,</span> <span class="p">())]</span> <span class="o">=</span> <span class="n">matching_tags</span>

    <span class="k">return</span> <span class="n">extracted_tags</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.generate_reduced_text_soup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_reduced_text_soup</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a copy of a BeautifulSoup object and truncates the text content of all NavigableString
elements in the copied BeautifulSoup object to the first five words, appending ellipses ("...")
if the text contains more than five words. The function returns a new BeautifulSoup object,
leaving the original unmodified.</p>
<h6 id="tnh_scholar.text_processing.generate_reduced_text_soup--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    A BeautifulSoup object representing the parsed HTML or XML content.</p>
<h6 id="tnh_scholar.text_processing.generate_reduced_text_soup--returns">Returns:</h6>
<p>BeautifulSoup
    A new BeautifulSoup object with truncated text.</p>
<h6 id="tnh_scholar.text_processing.generate_reduced_text_soup--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<p>This is a paragraph with more than five words.</p>"
soup = BeautifulSoup(html_content, 'html.parser')
result = reduce_tags_and_text(soup)
print(result.prettify())</p>
</blockquote>
</blockquote>
</blockquote>
<p>This is a paragraph with ...</p>

<h6 id="tnh_scholar.text_processing.generate_reduced_text_soup--notes">Notes:</h6>
<ul>
<li>Only NavigableString elements (text nodes) are truncated. HTML tags and structure remain unchanged.</li>
<li>The function does not remove or alter tags but only modifies the text within the tags.</li>
<li>The original BeautifulSoup object is left unchanged.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_reduced_text_soup</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeautifulSoup</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a copy of a BeautifulSoup object and truncates the text content of all NavigableString</span>
<span class="sd">    elements in the copied BeautifulSoup object to the first five words, appending ellipses (&quot;...&quot;)</span>
<span class="sd">    if the text contains more than five words. The function returns a new BeautifulSoup object,</span>
<span class="sd">    leaving the original unmodified.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        A BeautifulSoup object representing the parsed HTML or XML content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    BeautifulSoup</span>
<span class="sd">        A new BeautifulSoup object with truncated text.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;p&gt;This is a paragraph with more than five words.&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; result = reduce_tags_and_text(soup)</span>
<span class="sd">    &gt;&gt;&gt; print(result.prettify())</span>
<span class="sd">    &lt;p&gt;This is a paragraph with ...&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Only NavigableString elements (text nodes) are truncated. HTML tags and structure remain unchanged.</span>
<span class="sd">    - The function does not remove or alter tags but only modifies the text within the tags.</span>
<span class="sd">    - The original BeautifulSoup object is left unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a deep copy of the soup object to avoid modifying the original</span>
    <span class="n">new_soup</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>

    <span class="c1"># Traverse through all elements in the copied soup, targeting text nodes</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">new_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
        <span class="n">string</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>  <span class="c1"># Find all NavigableString text nodes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">truncated_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
                <span class="c1"># Replace the text with the truncated version in the copied soup</span>
                <span class="n">element</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">truncated_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_soup</span>  <span class="c1"># Return the modified copy of the soup object</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.get_all_attribute_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_attribute_values</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extract all unique attribute-value pairs for a given HTML tag across the soup.</p>
<p>For each attribute of the specified tag, store a set of all unique values
found across all occurrences of that tag in the soup.</p>
<h6 id="tnh_scholar.text_processing.get_all_attribute_values--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content.</p>


<details class="tag-" open>
  <summary>str</summary>
  <p>The tag name to search for (e.g., 'span', 'div').</p>
</details>        <h6 id="tnh_scholar.text_processing.get_all_attribute_values--returns">Returns:</h6>
<p>dict[str, set[str]]
    A dictionary where keys are attribute names and values are sets of
    unique attribute values across all instances of the given tag.</p>
<h6 id="tnh_scholar.text_processing.get_all_attribute_values--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('''
... <p class="text" id="para1">Paragraph</p>
... <p class="text" id="para2" style="color:red;">Styled paragraph</p>
... <p class="highlight" id="para2" style="color:blue;">Another paragraph</p>''', 'html.parser')
get_all_attribute_values(soup, 'p')
{'class': {'text', 'highlight'}, 'id': {'para1', 'para2'}, 'style': {'color:red;', 'color:blue;'}}</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_attribute_values</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all unique attribute-value pairs for a given HTML tag across the soup.</span>

<span class="sd">    For each attribute of the specified tag, store a set of all unique values</span>
<span class="sd">    found across all occurrences of that tag in the soup.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content.</span>

<span class="sd">    tag : str</span>
<span class="sd">        The tag name to search for (e.g., &#39;span&#39;, &#39;div&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict[str, set[str]]</span>
<span class="sd">        A dictionary where keys are attribute names and values are sets of</span>
<span class="sd">        unique attribute values across all instances of the given tag.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&#39;&#39;</span>
<span class="sd">    ... &lt;p class=&quot;text&quot; id=&quot;para1&quot;&gt;Paragraph&lt;/p&gt;</span>
<span class="sd">    ... &lt;p class=&quot;text&quot; id=&quot;para2&quot; style=&quot;color:red;&quot;&gt;Styled paragraph&lt;/p&gt;</span>
<span class="sd">    ... &lt;p class=&quot;highlight&quot; id=&quot;para2&quot; style=&quot;color:blue;&quot;&gt;Another paragraph&lt;/p&gt;&#39;&#39;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_all_attribute_values(soup, &#39;p&#39;)</span>
<span class="sd">    {&#39;class&#39;: {&#39;text&#39;, &#39;highlight&#39;}, &#39;id&#39;: {&#39;para1&#39;, &#39;para2&#39;}, &#39;style&#39;: {&#39;color:red;&#39;, &#39;color:blue;&#39;}}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes_with_values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Find all instances of the specified tag</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="c1"># Loop through each attribute in the element&#39;s attributes</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Add the attribute to the dictionary if not already present</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes_with_values</span><span class="p">:</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="c1"># Check if the value is a list (e.g., class=&quot;class1 class2&quot;) and handle accordingly</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">value</span>
                <span class="p">)</span>  <span class="c1"># Add all elements from the list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Add a single value</span>

    <span class="k">return</span> <span class="n">attributes_with_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.get_all_tag_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_tag_names</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extract all unique HTML tag names from a BeautifulSoup object.</p>
<h6 id="tnh_scholar.text_processing.get_all_tag_names--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content.</p>
<h6 id="tnh_scholar.text_processing.get_all_tag_names--returns">Returns:</h6>
<p>list[str]
    A list of all unique tag names in the soup, without content.</p>
<h6 id="tnh_scholar.text_processing.get_all_tag_names--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<p>Paragraph</p><div><span>Text</span></div>', 'html.parser')
get_all_tag_names(soup)
['p', 'div', 'span']</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_tag_names</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all unique HTML tag names from a BeautifulSoup object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    list[str]</span>
<span class="sd">        A list of all unique tag names in the soup, without content.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;p&gt;Paragraph&lt;/p&gt;&lt;div&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/div&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_all_tag_names(soup)</span>
<span class="sd">    [&#39;p&#39;, &#39;div&#39;, &#39;span&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">({</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="kc">True</span><span class="p">)})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.lines_from_bracketed_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lines_from_bracketed_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">keep_brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <pre><code>Extracts lines from bracketed text between the start and end indices, inclusive.
Handles both numbered and non-numbered cases.

Args:
    text (str): The input bracketed text containing lines like &lt;...&gt;.
    start (int): The starting line number (1-based).
    end (int): The ending line number (1-based).

Returns:
    list[str]: The lines from start to end inclusive, with angle brackets removed.

Raises:
    FormattingError: If the text contains improperly formatted lines (missing angle brackets).
    ValueError: If start or end indices are invalid or out of bounds.

Examples:
    &gt;&gt;&gt; text = "&lt;1:Line 1&gt;
</code></pre>
<p>&lt;2:Line 2&gt;
&lt;3:Line 3&gt;"
        &gt;&gt;&gt; lines_from_bracketed_text(text, 1, 2)
        ['Line 1', 'Line 2']</p>
<pre><code>    &gt;&gt;&gt; text = "&lt;Line 1&gt;
</code></pre>
<p><Line 2>
<Line 3>"
        &gt;&gt;&gt; lines_from_bracketed_text(text, 2, 3)
        ['Line 2', 'Line 3']</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lines_from_bracketed_text</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">keep_brackets</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts lines from bracketed text between the start and end indices, inclusive.</span>
<span class="sd">    Handles both numbered and non-numbered cases.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input bracketed text containing lines like &lt;...&gt;.</span>
<span class="sd">        start (int): The starting line number (1-based).</span>
<span class="sd">        end (int): The ending line number (1-based).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: The lines from start to end inclusive, with angle brackets removed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FormattingError: If the text contains improperly formatted lines (missing angle brackets).</span>
<span class="sd">        ValueError: If start or end indices are invalid or out of bounds.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;&lt;1:Line 1&gt;\n&lt;2:Line 2&gt;\n&lt;3:Line 3&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; lines_from_bracketed_text(text, 1, 2)</span>
<span class="sd">        [&#39;Line 1&#39;, &#39;Line 2&#39;]</span>

<span class="sd">        &gt;&gt;&gt; text = &quot;&lt;Line 1&gt;\n&lt;Line 2&gt;\n&lt;Line 3&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; lines_from_bracketed_text(text, 2, 3)</span>
<span class="sd">        [&#39;Line 2&#39;, &#39;Line 3&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Split the text into lines</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="c1"># Validate indices</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid start or end indices for the given text: start:</span><span class="si">{start}</span><span class="s2">, end: </span><span class="si">{end}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Extract lines and validate formatting</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
            <span class="c1"># Check for proper bracketing and extract the content</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(\d+:)?(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid format for line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># Add the extracted content (group 2) to the result</span>
            <span class="k">if</span> <span class="n">keep_brackets</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.normalize_newlines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <pre><code>Normalize newline blocks in the input text by reducing consecutive newlines
to the specified number of newlines for consistent readability and formatting.

Parameters:
----------
text : str
    The input text containing inconsistent newline spacing.
spacing : int, optional
    The number of newlines to insert between lines. Defaults to 2.

Returns:
-------
str
    The text with consecutive newlines reduced to the specified number of newlines.

Example:
--------
&gt;&gt;&gt; raw_text = "Heading
</code></pre>
<p>Paragraph text 1
Paragraph text 2</p>
<p>"
    &gt;&gt;&gt; normalize_newlines(raw_text, spacing=2)
    'Heading</p>
<p>Paragraph text 1</p>
<p>Paragraph text 2</p>
<p>'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">spacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize newline blocks in the input text by reducing consecutive newlines</span>
<span class="sd">    to the specified number of newlines for consistent readability and formatting.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The input text containing inconsistent newline spacing.</span>
<span class="sd">    spacing : int, optional</span>
<span class="sd">        The number of newlines to insert between lines. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The text with consecutive newlines reduced to the specified number of newlines.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; raw_text = &quot;Heading\n\n\nParagraph text 1\nParagraph text 2\n\n\n&quot;</span>
<span class="sd">    &gt;&gt;&gt; normalize_newlines(raw_text, spacing=2)</span>
<span class="sd">    &#39;Heading\n\nParagraph text 1\n\nParagraph text 2\n\n&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace one or more newlines with the desired number of newlines</span>
    <span class="n">newlines</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n{1,}&quot;</span><span class="p">,</span> <span class="n">newlines</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.normalize_quotes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_quotes</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Transforms all smart quotes in the input text to standard straight quotes.</p>
<p>This function replaces both single and double smart quotes (Unicode) with
their standard straight quote counterparts. Specifically, it:</p>
<ul>
<li>Converts left and right single smart quotes (‘ and ’) to ASCII single quote (').</li>
<li>Converts left and right double smart quotes (“ and ”) to ASCII double quote (").</li>
</ul>
<h6 id="tnh_scholar.text_processing.normalize_quotes--parameters">Parameters</h6>
<p>text : str
    The input text containing potential smart quotes.</p>
<h6 id="tnh_scholar.text_processing.normalize_quotes--returns">Returns</h6>
<p>str
    The text with all smart quotes replaced by standard straight quotes.</p>
<h6 id="tnh_scholar.text_processing.normalize_quotes--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>text = '“This is a ‘smart’ quoted text.”'
normalize_quotes(text)
'"This is a 'smart' quoted text."'</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.normalize_quotes--notes">Notes</h6>
<p>Smart quotes are often automatically inserted by word processors but can
introduce inconsistencies when parsing or tokenizing text data. This function
is useful for data preprocessing, ensuring uniform quote styles in text for
tasks like NLP model training or XML/HTML parsing.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_quotes</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms all smart quotes in the input text to standard straight quotes.</span>

<span class="sd">    This function replaces both single and double smart quotes (Unicode) with</span>
<span class="sd">    their standard straight quote counterparts. Specifically, it:</span>

<span class="sd">    - Converts left and right single smart quotes (‘ and ’) to ASCII single quote (&#39;).</span>
<span class="sd">    - Converts left and right double smart quotes (“ and ”) to ASCII double quote (&quot;).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The input text containing potential smart quotes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The text with all smart quotes replaced by standard straight quotes.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; text = &#39;“This is a ‘smart’ quoted text.”&#39;</span>
<span class="sd">    &gt;&gt;&gt; normalize_quotes(text)</span>
<span class="sd">    &#39;&quot;This is a \&#39;smart\&#39; quoted text.&quot;&#39;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Smart quotes are often automatically inserted by word processors but can</span>
<span class="sd">    introduce inconsistencies when parsing or tokenizing text data. This function</span>
<span class="sd">    is useful for data preprocessing, ensuring uniform quote styles in text for</span>
<span class="sd">    tasks like NLP model training or XML/HTML parsing.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace left and right double smart quotes with straight double quote</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u201C</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u201D</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u2018</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u2019</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.number_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;: &#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Numbers each line of text with a readable format, including empty lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text to be numbered. Can be multi-line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator between line number and content.
Defaults to ": ".</p>
              </div>
            </td>
            <td>
                  <code>&#39;: &#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numbered text where each line starts with "{number}: ".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;First line</span><span class="se">\n</span><span class="s2">Second line</span><span class="se">\n\n</span><span class="s2">Fourth line&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="go">1: First line</span>
<span class="go">2: Second line</span>
<span class="go">3:</span>
<span class="go">4: Fourth line</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; | &quot;</span><span class="p">))</span>
<span class="go">5 | First line</span>
<span class="go">6 | Second line</span>
<span class="go">7 |</span>
<span class="go">8 | Fourth line</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>All lines are numbered, including empty lines, to maintain text structure</li>
<li>Line numbers are aligned through natural string formatting</li>
<li>Customizable separator allows for different formatting needs</li>
<li>Can start from any line number for flexibility in text processing</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;: &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Numbers each line of text with a readable format, including empty lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Input text to be numbered. Can be multi-line.</span>
<span class="sd">        start (int, optional): Starting line number. Defaults to 1.</span>
<span class="sd">        separator (str, optional): Separator between line number and content.</span>
<span class="sd">            Defaults to &quot;: &quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Numbered text where each line starts with &quot;{number}: &quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;First line\\nSecond line\\n\\nFourth line&quot;</span>
<span class="sd">        &gt;&gt;&gt; print(number_lines(text))</span>
<span class="sd">        1: First line</span>
<span class="sd">        2: Second line</span>
<span class="sd">        3:</span>
<span class="sd">        4: Fourth line</span>

<span class="sd">        &gt;&gt;&gt; print(number_lines(text, start=5, separator=&quot; | &quot;))</span>
<span class="sd">        5 | First line</span>
<span class="sd">        6 | Second line</span>
<span class="sd">        7 |</span>
<span class="sd">        8 | Fourth line</span>

<span class="sd">    Notes:</span>
<span class="sd">        - All lines are numbered, including empty lines, to maintain text structure</span>
<span class="sd">        - Line numbers are aligned through natural string formatting</span>
<span class="sd">        - Customizable separator allows for different formatting needs</span>
<span class="sd">        - Can start from any line number for flexibility in text processing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}{</span><span class="n">separator</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.remove_all_tags_with_attribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_all_tags_with_attribute</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove unwanted tags with specific attributes from a BeautifulSoup object.</p>
<p>This function removes tags with a specific attribute (e.g., 'class') that matches a regular expression pattern.</p>
<h6 id="tnh_scholar.text_processing.remove_all_tags_with_attribute--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to match (e.g., 'class', 'id'). If None, no attribute filtering is done.</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only tags whose specified attribute
matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.remove_all_tags_with_attribute--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</p>
<h6 id="tnh_scholar.text_processing.remove_all_tags_with_attribute--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_all_tags_with_attribute(soup, attr_name='class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_all_tags_with_attribute</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove unwanted tags with specific attributes from a BeautifulSoup object.</span>

<span class="sd">    This function removes tags with a specific attribute (e.g., &#39;class&#39;) that matches a regular expression pattern.</span>


<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to match (e.g., &#39;class&#39;, &#39;id&#39;). If None, no attribute filtering is done.</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only tags whose specified attribute</span>
<span class="sd">        matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_all_tags_with_attribute(soup, attr_name=&#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tags_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Find all tags in the soup</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># If an attribute name is specified, filter tags by the attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Check if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="p">:</span>
            <span class="c1"># If no attribute is specified, remove the entire tag</span>
            <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="c1"># Remove all collected tags</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.remove_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_attributes</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove unwanted attributes from a specific tag or all tags in a BeautifulSoup object.</p>
<p>This function removes attributes based on the tag name and/or attribute value pattern. It can:
- Remove attributes from a specific tag (e.g., 'div').
- Remove attributes with a specific attribute value that matches a regular expression pattern.
- Remove attributes from all tags if no specific tag is provided.</p>
<h6 id="tnh_scholar.text_processing.remove_attributes--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to remove (e.g., 'class', 'id').</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only attributes whose values
match this pattern will be removed. If None, the attribute will be removed unconditionally.</p>
</details>

<details class="tag-" open>
  <summary>str, optional</summary>
  <p>The tag name to filter by (e.g., 'div', 'span'). If None, the attribute will be removed
from all tags that have the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.remove_attributes--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted attributes.</p>
<h6 id="tnh_scholar.text_processing.remove_attributes--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_attributes(soup, attr_name='class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<div>Text</div>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_attributes</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove unwanted attributes from a specific tag or all tags in a BeautifulSoup object.</span>

<span class="sd">    This function removes attributes based on the tag name and/or attribute value pattern. It can:</span>
<span class="sd">    - Remove attributes from a specific tag (e.g., &#39;div&#39;).</span>
<span class="sd">    - Remove attributes with a specific attribute value that matches a regular expression pattern.</span>
<span class="sd">    - Remove attributes from all tags if no specific tag is provided.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to remove (e.g., &#39;class&#39;, &#39;id&#39;).</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only attributes whose values</span>
<span class="sd">        match this pattern will be removed. If None, the attribute will be removed unconditionally.</span>

<span class="sd">    tag : str, optional</span>
<span class="sd">        The tag name to filter by (e.g., &#39;div&#39;, &#39;span&#39;). If None, the attribute will be removed</span>
<span class="sd">        from all tags that have the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_attributes(soup, attr_name=&#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;div&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Find all tags, filtered by tag name if provided</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span> <span class="ow">or</span> <span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Check if the tag has the specified attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>

            <span class="c1"># Check if we are matching the attribute value against a pattern</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="c1"># If the attribute value is a list (e.g., for class attribute), handle that case</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Remove the attribute if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="c1"># For single values, remove the attribute if it matches the pattern</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no pattern is specified, remove the attribute unconditionally</span>
                <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.remove_empty_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_empty_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove empty tags from a BeautifulSoup object based on a specified list or space-separated string of tag names.</p>
<p>This function examines each specified tag and checks if it is empty (contains no visible text).
If a tag contains only nested elements (i.e., descendants) but no visible text, it will be unwrapped
(preserving the nested content). Tags that contain neither text nor descendants are completely removed
from the document.</p>
<h6 id="tnh_scholar.text_processing.remove_empty_tags--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML or XML content to clean.</p>


<details class="tag_list-" open>
  <summary>list or str</summary>
  <p>A list of tag names (e.g., ['div', 'a']) or a space-separated string (e.g., 'div a') specifying
which tags should be checked and removed if empty. Only tags matching these names will be considered.</p>
</details>        <h6 id="tnh_scholar.text_processing.remove_empty_tags--returns">Returns:</h6>
<p>None
    This function modifies the BeautifulSoup object in place, removing or unwrapping tags as needed.</p>
<h6 id="tnh_scholar.text_processing.remove_empty_tags--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div></div><a href='link'><span></span></a><p>Content</p>"
soup = BeautifulSoup(html_content, 'html.parser')
remove_empty_tags(soup, 'div a')
print(soup)
<span></span><p>Content</p></p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.remove_empty_tags--notes">Notes:</h6>
<ul>
<li>This function relies on two helper functions, <code>tag_has_visible_text</code> and <code>tag_has_descendants</code>:<ul>
<li><code>tag_has_visible_text(tag)</code>: Returns True if the tag contains visible text (ignoring whitespace).</li>
<li><code>tag_has_descendants(tag)</code>: Returns True if the tag has nested elements (descendants).</li>
</ul>
</li>
<li>The function operates in place, meaning it directly modifies the <code>soup</code> object passed to it.</li>
<li>Tags with descendants but no visible text are unwrapped rather than removed, ensuring that nested
  content remains intact.</li>
<li>Useful for cleaning up HTML or XML content by removing purely empty elements without affecting structure.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_empty_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove empty tags from a BeautifulSoup object based on a specified list or space-separated string of tag names.</span>

<span class="sd">    This function examines each specified tag and checks if it is empty (contains no visible text).</span>
<span class="sd">    If a tag contains only nested elements (i.e., descendants) but no visible text, it will be unwrapped</span>
<span class="sd">    (preserving the nested content). Tags that contain neither text nor descendants are completely removed</span>
<span class="sd">    from the document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML or XML content to clean.</span>

<span class="sd">    tag_list : list or str</span>
<span class="sd">        A list of tag names (e.g., [&#39;div&#39;, &#39;a&#39;]) or a space-separated string (e.g., &#39;div a&#39;) specifying</span>
<span class="sd">        which tags should be checked and removed if empty. Only tags matching these names will be considered.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        This function modifies the BeautifulSoup object in place, removing or unwrapping tags as needed.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;&lt;/div&gt;&lt;a href=&#39;link&#39;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;Content&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_empty_tags(soup, &#39;div a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;span&gt;&lt;/span&gt;&lt;p&gt;Content&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function relies on two helper functions, `tag_has_visible_text` and `tag_has_descendants`:</span>
<span class="sd">        - `tag_has_visible_text(tag)`: Returns True if the tag contains visible text (ignoring whitespace).</span>
<span class="sd">        - `tag_has_descendants(tag)`: Returns True if the tag has nested elements (descendants).</span>
<span class="sd">    - The function operates in place, meaning it directly modifies the `soup` object passed to it.</span>
<span class="sd">    - Tags with descendants but no visible text are unwrapped rather than removed, ensuring that nested</span>
<span class="sd">      content remains intact.</span>
<span class="sd">    - Useful for cleaning up HTML or XML content by removing purely empty elements without affecting structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure tag_list is a list, even if passed as a space-separated string</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># Process tags in tag_list to either unwrap or remove</span>
    <span class="k">for</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag_name</span><span class="p">):</span>
            <span class="c1"># Check if the tag is empty (no text content) and has no nested elements</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                    <span class="c1"># Tag has descendants, so unwrap it instead of decomposing</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Tag is truly empty of meaningful content, so decompose it</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.remove_tag_whitespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_tag_whitespace</span><span class="p">(</span><span class="n">html_str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Removes any whitespace between adjacent HTML tags in an HTML string. This function is
designed to clean up HTML content by minimizing unnecessary spacing between elements,
which can improve readability in structured processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_str</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The HTML string to be processed. Must be well-formed for accurate parsing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned HTML string with no whitespace between adjacent tags. Tags that
 originally had whitespace between them will now be directly adjacent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>html_str = "<body> <p>This is some text.</p>   <br> </body>"
remove_tag_whitespace(html_str)
'<body><p>This is some text.</p><br></body>'</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function uses BeautifulSoup to parse the HTML and then removes whitespace between
  tags using a regular expression.</li>
<li>The function assumes that <code>html_str</code> is a well-formed HTML string. Malformed HTML may
  lead to unexpected behavior.</li>
<li>BeautifulSoup automatically corrects certain HTML issues, so the output may differ
  slightly in structure if the input was not well-formed.</li>
</ul>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input is not a valid HTML string or is an empty string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_tag_whitespace</span><span class="p">(</span><span class="n">html_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes any whitespace between adjacent HTML tags in an HTML string. This function is</span>
<span class="sd">    designed to clean up HTML content by minimizing unnecessary spacing between elements,</span>
<span class="sd">    which can improve readability in structured processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_str (str): The HTML string to be processed. Must be well-formed for accurate parsing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The cleaned HTML string with no whitespace between adjacent tags. Tags that</span>
<span class="sd">             originally had whitespace between them will now be directly adjacent.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; html_str = &quot;&lt;body&gt; &lt;p&gt;This is some text.&lt;/p&gt;   &lt;br&gt; &lt;/body&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; remove_tag_whitespace(html_str)</span>
<span class="sd">        &#39;&lt;body&gt;&lt;p&gt;This is some text.&lt;/p&gt;&lt;br&gt;&lt;/body&gt;&#39;</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function uses BeautifulSoup to parse the HTML and then removes whitespace between</span>
<span class="sd">          tags using a regular expression.</span>
<span class="sd">        - The function assumes that `html_str` is a well-formed HTML string. Malformed HTML may</span>
<span class="sd">          lead to unexpected behavior.</span>
<span class="sd">        - BeautifulSoup automatically corrects certain HTML issues, so the output may differ</span>
<span class="sd">          slightly in structure if the input was not well-formed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input is not a valid HTML string or is an empty string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">html_str</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input HTML string cannot be empty or whitespace-only.&quot;</span><span class="p">)</span>

    <span class="c1"># Use BeautifulSoup to parse and normalize the HTML structure</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_str</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

    <span class="c1"># return after converting back to string and using regex to remove whitespace between tags.</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&gt;\s+&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&lt;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.remove_tags_with_attribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_tags_with_attribute</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove a specific tags with specific attributes from a BeautifulSoup object.</p>
<p>This function removes tags with a specific attribute (e.g., 'class') that matches a regular expression pattern.</p>
<h6 id="tnh_scholar.text_processing.remove_tags_with_attribute--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>
<p>tag_list : the list of tags to remove if matching attribute is found; if a single string, then this string is split into tags.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to match (e.g., 'class', 'id'). If None, no attribute filtering is done.</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only tags whose specified attribute
matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.remove_tags_with_attribute--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</p>
<h6 id="tnh_scholar.text_processing.remove_tags_with_attribute--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_tags_with_attribute(soup, 'div', 'class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_tags_with_attribute</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span>
    <span class="n">tag_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a specific tags with specific attributes from a BeautifulSoup object.</span>

<span class="sd">    This function removes tags with a specific attribute (e.g., &#39;class&#39;) that matches a regular expression pattern.</span>


<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    tag_list : the list of tags to remove if matching attribute is found; if a single string, then this string is split into tags.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to match (e.g., &#39;class&#39;, &#39;id&#39;). If None, no attribute filtering is done.</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only tags whose specified attribute</span>
<span class="sd">        matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_tags_with_attribute(soup, &#39;div&#39;, &#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">tags_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Find all tags in the soup</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="o">*</span><span class="n">tag_list</span><span class="p">):</span>
        <span class="c1"># If an attribute name is specified, filter tags by the attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Check if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="p">:</span>
            <span class="c1"># If no attribute is specified, remove the entire tag</span>
            <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="c1"># Remove all collected tags</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.tag_has_descendants" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a BeautifulSoup tag has any descendants (nested elements), such as child tags
or text nodes.</p>
<p>This function is useful for determining if a tag contains any nested structure, whether
directly or indirectly, as opposed to being a standalone empty tag.</p>
<h6 id="tnh_scholar.text_processing.tag_has_descendants--parameters">Parameters:</h6>
<p>tag : BeautifulSoup tag
    The BeautifulSoup tag to check for descendants.</p>
<h6 id="tnh_scholar.text_processing.tag_has_descendants--returns">Returns:</h6>
<p>bool
    True if the tag contains any descendants (nested tags or text nodes), otherwise False.</p>
<h6 id="tnh_scholar.text_processing.tag_has_descendants--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div><p>Text inside paragraph.</p></div>"
soup = BeautifulSoup(html_content, 'html.parser')
div_tag = soup.find('div')
tag_has_descendants(div_tag)
True</p>
<p>empty_tag = soup.new_tag('div')
tag_has_descendants(empty_tag)
False</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.tag_has_descendants--notes">Notes:</h6>
<ul>
<li>This function checks if there are any nested tags or text nodes within the tag,
  regardless of depth. If the tag has even a single nested element, it returns True.</li>
<li>Ideal for use in filtering or cleaning HTML where nested structures are significant.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a BeautifulSoup tag has any descendants (nested elements), such as child tags</span>
<span class="sd">    or text nodes.</span>

<span class="sd">    This function is useful for determining if a tag contains any nested structure, whether</span>
<span class="sd">    directly or indirectly, as opposed to being a standalone empty tag.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    tag : BeautifulSoup tag</span>
<span class="sd">        The BeautifulSoup tag to check for descendants.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the tag contains any descendants (nested tags or text nodes), otherwise False.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;&lt;p&gt;Text inside paragraph.&lt;/p&gt;&lt;/div&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; div_tag = soup.find(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_descendants(div_tag)</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; empty_tag = soup.new_tag(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_descendants(empty_tag)</span>
<span class="sd">    False</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function checks if there are any nested tags or text nodes within the tag,</span>
<span class="sd">      regardless of depth. If the tag has even a single nested element, it returns True.</span>
<span class="sd">    - Ideal for use in filtering or cleaning HTML where nested structures are significant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">descendants</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.tag_has_visible_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if a BeautifulSoup tag has visible text content, meaning it contains text that is not
solely whitespace.</p>
<p>This function is useful for determining whether a tag has meaningful text content, as opposed to
being empty or containing only whitespace.</p>
<h6 id="tnh_scholar.text_processing.tag_has_visible_text--parameters">Parameters:</h6>
<p>tag : BeautifulSoup tag
    The BeautifulSoup tag to check for visible text content.</p>
<h6 id="tnh_scholar.text_processing.tag_has_visible_text--returns">Returns:</h6>
<p>bool
    True if the tag contains visible text (after stripping whitespace), otherwise False.</p>
<h6 id="tnh_scholar.text_processing.tag_has_visible_text--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div>   </div><p>This is text content.</p>"
soup = BeautifulSoup(html_content, 'html.parser')
div_tag = soup.find('div')
tag_has_visible_text(div_tag)
False</p>
<p>p_tag = soup.find('p')
tag_has_visible_text(p_tag)
True</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.tag_has_visible_text--notes">Notes:</h6>
<ul>
<li>This function ignores any nested tags, focusing only on direct visible text content.</li>
<li>Whitespace-only content is considered empty and will return False.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a BeautifulSoup tag has visible text content, meaning it contains text that is not</span>
<span class="sd">    solely whitespace.</span>

<span class="sd">    This function is useful for determining whether a tag has meaningful text content, as opposed to</span>
<span class="sd">    being empty or containing only whitespace.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    tag : BeautifulSoup tag</span>
<span class="sd">        The BeautifulSoup tag to check for visible text content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the tag contains visible text (after stripping whitespace), otherwise False.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;   &lt;/div&gt;&lt;p&gt;This is text content.&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; div_tag = soup.find(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_visible_text(div_tag)</span>
<span class="sd">    False</span>

<span class="sd">    &gt;&gt;&gt; p_tag = soup.find(&#39;p&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_visible_text(p_tag)</span>
<span class="sd">    True</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function ignores any nested tags, focusing only on direct visible text content.</span>
<span class="sd">    - Whitespace-only content is considered empty and will return False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.unbracket_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unbracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unbracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;blank page&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unbracket_lines</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.unbracket_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unbracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <pre><code>Removes angle brackets (&lt; &gt;) from encapsulated lines and optionally removes line numbers.

Args:
    text (str): The input string with encapsulated lines.
    number (bool): If True, removes line numbers in the format 'digit:'.
                   Raises a ValueError if `number=True` and a line does not start with a digit followed by a colon.

Returns:
    str: A newline-separated string with the encapsulation removed, and line numbers stripped if specified.

Examples:
    &gt;&gt;&gt; unbracket_lines("&lt;1:Line 1&gt;
</code></pre>
<p>&lt;2:Line 2&gt;", number=True)
        'Line 1
Line 2'</p>
<pre><code>    &gt;&gt;&gt; unbracket_lines("&lt;Line 1&gt;
</code></pre>
<p><Line 2>")
        'Line 1
Line 2'</p>
<pre><code>    &gt;&gt;&gt; unbracket_lines("&lt;1Line 1&gt;", number=True)
    ValueError: Line does not start with a valid number: '1Line 1'
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unbracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes angle brackets (&lt; &gt;) from encapsulated lines and optionally removes line numbers.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input string with encapsulated lines.</span>
<span class="sd">        number (bool): If True, removes line numbers in the format &#39;digit:&#39;.</span>
<span class="sd">                       Raises a ValueError if `number=True` and a line does not start with a digit followed by a colon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A newline-separated string with the encapsulation removed, and line numbers stripped if specified.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;1:Line 1&gt;\n&lt;2:Line 2&gt;&quot;, number=True)</span>
<span class="sd">        &#39;Line 1\nLine 2&#39;</span>

<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;Line 1&gt;\n&lt;Line 2&gt;&quot;)</span>
<span class="sd">        &#39;Line 1\nLine 2&#39;</span>

<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;1Line 1&gt;&quot;, number=True)</span>
<span class="sd">        ValueError: Line does not start with a valid number: &#39;1Line 1&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unbracketed_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(\d+):(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">if</span> <span class="n">number</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">number</span> <span class="k">else</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">unbracketed_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">number</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line does not start with a valid number: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line does not follow the expected format: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unbracketed_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.text_processing.unwrap_redundant_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwrap_redundant_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Unwrap tags that do not have any attributes and contain only a single child tag,
by first collecting tags to unwrap, then processing them in a separate loop.</p>
<h6 id="tnh_scholar.text_processing.unwrap_redundant_tags--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="tag_list-" open>
  <summary>list or str</summary>
  <p>A list of tag names (e.g., ['span', 'a']) or a space-separated string (e.g., 'span a') specifying
which tags should be checked and unwrapped if redundant.</p>
</details>        <h6 id="tnh_scholar.text_processing.unwrap_redundant_tags--returns">Returns:</h6>
<p>None
    This function modifies the BeautifulSoup object in place, unwrapping redundant tags as needed.</p>
<h6 id="tnh_scholar.text_processing.unwrap_redundant_tags--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = '''
... <p><span><span class="bold">Table of Contents</span></span></p>
... <p><a><span class="italic"><span class="underline">Title Page</span></span></a></p>
... '''
soup = BeautifulSoup(html_content, 'html.parser')
unwrap_redundant_tags(soup, 'span a')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p><span class="bold">Table of Contents</span></p>
<p><span class="italic"><span class="underline">Title Page</span></span></p>

<h6 id="tnh_scholar.text_processing.unwrap_redundant_tags--notes">Notes:</h6>
<ul>
<li>This function only unwraps tags that contain no attributes and have a single child with identical text content.</li>
<li>The function operates in place, meaning it directly modifies the <code>soup</code> object passed to it.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unwrap_redundant_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unwrap tags that do not have any attributes and contain only a single child tag,</span>
<span class="sd">    by first collecting tags to unwrap, then processing them in a separate loop.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    tag_list : list or str</span>
<span class="sd">        A list of tag names (e.g., [&#39;span&#39;, &#39;a&#39;]) or a space-separated string (e.g., &#39;span a&#39;) specifying</span>
<span class="sd">        which tags should be checked and unwrapped if redundant.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        This function modifies the BeautifulSoup object in place, unwrapping redundant tags as needed.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &#39;&#39;&#39;</span>
<span class="sd">    ... &lt;p&gt;&lt;span&gt;&lt;span class=&quot;bold&quot;&gt;Table of Contents&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</span>
<span class="sd">    ... &lt;p&gt;&lt;a&gt;&lt;span class=&quot;italic&quot;&gt;&lt;span class=&quot;underline&quot;&gt;Title Page&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; unwrap_redundant_tags(soup, &#39;span a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p&gt;&lt;span class=&quot;bold&quot;&gt;Table of Contents&lt;/span&gt;&lt;/p&gt;</span>
<span class="sd">    &lt;p&gt;&lt;span class=&quot;italic&quot;&gt;&lt;span class=&quot;underline&quot;&gt;Title Page&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function only unwraps tags that contain no attributes and have a single child with identical text content.</span>
<span class="sd">    - The function operates in place, meaning it directly modifies the `soup` object passed to it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># Step 1: Collect tags to unwrap</span>
    <span class="n">tags_to_unwrap</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Determines if a tag is redundant by checking three conditions:</span>
<span class="sd">            1. Has no attributes (preserves styled/classed tags)</span>
<span class="sd">            2. Contains exactly one child element</span>
<span class="sd">            3. Child is a Tag instance (not NavigableString/Comment)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">is_redundant_wrapper</span> <span class="o">=</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrs</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tag</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_redundant_wrapper</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">child</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="n">tags_to_unwrap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.text_processing.bracket" class="doc doc-heading">
            <code>bracket</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.text_processing.bracket.FormattingError" class="doc doc-heading">
            <code>FormattingError</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Custom exception raised for formatting-related errors.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FormattingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom exception raised for formatting-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.bracket.FormattingError.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;An error occurred due to invalid formatting.&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.bracket_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">bracket_lines</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.bracket_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Encloses each line of the input text with angle brackets.
If number is True, adds a line number followed by a colon `:` and then the line.

Args:
    text (str): The input string containing lines separated by '
</code></pre>
<p>'.
        number (bool): Whether to prepend line numbers to each line.</p>
<pre><code>Returns:
    str: A string where each line is enclosed in angle brackets.

Examples:
    &gt;&gt;&gt; bracket_lines("This is a string with
</code></pre>
<p>two lines.")
        '<This is a string with>
&lt;   two lines.&gt;'</p>
<pre><code>    &gt;&gt;&gt; bracket_lines("This is a string with
</code></pre>
<p>two lines.", number=True)
        '&lt;1:This is a string with&gt;
&lt;2:   two lines.&gt;'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encloses each line of the input text with angle brackets.</span>
<span class="sd">    If number is True, adds a line number followed by a colon `:` and then the line.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input string containing lines separated by &#39;\n&#39;.</span>
<span class="sd">        number (bool): Whether to prepend line numbers to each line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string where each line is enclosed in angle brackets.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; bracket_lines(&quot;This is a string with\n   two lines.&quot;)</span>
<span class="sd">        &#39;&lt;This is a string with&gt;\n&lt;   two lines.&gt;&#39;</span>

<span class="sd">        &gt;&gt;&gt; bracket_lines(&quot;This is a string with\n   two lines.&quot;, number=True)</span>
<span class="sd">        &#39;&lt;1:This is a string with&gt;\n&lt;2:   two lines.&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">line</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.lines_from_bracketed_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lines_from_bracketed_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">keep_brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Extracts lines from bracketed text between the start and end indices, inclusive.
Handles both numbered and non-numbered cases.

Args:
    text (str): The input bracketed text containing lines like &lt;...&gt;.
    start (int): The starting line number (1-based).
    end (int): The ending line number (1-based).

Returns:
    list[str]: The lines from start to end inclusive, with angle brackets removed.

Raises:
    FormattingError: If the text contains improperly formatted lines (missing angle brackets).
    ValueError: If start or end indices are invalid or out of bounds.

Examples:
    &gt;&gt;&gt; text = "&lt;1:Line 1&gt;
</code></pre>
<p>&lt;2:Line 2&gt;
&lt;3:Line 3&gt;"
        &gt;&gt;&gt; lines_from_bracketed_text(text, 1, 2)
        ['Line 1', 'Line 2']</p>
<pre><code>    &gt;&gt;&gt; text = "&lt;Line 1&gt;
</code></pre>
<p><Line 2>
<Line 3>"
        &gt;&gt;&gt; lines_from_bracketed_text(text, 2, 3)
        ['Line 2', 'Line 3']</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lines_from_bracketed_text</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">keep_brackets</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts lines from bracketed text between the start and end indices, inclusive.</span>
<span class="sd">    Handles both numbered and non-numbered cases.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input bracketed text containing lines like &lt;...&gt;.</span>
<span class="sd">        start (int): The starting line number (1-based).</span>
<span class="sd">        end (int): The ending line number (1-based).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: The lines from start to end inclusive, with angle brackets removed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FormattingError: If the text contains improperly formatted lines (missing angle brackets).</span>
<span class="sd">        ValueError: If start or end indices are invalid or out of bounds.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;&lt;1:Line 1&gt;\n&lt;2:Line 2&gt;\n&lt;3:Line 3&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; lines_from_bracketed_text(text, 1, 2)</span>
<span class="sd">        [&#39;Line 1&#39;, &#39;Line 2&#39;]</span>

<span class="sd">        &gt;&gt;&gt; text = &quot;&lt;Line 1&gt;\n&lt;Line 2&gt;\n&lt;Line 3&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; lines_from_bracketed_text(text, 2, 3)</span>
<span class="sd">        [&#39;Line 2&#39;, &#39;Line 3&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Split the text into lines</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="c1"># Validate indices</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">end</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid start or end indices for the given text: start:</span><span class="si">{start}</span><span class="s2">, end: </span><span class="si">{end}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Extract lines and validate formatting</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
            <span class="c1"># Check for proper bracketing and extract the content</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(\d+:)?(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid format for line </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># Add the extracted content (group 2) to the result</span>
            <span class="k">if</span> <span class="n">keep_brackets</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.number_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;: &#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Numbers each line of text with a readable format, including empty lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input text to be numbered. Can be multi-line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator between line number and content.
Defaults to ": ".</p>
              </div>
            </td>
            <td>
                  <code>&#39;: &#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numbered text where each line starts with "{number}: ".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;First line</span><span class="se">\n</span><span class="s2">Second line</span><span class="se">\n\n</span><span class="s2">Fourth line&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="go">1: First line</span>
<span class="go">2: Second line</span>
<span class="go">3:</span>
<span class="go">4: Fourth line</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; | &quot;</span><span class="p">))</span>
<span class="go">5 | First line</span>
<span class="go">6 | Second line</span>
<span class="go">7 |</span>
<span class="go">8 | Fourth line</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>All lines are numbered, including empty lines, to maintain text structure</li>
<li>Line numbers are aligned through natural string formatting</li>
<li>Customizable separator allows for different formatting needs</li>
<li>Can start from any line number for flexibility in text processing</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">number_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;: &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Numbers each line of text with a readable format, including empty lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Input text to be numbered. Can be multi-line.</span>
<span class="sd">        start (int, optional): Starting line number. Defaults to 1.</span>
<span class="sd">        separator (str, optional): Separator between line number and content.</span>
<span class="sd">            Defaults to &quot;: &quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Numbered text where each line starts with &quot;{number}: &quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;First line\\nSecond line\\n\\nFourth line&quot;</span>
<span class="sd">        &gt;&gt;&gt; print(number_lines(text))</span>
<span class="sd">        1: First line</span>
<span class="sd">        2: Second line</span>
<span class="sd">        3:</span>
<span class="sd">        4: Fourth line</span>

<span class="sd">        &gt;&gt;&gt; print(number_lines(text, start=5, separator=&quot; | &quot;))</span>
<span class="sd">        5 | First line</span>
<span class="sd">        6 | Second line</span>
<span class="sd">        7 |</span>
<span class="sd">        8 | Fourth line</span>

<span class="sd">    Notes:</span>
<span class="sd">        - All lines are numbered, including empty lines, to maintain text structure</span>
<span class="sd">        - Line numbers are aligned through natural string formatting</span>
<span class="sd">        - Customizable separator allows for different formatting needs</span>
<span class="sd">        - Can start from any line number for flexibility in text processing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}{</span><span class="n">separator</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.unbracket_all_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unbracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unbracket_all_lines</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;blank page&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unbracket_lines</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.bracket.unbracket_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unbracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Removes angle brackets (&lt; &gt;) from encapsulated lines and optionally removes line numbers.

Args:
    text (str): The input string with encapsulated lines.
    number (bool): If True, removes line numbers in the format 'digit:'.
                   Raises a ValueError if `number=True` and a line does not start with a digit followed by a colon.

Returns:
    str: A newline-separated string with the encapsulation removed, and line numbers stripped if specified.

Examples:
    &gt;&gt;&gt; unbracket_lines("&lt;1:Line 1&gt;
</code></pre>
<p>&lt;2:Line 2&gt;", number=True)
        'Line 1
Line 2'</p>
<pre><code>    &gt;&gt;&gt; unbracket_lines("&lt;Line 1&gt;
</code></pre>
<p><Line 2>")
        'Line 1
Line 2'</p>
<pre><code>    &gt;&gt;&gt; unbracket_lines("&lt;1Line 1&gt;", number=True)
    ValueError: Line does not start with a valid number: '1Line 1'
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/bracket.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unbracket_lines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes angle brackets (&lt; &gt;) from encapsulated lines and optionally removes line numbers.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The input string with encapsulated lines.</span>
<span class="sd">        number (bool): If True, removes line numbers in the format &#39;digit:&#39;.</span>
<span class="sd">                       Raises a ValueError if `number=True` and a line does not start with a digit followed by a colon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A newline-separated string with the encapsulation removed, and line numbers stripped if specified.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;1:Line 1&gt;\n&lt;2:Line 2&gt;&quot;, number=True)</span>
<span class="sd">        &#39;Line 1\nLine 2&#39;</span>

<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;Line 1&gt;\n&lt;Line 2&gt;&quot;)</span>
<span class="sd">        &#39;Line 1\nLine 2&#39;</span>

<span class="sd">        &gt;&gt;&gt; unbracket_lines(&quot;&lt;1Line 1&gt;&quot;, number=True)</span>
<span class="sd">        ValueError: Line does not start with a valid number: &#39;1Line 1&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unbracketed_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(\d+):(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">if</span> <span class="n">number</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;(.*?)&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">number</span> <span class="k">else</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">unbracketed_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">number</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line does not start with a valid number: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormattingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line does not follow the expected format: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unbracketed_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.text_processing.clean_parse_tag" class="doc doc-heading">
            <code>clean_parse_tag</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.clean_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Cleans a given text by replacing specific unwanted characters such as
tab, and non-breaking spaces with regular spaces.</p>
<p>This function takes a string as input and applies replacements
based on a predefined mapping of characters to replace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to be cleaned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned text with unwanted characters replaced by spaces.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>text = "This is\n an example\ttext with\xa0extra spaces."
clean_text(text)
'This is an example text with extra spaces.'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans a given text by replacing specific unwanted characters such as</span>
<span class="sd">    tab, and non-breaking spaces with regular spaces.</span>

<span class="sd">    This function takes a string as input and applies replacements</span>
<span class="sd">    based on a predefined mapping of characters to replace.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The text to be cleaned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The cleaned text with unwanted characters replaced by spaces.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;This is\\n an example\\ttext with\\xa0extra spaces.&quot;</span>
<span class="sd">        &gt;&gt;&gt; clean_text(text)</span>
<span class="sd">        &#39;This is an example text with extra spaces.&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define a mapping of characters to replace</span>
    <span class="n">replace_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>  <span class="c1"># Replace tabs with space</span>
        <span class="s2">&quot;</span><span class="se">\xa0</span><span class="s2">&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>  <span class="c1"># Replace non-breaking space with regular space</span>
        <span class="c1"># Add more replacements as needed</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">newline</span><span class="p">:</span>
        <span class="n">replace_map</span><span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># remove newlines</span>

    <span class="c1"># Loop through the replace map and replace each character</span>
    <span class="k">for</span> <span class="n">old_char</span><span class="p">,</span> <span class="n">new_char</span> <span class="ow">in</span> <span class="n">replace_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_char</span><span class="p">,</span> <span class="n">new_char</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Ensure any leading/trailing spaces are removed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_tags_by_attributes</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tags_with_attributes</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract specified tags and their attributes from a BeautifulSoup object.</p>
<p>This function allows you to search for multiple tags and their respective attributes
within an HTML document parsed by BeautifulSoup. The result is a dictionary where
each key is a tuple <code>(tag, attribute_values)</code> representing the tag name and the
attributes used to search for that tag. The corresponding value is a list of the
matching tags found in the soup object.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content from which tags will be extracted.</p>


<details class="tags_with_attributes-" open>
  <summary>dict</summary>
  <p>A dictionary where keys are the tag names (e.g., 'p', 'span') and values are
attribute dictionaries that filter the tags. For example, {'p': {}, 'span': {'class': 'italic'}}.
- To search for a tag without any attribute filters, provide an empty dictionary <code>{}</code>.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--returns">Returns:</h6>
<p>dict
    A dictionary where each key is a tuple <code>(tag, attribute_values)</code>:
        - <code>tag</code>: The HTML tag name (e.g., 'p', 'span').
        - <code>attribute_values</code>: A tuple of key-value pairs representing the tag's attributes (e.g., <code>(('class', 'italic'),)</code>).
          If no attributes were specified, the tuple will be empty <code>()</code>.
    The corresponding value is a list of BeautifulSoup tag elements that matched the search criteria.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<p>This is a paragraph.</p><span class="italic">Italic text</span>', 'html.parser')
tags_to_find = {'p': {}, 'span': {'class': 'italic'}}
extracted = extract_tags_by_attributes(soup, tags_to_find)
for (tag, attributes), matches in extracted.items():
    print(f"Found {len(matches)} {tag} tags with attributes {attributes}.")</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.extract_tags_by_attributes--example-output">Example Output:</h6>
<p>Found 1 p tags with attributes ().
Found 1 span tags with attributes (('class', 'italic'),).</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_tags_by_attributes</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tags_with_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">BeautifulSoup</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract specified tags and their attributes from a BeautifulSoup object.</span>

<span class="sd">    This function allows you to search for multiple tags and their respective attributes</span>
<span class="sd">    within an HTML document parsed by BeautifulSoup. The result is a dictionary where</span>
<span class="sd">    each key is a tuple `(tag, attribute_values)` representing the tag name and the</span>
<span class="sd">    attributes used to search for that tag. The corresponding value is a list of the</span>
<span class="sd">    matching tags found in the soup object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content from which tags will be extracted.</span>

<span class="sd">    tags_with_attributes : dict</span>
<span class="sd">        A dictionary where keys are the tag names (e.g., &#39;p&#39;, &#39;span&#39;) and values are</span>
<span class="sd">        attribute dictionaries that filter the tags. For example, {&#39;p&#39;: {}, &#39;span&#39;: {&#39;class&#39;: &#39;italic&#39;}}.</span>
<span class="sd">        - To search for a tag without any attribute filters, provide an empty dictionary `{}`.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where each key is a tuple `(tag, attribute_values)`:</span>
<span class="sd">            - `tag`: The HTML tag name (e.g., &#39;p&#39;, &#39;span&#39;).</span>
<span class="sd">            - `attribute_values`: A tuple of key-value pairs representing the tag&#39;s attributes (e.g., `((&#39;class&#39;, &#39;italic&#39;),)`).</span>
<span class="sd">              If no attributes were specified, the tuple will be empty `()`.</span>
<span class="sd">        The corresponding value is a list of BeautifulSoup tag elements that matched the search criteria.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;p&gt;This is a paragraph.&lt;/p&gt;&lt;span class=&quot;italic&quot;&gt;Italic text&lt;/span&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tags_to_find = {&#39;p&#39;: {}, &#39;span&#39;: {&#39;class&#39;: &#39;italic&#39;}}</span>
<span class="sd">    &gt;&gt;&gt; extracted = extract_tags_by_attributes(soup, tags_to_find)</span>
<span class="sd">    &gt;&gt;&gt; for (tag, attributes), matches in extracted.items():</span>
<span class="sd">    &gt;&gt;&gt;     print(f&quot;Found {len(matches)} {tag} tags with attributes {attributes}.&quot;)</span>

<span class="sd">    Example Output:</span>
<span class="sd">    ---------------</span>
<span class="sd">    Found 1 p tags with attributes ().</span>
<span class="sd">    Found 1 span tags with attributes ((&#39;class&#39;, &#39;italic&#39;),).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">extracted_tags</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Loop over each tag and attribute specification</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">in</span> <span class="n">tags_with_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Use find_all to search for tags with the specified attributes</span>
        <span class="n">matching_tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Store results using (tag, attribute_values) as key</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">extracted_tags</span><span class="p">[(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span> <span class="o">=</span> <span class="n">matching_tags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No attributes; use an empty tuple for the key</span>
            <span class="n">extracted_tags</span><span class="p">[(</span><span class="n">tag</span><span class="p">,</span> <span class="p">())]</span> <span class="o">=</span> <span class="n">matching_tags</span>

    <span class="k">return</span> <span class="n">extracted_tags</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_reduced_text_soup</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a copy of a BeautifulSoup object and truncates the text content of all NavigableString
elements in the copied BeautifulSoup object to the first five words, appending ellipses ("...")
if the text contains more than five words. The function returns a new BeautifulSoup object,
leaving the original unmodified.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    A BeautifulSoup object representing the parsed HTML or XML content.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--returns">Returns:</h6>
<p>BeautifulSoup
    A new BeautifulSoup object with truncated text.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<p>This is a paragraph with more than five words.</p>"
soup = BeautifulSoup(html_content, 'html.parser')
result = reduce_tags_and_text(soup)
print(result.prettify())</p>
</blockquote>
</blockquote>
</blockquote>
<p>This is a paragraph with ...</p>

<h6 id="tnh_scholar.text_processing.clean_parse_tag.generate_reduced_text_soup--notes">Notes:</h6>
<ul>
<li>Only NavigableString elements (text nodes) are truncated. HTML tags and structure remain unchanged.</li>
<li>The function does not remove or alter tags but only modifies the text within the tags.</li>
<li>The original BeautifulSoup object is left unchanged.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_reduced_text_soup</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeautifulSoup</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a copy of a BeautifulSoup object and truncates the text content of all NavigableString</span>
<span class="sd">    elements in the copied BeautifulSoup object to the first five words, appending ellipses (&quot;...&quot;)</span>
<span class="sd">    if the text contains more than five words. The function returns a new BeautifulSoup object,</span>
<span class="sd">    leaving the original unmodified.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        A BeautifulSoup object representing the parsed HTML or XML content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    BeautifulSoup</span>
<span class="sd">        A new BeautifulSoup object with truncated text.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;p&gt;This is a paragraph with more than five words.&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; result = reduce_tags_and_text(soup)</span>
<span class="sd">    &gt;&gt;&gt; print(result.prettify())</span>
<span class="sd">    &lt;p&gt;This is a paragraph with ...&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - Only NavigableString elements (text nodes) are truncated. HTML tags and structure remain unchanged.</span>
<span class="sd">    - The function does not remove or alter tags but only modifies the text within the tags.</span>
<span class="sd">    - The original BeautifulSoup object is left unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a deep copy of the soup object to avoid modifying the original</span>
    <span class="n">new_soup</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>

    <span class="c1"># Traverse through all elements in the copied soup, targeting text nodes</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">new_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
        <span class="n">string</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>  <span class="c1"># Find all NavigableString text nodes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">truncated_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
                <span class="c1"># Replace the text with the truncated version in the copied soup</span>
                <span class="n">element</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">truncated_text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_soup</span>  <span class="c1"># Return the modified copy of the soup object</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_attribute_values</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract all unique attribute-value pairs for a given HTML tag across the soup.</p>
<p>For each attribute of the specified tag, store a set of all unique values
found across all occurrences of that tag in the soup.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content.</p>


<details class="tag-" open>
  <summary>str</summary>
  <p>The tag name to search for (e.g., 'span', 'div').</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--returns">Returns:</h6>
<p>dict[str, set[str]]
    A dictionary where keys are attribute names and values are sets of
    unique attribute values across all instances of the given tag.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_attribute_values--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('''
... <p class="text" id="para1">Paragraph</p>
... <p class="text" id="para2" style="color:red;">Styled paragraph</p>
... <p class="highlight" id="para2" style="color:blue;">Another paragraph</p>''', 'html.parser')
get_all_attribute_values(soup, 'p')
{'class': {'text', 'highlight'}, 'id': {'para1', 'para2'}, 'style': {'color:red;', 'color:blue;'}}</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_attribute_values</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all unique attribute-value pairs for a given HTML tag across the soup.</span>

<span class="sd">    For each attribute of the specified tag, store a set of all unique values</span>
<span class="sd">    found across all occurrences of that tag in the soup.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content.</span>

<span class="sd">    tag : str</span>
<span class="sd">        The tag name to search for (e.g., &#39;span&#39;, &#39;div&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict[str, set[str]]</span>
<span class="sd">        A dictionary where keys are attribute names and values are sets of</span>
<span class="sd">        unique attribute values across all instances of the given tag.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&#39;&#39;</span>
<span class="sd">    ... &lt;p class=&quot;text&quot; id=&quot;para1&quot;&gt;Paragraph&lt;/p&gt;</span>
<span class="sd">    ... &lt;p class=&quot;text&quot; id=&quot;para2&quot; style=&quot;color:red;&quot;&gt;Styled paragraph&lt;/p&gt;</span>
<span class="sd">    ... &lt;p class=&quot;highlight&quot; id=&quot;para2&quot; style=&quot;color:blue;&quot;&gt;Another paragraph&lt;/p&gt;&#39;&#39;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_all_attribute_values(soup, &#39;p&#39;)</span>
<span class="sd">    {&#39;class&#39;: {&#39;text&#39;, &#39;highlight&#39;}, &#39;id&#39;: {&#39;para1&#39;, &#39;para2&#39;}, &#39;style&#39;: {&#39;color:red;&#39;, &#39;color:blue;&#39;}}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes_with_values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Find all instances of the specified tag</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="c1"># Loop through each attribute in the element&#39;s attributes</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Add the attribute to the dictionary if not already present</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes_with_values</span><span class="p">:</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="c1"># Check if the value is a list (e.g., class=&quot;class1 class2&quot;) and handle accordingly</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">value</span>
                <span class="p">)</span>  <span class="c1"># Add all elements from the list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes_with_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Add a single value</span>

    <span class="k">return</span> <span class="n">attributes_with_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_tag_names</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract all unique HTML tag names from a BeautifulSoup object.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--returns">Returns:</h6>
<p>list[str]
    A list of all unique tag names in the soup, without content.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.get_all_tag_names--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<p>Paragraph</p><div><span>Text</span></div>', 'html.parser')
get_all_tag_names(soup)
['p', 'div', 'span']</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_tag_names</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all unique HTML tag names from a BeautifulSoup object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    list[str]</span>
<span class="sd">        A list of all unique tag names in the soup, without content.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;p&gt;Paragraph&lt;/p&gt;&lt;div&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/div&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_all_tag_names(soup)</span>
<span class="sd">    [&#39;p&#39;, &#39;div&#39;, &#39;span&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">({</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="kc">True</span><span class="p">)})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.normalize_newlines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>Normalize newline blocks in the input text by reducing consecutive newlines
to the specified number of newlines for consistent readability and formatting.

Parameters:
----------
text : str
    The input text containing inconsistent newline spacing.
spacing : int, optional
    The number of newlines to insert between lines. Defaults to 2.

Returns:
-------
str
    The text with consecutive newlines reduced to the specified number of newlines.

Example:
--------
&gt;&gt;&gt; raw_text = "Heading
</code></pre>
<p>Paragraph text 1
Paragraph text 2</p>
<p>"
    &gt;&gt;&gt; normalize_newlines(raw_text, spacing=2)
    'Heading</p>
<p>Paragraph text 1</p>
<p>Paragraph text 2</p>
<p>'</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_newlines</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">spacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize newline blocks in the input text by reducing consecutive newlines</span>
<span class="sd">    to the specified number of newlines for consistent readability and formatting.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The input text containing inconsistent newline spacing.</span>
<span class="sd">    spacing : int, optional</span>
<span class="sd">        The number of newlines to insert between lines. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The text with consecutive newlines reduced to the specified number of newlines.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; raw_text = &quot;Heading\n\n\nParagraph text 1\nParagraph text 2\n\n\n&quot;</span>
<span class="sd">    &gt;&gt;&gt; normalize_newlines(raw_text, spacing=2)</span>
<span class="sd">    &#39;Heading\n\nParagraph text 1\n\nParagraph text 2\n\n&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace one or more newlines with the desired number of newlines</span>
    <span class="n">newlines</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n{1,}&quot;</span><span class="p">,</span> <span class="n">newlines</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.normalize_quotes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_quotes</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Transforms all smart quotes in the input text to standard straight quotes.</p>
<p>This function replaces both single and double smart quotes (Unicode) with
their standard straight quote counterparts. Specifically, it:</p>
<ul>
<li>Converts left and right single smart quotes (‘ and ’) to ASCII single quote (').</li>
<li>Converts left and right double smart quotes (“ and ”) to ASCII double quote (").</li>
</ul>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--parameters">Parameters</h6>
<p>text : str
    The input text containing potential smart quotes.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--returns">Returns</h6>
<p>str
    The text with all smart quotes replaced by standard straight quotes.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>text = '“This is a ‘smart’ quoted text.”'
normalize_quotes(text)
'"This is a 'smart' quoted text."'</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.normalize_quotes--notes">Notes</h6>
<p>Smart quotes are often automatically inserted by word processors but can
introduce inconsistencies when parsing or tokenizing text data. This function
is useful for data preprocessing, ensuring uniform quote styles in text for
tasks like NLP model training or XML/HTML parsing.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_quotes</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms all smart quotes in the input text to standard straight quotes.</span>

<span class="sd">    This function replaces both single and double smart quotes (Unicode) with</span>
<span class="sd">    their standard straight quote counterparts. Specifically, it:</span>

<span class="sd">    - Converts left and right single smart quotes (‘ and ’) to ASCII single quote (&#39;).</span>
<span class="sd">    - Converts left and right double smart quotes (“ and ”) to ASCII double quote (&quot;).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The input text containing potential smart quotes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The text with all smart quotes replaced by standard straight quotes.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; text = &#39;“This is a ‘smart’ quoted text.”&#39;</span>
<span class="sd">    &gt;&gt;&gt; normalize_quotes(text)</span>
<span class="sd">    &#39;&quot;This is a \&#39;smart\&#39; quoted text.&quot;&#39;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Smart quotes are often automatically inserted by word processors but can</span>
<span class="sd">    introduce inconsistencies when parsing or tokenizing text data. This function</span>
<span class="sd">    is useful for data preprocessing, ensuring uniform quote styles in text for</span>
<span class="sd">    tasks like NLP model training or XML/HTML parsing.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace left and right double smart quotes with straight double quote</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u201C</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u201D</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u2018</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u2019</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_all_tags_with_attribute</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Remove unwanted tags with specific attributes from a BeautifulSoup object.</p>
<p>This function removes tags with a specific attribute (e.g., 'class') that matches a regular expression pattern.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to match (e.g., 'class', 'id'). If None, no attribute filtering is done.</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only tags whose specified attribute
matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_all_tags_with_attribute--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_all_tags_with_attribute(soup, attr_name='class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_all_tags_with_attribute</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove unwanted tags with specific attributes from a BeautifulSoup object.</span>

<span class="sd">    This function removes tags with a specific attribute (e.g., &#39;class&#39;) that matches a regular expression pattern.</span>


<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to match (e.g., &#39;class&#39;, &#39;id&#39;). If None, no attribute filtering is done.</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only tags whose specified attribute</span>
<span class="sd">        matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_all_tags_with_attribute(soup, attr_name=&#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tags_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Find all tags in the soup</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># If an attribute name is specified, filter tags by the attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Check if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="p">:</span>
            <span class="c1"># If no attribute is specified, remove the entire tag</span>
            <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="c1"># Remove all collected tags</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.remove_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_attributes</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Remove unwanted attributes from a specific tag or all tags in a BeautifulSoup object.</p>
<p>This function removes attributes based on the tag name and/or attribute value pattern. It can:
- Remove attributes from a specific tag (e.g., 'div').
- Remove attributes with a specific attribute value that matches a regular expression pattern.
- Remove attributes from all tags if no specific tag is provided.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_attributes--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to remove (e.g., 'class', 'id').</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only attributes whose values
match this pattern will be removed. If None, the attribute will be removed unconditionally.</p>
</details>

<details class="tag-" open>
  <summary>str, optional</summary>
  <p>The tag name to filter by (e.g., 'div', 'span'). If None, the attribute will be removed
from all tags that have the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_attributes--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted attributes.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_attributes--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_attributes(soup, attr_name='class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<div>Text</div>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_attributes</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove unwanted attributes from a specific tag or all tags in a BeautifulSoup object.</span>

<span class="sd">    This function removes attributes based on the tag name and/or attribute value pattern. It can:</span>
<span class="sd">    - Remove attributes from a specific tag (e.g., &#39;div&#39;).</span>
<span class="sd">    - Remove attributes with a specific attribute value that matches a regular expression pattern.</span>
<span class="sd">    - Remove attributes from all tags if no specific tag is provided.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to remove (e.g., &#39;class&#39;, &#39;id&#39;).</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only attributes whose values</span>
<span class="sd">        match this pattern will be removed. If None, the attribute will be removed unconditionally.</span>

<span class="sd">    tag : str, optional</span>
<span class="sd">        The tag name to filter by (e.g., &#39;div&#39;, &#39;span&#39;). If None, the attribute will be removed</span>
<span class="sd">        from all tags that have the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_attributes(soup, attr_name=&#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;div&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Find all tags, filtered by tag name if provided</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span> <span class="ow">or</span> <span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Check if the tag has the specified attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>

            <span class="c1"># Check if we are matching the attribute value against a pattern</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="c1"># If the attribute value is a list (e.g., for class attribute), handle that case</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Remove the attribute if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="c1"># For single values, remove the attribute if it matches the pattern</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no pattern is specified, remove the attribute unconditionally</span>
                <span class="k">del</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_empty_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Remove empty tags from a BeautifulSoup object based on a specified list or space-separated string of tag names.</p>
<p>This function examines each specified tag and checks if it is empty (contains no visible text).
If a tag contains only nested elements (i.e., descendants) but no visible text, it will be unwrapped
(preserving the nested content). Tags that contain neither text nor descendants are completely removed
from the document.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML or XML content to clean.</p>


<details class="tag_list-" open>
  <summary>list or str</summary>
  <p>A list of tag names (e.g., ['div', 'a']) or a space-separated string (e.g., 'div a') specifying
which tags should be checked and removed if empty. Only tags matching these names will be considered.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--returns">Returns:</h6>
<p>None
    This function modifies the BeautifulSoup object in place, removing or unwrapping tags as needed.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div></div><a href='link'><span></span></a><p>Content</p>"
soup = BeautifulSoup(html_content, 'html.parser')
remove_empty_tags(soup, 'div a')
print(soup)
<span></span><p>Content</p></p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_empty_tags--notes">Notes:</h6>
<ul>
<li>This function relies on two helper functions, <code>tag_has_visible_text</code> and <code>tag_has_descendants</code>:<ul>
<li><code>tag_has_visible_text(tag)</code>: Returns True if the tag contains visible text (ignoring whitespace).</li>
<li><code>tag_has_descendants(tag)</code>: Returns True if the tag has nested elements (descendants).</li>
</ul>
</li>
<li>The function operates in place, meaning it directly modifies the <code>soup</code> object passed to it.</li>
<li>Tags with descendants but no visible text are unwrapped rather than removed, ensuring that nested
  content remains intact.</li>
<li>Useful for cleaning up HTML or XML content by removing purely empty elements without affecting structure.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_empty_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove empty tags from a BeautifulSoup object based on a specified list or space-separated string of tag names.</span>

<span class="sd">    This function examines each specified tag and checks if it is empty (contains no visible text).</span>
<span class="sd">    If a tag contains only nested elements (i.e., descendants) but no visible text, it will be unwrapped</span>
<span class="sd">    (preserving the nested content). Tags that contain neither text nor descendants are completely removed</span>
<span class="sd">    from the document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML or XML content to clean.</span>

<span class="sd">    tag_list : list or str</span>
<span class="sd">        A list of tag names (e.g., [&#39;div&#39;, &#39;a&#39;]) or a space-separated string (e.g., &#39;div a&#39;) specifying</span>
<span class="sd">        which tags should be checked and removed if empty. Only tags matching these names will be considered.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        This function modifies the BeautifulSoup object in place, removing or unwrapping tags as needed.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;&lt;/div&gt;&lt;a href=&#39;link&#39;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;Content&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_empty_tags(soup, &#39;div a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;span&gt;&lt;/span&gt;&lt;p&gt;Content&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function relies on two helper functions, `tag_has_visible_text` and `tag_has_descendants`:</span>
<span class="sd">        - `tag_has_visible_text(tag)`: Returns True if the tag contains visible text (ignoring whitespace).</span>
<span class="sd">        - `tag_has_descendants(tag)`: Returns True if the tag has nested elements (descendants).</span>
<span class="sd">    - The function operates in place, meaning it directly modifies the `soup` object passed to it.</span>
<span class="sd">    - Tags with descendants but no visible text are unwrapped rather than removed, ensuring that nested</span>
<span class="sd">      content remains intact.</span>
<span class="sd">    - Useful for cleaning up HTML or XML content by removing purely empty elements without affecting structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure tag_list is a list, even if passed as a space-separated string</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># Process tags in tag_list to either unwrap or remove</span>
    <span class="k">for</span> <span class="n">tag_name</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag_name</span><span class="p">):</span>
            <span class="c1"># Check if the tag is empty (no text content) and has no nested elements</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                    <span class="c1"># Tag has descendants, so unwrap it instead of decomposing</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Tag is truly empty of meaningful content, so decompose it</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.remove_tag_whitespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_tag_whitespace</span><span class="p">(</span><span class="n">html_str</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Removes any whitespace between adjacent HTML tags in an HTML string. This function is
designed to clean up HTML content by minimizing unnecessary spacing between elements,
which can improve readability in structured processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>html_str</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The HTML string to be processed. Must be well-formed for accurate parsing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned HTML string with no whitespace between adjacent tags. Tags that
 originally had whitespace between them will now be directly adjacent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>html_str = "<body> <p>This is some text.</p>   <br> </body>"
remove_tag_whitespace(html_str)
'<body><p>This is some text.</p><br></body>'</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function uses BeautifulSoup to parse the HTML and then removes whitespace between
  tags using a regular expression.</li>
<li>The function assumes that <code>html_str</code> is a well-formed HTML string. Malformed HTML may
  lead to unexpected behavior.</li>
<li>BeautifulSoup automatically corrects certain HTML issues, so the output may differ
  slightly in structure if the input was not well-formed.</li>
</ul>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input is not a valid HTML string or is an empty string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_tag_whitespace</span><span class="p">(</span><span class="n">html_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes any whitespace between adjacent HTML tags in an HTML string. This function is</span>
<span class="sd">    designed to clean up HTML content by minimizing unnecessary spacing between elements,</span>
<span class="sd">    which can improve readability in structured processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        html_str (str): The HTML string to be processed. Must be well-formed for accurate parsing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The cleaned HTML string with no whitespace between adjacent tags. Tags that</span>
<span class="sd">             originally had whitespace between them will now be directly adjacent.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; html_str = &quot;&lt;body&gt; &lt;p&gt;This is some text.&lt;/p&gt;   &lt;br&gt; &lt;/body&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; remove_tag_whitespace(html_str)</span>
<span class="sd">        &#39;&lt;body&gt;&lt;p&gt;This is some text.&lt;/p&gt;&lt;br&gt;&lt;/body&gt;&#39;</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function uses BeautifulSoup to parse the HTML and then removes whitespace between</span>
<span class="sd">          tags using a regular expression.</span>
<span class="sd">        - The function assumes that `html_str` is a well-formed HTML string. Malformed HTML may</span>
<span class="sd">          lead to unexpected behavior.</span>
<span class="sd">        - BeautifulSoup automatically corrects certain HTML issues, so the output may differ</span>
<span class="sd">          slightly in structure if the input was not well-formed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input is not a valid HTML string or is an empty string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">html_str</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input HTML string cannot be empty or whitespace-only.&quot;</span><span class="p">)</span>

    <span class="c1"># Use BeautifulSoup to parse and normalize the HTML structure</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_str</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

    <span class="c1"># return after converting back to string and using regex to remove whitespace between tags.</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&gt;\s+&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&lt;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_tags_with_attribute</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Remove a specific tags with specific attributes from a BeautifulSoup object.</p>
<p>This function removes tags with a specific attribute (e.g., 'class') that matches a regular expression pattern.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>
<p>tag_list : the list of tags to remove if matching attribute is found; if a single string, then this string is split into tags.</p>


<details class="attr_name-" open>
  <summary>str</summary>
  <p>The attribute name to match (e.g., 'class', 'id'). If None, no attribute filtering is done.</p>
</details>

<details class="attr_value_pattern-" open>
  <summary>str, optional</summary>
  <p>A regular expression pattern to match attribute values. Only tags whose specified attribute
matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--returns">Returns:</h6>
<p>None
    The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.remove_tags_with_attribute--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>soup = BeautifulSoup('<div class="calibre1">Text</div><p class="keep">Keep me</p>', 'html.parser')
remove_tags_with_attribute(soup, 'div', 'class', attr_value_pattern=r'calibre.*')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p class="keep">Keep me</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_tags_with_attribute</span><span class="p">(</span>
    <span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span>
    <span class="n">tag_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attr_value_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a specific tags with specific attributes from a BeautifulSoup object.</span>

<span class="sd">    This function removes tags with a specific attribute (e.g., &#39;class&#39;) that matches a regular expression pattern.</span>


<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    tag_list : the list of tags to remove if matching attribute is found; if a single string, then this string is split into tags.</span>

<span class="sd">    attr_name : str</span>
<span class="sd">        The attribute name to match (e.g., &#39;class&#39;, &#39;id&#39;). If None, no attribute filtering is done.</span>

<span class="sd">    attr_value_pattern : str, optional</span>
<span class="sd">        A regular expression pattern to match attribute values. Only tags whose specified attribute</span>
<span class="sd">        matches this pattern will be removed. If None, the function removes all tags with the specified attribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        The function modifies the BeautifulSoup object in place, removing the unwanted tags or attributes.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(&#39;&lt;div class=&quot;calibre1&quot;&gt;Text&lt;/div&gt;&lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;&#39;, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_tags_with_attribute(soup, &#39;div&#39;, &#39;class&#39;, attr_value_pattern=r&#39;calibre.*&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p class=&quot;keep&quot;&gt;Keep me&lt;/p&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">tags_to_remove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Find all tags in the soup</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="o">*</span><span class="n">tag_list</span><span class="p">):</span>
        <span class="c1"># If an attribute name is specified, filter tags by the attribute</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr_value_pattern</span><span class="p">:</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="c1"># Check if any value in the list matches the pattern</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">):</span>
                        <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr_value_pattern</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="p">:</span>
            <span class="c1"># If no attribute is specified, remove the entire tag</span>
            <span class="n">tags_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="c1"># Remove all collected tags</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_to_remove</span><span class="p">:</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Check if a BeautifulSoup tag has any descendants (nested elements), such as child tags
or text nodes.</p>
<p>This function is useful for determining if a tag contains any nested structure, whether
directly or indirectly, as opposed to being a standalone empty tag.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--parameters">Parameters:</h6>
<p>tag : BeautifulSoup tag
    The BeautifulSoup tag to check for descendants.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--returns">Returns:</h6>
<p>bool
    True if the tag contains any descendants (nested tags or text nodes), otherwise False.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div><p>Text inside paragraph.</p></div>"
soup = BeautifulSoup(html_content, 'html.parser')
div_tag = soup.find('div')
tag_has_descendants(div_tag)
True</p>
<p>empty_tag = soup.new_tag('div')
tag_has_descendants(empty_tag)
False</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_descendants--notes">Notes:</h6>
<ul>
<li>This function checks if there are any nested tags or text nodes within the tag,
  regardless of depth. If the tag has even a single nested element, it returns True.</li>
<li>Ideal for use in filtering or cleaning HTML where nested structures are significant.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tag_has_descendants</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a BeautifulSoup tag has any descendants (nested elements), such as child tags</span>
<span class="sd">    or text nodes.</span>

<span class="sd">    This function is useful for determining if a tag contains any nested structure, whether</span>
<span class="sd">    directly or indirectly, as opposed to being a standalone empty tag.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    tag : BeautifulSoup tag</span>
<span class="sd">        The BeautifulSoup tag to check for descendants.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the tag contains any descendants (nested tags or text nodes), otherwise False.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;&lt;p&gt;Text inside paragraph.&lt;/p&gt;&lt;/div&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; div_tag = soup.find(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_descendants(div_tag)</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; empty_tag = soup.new_tag(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_descendants(empty_tag)</span>
<span class="sd">    False</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function checks if there are any nested tags or text nodes within the tag,</span>
<span class="sd">      regardless of depth. If the tag has even a single nested element, it returns True.</span>
<span class="sd">    - Ideal for use in filtering or cleaning HTML where nested structures are significant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">descendants</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Check if a BeautifulSoup tag has visible text content, meaning it contains text that is not
solely whitespace.</p>
<p>This function is useful for determining whether a tag has meaningful text content, as opposed to
being empty or containing only whitespace.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--parameters">Parameters:</h6>
<p>tag : BeautifulSoup tag
    The BeautifulSoup tag to check for visible text content.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--returns">Returns:</h6>
<p>bool
    True if the tag contains visible text (after stripping whitespace), otherwise False.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = "<div>   </div><p>This is text content.</p>"
soup = BeautifulSoup(html_content, 'html.parser')
div_tag = soup.find('div')
tag_has_visible_text(div_tag)
False</p>
<p>p_tag = soup.find('p')
tag_has_visible_text(p_tag)
True</p>
</blockquote>
</blockquote>
</blockquote>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.tag_has_visible_text--notes">Notes:</h6>
<ul>
<li>This function ignores any nested tags, focusing only on direct visible text content.</li>
<li>Whitespace-only content is considered empty and will return False.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tag_has_visible_text</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a BeautifulSoup tag has visible text content, meaning it contains text that is not</span>
<span class="sd">    solely whitespace.</span>

<span class="sd">    This function is useful for determining whether a tag has meaningful text content, as opposed to</span>
<span class="sd">    being empty or containing only whitespace.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    tag : BeautifulSoup tag</span>
<span class="sd">        The BeautifulSoup tag to check for visible text content.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the tag contains visible text (after stripping whitespace), otherwise False.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &quot;&lt;div&gt;   &lt;/div&gt;&lt;p&gt;This is text content.&lt;/p&gt;&quot;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; div_tag = soup.find(&#39;div&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_visible_text(div_tag)</span>
<span class="sd">    False</span>

<span class="sd">    &gt;&gt;&gt; p_tag = soup.find(&#39;p&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tag_has_visible_text(p_tag)</span>
<span class="sd">    True</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function ignores any nested tags, focusing only on direct visible text content.</span>
<span class="sd">    - Whitespace-only content is considered empty and will return False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwrap_redundant_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Unwrap tags that do not have any attributes and contain only a single child tag,
by first collecting tags to unwrap, then processing them in a separate loop.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--parameters">Parameters:</h6>
<p>soup : BeautifulSoup
    The parsed HTML content to clean.</p>


<details class="tag_list-" open>
  <summary>list or str</summary>
  <p>A list of tag names (e.g., ['span', 'a']) or a space-separated string (e.g., 'span a') specifying
which tags should be checked and unwrapped if redundant.</p>
</details>        <h6 id="tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--returns">Returns:</h6>
<p>None
    This function modifies the BeautifulSoup object in place, unwrapping redundant tags as needed.</p>
<h6 id="tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--example">Example:</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from bs4 import BeautifulSoup
html_content = '''
... <p><span><span class="bold">Table of Contents</span></span></p>
... <p><a><span class="italic"><span class="underline">Title Page</span></span></a></p>
... '''
soup = BeautifulSoup(html_content, 'html.parser')
unwrap_redundant_tags(soup, 'span a')
print(soup)</p>
</blockquote>
</blockquote>
</blockquote>
<p><span class="bold">Table of Contents</span></p>
<p><span class="italic"><span class="underline">Title Page</span></span></p>

<h6 id="tnh_scholar.text_processing.clean_parse_tag.unwrap_redundant_tags--notes">Notes:</h6>
<ul>
<li>This function only unwraps tags that contain no attributes and have a single child with identical text content.</li>
<li>The function operates in place, meaning it directly modifies the <code>soup</code> object passed to it.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/clean_parse_tag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unwrap_redundant_tags</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unwrap tags that do not have any attributes and contain only a single child tag,</span>
<span class="sd">    by first collecting tags to unwrap, then processing them in a separate loop.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    soup : BeautifulSoup</span>
<span class="sd">        The parsed HTML content to clean.</span>

<span class="sd">    tag_list : list or str</span>
<span class="sd">        A list of tag names (e.g., [&#39;span&#39;, &#39;a&#39;]) or a space-separated string (e.g., &#39;span a&#39;) specifying</span>
<span class="sd">        which tags should be checked and unwrapped if redundant.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        This function modifies the BeautifulSoup object in place, unwrapping redundant tags as needed.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from bs4 import BeautifulSoup</span>
<span class="sd">    &gt;&gt;&gt; html_content = &#39;&#39;&#39;</span>
<span class="sd">    ... &lt;p&gt;&lt;span&gt;&lt;span class=&quot;bold&quot;&gt;Table of Contents&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</span>
<span class="sd">    ... &lt;p&gt;&lt;a&gt;&lt;span class=&quot;italic&quot;&gt;&lt;span class=&quot;underline&quot;&gt;Title Page&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; soup = BeautifulSoup(html_content, &#39;html.parser&#39;)</span>
<span class="sd">    &gt;&gt;&gt; unwrap_redundant_tags(soup, &#39;span a&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(soup)</span>
<span class="sd">    &lt;p&gt;&lt;span class=&quot;bold&quot;&gt;Table of Contents&lt;/span&gt;&lt;/p&gt;</span>
<span class="sd">    &lt;p&gt;&lt;span class=&quot;italic&quot;&gt;&lt;span class=&quot;underline&quot;&gt;Title Page&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - This function only unwraps tags that contain no attributes and have a single child with identical text content.</span>
<span class="sd">    - The function operates in place, meaning it directly modifies the `soup` object passed to it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tag_list</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># Step 1: Collect tags to unwrap</span>
    <span class="n">tags_to_unwrap</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Determines if a tag is redundant by checking three conditions:</span>
<span class="sd">            1. Has no attributes (preserves styled/classed tags)</span>
<span class="sd">            2. Contains exactly one child element</span>
<span class="sd">            3. Child is a Tag instance (not NavigableString/Comment)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">is_redundant_wrapper</span> <span class="o">=</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrs</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tag</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_redundant_wrapper</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">child</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="n">tags_to_unwrap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.text_processing.initial_cleaning_scripts" class="doc doc-heading">
            <code>initial_cleaning_scripts</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.text_processing.initial_cleaning_scripts.nlp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.initial_cleaning_scripts.clean_and_tag_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_and_tag_text</span><span class="p">(</span><span class="n">content_with_metadata</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/initial_cleaning_scripts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_and_tag_text</span><span class="p">(</span><span class="n">content_with_metadata</span><span class="p">):</span>
    <span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_with_metadata</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">sents</span><span class="p">]</span>

        <span class="c1"># Store cleaned text alongside metadata</span>
        <span class="n">cleaned_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;chapter&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;chapter&quot;</span><span class="p">],</span>
                <span class="s2">&quot;sentences&quot;</span><span class="p">:</span> <span class="n">sentences</span><span class="p">,</span>
                <span class="c1"># Add page number here if available</span>
                <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">cleaned_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.initial_cleaning_scripts.extract_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_content</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts content from a BeautifulSoup object considering blockquotes, spans, and paragraphs.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/initial_cleaning_scripts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_content</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts content from a BeautifulSoup object considering blockquotes, spans, and paragraphs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chapter_title</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Look for blockquote or span elements that might contain the chapter title</span>
    <span class="n">possible_titles</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">([</span><span class="s2">&quot;blockquote&quot;</span><span class="p">,</span> <span class="s2">&quot;span&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">possible_titles</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Chapter&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>  <span class="c1"># Basic check for chapter titles</span>
            <span class="n">chapter_title</span> <span class="o">=</span> <span class="n">text</span>
            <span class="k">break</span>  <span class="c1"># Stop after finding the first relevant title</span>

    <span class="c1"># Collect paragraphs and blockquote content</span>
    <span class="n">paragraphs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">([</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;blockquote&quot;</span><span class="p">]):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">para</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>  <span class="c1"># Only add non-empty text</span>
            <span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">chapter_title</span><span class="p">,</span> <span class="n">paragraphs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.initial_cleaning_scripts.extract_text_and_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_text_and_metadata</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts text, chapter titles, and metadata (like book title and author) from an EPUB file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the EPUB file to be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with metadata (title, author) and a list of chapter texts.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/initial_cleaning_scripts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_text_and_metadata</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts text, chapter titles, and metadata (like book title and author) from an EPUB file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path to the EPUB file to be processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary with metadata (title, author) and a list of chapter texts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read the EPUB file</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">epub</span><span class="o">.</span><span class="n">read_epub</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">content_with_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;chapters&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Extract metadata (title and author)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;DC&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">content_with_metadata</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">author</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;DC&quot;</span><span class="p">,</span> <span class="s2">&quot;creator&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">author</span><span class="p">:</span>
        <span class="n">content_with_metadata</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">author</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get items of the desired media type (HTML content)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">get_items_of_media_type</span><span class="p">(</span><span class="s2">&quot;application/xhtml+xml&quot;</span><span class="p">):</span>
        <span class="c1"># Parse the HTML content using BeautifulSoup</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_body_content</span><span class="p">(),</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

        <span class="n">chapter_title</span><span class="p">,</span> <span class="n">chapter_content</span> <span class="o">=</span> <span class="n">extract_content</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
        <span class="n">content_with_metadata</span><span class="p">[</span><span class="s2">&quot;chapters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;chapter&quot;</span><span class="p">:</span> <span class="n">chapter_title</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">chapter_content</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">content_with_metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.text_processing.numbered_text" class="doc doc-heading">
            <code>numbered_text</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.text_processing.numbered_text.NumberedFormat" class="doc doc-heading">
            <code>NumberedFormat</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>







              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumberedFormat</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">is_numbered</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">separator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">start_num</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedFormat.is_numbered" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_numbered</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedFormat.separator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">separator</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedFormat.start_num" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_num</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.text_processing.numbered_text.NumberedText" class="doc doc-heading">
            <code>NumberedText</code>


</h5>


    <div class="doc doc-contents ">


        <p>Represents a text document with numbered lines for easy reference and manipulation.</p>
<p>Provides utilities for working with line-numbered text including reading,
writing, accessing lines by number, and iterating over numbered lines.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.lines" href="#tnh_scholar.text_processing.numbered_text.NumberedText.lines">lines</a></code></td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of text lines</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.start" href="#tnh_scholar.text_processing.numbered_text.NumberedText.start">start</a></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number (default: 1)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.separator" href="#tnh_scholar.text_processing.numbered_text.NumberedText.separator">separator</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator between line number and content (default: ": ")</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;First line</span><span class="se">\n</span><span class="s2">Second line</span><span class="se">\n\n</span><span class="s2">Fourth line&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="go">1: First line</span>
<span class="go">2: Second line</span>
<span class="go">3:</span>
<span class="go">4: Fourth line</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">get_line</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="go">Second line</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumberedText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a text document with numbered lines for easy reference and manipulation.</span>

<span class="sd">    Provides utilities for working with line-numbered text including reading,</span>
<span class="sd">    writing, accessing lines by number, and iterating over numbered lines.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        lines (List[str]): List of text lines</span>
<span class="sd">        start (int): Starting line number (default: 1)</span>
<span class="sd">        separator (str): Separator between line number and content (default: &quot;: &quot;)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text = &quot;First line\\nSecond line\\n\\nFourth line&quot;</span>
<span class="sd">        &gt;&gt;&gt; doc = NumberedText(text)</span>
<span class="sd">        &gt;&gt;&gt; print(doc)</span>
<span class="sd">        1: First line</span>
<span class="sd">        2: Second line</span>
<span class="sd">        3:</span>
<span class="sd">        4: Fourth line</span>

<span class="sd">        &gt;&gt;&gt; print(doc.get_line(2))</span>
<span class="sd">        Second line</span>

<span class="sd">        &gt;&gt;&gt; for num, line in doc:</span>
<span class="sd">        ...     print(f&quot;Line {num}: {len(line)} chars&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">LineSegment</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represents a segment of lines with start and end indices in 1-based indexing.</span>

<span class="sd">        The segment follows Python range conventions where start is inclusive and</span>
<span class="sd">        end is exclusive. However, indexing is 1-based to match NumberedText.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            start: Starting line number (inclusive, 1-based)</span>
<span class="sd">            end: Ending line number (exclusive, 1-based)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Allow unpacking into start, end pairs.&quot;&quot;&quot;</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>

    <span class="k">class</span> <span class="nc">SegmentIterator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterator for generating line segments of specified size.</span>

<span class="sd">        Produces segments of lines with start/end indices following 1-based indexing.</span>
<span class="sd">        The final segment may be smaller than the specified segment size.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            total_lines: Total number of lines in text</span>
<span class="sd">            segment_size: Number of lines per segment</span>
<span class="sd">            start_line: Starting line number (1-based)</span>
<span class="sd">            min_segment_size: Minimum size for the final segment</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">total_lines</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">min_segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialize the segment iterator.</span>

<span class="sd">            Args:</span>
<span class="sd">                total_lines: Total number of lines to iterate over</span>
<span class="sd">                segment_size: Desired size of each segment</span>
<span class="sd">                start_line: First line number (default: 1)</span>
<span class="sd">                min_segment_size: Minimum size for final segment (default: None)</span>
<span class="sd">                    If specified, the last segment will be merged with the previous one</span>
<span class="sd">                    if it would be smaller than this size.</span>

<span class="sd">            Raises:</span>
<span class="sd">                ValueError: If segment_size &lt; 1 or total_lines &lt; 1</span>
<span class="sd">                ValueError: If start_line &lt; 1 (must use 1-based indexing)</span>
<span class="sd">                ValueError: If min_segment_size &gt;= segment_size</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">segment_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Segment size must be at least 1&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_lines</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Total lines must be at least 1&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_line</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start line must be at least 1 (1-based indexing)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_segment_size</span> <span class="o">&gt;=</span> <span class="n">segment_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum segment size must be less than segment size&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">=</span> <span class="n">total_lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="o">=</span> <span class="n">min_segment_size</span>

            <span class="c1"># Calculate number of segments</span>
            <span class="n">remaining_lines</span> <span class="o">=</span> <span class="n">total_lines</span> <span class="o">-</span> <span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">=</span> <span class="p">(</span><span class="n">remaining_lines</span> <span class="o">+</span> <span class="n">segment_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">segment_size</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s2">&quot;NumberedText.LineSegment&quot;</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Iterate over line segments.</span>

<span class="sd">            Yields:</span>
<span class="sd">                LineSegment containing start (inclusive) and end (exclusive) indices</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
                <span class="n">is_last_segment</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">segment_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Handle minimum segment size for last segment</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">is_last_segment</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">segment_end</span> <span class="o">-</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span>
                    <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="c1"># Merge with previous segment by not yielding</span>
                    <span class="k">break</span>

                <span class="k">yield</span> <span class="n">NumberedText</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">segment_end</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">segment_end</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a numbered text document, detecting and preserving existing numbering.</span>

<span class="sd">        Valid numbered text must have:</span>
<span class="sd">        - Sequential line numbers</span>
<span class="sd">        - Consistent separator character(s)</span>
<span class="sd">        - Every non-empty line must follow the numbering pattern</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Initial text content, if any</span>
<span class="sd">            start: Starting line number (used only if content isn&#39;t already numbered)</span>
<span class="sd">            separator: Separator between line numbers and content (only if content isn&#39;t numbered)</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Custom separators</span>
<span class="sd">            &gt;&gt;&gt; doc = NumberedText(&quot;1→First line\\n2→Second line&quot;)</span>
<span class="sd">            &gt;&gt;&gt; doc.separator == &quot;→&quot;</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; # Preserves starting number</span>
<span class="sd">            &gt;&gt;&gt; doc = NumberedText(&quot;5#First\\n6#Second&quot;)</span>
<span class="sd">            &gt;&gt;&gt; doc.start == 5</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; # Regular numbered list isn&#39;t treated as line numbers</span>
<span class="sd">            &gt;&gt;&gt; doc = NumberedText(&quot;1. First item\\n2. Second item&quot;)</span>
<span class="sd">            &gt;&gt;&gt; doc.numbered_lines</span>
<span class="sd">            [&#39;1: 1. First item&#39;, &#39;2: 2. Second item&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Declare lines here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">start</span>  <span class="c1"># Declare start with its type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">separator</span>  <span class="c1"># and separator</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;NumberedText requires string input.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># enforce 1 based indexing.</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="s2">&quot;NumberedText: Numbered lines must begin on an integer great or equal to 1.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Analyze the text format</span>
        <span class="n">is_numbered</span><span class="p">,</span> <span class="n">detected_sep</span><span class="p">,</span> <span class="n">start_num</span> <span class="o">=</span> <span class="n">get_numbered_format</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="n">format_info</span> <span class="o">=</span> <span class="n">get_numbered_format</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">format_info</span><span class="o">.</span><span class="n">is_numbered</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">format_info</span><span class="o">.</span><span class="n">start_num</span>  <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">format_info</span><span class="o">.</span><span class="n">separator</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Extract content by removing number and separator</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^\d+</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">detected_sep</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumberedText&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a NumberedText instance from a file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line_num</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_to_internal_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the index into the lines object in Python 0-based indexing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># allow negative indexing to index from end</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NumberedText: negative index out of range: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">idx</span>  <span class="c1"># convert to logical positive location for reference.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;NumberedText: Index cannot be zero in 1-based indexing.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the numbered text representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of lines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over (line_number, line_content) pairs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get line content by line number (1-based indexing).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get content of specified line number.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_to_line_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">internal_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">internal_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_numbered_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get specified line with line number.&quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_line_index</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get content of line range, not inclusive of end line.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">get_numbered_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start index </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> is before first line </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End index </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2"> is past last line </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start index </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> must be less than end index </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">iter_segments</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">LineSegment</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over segments of the text with specified size.</span>

<span class="sd">        Args:</span>
<span class="sd">            segment_size: Number of lines per segment</span>
<span class="sd">            min_segment_size: Optional minimum size for final segment.</span>
<span class="sd">                If specified, last segment will be merged with previous one</span>
<span class="sd">                if it would be smaller than this size.</span>

<span class="sd">        Yields:</span>
<span class="sd">            LineSegment objects containing start and end line numbers</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; text = NumberedText(&quot;line1\\nline2\\nline3\\nline4\\nline5&quot;)</span>
<span class="sd">            &gt;&gt;&gt; for segment in text.iter_segments(2):</span>
<span class="sd">            ...     print(f&quot;Lines {segment.start}-{segment.end}&quot;)</span>
<span class="sd">            Lines 1-3</span>
<span class="sd">            Lines 3-5</span>
<span class="sd">            Lines 5-6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SegmentIterator</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">segment_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">min_segment_size</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_numbered_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_numbered_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">numbered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save document to file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Output file path</span>
<span class="sd">            numbered: Whether to save with line numbers (default: True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">numbered</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Append text, splitting into lines if needed.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert text at specified line number. Assumes text is not empty.&quot;&quot;&quot;</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">internal_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">internal_idx</span><span class="p">:</span><span class="n">internal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lines</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get original text without line numbers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of lines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numbered_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get list of lines with line numbers included.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: Lines with numbers and separator prefixed</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; doc = NumberedText(&quot;First line\\nSecond line&quot;)</span>
<span class="sd">            &gt;&gt;&gt; doc.numbered_lines</span>
<span class="sd">            [&#39;1: First line&#39;, &#39;2: Second line&#39;]</span>

<span class="sd">        Note:</span>
<span class="sd">            - Unlike str(self), this returns a list rather than joined string</span>
<span class="sd">            - Maintains consistent formatting with separator</span>
<span class="sd">            - Useful for processing or displaying individual numbered lines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">content</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Get original text without line numbers.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.numbered_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">numbered_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Get list of lines with line numbers included.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: Lines with numbers and separator prefixed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="s2">&quot;First line</span><span class="se">\n</span><span class="s2">Second line&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">numbered_lines</span>
<span class="go">[&#39;1: First line&#39;, &#39;2: Second line&#39;]</span>
</code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Unlike str(self), this returns a list rather than joined string</li>
<li>Maintains consistent formatting with separator</li>
<li>Useful for processing or displaying individual numbered lines</li>
</ul>
</details>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.separator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Get the number of lines.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span> <span class="o">=</span> <span class="n">start</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment" class="doc doc-heading">
            <code>LineSegment</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">


        <p>Represents a segment of lines with start and end indices in 1-based indexing.</p>
<p>The segment follows Python range conventions where start is inclusive and
end is exclusive. However, indexing is 1-based to match NumberedText.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.start" href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.start">start</a></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number (inclusive, 1-based)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.end" href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.end">end</a></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ending line number (exclusive, 1-based)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LineSegment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a segment of lines with start and end indices in 1-based indexing.</span>

<span class="sd">    The segment follows Python range conventions where start is inclusive and</span>
<span class="sd">    end is exclusive. However, indexing is 1-based to match NumberedText.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        start: Starting line number (inclusive, 1-based)</span>
<span class="sd">        end: Ending line number (exclusive, 1-based)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow unpacking into start, end pairs.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment.__iter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__iter__</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Allow unpacking into start, end pairs.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allow unpacking into start, end pairs.&quot;&quot;&quot;</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator" class="doc doc-heading">
            <code>SegmentIterator</code>


</h6>


    <div class="doc doc-contents ">


        <p>Iterator for generating line segments of specified size.</p>
<p>Produces segments of lines with start/end indices following 1-based indexing.
The final segment may be smaller than the specified segment size.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.total_lines" href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.total_lines">total_lines</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of lines in text</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.segment_size" href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.segment_size">segment_size</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of lines per segment</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.start_line" href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.start_line">start_line</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number (1-based)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.min_segment_size" href="#tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.min_segment_size">min_segment_size</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum size for the final segment</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SegmentIterator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterator for generating line segments of specified size.</span>

<span class="sd">    Produces segments of lines with start/end indices following 1-based indexing.</span>
<span class="sd">    The final segment may be smaller than the specified segment size.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        total_lines: Total number of lines in text</span>
<span class="sd">        segment_size: Number of lines per segment</span>
<span class="sd">        start_line: Starting line number (1-based)</span>
<span class="sd">        min_segment_size: Minimum size for the final segment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">total_lines</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the segment iterator.</span>

<span class="sd">        Args:</span>
<span class="sd">            total_lines: Total number of lines to iterate over</span>
<span class="sd">            segment_size: Desired size of each segment</span>
<span class="sd">            start_line: First line number (default: 1)</span>
<span class="sd">            min_segment_size: Minimum size for final segment (default: None)</span>
<span class="sd">                If specified, the last segment will be merged with the previous one</span>
<span class="sd">                if it would be smaller than this size.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If segment_size &lt; 1 or total_lines &lt; 1</span>
<span class="sd">            ValueError: If start_line &lt; 1 (must use 1-based indexing)</span>
<span class="sd">            ValueError: If min_segment_size &gt;= segment_size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">segment_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Segment size must be at least 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_lines</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Total lines must be at least 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_line</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start line must be at least 1 (1-based indexing)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_segment_size</span> <span class="o">&gt;=</span> <span class="n">segment_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum segment size must be less than segment size&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">=</span> <span class="n">total_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="o">=</span> <span class="n">min_segment_size</span>

        <span class="c1"># Calculate number of segments</span>
        <span class="n">remaining_lines</span> <span class="o">=</span> <span class="n">total_lines</span> <span class="o">-</span> <span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">=</span> <span class="p">(</span><span class="n">remaining_lines</span> <span class="o">+</span> <span class="n">segment_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">segment_size</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s2">&quot;NumberedText.LineSegment&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over line segments.</span>

<span class="sd">        Yields:</span>
<span class="sd">            LineSegment containing start (inclusive) and end (exclusive) indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
            <span class="n">is_last_segment</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">segment_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Handle minimum segment size for last segment</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">is_last_segment</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">segment_end</span> <span class="o">-</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span>
                <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="c1"># Merge with previous segment by not yielding</span>
                <span class="k">break</span>

            <span class="k">yield</span> <span class="n">NumberedText</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">segment_end</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">segment_end</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.min_segment_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">min_segment_size</span> <span class="o">=</span> <span class="n">min_segment_size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.num_segments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_segments</span> <span class="o">=</span> <span class="n">remaining_lines</span> <span class="o">+</span> <span class="n">segment_size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">//</span> <span class="n">segment_size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.segment_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment_size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.start_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.total_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_lines</span> <span class="o">=</span> <span class="n">total_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">total_lines</span><span class="p">,</span> <span class="n">segment_size</span><span class="p">,</span> <span class="n">start_line</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_segment_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Initialize the segment iterator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_lines</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of lines to iterate over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired size of each segment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_line</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First line number (default: 1)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_segment_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum size for final segment (default: None)
If specified, the last segment will be merged with the previous one
if it would be smaller than this size.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If segment_size &lt; 1 or total_lines &lt; 1</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If start_line &lt; 1 (must use 1-based indexing)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If min_segment_size &gt;= segment_size</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">total_lines</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">min_segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the segment iterator.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_lines: Total number of lines to iterate over</span>
<span class="sd">        segment_size: Desired size of each segment</span>
<span class="sd">        start_line: First line number (default: 1)</span>
<span class="sd">        min_segment_size: Minimum size for final segment (default: None)</span>
<span class="sd">            If specified, the last segment will be merged with the previous one</span>
<span class="sd">            if it would be smaller than this size.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If segment_size &lt; 1 or total_lines &lt; 1</span>
<span class="sd">        ValueError: If start_line &lt; 1 (must use 1-based indexing)</span>
<span class="sd">        ValueError: If min_segment_size &gt;= segment_size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">segment_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Segment size must be at least 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_lines</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Total lines must be at least 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_line</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start line must be at least 1 (1-based indexing)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_segment_size</span> <span class="o">&gt;=</span> <span class="n">segment_size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum segment size must be less than segment size&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">=</span> <span class="n">total_lines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">start_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="o">=</span> <span class="n">min_segment_size</span>

    <span class="c1"># Calculate number of segments</span>
    <span class="n">remaining_lines</span> <span class="o">=</span> <span class="n">total_lines</span> <span class="o">-</span> <span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">=</span> <span class="p">(</span><span class="n">remaining_lines</span> <span class="o">+</span> <span class="n">segment_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">segment_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="tnh_scholar.text_processing.numbered_text.NumberedText.SegmentIterator.__iter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__iter__</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Iterate over line segments.</p>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment" href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment">LineSegment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LineSegment containing start (inclusive) and end (exclusive) indices</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s2">&quot;NumberedText.LineSegment&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate over line segments.</span>

<span class="sd">    Yields:</span>
<span class="sd">        LineSegment containing start (inclusive) and end (exclusive) indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span><span class="p">):</span>
        <span class="n">is_last_segment</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">segment_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Handle minimum segment size for last segment</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">is_last_segment</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">segment_end</span> <span class="o">-</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_segment_size</span>
            <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="c1"># Merge with previous segment by not yielding</span>
            <span class="k">break</span>

        <span class="k">yield</span> <span class="n">NumberedText</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">segment_end</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">segment_end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get line content by line number (1-based indexing).</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get line content by line number (1-based indexing).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize a numbered text document, detecting and preserving existing numbering.</p>
<p>Valid numbered text must have:
- Sequential line numbers
- Consistent separator character(s)
- Every non-empty line must follow the numbering pattern</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>content</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial text content, if any</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Starting line number (used only if content isn't already numbered)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator between line numbers and content (only if content isn't numbered)</p>
              </div>
            </td>
            <td>
                  <code>&#39;:&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Custom separators</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="s2">&quot;1→First line</span><span class="se">\n</span><span class="s2">2→Second line&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">separator</span> <span class="o">==</span> <span class="s2">&quot;→&quot;</span>
<span class="go">True</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Preserves starting number</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="s2">&quot;5#First</span><span class="se">\n</span><span class="s2">6#Second&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">5</span>
<span class="go">True</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Regular numbered list isn&#39;t treated as line numbers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">NumberedText</span><span class="p">(</span><span class="s2">&quot;1. First item</span><span class="se">\n</span><span class="s2">2. Second item&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">numbered_lines</span>
<span class="go">[&#39;1: 1. First item&#39;, &#39;2: 2. Second item&#39;]</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a numbered text document, detecting and preserving existing numbering.</span>

<span class="sd">    Valid numbered text must have:</span>
<span class="sd">    - Sequential line numbers</span>
<span class="sd">    - Consistent separator character(s)</span>
<span class="sd">    - Every non-empty line must follow the numbering pattern</span>

<span class="sd">    Args:</span>
<span class="sd">        content: Initial text content, if any</span>
<span class="sd">        start: Starting line number (used only if content isn&#39;t already numbered)</span>
<span class="sd">        separator: Separator between line numbers and content (only if content isn&#39;t numbered)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Custom separators</span>
<span class="sd">        &gt;&gt;&gt; doc = NumberedText(&quot;1→First line\\n2→Second line&quot;)</span>
<span class="sd">        &gt;&gt;&gt; doc.separator == &quot;→&quot;</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; # Preserves starting number</span>
<span class="sd">        &gt;&gt;&gt; doc = NumberedText(&quot;5#First\\n6#Second&quot;)</span>
<span class="sd">        &gt;&gt;&gt; doc.start == 5</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; # Regular numbered list isn&#39;t treated as line numbers</span>
<span class="sd">        &gt;&gt;&gt; doc = NumberedText(&quot;1. First item\\n2. Second item&quot;)</span>
<span class="sd">        &gt;&gt;&gt; doc.numbered_lines</span>
<span class="sd">        [&#39;1: 1. First item&#39;, &#39;2: 2. Second item&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Declare lines here</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">start</span>  <span class="c1"># Declare start with its type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">separator</span>  <span class="c1"># and separator</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;NumberedText requires string input.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># enforce 1 based indexing.</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
            <span class="s2">&quot;NumberedText: Numbered lines must begin on an integer great or equal to 1.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Analyze the text format</span>
    <span class="n">is_numbered</span><span class="p">,</span> <span class="n">detected_sep</span><span class="p">,</span> <span class="n">start_num</span> <span class="o">=</span> <span class="n">get_numbered_format</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="n">format_info</span> <span class="o">=</span> <span class="n">get_numbered_format</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">format_info</span><span class="o">.</span><span class="n">is_numbered</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">format_info</span><span class="o">.</span><span class="n">start_num</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">format_info</span><span class="o">.</span><span class="n">separator</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Extract content by removing number and separator</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^\d+</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">detected_sep</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.__iter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__iter__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Iterate over (line_number, line_content) pairs.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over (line_number, line_content) pairs.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Return the number of lines.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of lines.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Return the numbered text representation.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the numbered text representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.append" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Append text, splitting into lines if needed.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Append text, splitting into lines if needed.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.from_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Create a NumberedText instance from a file.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NumberedText&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a NumberedText instance from a file.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_line</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get content of specified line number.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get content of specified line number.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get content of line range, not inclusive of end line.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get content of line range, not inclusive of end line.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numbered_line</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get specified line with line number.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_numbered_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get specified line with line number.&quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_line_index</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numbered_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_numbered_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format_line</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_numbered_segment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numbered_segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_numbered_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_numbered_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.get_segment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start index </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> is before first line </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End index </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2"> is past last line </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start index </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> must be less than end index </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.insert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert</span><span class="p">(</span><span class="n">line_num</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Insert text at specified line number. Assumes text is not empty.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert text at specified line number. Assumes text is not empty.&quot;&quot;&quot;</span>
    <span class="n">new_lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">internal_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_internal_index</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">internal_idx</span><span class="p">:</span><span class="n">internal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.iter_segments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iter_segments</span><span class="p">(</span><span class="n">segment_size</span><span class="p">,</span> <span class="n">min_segment_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Iterate over segments of the text with specified size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>segment_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of lines per segment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_segment_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional minimum size for final segment.
If specified, last segment will be merged with previous one
if it would be smaller than this size.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment" href="#tnh_scholar.text_processing.numbered_text.NumberedText.LineSegment">LineSegment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>LineSegment objects containing start and end line numbers</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>text = NumberedText("line1\nline2\nline3\nline4\nline5")
for segment in text.iter_segments(2):
...     print(f"Lines {segment.start}-{segment.end}")
Lines 1-3
Lines 3-5
Lines 5-6</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">iter_segments</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_segment_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">LineSegment</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate over segments of the text with specified size.</span>

<span class="sd">    Args:</span>
<span class="sd">        segment_size: Number of lines per segment</span>
<span class="sd">        min_segment_size: Optional minimum size for final segment.</span>
<span class="sd">            If specified, last segment will be merged with previous one</span>
<span class="sd">            if it would be smaller than this size.</span>

<span class="sd">    Yields:</span>
<span class="sd">        LineSegment objects containing start and end line numbers</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; text = NumberedText(&quot;line1\\nline2\\nline3\\nline4\\nline5&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for segment in text.iter_segments(2):</span>
<span class="sd">        ...     print(f&quot;Lines {segment.start}-{segment.end}&quot;)</span>
<span class="sd">        Lines 1-3</span>
<span class="sd">        Lines 3-5</span>
<span class="sd">        Lines 5-6</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SegmentIterator</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">segment_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">min_segment_size</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.text_processing.numbered_text.NumberedText.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">numbered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Save document to file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output file path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numbered</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save with line numbers (default: True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">numbered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save document to file.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Output file path</span>
<span class="sd">        numbered: Whether to save with line numbers (default: True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">numbered</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.numbered_text.get_numbered_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_numbered_format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Analyze text to determine if it follows a consistent line numbering format.</p>
<p>Valid formats have:
- Sequential numbers starting from some value
- Consistent separator character(s)
- Every line must follow the format</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to analyze</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.text_processing.numbered_text.NumberedFormat" href="#tnh_scholar.text_processing.numbered_text.NumberedFormat">NumberedFormat</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (is_numbered, separator, start_number)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">_analyze_numbered_format</span><span class="p">(</span><span class="s2">&quot;1→First</span><span class="se">\n</span><span class="s2">2→Second&quot;</span><span class="p">)</span>
<span class="go">(True, &quot;→&quot;, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_analyze_numbered_format</span><span class="p">(</span><span class="s2">&quot;1. First&quot;</span><span class="p">)</span>  <span class="c1"># Numbered list format</span>
<span class="go">(False, None, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_analyze_numbered_format</span><span class="p">(</span><span class="s2">&quot;5#Line</span><span class="se">\n</span><span class="s2">6#Other&quot;</span><span class="p">)</span>
<span class="go">(True, &quot;#&quot;, 5)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/numbered_text.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_numbered_format</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumberedFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze text to determine if it follows a consistent line numbering format.</span>

<span class="sd">    Valid formats have:</span>
<span class="sd">    - Sequential numbers starting from some value</span>
<span class="sd">    - Consistent separator character(s)</span>
<span class="sd">    - Every line must follow the format</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to analyze</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (is_numbered, separator, start_number)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; _analyze_numbered_format(&quot;1→First\\n2→Second&quot;)</span>
<span class="sd">        (True, &quot;→&quot;, 1)</span>
<span class="sd">        &gt;&gt;&gt; _analyze_numbered_format(&quot;1. First&quot;)  # Numbered list format</span>
<span class="sd">        (False, None, None)</span>
<span class="sd">        &gt;&gt;&gt; _analyze_numbered_format(&quot;5#Line\\n6#Other&quot;)</span>
<span class="sd">        (True, &quot;#&quot;, 5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">NumberedFormat</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NumberedFormat</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Try to detect pattern from first line</span>
    <span class="n">SEPARATOR_PATTERN</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[^\w\s.]&quot;</span>  <span class="c1"># not (word char or whitespace or period)</span>
    <span class="n">first_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^(\d+)(</span><span class="si">{</span><span class="n">SEPARATOR_PATTERN</span><span class="si">}</span><span class="s2">)(.*?)$&quot;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_check_line_structure</span><span class="p">(</span><span class="n">first_match</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NumberedFormat</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.text_processing.v2_cleaning_scripts" class="doc doc-heading">
            <code>v2_cleaning_scripts</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.text_processing.v2_cleaning_scripts.classifier" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">classifier</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s1">&#39;zero-shot-classification&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;facebook/bart-large-mnli&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.text_processing.v2_cleaning_scripts.nlp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.v2_cleaning_scripts.classify_heading" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">classify_heading</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Classifies text as heading or not using a Hugging Face model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to classify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the text is classified as a heading, otherwise False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/v2_cleaning_scripts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">classify_heading</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classifies text as heading or not using a Hugging Face model.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The text to classify.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the text is classified as a heading, otherwise False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define candidate labels for zero-shot classification</span>
    <span class="n">candidate_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;heading&quot;</span><span class="p">,</span> <span class="s2">&quot;paragraph&quot;</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">candidate_labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;heading&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.text_processing.v2_cleaning_scripts.process_book" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_book</span><span class="p">(</span><span class="n">book_text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Process text to extract chapters and paragraphs using spaCy NLP model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>book_text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw text of the book.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of (chapter_title, chapter_content) tuples.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/text_processing/v2_cleaning_scripts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_book</span><span class="p">(</span><span class="n">book_text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process text to extract chapters and paragraphs using spaCy NLP model.</span>

<span class="sd">    Args:</span>
<span class="sd">        book_text (str): Raw text of the book.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of (chapter_title, chapter_content) tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">book_text</span><span class="p">)</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chapter_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">chapter_content</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">sents</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;chapter&quot;</span> <span class="ow">in</span> <span class="n">sent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="c1"># Store previous chapter if any</span>
            <span class="k">if</span> <span class="n">chapter_title</span><span class="p">:</span>
                <span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">chapter_title</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">)))</span>
            <span class="n">chapter_title</span> <span class="o">=</span> <span class="n">sent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">chapter_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chapter_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">chapter_title</span><span class="p">:</span>
        <span class="n">chapters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">chapter_title</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chapter_content</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">chapters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.utils" class="doc doc-heading">
            <code>utils</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.utils.file_utils" class="doc doc-heading">
            <code>file_utils</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.utils.file_utils.FileExistsWarning" class="doc doc-heading">
            <code>FileExistsWarning</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>UserWarning</code></p>







              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FileExistsWarning</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.file_utils.copy_files_with_regex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_files_with_regex</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">,</span> <span class="n">regex_patterns</span><span class="p">,</span> <span class="n">preserve_structure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Copies files from subdirectories one level down in the source directory to the destination directory
if they match any regex pattern. Optionally preserves the directory structure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the source directory to search files in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the destination directory where files will be copied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex_patterns</code>
            </td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of regex patterns to match file names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>preserve_structure</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to preserve the directory structure. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the source directory does not exist or is not a directory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>copy_files_with_regex(
...     source_dir=Path("/path/to/source"),
...     destination_dir=Path("/path/to/destination"),
...     regex_patterns=[r'.<em>.txt$', r'.</em>.log$'],
...     preserve_structure=True
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">copy_files_with_regex</span><span class="p">(</span>
    <span class="n">source_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">destination_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">regex_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">preserve_structure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copies files from subdirectories one level down in the source directory to the destination directory</span>
<span class="sd">    if they match any regex pattern. Optionally preserves the directory structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_dir (Path): Path to the source directory to search files in.</span>
<span class="sd">        destination_dir (Path): Path to the destination directory where files will be copied.</span>
<span class="sd">        regex_patterns (list[str]): List of regex patterns to match file names.</span>
<span class="sd">        preserve_structure (bool): Whether to preserve the directory structure. Defaults to True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the source directory does not exist or is not a directory.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; copy_files_with_regex(</span>
<span class="sd">        ...     source_dir=Path(&quot;/path/to/source&quot;),</span>
<span class="sd">        ...     destination_dir=Path(&quot;/path/to/destination&quot;),</span>
<span class="sd">        ...     regex_patterns=[r&#39;.*\\.txt$&#39;, r&#39;.*\\.log$&#39;],</span>
<span class="sd">        ...     preserve_structure=True</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The source directory </span><span class="si">{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2"> does not exist or is not a directory.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">destination_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">destination_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Compile regex patterns for efficiency</span>
    <span class="n">compiled_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">regex_patterns</span><span class="p">]</span>

    <span class="c1"># Process only one level down</span>
    <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">source_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">subdir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>  <span class="c1"># Only process subdirectories</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;processing </span><span class="si">{</span><span class="n">subdir</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">subdir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>  <span class="c1"># Only files in this subdirectory</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;checking file: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Check if the file matches any of the regex patterns</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">compiled_patterns</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">preserve_structure</span><span class="p">:</span>
                            <span class="c1"># Construct the target path, preserving relative structure</span>
                            <span class="n">relative_path</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">subdir</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                            <span class="n">target_path</span> <span class="o">=</span> <span class="n">destination_dir</span> <span class="o">/</span> <span class="n">relative_path</span>
                            <span class="n">target_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Place directly in destination without subdirectory structure</span>
                            <span class="n">target_path</span> <span class="o">=</span> <span class="n">destination_dir</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>

                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">target_path</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.file_utils.ensure_directory_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_directory_exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create directory if it doesn't exist.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory path to ensure exists.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_directory_exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create directory if it doesn&#39;t exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        dir_path (Path): Directory path to ensure exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Stub Implementation</span>
    <span class="k">return</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.file_utils.get_text_from_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_text_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Reads the entire content of a text file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the text file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The content of the text file as a single string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_text_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads the entire content of a text file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: The path to the text file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The content of the text file as a single string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.file_utils.iterate_subdir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iterate_subdir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Iterates through subdirectories in the given directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The root directory to start the iteration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recursive</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, iterates recursively through all subdirectories.
              If False, iterates only over the immediate subdirectories.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Path</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paths to each subdirectory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>for subdir in iterate_subdir(Path('/root'), recursive=False):
...     print(subdir)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">iterate_subdir</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates through subdirectories in the given directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (Path): The root directory to start the iteration.</span>
<span class="sd">        recursive (bool): If True, iterates recursively through all subdirectories.</span>
<span class="sd">                          If False, iterates only over the immediate subdirectories.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Path: Paths to each subdirectory.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; for subdir in iterate_subdir(Path(&#39;/root&#39;), recursive=False):</span>
<span class="sd">        ...     print(subdir)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subdirectory</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subdirectory</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">subdirectory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subdirectory</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subdirectory</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">subdirectory</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.file_utils.write_text_to_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_text_to_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Writes text content to a file, handling overwriting and appending.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>content</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text content to write.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, overwrites the file if it exists.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>append</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, appends the content to the file if it exists.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.utils.file_utils.FileExistsWarning" href="#tnh_scholar.utils.file_utils.FileExistsWarning">FileExistsWarning</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file exists and neither overwrite nor append are True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/file_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_text_to_file</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes text content to a file, handling overwriting and appending.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: The path to the file.</span>
<span class="sd">        content: The text content to write.</span>
<span class="sd">        overwrite: If True, overwrites the file if it exists.</span>
<span class="sd">        append: If True, appends the content to the file if it exists.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsWarning: If the file exists and neither overwrite nor append are True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; already exists. Use overwrite or append.&quot;</span><span class="p">,</span>
                <span class="n">FileExistsWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Do not write if neither flag is set</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="k">if</span> <span class="n">append</span> <span class="k">else</span> <span class="s2">&quot;w&quot;</span>  <span class="c1"># Choose mode based on flags</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>  <span class="c1"># Default to write mode if file doesn&#39;t exist</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.utils.json_utils" class="doc doc-heading">
            <code>json_utils</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.json_utils.format_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_json</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Formats a JSON file with line breaks and indentation for readability.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file to be formatted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>format_json(Path("data.json"))</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/json_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_json</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats a JSON file with line breaks and indentation for readability.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): Path to the JSON file to be formatted.</span>

<span class="sd">    Example:</span>
<span class="sd">        format_json(Path(&quot;data.json&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.json_utils.load_json_into_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_json_into_model</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Loads a JSON file and validates it against a Pydantic model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>type[<span title="pydantic.BaseModel">BaseModel</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Pydantic model to validate against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseModel</code></td>            <td>
                  <code><span title="pydantic.BaseModel">BaseModel</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the validated Pydantic model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file content is invalid JSON or does not match the model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Example:
    class ExampleModel(BaseModel):
    name: str
    age: int
    city: str</p>
<pre><code>if __name__ == "__main__":
    json_file = Path("example.json")
    try:
        data = load_json_into_model(json_file, ExampleModel)
        print(data)
    except ValueError as e:
        print(e)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/json_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_json_into_model</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BaseModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a JSON file and validates it against a Pydantic model.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): Path to the JSON file.</span>
<span class="sd">        model (type[BaseModel]): The Pydantic model to validate against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseModel: An instance of the validated Pydantic model.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the file content is invalid JSON or does not match the model.</span>
<span class="sd">    Example:</span>
<span class="sd">        class ExampleModel(BaseModel):</span>
<span class="sd">        name: str</span>
<span class="sd">        age: int</span>
<span class="sd">        city: str</span>

<span class="sd">        if __name__ == &quot;__main__&quot;:</span>
<span class="sd">            json_file = Path(&quot;example.json&quot;)</span>
<span class="sd">            try:</span>
<span class="sd">                data = load_json_into_model(json_file, ExampleModel)</span>
<span class="sd">                print(data)</span>
<span class="sd">            except ValueError as e:</span>
<span class="sd">                print(e)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading or validating JSON file &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.json_utils.load_jsonl_to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_jsonl_to_dict</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Load a JSONL file into a list of dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSONL file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict]: A list of dictionaries, each representing a line in the JSONL file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
file_path = Path("data.jsonl")
data = load_jsonl_to_dict(file_path)
print(data)
[{'key1': 'value1'}, {'key2': 'value2'}]</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/json_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_jsonl_to_dict</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a JSONL file into a list of dictionaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path): Path to the JSONL file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict]: A list of dictionaries, each representing a line in the JSONL file.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; file_path = Path(&quot;data.jsonl&quot;)</span>
<span class="sd">        &gt;&gt;&gt; data = load_jsonl_to_dict(file_path)</span>
<span class="sd">        &gt;&gt;&gt; print(data)</span>
<span class="sd">        [{&#39;key1&#39;: &#39;value1&#39;}, {&#39;key2&#39;: &#39;value2&#39;}]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.json_utils.save_model_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_model_to_json</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Saves a Pydantic model to a JSON file, formatted with indentation for readability.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file where the model will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="pydantic.BaseModel">BaseModel</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Pydantic model instance to save.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indent</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of spaces for JSON indentation. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ensure_ascii</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to escape non-ASCII characters. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the model cannot be serialized to JSON.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>IOError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an issue writing to the file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>class ExampleModel(BaseModel):
    name: str
    age: int</p>
<p>if <strong>name</strong> == "<strong>main</strong>":
    model_instance = ExampleModel(name="John", age=30)
    json_file = Path("example.json")
    try:
        save_model_to_json(json_file, model_instance)
        print(f"Model saved to {json_file}")
    except (ValueError, IOError) as e:
        print(e)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/json_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_model_to_json</span><span class="p">(</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves a Pydantic model to a JSON file, formatted with indentation for readability.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): Path to the JSON file where the model will be saved.</span>
<span class="sd">        model (BaseModel): The Pydantic model instance to save.</span>
<span class="sd">        indent (int): Number of spaces for JSON indentation. Defaults to 4.</span>
<span class="sd">        ensure_ascii (bool): Whether to escape non-ASCII characters. Defaults to False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the model cannot be serialized to JSON.</span>
<span class="sd">        IOError: If there is an issue writing to the file.</span>

<span class="sd">    Example:</span>
<span class="sd">        class ExampleModel(BaseModel):</span>
<span class="sd">            name: str</span>
<span class="sd">            age: int</span>

<span class="sd">        if __name__ == &quot;__main__&quot;:</span>
<span class="sd">            model_instance = ExampleModel(name=&quot;John&quot;, age=30)</span>
<span class="sd">            json_file = Path(&quot;example.json&quot;)</span>
<span class="sd">            try:</span>
<span class="sd">                save_model_to_json(json_file, model_instance)</span>
<span class="sd">                print(f&quot;Model saved to {json_file}&quot;)</span>
<span class="sd">            except (ValueError, IOError) as e:</span>
<span class="sd">                print(e)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Serialize model to JSON string</span>
        <span class="n">model_dict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error serializing model to JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Write the JSON string to the file</span>
    <span class="n">write_data_to_json_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="n">ensure_ascii</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.json_utils.write_data_to_json_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_data_to_json_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Writes a dictionary or list as a JSON string to a file, ensuring the parent directory exists,
and supports formatting with indentation and ASCII control.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file where the data will be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[dict, list]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to write to the file. Typically a dict or list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indent</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of spaces for JSON indentation. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ensure_ascii</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to escape non-ASCII characters. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the data cannot be serialized to JSON.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>IOError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an issue writing to the file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
data = {"key": "value"}
write_json_str_to_file(Path("output.json"), data, indent=2, ensure_ascii=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/json_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_data_to_json_file</span><span class="p">(</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a dictionary or list as a JSON string to a file, ensuring the parent directory exists,</span>
<span class="sd">    and supports formatting with indentation and ASCII control.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): Path to the JSON file where the data will be written.</span>
<span class="sd">        data (Union[dict, list]): The data to write to the file. Typically a dict or list.</span>
<span class="sd">        indent (int): Number of spaces for JSON indentation. Defaults to 4.</span>
<span class="sd">        ensure_ascii (bool): Whether to escape non-ASCII characters. Defaults to False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the data cannot be serialized to JSON.</span>
<span class="sd">        IOError: If there is an issue writing to the file.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; data = {&quot;key&quot;: &quot;value&quot;}</span>
<span class="sd">        &gt;&gt;&gt; write_json_str_to_file(Path(&quot;output.json&quot;), data, indent=2, ensure_ascii=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert the data to a formatted JSON string</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="n">ensure_ascii</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error serializing data to JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure the parent directory exists</span>
        <span class="n">file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Write the JSON string to the file</span>
        <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing JSON string to file &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.utils.progress_utils" class="doc doc-heading">
            <code>progress_utils</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.utils.progress_utils.BAR_FORMAT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">BAR_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{desc}</span><span class="s1">: </span><span class="si">{percentage:3.0f}</span><span class="s1">%|</span><span class="si">{bar}</span><span class="s1">| Total: </span><span class="si">{total_fmt}</span><span class="s1"> sec. [elapsed: </span><span class="si">{elapsed}</span><span class="s1">]&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM" class="doc doc-heading">
            <code>ExpectedTimeTQDM</code>


</h5>


    <div class="doc doc-contents ">


        <p>A context manager for a time-based tqdm progress bar with optional delay.</p>
<ul>
<li>'expected_time': number of seconds we anticipate the task might take.</li>
<li>'display_interval': how often (seconds) to refresh the bar.</li>
<li>'desc': a short description for the bar.</li>
<li>'delay_start': how many seconds to wait (sleep) before we even create/start the bar.</li>
</ul>
<p>If the task finishes before 'delay_start' has elapsed, the bar may never appear.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExpectedTimeTQDM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A context manager for a time-based tqdm progress bar with optional delay.</span>

<span class="sd">    - &#39;expected_time&#39;: number of seconds we anticipate the task might take.</span>
<span class="sd">    - &#39;display_interval&#39;: how often (seconds) to refresh the bar.</span>
<span class="sd">    - &#39;desc&#39;: a short description for the bar.</span>
<span class="sd">    - &#39;delay_start&#39;: how many seconds to wait (sleep) before we even create/start the bar.</span>

<span class="sd">    If the task finishes before &#39;delay_start&#39; has elapsed, the bar may never appear.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expected_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">display_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time-based Progress&quot;</span><span class="p">,</span>
        <span class="n">delay_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected_time</span><span class="p">)</span>  <span class="c1"># use nearest second.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_start</span> <span class="o">=</span> <span class="n">delay_start</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># We won&#39;t create the bar until after &#39;delay_start&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Record the start time for reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Spawn the background thread; it will handle waiting and then creating/updating the bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_bar</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_update_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 1) Delay so warnings/logs can appear before the bar</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_start</span><span class="p">)</span>

        <span class="c1"># 2) Create the tqdm bar (only now does it appear)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;sec&quot;</span><span class="p">,</span> <span class="n">bar_format</span><span class="o">=</span><span class="n">BAR_FORMAT</span>
        <span class="p">)</span>

        <span class="c1"># 3) Update until told to stop</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
            <span class="n">current_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="c1"># Signal the thread to stop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># If the bar was actually created (i.e., we didn&#39;t finish too quickly),</span>
        <span class="c1"># do a final update and close</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">time</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.delay_start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delay_start</span> <span class="o">=</span> <span class="n">delay_start</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.desc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.display_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.expected_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expected_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected_time</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__enter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__enter__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Record the start time for reference</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Spawn the background thread; it will handle waiting and then creating/updating the bar</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_bar</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__exit__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
    <span class="c1"># Signal the thread to stop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="c1"># If the bar was actually created (i.e., we didn&#39;t finish too quickly),</span>
    <span class="c1"># do a final update and close</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.ExpectedTimeTQDM.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">expected_time</span><span class="p">,</span> <span class="n">display_interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Time-based Progress&#39;</span><span class="p">,</span> <span class="n">delay_start</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">expected_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">display_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time-based Progress&quot;</span><span class="p">,</span>
    <span class="n">delay_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected_time</span><span class="p">)</span>  <span class="c1"># use nearest second.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">delay_start</span> <span class="o">=</span> <span class="n">delay_start</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pbar</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># We won&#39;t create the bar until after &#39;delay_start&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.utils.progress_utils.TimeProgress" class="doc doc-heading">
            <code>TimeProgress</code>


</h5>


    <div class="doc doc-contents ">


        <p>A context manager for a time-based progress display using dots.</p>
<p>The display updates once per second, printing a dot and showing:
- Expected time (if provided)
- Elapsed time (always displayed)</p>
<p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import time
with ExpectedTimeProgress(expected_time=60, desc="Transcribing..."):
...     time.sleep(5)  # Simulate work
[Expected Time: 1:00, Elapsed Time: 0:05] .....</p>
</blockquote>
</blockquote>
</blockquote>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expected_time</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Expected time in seconds. Optional.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_interval</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How often to print a dot (seconds).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desc</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to display alongside the progress.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TimeProgress</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A context manager for a time-based progress display using dots.</span>

<span class="sd">    The display updates once per second, printing a dot and showing:</span>
<span class="sd">    - Expected time (if provided)</span>
<span class="sd">    - Elapsed time (always displayed)</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import time</span>
<span class="sd">    &gt;&gt;&gt; with ExpectedTimeProgress(expected_time=60, desc=&quot;Transcribing...&quot;):</span>
<span class="sd">    ...     time.sleep(5)  # Simulate work</span>
<span class="sd">    [Expected Time: 1:00, Elapsed Time: 0:05] .....</span>

<span class="sd">    Args:</span>
<span class="sd">        expected_time (Optional[float]): Expected time in seconds. Optional.</span>
<span class="sd">        display_interval (float): How often to print a dot (seconds).</span>
<span class="sd">        desc (str): Description to display alongside the progress.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expected_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">display_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="o">=</span> <span class="n">expected_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_length</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># To keep track of the last printed line length</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Record the start time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Spawn the background thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_progress</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_print_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Continuously prints progress alternating between | and — along with elapsed/expected time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;—&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">]</span>  <span class="c1"># Symbols to alternate between</span>
        <span class="n">symbol_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Keep track of the current symbol</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>

            <span class="c1"># Format elapsed time as mm:ss</span>
            <span class="n">elapsed_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>

            <span class="c1"># Format expected time if provided</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">expected_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">)</span>
                <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Expected Time: </span><span class="si">{</span><span class="n">expected_str</span><span class="si">}</span><span class="s2">, Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>

            <span class="c1"># Get the current symbol for the spinner</span>
            <span class="n">spinner</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol_index</span><span class="p">]</span>

            <span class="c1"># Construct the line with the spinner</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">spinner</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Write to stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># Update the symbol index to alternate</span>
            <span class="n">symbol_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbol_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>

            <span class="c1"># Sleep before next update</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span><span class="p">)</span>

        <span class="c1"># Clear the spinner after finishing</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="c1"># Signal the thread to stop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># Final elapsed time</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
        <span class="n">elapsed_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>

        <span class="c1"># Construct the final line</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expected_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">)</span>
            <span class="n">final_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Expected Time: </span><span class="si">{</span><span class="n">expected_str</span><span class="si">}</span><span class="s2">, Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="c1"># Final dots</span>
        <span class="n">final_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">{</span><span class="n">final_header</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Clear the line and move to the next line</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_line</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_line</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_time</span><span class="p">(</span><span class="n">seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts seconds to a formatted string (mm:ss).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.desc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.display_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.expected_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expected_time</span> <span class="o">=</span> <span class="n">expected_time</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.__enter__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__enter__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Record the start time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Spawn the background thread</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_progress</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.__exit__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
    <span class="c1"># Signal the thread to stop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="c1"># Final elapsed time</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
    <span class="n">elapsed_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>

    <span class="c1"># Construct the final line</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expected_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span><span class="p">)</span>
        <span class="n">final_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Expected Time: </span><span class="si">{</span><span class="n">expected_str</span><span class="si">}</span><span class="s2">, Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">final_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2"> [Elapsed Time: </span><span class="si">{</span><span class="n">elapsed_str</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="c1"># Final dots</span>
    <span class="n">final_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">{</span><span class="n">final_header</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Clear the line and move to the next line</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_line</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_line</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.utils.progress_utils.TimeProgress.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">expected_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_interval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/progress_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">expected_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">display_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expected_time</span> <span class="o">=</span> <span class="n">expected_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">display_interval</span> <span class="o">=</span> <span class="n">display_interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_last_length</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># To keep track of the last printed line length</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.utils.slugify" class="doc doc-heading">
            <code>slugify</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.slugify.slugify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">slugify</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Slugify a Unicode string.</p>
<p>Converts a string to a strict URL-friendly slug format,
allowing only lowercase letters, digits, and hyphens.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>slugify("Héllø_Wörld!")
'hello-world'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/slugify.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">slugify</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Slugify a Unicode string.</span>

<span class="sd">    Converts a string to a strict URL-friendly slug format,</span>
<span class="sd">    allowing only lowercase letters, digits, and hyphens.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; slugify(&quot;Héllø_Wörld!&quot;)</span>
<span class="sd">        &#39;hello-world&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize Unicode to remove accents and convert to ASCII</span>
    <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFKD&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Replace all non-alphanumeric characters with spaces (only keep a-z and 0-9)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-z0-9\s]&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Replace any sequence of spaces with a single hyphen</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.utils.user_io_utils" class="doc doc-heading">
            <code>user_io_utils</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.user_io_utils.get_single_char" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_single_char</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get a single character from standard input without requiring Enter.
Cross-platform implementation for Windows and Unix-like systems.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/user_io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_single_char</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single character from standard input without requiring Enter.</span>
<span class="sd">    Cross-platform implementation for Windows and Unix-like systems.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">getch</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>  <span class="c1"># Windows</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
    <span class="n">old_settings</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tty</span><span class="o">.</span><span class="n">setraw</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">char</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSADRAIN</span><span class="p">,</span> <span class="n">old_settings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">char</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.utils.user_io_utils.get_user_confirmation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_user_confirmation</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Prompt the user for a yes/no confirmation with single-character input.
Cross-platform implementation. Returns True if 'y' is entered, and False if 'n'
Allows for default value if return is entered.</p>
<p>Example usage
    if get_user_confirmation("Do you want to continue"):
        print("Continuing...")
    else:
        print("Exiting...")</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/utils/user_io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_user_confirmation</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt the user for a yes/no confirmation with single-character input.</span>
<span class="sd">    Cross-platform implementation. Returns True if &#39;y&#39; is entered, and False if &#39;n&#39;</span>
<span class="sd">    Allows for default value if return is entered.</span>

<span class="sd">    Example usage</span>
<span class="sd">        if get_user_confirmation(&quot;Do you want to continue&quot;):</span>
<span class="sd">            print(&quot;Continuing...&quot;)</span>
<span class="sd">        else:</span>
<span class="sd">            print(&quot;Exiting...&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">char</span> <span class="o">=</span> <span class="n">get_single_char</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>  <span class="c1"># Echo the choice</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>  <span class="c1"># Enter key (use default)</span>
            <span class="nb">print</span><span class="p">()</span>  <span class="c1"># Add a newline</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid input: </span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s2">. Please type &#39;y&#39; or &#39;n&#39;: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.video_processing" class="doc doc-heading">
            <code>video_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.video_processing.video_processing" class="doc doc-heading">
            <code>video_processing</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSCRIPT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.yt_dlp_transcripts&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_OPTIONS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_TRANSCRIPT_OPTIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;skip_download&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;no_warnings&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;extract_flat&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;socket_timeout&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;retries&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;ignoreerrors&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">logger</span><span class="p">}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.video_processing.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>


<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.video_processing.video_processing.SubtitleTrack" class="doc doc-heading">
            <code>SubtitleTrack</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>


        <p>Type definition for a subtitle track entry.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SubtitleTrack</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type definition for a subtitle track entry.&quot;&quot;&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ext</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.SubtitleTrack.ext" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ext</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.SubtitleTrack.name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.SubtitleTrack.url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">url</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError" class="doc doc-heading">
            <code>TranscriptNotFoundError</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Raised when no transcript is available for the requested language.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TranscriptNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when no transcript is available for the requested language.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize TranscriptNotFoundError.</span>

<span class="sd">        Args:</span>
<span class="sd">            video_url: URL of the video where transcript was not found</span>
<span class="sd">            language: Language code that was requested</span>
<span class="sd">            available_manual: List of available manual transcript languages</span>
<span class="sd">            available_auto: List of available auto-generated transcript languages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_url</span> <span class="o">=</span> <span class="n">video_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No transcript found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video_url</span><span class="si">}</span><span class="s2"> in language </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="si">}</span><span class="s2">. &quot;</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">language</span> <span class="o">=</span> <span class="n">language</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.video_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">video_url</span> <span class="o">=</span> <span class="n">video_url</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize TranscriptNotFoundError.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>video_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL of the video where transcript was not found</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language code that was requested</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>available_manual</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of available manual transcript languages</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>available_auto</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of available auto-generated transcript languages</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">video_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize TranscriptNotFoundError.</span>

<span class="sd">    Args:</span>
<span class="sd">        video_url: URL of the video where transcript was not found</span>
<span class="sd">        language: Language code that was requested</span>
<span class="sd">        available_manual: List of available manual transcript languages</span>
<span class="sd">        available_auto: List of available auto-generated transcript languages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">video_url</span> <span class="o">=</span> <span class="n">video_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>

    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;No transcript found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video_url</span><span class="si">}</span><span class="s2"> in language </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="si">}</span><span class="s2">. &quot;</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.video_processing.video_processing.VideoInfo" class="doc doc-heading">
            <code>VideoInfo</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>


        <p>Type definition for relevant video info fields.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VideoInfo</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type definition for relevant video info fields.&quot;&quot;&quot;</span>

    <span class="n">subtitles</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">SubtitleTrack</span><span class="p">]]</span>
    <span class="n">automatic_captions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">SubtitleTrack</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.VideoInfo.automatic_captions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">automatic_captions</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="tnh_scholar.video_processing.video_processing.VideoInfo.subtitles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">subtitles</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">
    </div>

</div>





  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.video_processing.download_audio_yt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_audio_yt</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prompt_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Downloads audio from a YouTube video using yt_dlp.YoutubeDL, with an optional start time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL of the YouTube video.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the downloaded audio file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_time</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional start time (e.g., '00:01:30' for 1 minute 30 seconds).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Path</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the downloaded audio file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_audio_yt</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prompt_overwrite</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads audio from a YouTube video using yt_dlp.YoutubeDL, with an optional start time.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): URL of the YouTube video.</span>
<span class="sd">        output_dir (Path): Directory to save the downloaded audio file.</span>
<span class="sd">        start_time (str): Optional start time (e.g., &#39;00:01:30&#39; for 1 minute 30 seconds).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path: Path to the downloaded audio file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;bestaudio/best&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postprocessors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;FFmpegExtractAudio&quot;</span><span class="p">,</span>
                <span class="s2">&quot;preferredcodec&quot;</span><span class="p">:</span> <span class="s2">&quot;mp3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;preferredquality&quot;</span><span class="p">:</span> <span class="s2">&quot;192&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;postprocessor_args&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;noplaylist&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;</span><span class="si">%(title)s</span><span class="s2">.</span><span class="si">%(ext)s</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add start time to the FFmpeg postprocessor if provided</span>
    <span class="k">if</span> <span class="n">start_time</span><span class="p">:</span>
        <span class="n">ydl_opts</span><span class="p">[</span><span class="s2">&quot;postprocessor_args&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-ss&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Postprocessor start time set to: </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">yt_dlp</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">(</span><span class="n">ydl_opts</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Extract metadata and download</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.mp3&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.video_processing.get_transcript" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transcript</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="n">DEFAULT_TRANSCRIPT_DIR</span><span class="p">,</span> <span class="n">keep_transcript_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Downloads and extracts the transcript for a given YouTube video URL.</p>
<p>Retrieves the transcript file, extracts the text content, and returns the raw text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the YouTube video.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lang</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The language code for the transcript (default: 'en').</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>download_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to download the transcript to.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_DIR" href="#tnh_scholar.video_processing.video_processing.DEFAULT_TRANSCRIPT_DIR">DEFAULT_TRANSCRIPT_DIR</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_transcript_file</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the downloaded transcript file (default: False).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The extracted transcript text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError" href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError">TranscriptNotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no transcript is available in the specified language.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="yt_dlp.utils.DownloadError">DownloadError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If video info extraction or download fails.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the downloaded transcript file is invalid or empty.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xml.etree.ElementTree.ParseError">ParseError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If XML parsing of the transcript fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_transcript</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="n">download_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">DEFAULT_TRANSCRIPT_DIR</span><span class="p">,</span>
    <span class="n">keep_transcript_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads and extracts the transcript for a given YouTube video URL.</span>

<span class="sd">    Retrieves the transcript file, extracts the text content, and returns the raw text.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: The URL of the YouTube video.</span>
<span class="sd">        lang: The language code for the transcript (default: &#39;en&#39;).</span>
<span class="sd">        download_dir: The directory to download the transcript to.</span>
<span class="sd">        keep_transcript_file: Whether to keep the downloaded transcript file (default: False).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The extracted transcript text.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TranscriptNotFoundError: If no transcript is available in the specified language.</span>
<span class="sd">        yt_dlp.utils.DownloadError: If video info extraction or download fails.</span>
<span class="sd">        ValueError: If the downloaded transcript file is invalid or empty.</span>
<span class="sd">        ParseError: If XML parsing of the transcript fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">transcript_file</span> <span class="o">=</span> <span class="n">_download_yt_ttml</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">get_text_from_file</span><span class="p">(</span><span class="n">transcript_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_transcript_file</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">transcript_file</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed temporary transcript file: </span><span class="si">{</span><span class="n">transcript_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to remove temporary transcript file </span><span class="si">{</span><span class="n">transcript_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">_extract_ttml_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.video_processing.get_transcript_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transcript_info</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Retrieves the transcript URL for a video in the specified language.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>video_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the video</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lang</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired language code</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL of the transcript</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.video_processing.video_processing.TranscriptNotFoundError" href="#tnh_scholar.video_processing.video_processing.TranscriptNotFoundError">TranscriptNotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no transcript is available in the specified language</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="yt_dlp.utils.DownloadError">DownloadError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If video info extraction fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_transcript_info</span><span class="p">(</span><span class="n">video_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the transcript URL for a video in the specified language.</span>

<span class="sd">    Args:</span>
<span class="sd">        video_url: The URL of the video</span>
<span class="sd">        lang: The desired language code</span>

<span class="sd">    Returns:</span>
<span class="sd">        URL of the transcript</span>

<span class="sd">    Raises:</span>
<span class="sd">        TranscriptNotFoundError: If no transcript is available in the specified language</span>
<span class="sd">        yt_dlp.utils.DownloadError: If video info extraction fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;writesubtitles&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;writeautomaticsub&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;subtitleslangs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">lang</span><span class="p">],</span>
        <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1">#    &#39;verbose&#39;: True</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="n">yt_dlp</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
        <span class="c1"># This may raise yt_dlp.utils.DownloadError which we let propagate</span>
        <span class="n">info</span><span class="p">:</span> <span class="n">VideoInfo</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span><span class="n">video_url</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="n">subtitles</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtitles&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">auto_subtitles</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;automatic_captions&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Log available subtitle information</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available subtitles:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual subtitles: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">subtitles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auto captions: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">auto_subtitles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">subtitles</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtitles</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">auto_subtitles</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">auto_subtitles</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="n">TranscriptNotFoundError</span><span class="p">(</span><span class="n">video_url</span><span class="o">=</span><span class="n">video_url</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.video_processing.get_video_download_path_yt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_video_download_path_yt</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extracts the video title using yt-dlp.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The YouTube URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the video.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_video_download_path_yt</span><span class="p">(</span><span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the video title using yt-dlp.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The YouTube URL.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The title of the video.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Suppress output</span>
        <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Don&#39;t download, just fetch metadata</span>
        <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;</span><span class="si">%(title)s</span><span class="s2">.</span><span class="si">%(ext)s</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="n">yt_dlp</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">(</span><span class="n">ydl_opts</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>  <span class="c1"># Extract metadata without downloading</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.mp3&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.video_processing.get_youtube_urls_from_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_youtube_urls_from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Reads a CSV file containing YouTube URLs and titles, logs the titles,
and returns a list of URLs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV file containing YouTube URLs and titles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: List of YouTube URLs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the CSV file is improperly formatted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/video_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_youtube_urls_from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a CSV file containing YouTube URLs and titles, logs the titles,</span>
<span class="sd">    and returns a list of URLs.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path): Path to the CSV file containing YouTube URLs and titles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of YouTube URLs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>
<span class="sd">        ValueError: If the CSV file is improperly formatted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span> <span class="ow">or</span> <span class="s2">&quot;title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;CSV file must contain &#39;url&#39; and &#39;title&#39; columns.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CSV file must contain &#39;url&#39; and &#39;title&#39; columns.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found video title: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">urls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.video_processing.yt_transcribe" class="doc doc-heading">
            <code>yt_transcribe</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_MS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_CHUNK_DURATION_MS</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_S" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_CHUNK_DURATION_S</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.DEFAULT_OUTPUT_DIR" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_OUTPUT_DIR</span> <span class="o">=</span> <span class="s1">&#39;./video_transcriptions&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.DEFAULT_PROMPT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_PROMPT</span> <span class="o">=</span> <span class="s1">&#39;Dharma, Deer Park, Thay, Thich Nhat Hanh, Bodhicitta, Bodhisattva, Mahayana&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.EXPECTED_ENV" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">EXPECTED_ENV</span> <span class="o">=</span> <span class="s1">&#39;tnh-scholar&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logger</span> <span class="o">=</span> <span class="n">get_child_logger</span><span class="p">(</span><span class="s1">&#39;yt_transcribe&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.output_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.parser" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Transcribe YouTube videos from a URL or a file containing URLs.&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.url_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">url_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="tnh_scholar.video_processing.yt_transcribe.video_urls" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">video_urls</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.yt_transcribe.check_conda_env" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_conda_env</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/yt_transcribe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_conda_env</span><span class="p">():</span>
    <span class="n">active_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CONDA_DEFAULT_ENV&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">active_env</span> <span class="o">!=</span> <span class="n">EXPECTED_ENV</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: The active conda environment is &#39;</span><span class="si">{</span><span class="n">active_env</span><span class="si">}</span><span class="s2">&#39;, but &#39;</span><span class="si">{</span><span class="n">EXPECTED_ENV</span><span class="si">}</span><span class="s2">&#39; is required. &quot;</span>
            <span class="s2">&quot;Please activate the correct environment.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Optionally exit the script</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.video_processing.yt_transcribe.transcribe_youtube_videos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transcribe_youtube_videos</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">output_base_dir</span><span class="p">,</span> <span class="n">max_chunk_duration</span><span class="o">=</span><span class="n">DEFAULT_CHUNK_DURATION_S</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Full pipeline for transcribing a list of YouTube videos.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>urls</code>
            </td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of YouTube video URLs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_base_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for storing output.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_chunk_duration</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum duration for audio chunks in seconds (default is 10 minutes).</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_S" href="#tnh_scholar.video_processing.yt_transcribe.DEFAULT_CHUNK_DURATION_S">DEFAULT_CHUNK_DURATION_S</a></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/video_processing/yt_transcribe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transcribe_youtube_videos</span><span class="p">(</span>
    <span class="n">urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">output_base_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">max_chunk_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_CHUNK_DURATION_S</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Full pipeline for transcribing a list of YouTube videos.</span>

<span class="sd">    Args:</span>
<span class="sd">        urls (list[str]): List of YouTube video URLs.</span>
<span class="sd">        output_base_dir (Path): Base directory for storing output.</span>
<span class="sd">        max_chunk_duration (int): Maximum duration for audio chunks in seconds (default is 10 minutes).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_base_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing video: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 1: Download audio</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading audio...&quot;</span><span class="p">)</span>
            <span class="n">tmp_audio_file</span> <span class="o">=</span> <span class="n">download_audio_yt</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output_base_dir</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded audio file: </span><span class="si">{</span><span class="n">tmp_audio_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Prepare directories for chunks and outputs</span>
            <span class="n">video_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tmp_audio_file</span><span class="o">.</span><span class="n">stem</span>
            <span class="p">)</span>  <span class="c1"># Use the stem of the audio file (title without extension)</span>
            <span class="n">video_output_dir</span> <span class="o">=</span> <span class="n">output_base_dir</span> <span class="o">/</span> <span class="n">video_name</span>
            <span class="n">chunks_dir</span> <span class="o">=</span> <span class="n">video_output_dir</span> <span class="o">/</span> <span class="s2">&quot;chunks&quot;</span>
            <span class="n">chunks_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Create the video directory and move the audio file into it</span>
            <span class="n">video_output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">audio_file</span> <span class="o">=</span> <span class="n">video_output_dir</span> <span class="o">/</span> <span class="n">tmp_audio_file</span><span class="o">.</span><span class="n">name</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_audio_file</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="n">audio_file</span>
                <span class="p">)</span>  <span class="c1"># Move the audio file to the video directory</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moved audio file to: </span><span class="si">{</span><span class="n">audio_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move audio file to </span><span class="si">{</span><span class="n">video_output_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Ensure the code gracefully handles issues here, reassigning to the original tmp path.</span>
                <span class="n">audio_file</span> <span class="o">=</span> <span class="n">tmp_audio_file</span>

            <span class="c1"># Step 2: Detect boundaries</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detecting boundaries...&quot;</span><span class="p">)</span>
            <span class="n">boundaries</span> <span class="o">=</span> <span class="n">detect_boundaries</span><span class="p">(</span><span class="n">audio_file</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Boundaries generated.&quot;</span><span class="p">)</span>

            <span class="c1"># Step 3: Split audio into chunks</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Splitting audio into chunks...&quot;</span><span class="p">)</span>
            <span class="n">split_audio_at_boundaries</span><span class="p">(</span>
                <span class="n">audio_file</span><span class="o">=</span><span class="n">audio_file</span><span class="p">,</span>
                <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">chunks_dir</span><span class="p">,</span>
                <span class="n">max_duration</span><span class="o">=</span><span class="n">max_chunk_duration</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio chunks saved to: </span><span class="si">{</span><span class="n">chunks_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 4: Transcribe audio chunks</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transcribing audio chunks...&quot;</span><span class="p">)</span>
            <span class="n">transcript_file</span> <span class="o">=</span> <span class="n">video_output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
            <span class="n">jsonl_file</span> <span class="o">=</span> <span class="n">video_output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video_name</span><span class="si">}</span><span class="s2">.jsonl&quot;</span>
            <span class="n">process_audio_chunks</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">chunks_dir</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="n">transcript_file</span><span class="p">,</span>
                <span class="n">jsonl_file</span><span class="o">=</span><span class="n">jsonl_file</span><span class="p">,</span>
                <span class="n">prompt</span><span class="o">=</span><span class="n">DEFAULT_PROMPT</span><span class="p">,</span>
                <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcription completed for </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcript saved to: </span><span class="si">{</span><span class="n">transcript_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raw transcription data saved to: </span><span class="si">{</span><span class="n">jsonl_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process video </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tnh_scholar.xml_processing" class="doc doc-heading">
            <code>xml_processing</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tnh_scholar.xml_processing.FormattingError" class="doc doc-heading">
            <code>FormattingError</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Custom exception raised for formatting-related errors.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FormattingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom exception raised for formatting-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.FormattingError.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;An error occurred due to invalid formatting.&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.xml_processing.join_xml_data_to_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">join_xml_data_to_doc</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Joins a list of XML-tagged data with newlines, wraps it with <document> tags,
and writes it to the specified file. Raises an exception if the file exists
and overwrite is not set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of XML-tagged data strings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite the file if it exists.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileExistsError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file exists and overwrite is False.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the data list is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>join_xml_data_to_doc(Path("output.xml"), ["<tag>Data</tag>"], overwrite=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join_xml_data_to_doc</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Joins a list of XML-tagged data with newlines, wraps it with &lt;document&gt; tags,</span>
<span class="sd">    and writes it to the specified file. Raises an exception if the file exists</span>
<span class="sd">    and overwrite is not set.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path): Path to the output file.</span>
<span class="sd">        data (List[str]): List of XML-tagged data strings.</span>
<span class="sd">        overwrite (bool): Whether to overwrite the file if it exists.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If the file exists and overwrite is False.</span>
<span class="sd">        ValueError: If the data list is empty.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; join_xml_data_to_doc(Path(&quot;output.xml&quot;), [&quot;&lt;tag&gt;Data&lt;/tag&gt;&quot;], overwrite=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> already exists and overwrite is not set.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data list cannot be empty.&quot;</span><span class="p">)</span>

    <span class="c1"># Create the XML content</span>
    <span class="n">joined_data</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Joining data with newline</span>
    <span class="n">xml_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;document&gt;</span><span class="se">\n</span><span class="si">{</span><span class="n">joined_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;/document&gt;&quot;</span>

    <span class="c1"># Write to file</span>
    <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_content</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.xml_processing.remove_page_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_page_tags</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Removes <page ...> and </page> tags from a text string.</p>
<p>Parameters:
- text (str): The input text containing <page> tags.</p>
<p>Returns:
- str: The text with <page> tags removed.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_page_tags</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes &lt;page ...&gt; and &lt;/page&gt; tags from a text string.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - text (str): The input text containing &lt;page&gt; tags.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - str: The text with &lt;page&gt; tags removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove opening &lt;page ...&gt; tags</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;page[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Remove closing &lt;/page&gt; tags</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;/page&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.xml_processing.save_pages_to_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_pages_to_xml</span><span class="p">(</span><span class="n">output_xml_path</span><span class="p">,</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generates and saves an XML file containing text pages, with a <pagebreak> tag indicating the page ends.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_xml_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path object for the file where the XML file will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_pages</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of strings, each representing the text content of a page.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, overwrites the file if it exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input list of text_pages is empty or contains invalid types.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>FileExistsError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file already exists and overwrite is False.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>PermissionError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file cannot be created due to insufficient permissions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>OSError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For other file I/O-related errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_pages_to_xml</span><span class="p">(</span>
    <span class="n">output_xml_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">text_pages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates and saves an XML file containing text pages, with a &lt;pagebreak&gt; tag indicating the page ends.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_xml_path (Path): The Path object for the file where the XML file will be saved.</span>
<span class="sd">        text_pages (List[str]): A list of strings, each representing the text content of a page.</span>
<span class="sd">        overwrite (bool): If True, overwrites the file if it exists. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input list of text_pages is empty or contains invalid types.</span>
<span class="sd">        FileExistsError: If the file already exists and overwrite is False.</span>
<span class="sd">        PermissionError: If the file cannot be created due to insufficient permissions.</span>
<span class="sd">        OSError: For other file I/O-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text_pages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The text_pages list is empty. Cannot generate XML.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the file exists and handle overwrite behavior</span>
    <span class="k">if</span> <span class="n">output_xml_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">&#39; already exists. Set overwrite=True to overwrite.&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure the output directory exists</span>
        <span class="n">output_xml_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Write the XML file</span>
        <span class="k">with</span> <span class="n">output_xml_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">xml_file</span><span class="p">:</span>
            <span class="c1"># Write XML declaration and root element</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;document&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Add each page with its content and &lt;pagebreak&gt; tag</span>
            <span class="k">for</span> <span class="n">page_number</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_pages</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid page content at index </span><span class="si">{</span><span class="n">page_number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: expected a string.&quot;</span>
                    <span class="p">)</span>

                <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">escaped_text</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">escaped_text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &lt;pagebreak page=&#39;</span><span class="si">{</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&#39; /&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Close the root element</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/document&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;XML file successfully saved at </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Permission denied while writing to </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;An OS-related error occurred while saving XML file at </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="tnh_scholar.xml_processing.split_xml_on_pagebreaks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_xml_on_pagebreaks</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">page_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_pagebreaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Splits an XML document into individual pages based on <pagebreak> tags.
Optionally groups pages together based on page_groups and retains <pagebreak> tags if keep_pagebreaks is True.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The XML document as a string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_groups</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tuples defining page ranges to group together.
                                          Each tuple is of the form (start_page, end_page), inclusive.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_pagebreaks</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to retain the <pagebreak> tags in the returned data. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of page contents as strings, either split by pages or grouped by page_groups.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the expected preamble or <document> tags are missing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_xml_on_pagebreaks</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">page_groups</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keep_pagebreaks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits an XML document into individual pages based on &lt;pagebreak&gt; tags.</span>
<span class="sd">    Optionally groups pages together based on page_groups and retains &lt;pagebreak&gt; tags if keep_pagebreaks is True.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        text (str): The XML document as a string.</span>
<span class="sd">        page_groups (Optional[List[Tuple[int, int]]]): A list of tuples defining page ranges to group together.</span>
<span class="sd">                                                      Each tuple is of the form (start_page, end_page), inclusive.</span>
<span class="sd">        keep_pagebreaks (bool): Whether to retain the &lt;pagebreak&gt; tags in the returned data. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of page contents as strings, either split by pages or grouped by page_groups.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the expected preamble or &lt;document&gt; tags are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Split text into lines</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="c1"># Preprocess: Remove `&lt;?xml ... ?&gt;` preamble and &lt;document&gt; tags</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;?xml&quot;</span><span class="p">):</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;?xml ... ?&gt;` preamble on the first line.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&lt;document&gt;&quot;</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;document&gt;` opening tag on the second line.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&lt;/document&gt;&quot;</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;/document&gt;` closing tag on the last line.&quot;</span><span class="p">)</span>

    <span class="c1"># Process content to split pages based on &lt;pagebreak&gt; tags</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_page</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;pagebreak&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Page boundary detected</span>
            <span class="k">if</span> <span class="n">current_page</span><span class="p">:</span>
                <span class="n">page_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">keep_pagebreaks</span><span class="p">:</span>
                    <span class="n">page_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Retain the &lt;pagebreak&gt; tag</span>
                <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_content</span><span class="p">)</span>
                <span class="n">current_page</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Append the last page if it exists</span>
    <span class="k">if</span> <span class="n">current_page</span><span class="p">:</span>
        <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Validate that pages are extracted</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No pages found in the XML content.&quot;</span><span class="p">)</span>

    <span class="c1"># Group pages if page_groups is provided</span>
    <span class="k">if</span> <span class="n">page_groups</span><span class="p">:</span>
        <span class="n">grouped_pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">page_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group_content</span> <span class="o">:=</span> <span class="p">[</span>
                <span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>
            <span class="p">]:</span>
                <span class="n">grouped_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">group_content</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">grouped_pages</span>

    <span class="k">return</span> <span class="n">pages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.xml_processing.extract_tags" class="doc doc-heading">
            <code>extract_tags</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.extract_tags.extract_unique_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_unique_tags</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Extract all unique tags from an XML file using lxml.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xml_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the XML file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>set</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A set of unique tags in the XML document.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/extract_tags.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_unique_tags</span><span class="p">(</span><span class="n">xml_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract all unique tags from an XML file using lxml.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        xml_file (str): Path to the XML file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        set: A set of unique tags in the XML document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse the XML file</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span>

    <span class="c1"># Find all unique tags and return</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.extract_tags.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/extract_tags.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Create argument parser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extract all unique tags from an XML file.&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;xml_file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the XML file.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse command-line arguments</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Extract tags</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">extract_unique_tags</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">xml_file</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique Tags Found:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="tnh_scholar.xml_processing.xml_processing" class="doc doc-heading">
            <code>xml_processing</code>


</h4>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h5 id="tnh_scholar.xml_processing.xml_processing.FormattingError" class="doc doc-heading">
            <code>FormattingError</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Custom exception raised for formatting-related errors.</p>






              <details class="quote">
                <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FormattingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom exception raised for formatting-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h6 id="tnh_scholar.xml_processing.xml_processing.FormattingError.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;An error occurred due to invalid formatting.&#39;</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;An error occurred due to invalid formatting.&quot;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.xml_processing.join_xml_data_to_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">join_xml_data_to_doc</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Joins a list of XML-tagged data with newlines, wraps it with <document> tags,
and writes it to the specified file. Raises an exception if the file exists
and overwrite is not set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of XML-tagged data strings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite the file if it exists.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileExistsError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file exists and overwrite is False.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the data list is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>join_xml_data_to_doc(Path("output.xml"), ["<tag>Data</tag>"], overwrite=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join_xml_data_to_doc</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Joins a list of XML-tagged data with newlines, wraps it with &lt;document&gt; tags,</span>
<span class="sd">    and writes it to the specified file. Raises an exception if the file exists</span>
<span class="sd">    and overwrite is not set.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path): Path to the output file.</span>
<span class="sd">        data (List[str]): List of XML-tagged data strings.</span>
<span class="sd">        overwrite (bool): Whether to overwrite the file if it exists.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If the file exists and overwrite is False.</span>
<span class="sd">        ValueError: If the data list is empty.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; join_xml_data_to_doc(Path(&quot;output.xml&quot;), [&quot;&lt;tag&gt;Data&lt;/tag&gt;&quot;], overwrite=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> already exists and overwrite is not set.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data list cannot be empty.&quot;</span><span class="p">)</span>

    <span class="c1"># Create the XML content</span>
    <span class="n">joined_data</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Joining data with newline</span>
    <span class="n">xml_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;document&gt;</span><span class="se">\n</span><span class="si">{</span><span class="n">joined_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;/document&gt;&quot;</span>

    <span class="c1"># Write to file</span>
    <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_content</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.xml_processing.remove_page_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_page_tags</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Removes <page ...> and </page> tags from a text string.</p>
<p>Parameters:
- text (str): The input text containing <page> tags.</p>
<p>Returns:
- str: The text with <page> tags removed.</p>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_page_tags</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes &lt;page ...&gt; and &lt;/page&gt; tags from a text string.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - text (str): The input text containing &lt;page&gt; tags.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - str: The text with &lt;page&gt; tags removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove opening &lt;page ...&gt; tags</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;page[^&gt;]*&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1"># Remove closing &lt;/page&gt; tags</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;/page&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.xml_processing.save_pages_to_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_pages_to_xml</span><span class="p">(</span><span class="n">output_xml_path</span><span class="p">,</span> <span class="n">text_pages</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generates and saves an XML file containing text pages, with a <pagebreak> tag indicating the page ends.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_xml_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path object for the file where the XML file will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_pages</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of strings, each representing the text content of a page.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, overwrites the file if it exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input list of text_pages is empty or contains invalid types.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>FileExistsError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file already exists and overwrite is False.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>PermissionError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the file cannot be created due to insufficient permissions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>OSError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For other file I/O-related errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_pages_to_xml</span><span class="p">(</span>
    <span class="n">output_xml_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">text_pages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates and saves an XML file containing text pages, with a &lt;pagebreak&gt; tag indicating the page ends.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_xml_path (Path): The Path object for the file where the XML file will be saved.</span>
<span class="sd">        text_pages (List[str]): A list of strings, each representing the text content of a page.</span>
<span class="sd">        overwrite (bool): If True, overwrites the file if it exists. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input list of text_pages is empty or contains invalid types.</span>
<span class="sd">        FileExistsError: If the file already exists and overwrite is False.</span>
<span class="sd">        PermissionError: If the file cannot be created due to insufficient permissions.</span>
<span class="sd">        OSError: For other file I/O-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text_pages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The text_pages list is empty. Cannot generate XML.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the file exists and handle overwrite behavior</span>
    <span class="k">if</span> <span class="n">output_xml_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file &#39;</span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">&#39; already exists. Set overwrite=True to overwrite.&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure the output directory exists</span>
        <span class="n">output_xml_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Write the XML file</span>
        <span class="k">with</span> <span class="n">output_xml_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">xml_file</span><span class="p">:</span>
            <span class="c1"># Write XML declaration and root element</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;document&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Add each page with its content and &lt;pagebreak&gt; tag</span>
            <span class="k">for</span> <span class="n">page_number</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_pages</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid page content at index </span><span class="si">{</span><span class="n">page_number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: expected a string.&quot;</span>
                    <span class="p">)</span>

                <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">escaped_text</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">escaped_text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &lt;pagebreak page=&#39;</span><span class="si">{</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&#39; /&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Close the root element</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/document&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;XML file successfully saved at </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Permission denied while writing to </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;An OS-related error occurred while saving XML file at </span><span class="si">{</span><span class="n">output_xml_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="tnh_scholar.xml_processing.xml_processing.split_xml_on_pagebreaks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_xml_on_pagebreaks</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">page_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_pagebreaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Splits an XML document into individual pages based on <pagebreak> tags.
Optionally groups pages together based on page_groups and retains <pagebreak> tags if keep_pagebreaks is True.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The XML document as a string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_groups</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tuples defining page ranges to group together.
                                          Each tuple is of the form (start_page, end_page), inclusive.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_pagebreaks</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to retain the <pagebreak> tags in the returned data. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of page contents as strings, either split by pages or grouped by page_groups.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the expected preamble or <document> tags are missing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/tnh_scholar/xml_processing/xml_processing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_xml_on_pagebreaks</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">page_groups</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keep_pagebreaks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits an XML document into individual pages based on &lt;pagebreak&gt; tags.</span>
<span class="sd">    Optionally groups pages together based on page_groups and retains &lt;pagebreak&gt; tags if keep_pagebreaks is True.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        text (str): The XML document as a string.</span>
<span class="sd">        page_groups (Optional[List[Tuple[int, int]]]): A list of tuples defining page ranges to group together.</span>
<span class="sd">                                                      Each tuple is of the form (start_page, end_page), inclusive.</span>
<span class="sd">        keep_pagebreaks (bool): Whether to retain the &lt;pagebreak&gt; tags in the returned data. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of page contents as strings, either split by pages or grouped by page_groups.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the expected preamble or &lt;document&gt; tags are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Split text into lines</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="c1"># Preprocess: Remove `&lt;?xml ... ?&gt;` preamble and &lt;document&gt; tags</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;?xml&quot;</span><span class="p">):</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;?xml ... ?&gt;` preamble on the first line.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&lt;document&gt;&quot;</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;document&gt;` opening tag on the second line.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&lt;/document&gt;&quot;</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing `&lt;/document&gt;` closing tag on the last line.&quot;</span><span class="p">)</span>

    <span class="c1"># Process content to split pages based on &lt;pagebreak&gt; tags</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_page</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&lt;pagebreak&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Page boundary detected</span>
            <span class="k">if</span> <span class="n">current_page</span><span class="p">:</span>
                <span class="n">page_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">keep_pagebreaks</span><span class="p">:</span>
                    <span class="n">page_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Retain the &lt;pagebreak&gt; tag</span>
                <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_content</span><span class="p">)</span>
                <span class="n">current_page</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Append the last page if it exists</span>
    <span class="k">if</span> <span class="n">current_page</span><span class="p">:</span>
        <span class="n">pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Validate that pages are extracted</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No pages found in the XML content.&quot;</span><span class="p">)</span>

    <span class="c1"># Group pages if page_groups is provided</span>
    <span class="k">if</span> <span class="n">page_groups</span><span class="p">:</span>
        <span class="n">grouped_pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">page_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group_content</span> <span class="o">:=</span> <span class="p">[</span>
                <span class="n">pages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>
            <span class="p">]:</span>
                <span class="n">grouped_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">group_content</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">grouped_pages</span>

    <span class="k">return</span> <span class="n">pages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>