
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Specification for a reusable package version checking utility with flexible strategies and clear reporting.">
      
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Package Version Checker Design Document - TNH Scholar Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#package-version-checker-design-document" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="TNH Scholar Documentation" class="md-header__button md-logo" aria-label="TNH Scholar Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TNH Scholar Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Package Version Checker Design Document
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aaronksolomon/tnh-scholar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="TNH Scholar Documentation" class="md-nav__button md-logo" aria-label="TNH Scholar Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TNH Scholar Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aaronksolomon/tnh-scholar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/quick-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pattern System
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/best-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            CLI Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/tnh-fab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tnh-fab
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/audio-transcribe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    audio-transcribe
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/ytt-fetch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ytt-fetch
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/nfmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nfmt
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/token-count/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    token-count
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/tnh-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tnh-setup
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../development/system-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Overview
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../development/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Design
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../development/design-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Guide
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" >
        
          
          <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLI Design
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_2">
            <span class="md-nav__icon md-icon"></span>
            CLI Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_6_3_2_1" id="__nav_6_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TNH-FAB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            TNH-FAB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tnh-fab/design/text-processing-cli-design-v1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tnh-fab/design/text-processing-cli-design-v2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v2
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_6_3_2_2" id="__nav_6_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    YTT-Fetch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            YTT-Fetch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ytt-fetch/adr/adr-yf00-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  
    
  
  
    <span class="md-status md-status--historical"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ytt-fetch/adr/adr-yf01-transcript-source-handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transcript Source
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ytt-fetch/adr/adr-yf02-yt-dlp-transcripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YT-DLP Integration
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ytt-fetch/design/yt-dlp-vs-youtube-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Comparison
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup-tnh/design/setup-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SETUP-TNH
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs-design/design/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docs-Design
  </span>
  
    
  
  
    <span class="md-status md-status--processing"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_2" >
        
          
          <label class="md-nav__link" for="__nav_6_4_2" id="__nav_6_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Docs-Planning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4_2">
            <span class="md-nav__icon md-icon"></span>
            Docs-Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs-design/planning/roadmap.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs-design/planning/maintenance.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Research
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../gpt_4o_search_query_text_pair_testing/testing_input_output.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../gpt_4o_translations_experiments/passage_test.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../translation_research.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translation Research
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../preliminary_feasibility_study.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feasibility Study
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    <span class="md-ellipsis">
      Goals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design" class="md-nav__link">
    <span class="md-ellipsis">
      Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Key Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-packageversionchecker" class="md-nav__link">
    <span class="md-ellipsis">
      1. PackageVersionChecker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-versioncheckerconfig" class="md-nav__link">
    <span class="md-ellipsis">
      2. VersionCheckerConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-result" class="md-nav__link">
    <span class="md-ellipsis">
      3. Result
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Phases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Phases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-core-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Core Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-enhanced-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: Enhanced Functionality
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-cli-and-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: CLI and Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Module Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Version Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Version Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Caching Mechanism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-whisper-service" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Whisper Service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Command-line Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensibility" class="md-nav__link">
    <span class="md-ellipsis">
      Extensibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Enhancements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="package-version-checker-design-document">Package Version Checker Design Document</h1>
<p>Specification for a reusable package version checking utility with flexible strategies and clear reporting.</p>
<h2 id="overview">Overview</h2>
<p>This document outlines the design for a robust, reusable package version checking utility that can verify versions for any Python package against minimum requirements, latest versions, or specific version constraints.</p>
<p>The utility provides a simple, flexible API for checking package versions with configurable behavior for different compatibility requirements. It's designed to support both simple version checks and sophisticated version difference monitoring.</p>
<h2 id="context">Context</h2>
<p>Modern Python applications often depend on rapidly evolving libraries. Ensuring compatibility with these dependencies requires monitoring version differences and enforcing version requirements. This is especially important for libraries with frequent updates and API changes, such as OpenAI's client libraries.</p>
<p>Existing approaches often lack flexibility in defining what constitutes a "compatible" version, particularly when dealing with semantic versioning differences at various levels (major, minor, patch).</p>
<h2 id="goals">Goals</h2>
<ul>
<li>Create a modular, extensible version checking system that works with any Python package</li>
<li>Provide both programmatic and CLI interfaces</li>
<li>Support multiple checking strategies (minimum version, exact version, version range)</li>
<li>Include robust error handling with configurable failure modes</li>
<li>Maintain clean separation of concerns</li>
<li>Support caching to minimize network requests</li>
<li>Provide clear, actionable feedback to users</li>
<li>Allow fine-grained control over version difference thresholds</li>
</ul>
<h2 id="design">Design</h2>
<h3 id="core-components">Core Components</h3>
<pre><code class="language-mermaid">classDiagram
    class PackageVersionChecker {
        +check_version(package_name, config) Result
    }

    class VersionCheckerConfig {
        +fail_on_error: bool
        +cache_duration: int
        +network_timeout: int
        +strategy: VersionStrategy
        +requirement: str
    }

    class VersionStrategy {
        &lt;&lt;enumeration&gt;&gt;
        MINIMUM
        EXACT
        LATEST
        RANGE
        VERSION_DIFF
    }

    class PackageInfo {
        +name: str
        +installed_version: Version
        +required_version: Version
        +latest_version: Version
    }

    class Result {
        +is_compatible: bool
        +needs_update: bool
        +package_info: PackageInfo
        +error: Optional[str]
        +get_upgrade_command() str
    }

    class VersionProvider {
        &lt;&lt;interface&gt;&gt;
        +get_installed_version(package_name) Version
        +get_latest_version(package_name) Version
    }

    class StandardVersionProvider {
        +get_installed_version(package_name) Version
        +get_latest_version(package_name) Version
    }

    class VersionCache {
        +get(package_name) CachedVersion
        +set(package_name, version) None
        +is_valid(package_name) bool
    }

    PackageVersionChecker --&gt; VersionCheckerConfig : uses
    PackageVersionChecker --&gt; VersionProvider : uses
    PackageVersionChecker --&gt; Result : produces
    Result *-- PackageInfo
    VersionCheckerConfig *-- VersionStrategy
    VersionProvider &lt;|-- StandardVersionProvider
    StandardVersionProvider --&gt; VersionCache : uses
</code></pre>
<h3 id="key-classes">Key Classes</h3>
<h4 id="1-packageversionchecker">1. <code>PackageVersionChecker</code></h4>
<p>The main entry point for version checking functionality:</p>
<pre><code class="language-python">class PackageVersionChecker:
    def __init__(self, 
                 provider: Optional[VersionProvider] = None,
                 cache: Optional[VersionCache] = None):
        self.provider = provider or StandardVersionProvider()
        self.cache = cache or VersionCache()

    def check_version(self, 
                      package_name: str, 
                      config: Optional[VersionCheckerConfig] = None) -&gt; Result:
        &quot;&quot;&quot;Check if package meets version requirements based on config.&quot;&quot;&quot;
        # Implementation
</code></pre>
<h4 id="2-versioncheckerconfig">2. <code>VersionCheckerConfig</code></h4>
<p>Configuration for version checking behavior:</p>
<pre><code class="language-python">class VersionCheckerConfig:
    def __init__(self,
                 strategy: VersionStrategy = VersionStrategy.MINIMUM,
                 requirement: str = &quot;&quot;,
                 fail_on_error: bool = False,
                 cache_duration: int = 3600,  # 1 hour
                 network_timeout: int = 5,    # seconds
                 vdiff_warn_matrix: Optional[str] = None,
                 vdiff_fail_matrix: Optional[str] = None):
        &quot;&quot;&quot;
        Initialize version checker configuration.

        Args:
            strategy: Version checking strategy to use
            requirement: Version requirement string (for MINIMUM, EXACT, RANGE strategies)
            fail_on_error: Whether to raise exceptions on errors
            cache_duration: How long to cache PyPI results in seconds
            network_timeout: Network request timeout in seconds
            vdiff_warn_matrix: Version difference matrix for warnings [major.minor.micro]
                               Use * for any/infinity, e.g. &quot;1.5.*&quot; 
            vdiff_fail_matrix: Version difference matrix for failures [major.minor.micro]
                               Use * for any/infinity, e.g. &quot;0.20.*&quot;
        &quot;&quot;&quot;
        self.strategy = strategy
        self.requirement = requirement
        self.fail_on_error = fail_on_error
        self.cache_duration = cache_duration
        self.network_timeout = network_timeout

        # Version difference matrices
        self.vdiff_warn_matrix = vdiff_warn_matrix
        self.vdiff_fail_matrix = vdiff_fail_matrix

    def parse_vdiff_matrix(self, matrix_str: Optional[str]) -&gt; Tuple[Optional[int], Optional[int], Optional[int]]:
        &quot;&quot;&quot;
        Parse a version difference matrix string into component thresholds.

        Args:
            matrix_str: String in format &quot;major.minor.micro&quot; where each component
                       is either a number or * for infinity

        Returns:
            Tuple of (major_diff, minor_diff, micro_diff) thresholds

        Examples:
            &quot;1.5.*&quot; -&gt; (1, 5, None)  # Major diff &gt; 1 or minor diff &gt; 5, ignore micro
            &quot;0.0.0&quot; -&gt; (0, 0, 0)     # Any difference triggers
            &quot;*.*.*&quot; -&gt; (None, None, None)  # No difference triggers
        &quot;&quot;&quot;
        if not matrix_str:
            return None, None, None

        parts = matrix_str.split(&quot;.&quot;)
        if len(parts) != 3:
            raise ValueError(f&quot;Invalid version difference matrix: {matrix_str}. &quot;
                            f&quot;Format should be 'major.minor.micro'&quot;)

        thresholds = []
        for part in parts:
            if part == &quot;*&quot;:
                thresholds.append(None)  # None represents infinity/any
            else:
                try:
                    thresholds.append(int(part))
                except ValueError:
                    raise ValueError(f&quot;Invalid version component in matrix: {part}. &quot;
                                    f&quot;Must be a number or *&quot;)

        return tuple(thresholds)  # type: Tuple[Optional[int], Optional[int], Optional[int]]
</code></pre>
<h4 id="3-result">3. <code>Result</code></h4>
<p>Structured result of version check operations:</p>
<pre><code class="language-python">class Result:
    def __init__(self,
                 is_compatible: bool,
                 needs_update: bool,
                 package_info: PackageInfo,
                 error: Optional[str] = None,
                 warning_level: Optional[str] = None,
                 diff_details: Optional[Dict[str, int]] = None):
        self.is_compatible = is_compatible
        self.needs_update = needs_update
        self.package_info = package_info
        self.error = error
        self.warning_level = warning_level  # e.g., &quot;MAJOR&quot;, &quot;MINOR&quot;, &quot;MICRO&quot;
        self.diff_details = diff_details    # e.g., {&quot;major&quot;: 1, &quot;minor&quot;: 5}

    def get_upgrade_command(self) -&gt; str:
        &quot;&quot;&quot;Return pip command to upgrade package.&quot;&quot;&quot;
        # Implementation
</code></pre>
<h3 id="implementation-phases">Implementation Phases</h3>
<h4 id="phase-1-core-implementation">Phase 1: Core Implementation</h4>
<ol>
<li>Define all interfaces and data classes</li>
<li>Implement <code>StandardVersionProvider</code> (using importlib.metadata and PyPI API)</li>
<li>Implement basic caching mechanism</li>
<li>Implement core <code>PackageVersionChecker</code> functionality</li>
<li>Add support for minimum version strategy</li>
</ol>
<h4 id="phase-2-enhanced-functionality">Phase 2: Enhanced Functionality</h4>
<ol>
<li>Add support for all version strategies</li>
<li>Implement robust error handling</li>
<li>Add configurable logging</li>
<li>Implement cache invalidation</li>
<li>Add utility functions for common use cases</li>
</ol>
<h4 id="phase-3-cli-and-integration">Phase 3: CLI and Integration</h4>
<ol>
<li>Create CLI interface</li>
<li>Add support for requirements.txt parsing</li>
<li>Implement environment-aware version checking</li>
<li>Add documentation and examples</li>
<li>Create integration tests</li>
</ol>
<h2 id="implementation-plan">Implementation Plan</h2>
<h3 id="module-structure">Module Structure</h3>
<pre><code>src/tnh_scholar/utils/
├── version_check/
│   ├── __init__.py
│   ├── checker.py       # Main PackageVersionChecker class
│   ├── config.py        # Configuration classes
│   ├── providers.py     # Version provider implementations  
│   ├── cache.py         # Caching mechanisms
│   ├── models.py        # Data models (Result, PackageInfo)
│   ├── strategies.py    # Version comparison strategies
│   └── cli.py           # Command-line interface
└── __init__.py
</code></pre>
<h3 id="implementation-details">Implementation Details</h3>
<h4 id="version-retrieval">Version Retrieval</h4>
<p>We'll build on the existing implementation, but make it more generic:</p>
<pre><code class="language-python">def get_installed_version(package_name: str) -&gt; Version:
    &quot;&quot;&quot;Get installed package version.&quot;&quot;&quot;
    try:
        if version_str := str(importlib.metadata.version(package_name)):
            return Version(version_str)
        else:
            raise InvalidVersion(f&quot;{package_name} version string is empty&quot;)
    except importlib.metadata.PackageNotFoundError as e:
        raise ImportError(f&quot;{package_name} is not installed&quot;) from e
    except InvalidVersion as e:
        raise InvalidVersion(f&quot;Invalid version for {package_name}: {e}&quot;) from e
</code></pre>
<h4 id="version-comparison">Version Comparison</h4>
<p>Version strategies will use comparison operators from <code>packaging.version</code>:</p>
<pre><code class="language-python">def check_minimum_version(installed: Version, 
                         required: Version) -&gt; bool:
    &quot;&quot;&quot;Check if installed version meets minimum requirement.&quot;&quot;&quot;
    return installed &gt;= required

def check_compatible_version(installed: Version, 
                           required: Version) -&gt; bool:
    &quot;&quot;&quot;Check if installed version is compatible with requirement.&quot;&quot;&quot;
    # Example: versions like 2.1.x are compatible with 2.1.0
    return (installed.major == required.major and 
            installed.minor == required.minor and
            installed.micro &gt;= required.micro)

def check_version_diff(installed: Version,
                      reference: Version,
                      vdiff_matrix: Optional[str] = None) -&gt; Tuple[bool, Dict[str, int]]:
    &quot;&quot;&quot;
    Check if version difference is within specified limits.

    Args:
        installed: The installed version
        reference: The reference version to compare against (typically latest)
        vdiff_matrix: Version difference matrix string in format &quot;major.minor.micro&quot;

    Returns:
        Tuple of (is_within_limits, diff_details)
        where diff_details is a dict with actual differences
    &quot;&quot;&quot;
    # Calculate actual differences
    major_diff = abs(reference.major - installed.major)
    minor_diff = abs(reference.minor - installed.minor) if reference.major == installed.major else 0
    micro_diff = abs(reference.micro - installed.micro) if (reference.major == installed.major and 
                                                            reference.minor == installed.minor) else 0

    diff_details = {
        &quot;major&quot;: major_diff,
        &quot;minor&quot;: minor_diff,
        &quot;micro&quot;: micro_diff
    }

    # If no matrix provided, differences are acceptable
    if not vdiff_matrix:
        return True, diff_details

    # Parse matrix
    major_limit, minor_limit, micro_limit = parse_vdiff_matrix(vdiff_matrix)

    # Check limits (None means no limit)
    if major_limit is not None and major_diff &gt; major_limit:
        return False, diff_details

    if minor_limit is not None and minor_diff &gt; minor_limit:
        return False, diff_details

    if micro_limit is not None and micro_diff &gt; micro_limit:
        return False, diff_details

    return True, diff_details

def parse_vdiff_matrix(matrix_str: str) -&gt; Tuple[Optional[int], Optional[int], Optional[int]]:
    &quot;&quot;&quot;
    Parse a version difference matrix string.

    Args:
        matrix_str: String in format &quot;major.minor.micro&quot;

    Returns:
        Tuple of (major_limit, minor_limit, micro_limit)
        where None represents no limit
    &quot;&quot;&quot;
    parts = matrix_str.split(&quot;.&quot;)
    if len(parts) != 3:
        raise ValueError(f&quot;Invalid version difference matrix: {matrix_str}&quot;)

    limits = []
    for part in parts:
        if part == &quot;*&quot;:
            limits.append(None)  # No limit
        else:
            try:
                limits.append(int(part))
            except ValueError:
                raise ValueError(f&quot;Invalid version component: {part}&quot;)

    return tuple(limits)  # type: Tuple[Optional[int], Optional[int], Optional[int]]
</code></pre>
<h4 id="caching-mechanism">Caching Mechanism</h4>
<p>Simple time-based caching for PyPI results:</p>
<pre><code class="language-python">class VersionCache:
    def __init__(self, cache_duration: int = 3600):
        self.cache = {}
        self.timestamps = {}
        self.cache_duration = cache_duration

    def get(self, key: str) -&gt; Optional[Version]:
        &quot;&quot;&quot;Get cached version if still valid.&quot;&quot;&quot;
        if not self.is_valid(key):
            return None
        return self.cache.get(key)

    def set(self, key: str, value: Version) -&gt; None:
        &quot;&quot;&quot;Cache version with current timestamp.&quot;&quot;&quot;
        self.cache[key] = value
        self.timestamps[key] = time.time()

    def is_valid(self, key: str) -&gt; bool:
        &quot;&quot;&quot;Check if cached value is still valid.&quot;&quot;&quot;
        if key not in self.timestamps:
            return False
        age = time.time() - self.timestamps[key]
        return age &lt; self.cache_duration
</code></pre>
<h4 id="error-handling">Error Handling</h4>
<p>Robust error handling with configurable behavior:</p>
<pre><code class="language-python">def handle_error(error: Exception, 
                config: VersionCheckerConfig, 
                package_name: str) -&gt; Result:
    &quot;&quot;&quot;Handle errors based on configuration.&quot;&quot;&quot;
    error_message = str(error)
    logger.error(f&quot;Error checking {package_name} version: {error_message}&quot;)

    if config.fail_on_error:
        raise error

    return Result(
        is_compatible=False,
        needs_update=False,
        package_info=PackageInfo(name=package_name),
        error=error_message
    )
</code></pre>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="language-python">from tnh_scholar.utils.version_check import PackageVersionChecker, VersionCheckerConfig, VersionStrategy

# Check if package meets minimum version
checker = PackageVersionChecker()
result = checker.check_version(
    &quot;openai&quot;, 
    VersionCheckerConfig(
        strategy=VersionStrategy.MINIMUM,
        requirement=&quot;1.70.0&quot;
    )
)

if not result.is_compatible:
    print(f&quot;openai package version {result.package_info.installed_version} &quot; 
          f&quot;does not meet minimum requirement {result.package_info.required_version}&quot;)
    print(f&quot;Upgrade with: {result.get_upgrade_command()}&quot;)
</code></pre>
<h3 id="integration-with-whisper-service">Integration with Whisper Service</h3>
<pre><code class="language-python">def __init__(self, api_key: Optional[str] = None, **config_options):
    # Check OpenAI package version
    checker = PackageVersionChecker()
    result = checker.check_version(
        &quot;openai&quot;,
        VersionCheckerConfig(
            strategy=VersionStrategy.MINIMUM,
            requirement=&quot;1.70.0&quot;,
            fail_on_error=False
        )
    )

    if not result.is_compatible:
        logger.warning(
            f&quot;OpenAI package version {result.package_info.installed_version} &quot;
            f&quot;is older than required version {result.package_info.required_version}. &quot;
            f&quot;Some features may not work as expected. &quot;
            f&quot;Please upgrade using: {result.get_upgrade_command()}&quot;
        )

    # Continue with initialization
    self.config = WhisperConfig()
    # ...
</code></pre>
<h2 id="command-line-interface">Command-line Interface</h2>
<pre><code>usage: version-check [-h] [--min MIN_VERSION] [--exact EXACT_VERSION] 
                     [--vdiff-warn VDIFF_WARN_MATRIX]
                     [--vdiff-fail VDIFF_FAIL_MATRIX]
                     [--fail-on-error] [--timeout TIMEOUT] [--no-cache]
                     PACKAGE_NAME

Check if a Python package meets version requirements.

positional arguments:
  PACKAGE_NAME          Name of the package to check

optional arguments:
  -h, --help            show this help message and exit
  --min MIN_VERSION     Minimum required version
  --exact EXACT_VERSION Exact required version
  --vdiff-warn VDIFF_WARN_MATRIX
                        Version difference matrix for warnings in format major.minor.micro
                        Use * for any/infinity, e.g. &quot;1.5.*&quot;
  --vdiff-fail VDIFF_FAIL_MATRIX
                        Version difference matrix for failures in format major.minor.micro
                        Use * for any/infinity, e.g. &quot;0.20.*&quot;
  --fail-on-error       Exit with error code on version mismatch
  --timeout TIMEOUT     Network timeout in seconds
  --no-cache            Bypass cache and check PyPI directly
</code></pre>
<h2 id="implementation-examples">Implementation Examples</h2>
<p>Here's a simplified sketch of the key implementation components:</p>
<pre><code class="language-python">def check_version(
    package_name: str, 
    config: VersionCheckerConfig
) -&gt; Result:
    &quot;&quot;&quot;Main version checking function.&quot;&quot;&quot;
    try:
        installed = get_installed_version(package_name)
        latest = get_latest_version(package_name, config.network_timeout)

        # Determine compatibility based on strategy
        is_compatible = True
        needs_update = False
        warning_level = None
        diff_details = None

        if config.strategy == VersionStrategy.MINIMUM:
            required = Version(config.requirement)
            is_compatible = installed &gt;= required
            needs_update = installed &lt; latest

        elif config.strategy == VersionStrategy.EXACT:
            required = Version(config.requirement)
            is_compatible = installed == required
            needs_update = installed != required

        elif config.strategy == VersionStrategy.VERSION_DIFF:
            # Check warning threshold
            if config.vdiff_warn_matrix:
                warn_within_limits, diff_details = check_version_diff(
                    installed, latest, config.vdiff_warn_matrix)
                if not warn_within_limits:
                    warning_level = determine_warning_level(diff_details)

            # Check failure threshold
            if config.vdiff_fail_matrix:
                fail_within_limits, diff_details = check_version_diff(
                    installed, latest, config.vdiff_fail_matrix)
                is_compatible = fail_within_limits

            needs_update = installed &lt; latest

        # Create package info
        package_info = PackageInfo(
            name=package_name,
            installed_version=str(installed),
            latest_version=str(latest),
            required_version=config.requirement if hasattr(config, 'requirement') else None
        )

        # Create and return result
        return Result(
            is_compatible=is_compatible,
            needs_update=needs_update,
            package_info=package_info,
            warning_level=warning_level,
            diff_details=diff_details
        )

    except Exception as e:
        # Handle errors based on configuration
        if config.fail_on_error:
            raise
        return Result(
            is_compatible=False,
            needs_update=False,
            package_info=PackageInfo(name=package_name),
            error=str(e)
        )
</code></pre>
<h2 id="extensibility">Extensibility</h2>
<p>The design supports these extension points:</p>
<ol>
<li>
<p><strong>New Version Strategies</strong>: Adding new comparison strategies is as simple as extending the <code>VersionStrategy</code> enum and implementing the corresponding check in the <code>check_version</code> method.</p>
</li>
<li>
<p><strong>Custom Version Providers</strong>: The separation of version retrieval logic allows for swapping in alternative providers for handling private repositories, alternate package indexes, or specialized version parsing.</p>
</li>
<li>
<p><strong>Advanced Caching</strong>: The caching system can be extended to provide persistent caching, environment-aware caching, or more sophisticated invalidation strategies.</p>
</li>
<li>
<p><strong>Result Processing</strong>: The detailed <code>Result</code> object can be used to generate different types of reports, integrate with monitoring systems, or enforce custom policies.</p>
</li>
</ol>
<h2 id="future-enhancements">Future Enhancements</h2>
<ul>
<li>Support for version ranges with upper bounds</li>
<li>Integration with virtual environment detection</li>
<li>Cache persistence across runs</li>
<li>Support for private PyPI repositories</li>
<li>Batch checking of multiple packages</li>
<li>Integration with dependency resolution</li>
<li>Support for pre-release versions</li>
<li>More sophisticated version difference metrics (e.g., weighted differences)</li>
<li>Configurable version comparison for non-semver packages</li>
<li>Support for checking against specific release channels (stable, beta, etc.)</li>
<li>Integration with package security advisories</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>This version checking utility will provide a robust, flexible solution for ensuring package compatibility across the TNH Scholar project. By building on the existing YTDVersionChecker implementation but making it more generic and configurable, it will help prevent runtime errors and improve user experience.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>